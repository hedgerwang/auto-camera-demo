<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no,viewport-fit=cover,maximum-scale=1,user-scalable=no"><meta name="theme-color" content="#000000"/><meta name="description" content="Web site created using create-react-app"/><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><title>Camera App DEMO</title><script></script><link /></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"></div></body></html>

<script>

/*! For license information please see main.3d484234.js.LICENSE.txt */
!function(){var e={741:function(e){function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=741,e.exports=t},295:function(e,t,n){var r;e=n.nmd(e),function(){"use strict";function t(e,t){var n,r=Object.keys(t);for(n=0;n<r.length;n++)e=e.replace(new RegExp("\\{"+r[n]+"\\}","gi"),t[r[n]]);return e}function n(e){var t,n,r;if(!e)throw new Error("cannot create a random attribute name for an undefined object");t="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="";do{for(n="",r=0;r<12;r++)n+=t[Math.floor(Math.random()*t.length)]}while(e[n]);return n}function r(e){var t={left:"start",right:"end",center:"middle",start:"start",end:"end"};return t[e]||t.start}function a(e){var t={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"};return t[e]||t.alphabetic}var i,o,s,u,c;c=function(e,t){var n,r,a,i={};for(e=e.split(","),t=t||10,n=0;n<e.length;n+=2)r="&"+e[n+1]+";",a=parseInt(e[n],t),i[r]="&#"+a+";";return i["\\xa0"]="&#160;",i}("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),i={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},s=function(e,t){this.__root=e,this.__ctx=t},s.prototype.addColorStop=function(e,n){var r,a=this.__ctx.__createElement("stop");a.setAttribute("offset",e),-1!==n.indexOf("rgba")?(r=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(n),a.setAttribute("stop-color",t("rgb({r},{g},{b})",{r:r[1],g:r[2],b:r[3]})),a.setAttribute("stop-opacity",r[4])):a.setAttribute("stop-color",n),this.__root.appendChild(a)},u=function(e,t){this.__root=e,this.__ctx=t},o=function(e){var t,n={width:500,height:500,enableMirroring:!1};if(arguments.length>1?((t=n).width=arguments[0],t.height=arguments[1]):t=e||n,!(this instanceof o))return new o(t);this.width=t.width||n.width,this.height=t.height||n.height,this.enableMirroring=void 0!==t.enableMirroring?t.enableMirroring:n.enableMirroring,this.canvas=this,this.__document=t.document||document,t.ctx?this.__ctx=t.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)},o.prototype.__createElement=function(e,t,n){void 0===t&&(t={});var r,a,i=this.__document.createElementNS("http://www.w3.org/2000/svg",e),o=Object.keys(t);for(n&&(i.setAttribute("fill","none"),i.setAttribute("stroke","none")),r=0;r<o.length;r++)a=o[r],i.setAttribute(a,t[a]);return i},o.prototype.__setDefaultStyles=function(){var e,t,n=Object.keys(i);for(e=0;e<n.length;e++)this[t=n[e]]=i[t].canvas},o.prototype.__applyStyleState=function(e){var t,n,r=Object.keys(e);for(t=0;t<r.length;t++)this[n=r[t]]=e[n]},o.prototype.__getStyleState=function(){var e,t,n={},r=Object.keys(i);for(e=0;e<r.length;e++)n[t=r[e]]=this[t];return n},o.prototype.__applyStyleToCurrentElement=function(e){var n=this.__currentElement,r=this.__currentElementsToStyle;r&&(n.setAttribute(e,""),n=r.element,r.children.forEach((function(t){t.setAttribute(e,"")})));var a,o,c,l,p,d=Object.keys(i);for(a=0;a<d.length;a++)if(o=i[d[a]],c=this[d[a]],o.apply)if(c instanceof u){if(c.__ctx)for(;c.__ctx.__defs.childNodes.length;)l=c.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[l]=l,this.__defs.appendChild(c.__ctx.__defs.childNodes[0]);n.setAttribute(o.apply,t("url(#{id})",{id:c.__root.getAttribute("id")}))}else if(c instanceof s)n.setAttribute(o.apply,t("url(#{id})",{id:c.__root.getAttribute("id")}));else if(-1!==o.apply.indexOf(e)&&o.svg!==c)if("stroke"!==o.svgAttr&&"fill"!==o.svgAttr||-1===c.indexOf("rgba")){var f=o.svgAttr;if("globalAlpha"===d[a]&&(f=e+"-"+o.svgAttr,n.getAttribute(f)))continue;n.setAttribute(f,c)}else{p=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(c),n.setAttribute(o.svgAttr,t("rgb({r},{g},{b})",{r:p[1],g:p[2],b:p[3]}));var h=p[4],m=this.globalAlpha;null!=m&&(h*=m),n.setAttribute(o.svgAttr+"-opacity",h)}},o.prototype.__closestGroupOrSvg=function(e){return"g"===(e=e||this.__currentElement).nodeName||"svg"===e.nodeName?e:this.__closestGroupOrSvg(e.parentNode)},o.prototype.getSerializedSvg=function(e){var t,n,r,a,i,o=(new XMLSerializer).serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(o)&&(o=o.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),e)for(t=Object.keys(c),n=0;n<t.length;n++)r=t[n],a=c[r],(i=new RegExp(r,"gi")).test(o)&&(o=o.replace(i,a));return o},o.prototype.getSvg=function(){return this.__root},o.prototype.save=function(){var e=this.__createElement("g"),t=this.__closestGroupOrSvg();this.__groupStack.push(t),t.appendChild(e),this.__currentElement=e,this.__stack.push(this.__getStyleState())},o.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var e=this.__stack.pop();this.__applyStyleState(e)},o.prototype.__addTransform=function(e){var t=this.__closestGroupOrSvg();if(t.childNodes.length>0){"path"===this.__currentElement.nodeName&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:t,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var n=this.__createElement("g");t.appendChild(n),this.__currentElement=n}var r=this.__currentElement.getAttribute("transform");r?r+=" ":r="",r+=e,this.__currentElement.setAttribute("transform",r)},o.prototype.scale=function(e,n){void 0===n&&(n=e),this.__addTransform(t("scale({x},{y})",{x:e,y:n}))},o.prototype.rotate=function(e){var n=180*e/Math.PI;this.__addTransform(t("rotate({angle},{cx},{cy})",{angle:n,cx:0,cy:0}))},o.prototype.translate=function(e,n){this.__addTransform(t("translate({x},{y})",{x:e,y:n}))},o.prototype.transform=function(e,n,r,a,i,o){this.__addTransform(t("matrix({a},{b},{c},{d},{e},{f})",{a:e,b:n,c:r,d:a,e:i,f:o}))},o.prototype.beginPath=function(){var e;this.__currentDefaultPath="",this.__currentPosition={},e=this.__createElement("path",{},!0),this.__closestGroupOrSvg().appendChild(e),this.__currentElement=e},o.prototype.__applyCurrentDefaultPath=function(){var e=this.__currentElement;"path"===e.nodeName?e.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",e.nodeName)},o.prototype.__addPathCommand=function(e){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=e},o.prototype.moveTo=function(e,n){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.__currentPosition={x:e,y:n},this.__addPathCommand(t("M {x} {y}",{x:e,y:n}))},o.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},o.prototype.lineTo=function(e,n){this.__currentPosition={x:e,y:n},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(t("L {x} {y}",{x:e,y:n})):this.__addPathCommand(t("M {x} {y}",{x:e,y:n}))},o.prototype.bezierCurveTo=function(e,n,r,a,i,o){this.__currentPosition={x:i,y:o},this.__addPathCommand(t("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:e,cp1y:n,cp2x:r,cp2y:a,x:i,y:o}))},o.prototype.quadraticCurveTo=function(e,n,r,a){this.__currentPosition={x:r,y:a},this.__addPathCommand(t("Q {cpx} {cpy} {x} {y}",{cpx:e,cpy:n,x:r,y:a}))};var l=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]};o.prototype.arcTo=function(e,t,n,r,a){var i=this.__currentPosition&&this.__currentPosition.x,o=this.__currentPosition&&this.__currentPosition.y;if(void 0!==i&&void 0!==o){if(a<0)throw new Error("IndexSizeError: The radius provided ("+a+") is negative.");if(i===e&&o===t||e===n&&t===r||0===a)return void this.lineTo(e,t);var s=l([i-e,o-t]),u=l([n-e,r-t]);if(s[0]*u[1]==s[1]*u[0])return void this.lineTo(e,t);var c=s[0]*u[0]+s[1]*u[1],p=Math.acos(Math.abs(c)),d=l([s[0]+u[0],s[1]+u[1]]),f=a/Math.sin(p/2),h=e+f*d[0],m=t+f*d[1],v=[-s[1],s[0]],g=[u[1],-u[0]],y=function(e){var t=e[0];return e[1]>=0?Math.acos(t):-Math.acos(t)},b=y(v),x=y(g);this.lineTo(h+v[0]*a,m+v[1]*a),this.arc(h,m,a,b,x)}},o.prototype.stroke=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},o.prototype.fill=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},o.prototype.rect=function(e,t,n,r){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+r),this.lineTo(e,t+r),this.lineTo(e,t),this.closePath()},o.prototype.fillRect=function(e,t,n,r){var a;a=this.__createElement("rect",{x:e,y:t,width:n,height:r,"shape-rendering":"crispEdges"},!0),this.__closestGroupOrSvg().appendChild(a),this.__currentElement=a,this.__applyStyleToCurrentElement("fill")},o.prototype.strokeRect=function(e,t,n,r){var a;a=this.__createElement("rect",{x:e,y:t,width:n,height:r},!0),this.__closestGroupOrSvg().appendChild(a),this.__currentElement=a,this.__applyStyleToCurrentElement("stroke")},o.prototype.__clearCanvas=function(){for(var e=this.__closestGroupOrSvg().getAttribute("transform"),t=this.__root.childNodes[1],n=t.childNodes,r=n.length-1;r>=0;r--)n[r]&&t.removeChild(n[r]);this.__currentElement=t,this.__groupStack=[],e&&this.__addTransform(e)},o.prototype.clearRect=function(e,t,n,r){if(0!==e||0!==t||n!==this.width||r!==this.height){var a,i=this.__closestGroupOrSvg();a=this.__createElement("rect",{x:e,y:t,width:n,height:r,fill:"#FFFFFF"},!0),i.appendChild(a)}else this.__clearCanvas()},o.prototype.createLinearGradient=function(e,t,r,a){var i=this.__createElement("linearGradient",{id:n(this.__ids),x1:e+"px",x2:r+"px",y1:t+"px",y2:a+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(i),new s(i,this)},o.prototype.createRadialGradient=function(e,t,r,a,i,o){var u=this.__createElement("radialGradient",{id:n(this.__ids),cx:a+"px",cy:i+"px",r:o+"px",fx:e+"px",fy:t+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(u),new s(u,this)},o.prototype.__parseFont=function(){var e=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i.exec(this.font),t={style:e[1]||"normal",size:e[4]||"10px",family:e[6]||"sans-serif",weight:e[3]||"normal",decoration:e[2]||"normal",href:null};return"underline"===this.__fontUnderline&&(t.decoration="underline"),this.__fontHref&&(t.href=this.__fontHref),t},o.prototype.__wrapTextLink=function(e,t){if(e.href){var n=this.__createElement("a");return n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.href),n.appendChild(t),n}return t},o.prototype.__applyText=function(e,t,n,i){var o=this.__parseFont(),s=this.__closestGroupOrSvg(),u=this.__createElement("text",{"font-family":o.family,"font-size":o.size,"font-style":o.style,"font-weight":o.weight,"text-decoration":o.decoration,x:t,y:n,"text-anchor":r(this.textAlign),"dominant-baseline":a(this.textBaseline)},!0);u.appendChild(this.__document.createTextNode(e)),this.__currentElement=u,this.__applyStyleToCurrentElement(i),s.appendChild(this.__wrapTextLink(o,u))},o.prototype.fillText=function(e,t,n){this.__applyText(e,t,n,"fill")},o.prototype.strokeText=function(e,t,n){this.__applyText(e,t,n,"stroke")},o.prototype.measureText=function(e){return this.__ctx.font=this.font,this.__ctx.measureText(e)},o.prototype.arc=function(e,n,r,a,i,o){if(a!==i){(a%=2*Math.PI)===(i%=2*Math.PI)&&(i=(i+2*Math.PI-.001*(o?-1:1))%(2*Math.PI));var s,u=e+r*Math.cos(i),c=n+r*Math.sin(i),l=e+r*Math.cos(a),p=n+r*Math.sin(a),d=o?0:1,f=i-a;f<0&&(f+=2*Math.PI),s=o?f>Math.PI?0:1:f>Math.PI?1:0,this.lineTo(l,p),this.__addPathCommand(t("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:r,ry:r,xAxisRotation:0,largeArcFlag:s,sweepFlag:d,endX:u,endY:c})),this.__currentPosition={x:u,y:c}}},o.prototype.clip=function(){var e=this.__closestGroupOrSvg(),r=this.__createElement("clipPath"),a=n(this.__ids),i=this.__createElement("g");this.__applyCurrentDefaultPath(),e.removeChild(this.__currentElement),r.setAttribute("id",a),r.appendChild(this.__currentElement),this.__defs.appendChild(r),e.setAttribute("clip-path",t("url(#{id})",{id:a})),e.appendChild(i),this.__currentElement=i},o.prototype.drawImage=function(){var e,t,n,r,a,i,s,u,c,l,p,d,f,h=Array.prototype.slice.call(arguments),m=h[0],v=0,g=0;if(3===h.length)e=h[1],t=h[2],n=a=m.width,r=i=m.height;else if(5===h.length)e=h[1],t=h[2],n=h[3],r=h[4],a=m.width,i=m.height;else{if(9!==h.length)throw new Error("Invalid number of arguments passed to drawImage: "+arguments.length);v=h[1],g=h[2],a=h[3],i=h[4],e=h[5],t=h[6],n=h[7],r=h[8]}s=this.__closestGroupOrSvg(),this.__currentElement;var y="translate("+e+", "+t+")";if(m instanceof o){if((u=m.getSvg().cloneNode(!0)).childNodes&&u.childNodes.length>1){for(c=u.childNodes[0];c.childNodes.length;)f=c.childNodes[0].getAttribute("id"),this.__ids[f]=f,this.__defs.appendChild(c.childNodes[0]);if(l=u.childNodes[1]){var b,x=l.getAttribute("transform");b=x?x+" "+y:y,l.setAttribute("transform",b),s.appendChild(l)}}}else"CANVAS"!==m.nodeName&&"IMG"!==m.nodeName||((p=this.__createElement("image")).setAttribute("width",n),p.setAttribute("height",r),p.setAttribute("preserveAspectRatio","none"),p.setAttribute("opacity",this.globalAlpha),(v||g||a!==m.width||i!==m.height)&&((d=this.__document.createElement("canvas")).width=n,d.height=r,d.getContext("2d").drawImage(m,v,g,a,i,0,0,n,r),m=d),p.setAttribute("transform",y),p.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===m.nodeName?m.toDataURL():m.originalSrc),s.appendChild(p))},o.prototype.createPattern=function(e,t){var r,a=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),i=n(this.__ids);return a.setAttribute("id",i),a.setAttribute("width",e.width),a.setAttribute("height",e.height),"CANVAS"===e.nodeName||"IMG"===e.nodeName?((r=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",e.width),r.setAttribute("height",e.height),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===e.nodeName?e.toDataURL():e.getAttribute("src")),a.appendChild(r),this.__defs.appendChild(a)):e instanceof o&&(a.appendChild(e.__root.childNodes[1]),this.__defs.appendChild(a)),new u(a,this)},o.prototype.setLineDash=function(e){e&&e.length>0?this.lineDash=e.join(","):this.lineDash=null},o.prototype.drawFocusRing=function(){},o.prototype.createImageData=function(){},o.prototype.getImageData=function(){},o.prototype.putImageData=function(){},o.prototype.globalCompositeOperation=function(){},o.prototype.setTransform=function(){},"object"==typeof window&&(window.C2S=o),"object"==typeof e.exports&&(e.exports=o)}(),function(){"use strict";function a(e,t,n){this.mode=g.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var r=0,a=this.data.length;r<a;r++){var i=[],o=this.data.charCodeAt(r);t?i[0]=o:o>65536?(i[0]=240|(1835008&o)>>>18,i[1]=128|(258048&o)>>>12,i[2]=128|(4032&o)>>>6,i[3]=128|63&o):o>2048?(i[0]=224|(61440&o)>>>12,i[1]=128|(4032&o)>>>6,i[2]=128|63&o):o>128?(i[0]=192|(1984&o)>>>6,i[1]=128|63&o):i[0]=o,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),n||this.parsedData.length==this.data.length||(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function i(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function o(e,t){if(e.length==p)throw new Error(e.length+"/"+t);for(var n=0;n<e.length&&0==e[n];)n++;this.num=new Array(e.length-n+t);for(var r=0;r<e.length-n;r++)this.num[r]=e[r+n]}function s(e,t){this.totalCount=e,this.dataCount=t}function u(){this.buffer=[],this.length=0}function c(){var e=!1,t=navigator.userAgent;if(/android/i.test(t)){e=!0;var n=t.toString().match(/android ([0-9]\.[0-9])/i);n&&n[1]&&(e=parseFloat(n[1]))}return e}function l(e,t){for(var n=t.correctLevel,r=1,a=function(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e.length?3:0)}(e),i=0,o=S.length;i<o;i++){var s=0;switch(n){case y.L:s=S[i][0];break;case y.M:s=S[i][1];break;case y.Q:s=S[i][2];break;case y.H:s=S[i][3]}if(a<=s)break;r++}if(r>S.length)throw new Error("Too long data. the CorrectLevel."+["M","L","H","Q"][n]+" limit length is "+s);return 0!=t.version&&(r<=t.version?(r=t.version,t.runVersion=r):(console.warn("QR Code version "+t.version+" too small, run version use "+r),t.runVersion=r)),r}var p,d,f="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,h="object"==typeof self&&self&&self.Object===Object&&self,m=f||h||Function("return this")(),v=(t&&!t.nodeType&&t&&e&&e.nodeType,m.QRCode);a.prototype={getLength:function(e){return this.parsedData.length},write:function(e){for(var t=0,n=this.parsedData.length;t<n;t++)e.put(this.parsedData[t],8)}},i.prototype={addData:function(e,t,n){var r=new a(e,t,n);this.dataList.push(r),this.dataCache=null},isDark:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t][0]},getEye:function(e,t){if(e<0||this.moduleCount<=e||t<0||this.moduleCount<=t)throw new Error(e+","+t);var n=this.modules[e][t];if(n[1]){var r="P"+n[1]+"_"+n[2];return"A"==n[2]&&(r="A"+n[1]),{isDark:n[0],type:r}}return null},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,t){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var r=0;r<this.moduleCount;r++)this.modules[n][r]=[]}this.setupPositionProbePattern(0,0,"TL"),this.setupPositionProbePattern(this.moduleCount-7,0,"BL"),this.setupPositionProbePattern(0,this.moduleCount-7,"TR"),this.setupPositionAdjustPattern("A"),this.setupTimingPattern(),this.setupTypeInfo(e,t),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=i.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,t)},setupPositionProbePattern:function(e,t,n){for(var r=-1;r<=7;r++)if(!(e+r<=-1||this.moduleCount<=e+r))for(var a=-1;a<=7;a++)t+a<=-1||this.moduleCount<=t+a||(0<=r&&r<=6&&(0==a||6==a)||0<=a&&a<=6&&(0==r||6==r)||2<=r&&r<=4&&2<=a&&a<=4?(this.modules[e+r][t+a][0]=!0,this.modules[e+r][t+a][2]=n,this.modules[e+r][t+a][1]=-0==r||-0==a||6==r||6==a?"O":"I"):this.modules[e+r][t+a][0]=!1)},getBestMaskPattern:function(){for(var e=0,t=0,n=0;n<8;n++){this.makeImpl(!0,n);var r=x.getLostPoint(this);(0==n||e>r)&&(e=r,t=n)}return t},createMovieClip:function(e,t,n){var r=e.createEmptyMovieClip(t,n);this.make();for(var a=0;a<this.modules.length;a++)for(var i=1*a,o=0;o<this.modules[a].length;o++){var s=1*o;this.modules[a][o][0]&&(r.beginFill(0,100),r.moveTo(s,i),r.lineTo(s+1,i),r.lineTo(s+1,i+1),r.lineTo(s,i+1),r.endFill())}return r},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6][0]&&(this.modules[e][6][0]=e%2==0);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t][0]&&(this.modules[6][t][0]=t%2==0)},setupPositionAdjustPattern:function(e){for(var t=x.getPatternPosition(this.typeNumber),n=0;n<t.length;n++)for(var r=0;r<t.length;r++){var a=t[n],i=t[r];if(null==this.modules[a][i][0])for(var o=-2;o<=2;o++)for(var s=-2;s<=2;s++)-2==o||2==o||-2==s||2==s||0==o&&0==s?(this.modules[a+o][i+s][0]=!0,this.modules[a+o][i+s][2]=e,this.modules[a+o][i+s][1]=-2==o||-2==s||2==o||2==s?"O":"I"):this.modules[a+o][i+s][0]=!1}},setupTypeNumber:function(e){for(var t=x.getBCHTypeNumber(this.typeNumber),n=0;n<18;n++){var r=!e&&1==(t>>n&1);this.modules[Math.floor(n/3)][n%3+this.moduleCount-8-3][0]=r}for(n=0;n<18;n++){r=!e&&1==(t>>n&1);this.modules[n%3+this.moduleCount-8-3][Math.floor(n/3)][0]=r}},setupTypeInfo:function(e,t){for(var n=this.errorCorrectLevel<<3|t,r=x.getBCHTypeInfo(n),a=0;a<15;a++){var i=!e&&1==(r>>a&1);a<6?this.modules[a][8][0]=i:a<8?this.modules[a+1][8][0]=i:this.modules[this.moduleCount-15+a][8][0]=i}for(a=0;a<15;a++){i=!e&&1==(r>>a&1);a<8?this.modules[8][this.moduleCount-a-1][0]=i:a<9?this.modules[8][15-a-1+1][0]=i:this.modules[8][15-a-1][0]=i}this.modules[this.moduleCount-8][8][0]=!e},mapData:function(e,t){for(var n=-1,r=this.moduleCount-1,a=7,i=0,o=this.moduleCount-1;o>0;o-=2)for(6==o&&o--;;){for(var s=0;s<2;s++)if(null==this.modules[r][o-s][0]){var u=!1;i<e.length&&(u=1==(e[i]>>>a&1)),x.getMask(t,r,o-s)&&(u=!u),this.modules[r][o-s][0]=u,-1==--a&&(i++,a=7)}if((r+=n)<0||this.moduleCount<=r){r-=n,n=-n;break}}}},i.PAD0=236,i.PAD1=17,i.createData=function(e,t,n){for(var r=s.getRSBlocks(e,t),a=new u,o=0;o<n.length;o++){var c=n[o];a.put(c.mode,4),a.put(c.getLength(),x.getLengthInBits(c.mode,e)),c.write(a)}var l=0;for(o=0;o<r.length;o++)l+=r[o].dataCount;if(a.getLengthInBits()>8*l)throw new Error("code length overflow. ("+a.getLengthInBits()+">"+8*l+")");for(a.getLengthInBits()+4<=8*l&&a.put(0,4);a.getLengthInBits()%8!=0;)a.putBit(!1);for(;!(a.getLengthInBits()>=8*l)&&(a.put(i.PAD0,8),!(a.getLengthInBits()>=8*l));)a.put(i.PAD1,8);return i.createBytes(a,r)},i.createBytes=function(e,t){for(var n=0,r=0,a=0,i=new Array(t.length),s=new Array(t.length),u=0;u<t.length;u++){var c=t[u].dataCount,l=t[u].totalCount-c;r=Math.max(r,c),a=Math.max(a,l),i[u]=new Array(c);for(var p=0;p<i[u].length;p++)i[u][p]=255&e.buffer[p+n];n+=c;var d=x.getErrorCorrectPolynomial(l),f=new o(i[u],d.getLength()-1).mod(d);s[u]=new Array(d.getLength()-1);for(p=0;p<s[u].length;p++){var h=p+f.getLength()-s[u].length;s[u][p]=h>=0?f.get(h):0}}var m=0;for(p=0;p<t.length;p++)m+=t[p].totalCount;var v=new Array(m),g=0;for(p=0;p<r;p++)for(u=0;u<t.length;u++)p<i[u].length&&(v[g++]=i[u][p]);for(p=0;p<a;p++)for(u=0;u<t.length;u++)p<s[u].length&&(v[g++]=s[u][p]);return v};for(var g={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},y={L:1,M:0,Q:3,H:2},b={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},x={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;x.getBCHDigit(t)-x.getBCHDigit(x.G15)>=0;)t^=x.G15<<x.getBCHDigit(t)-x.getBCHDigit(x.G15);return(e<<10|t)^x.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;x.getBCHDigit(t)-x.getBCHDigit(x.G18)>=0;)t^=x.G18<<x.getBCHDigit(t)-x.getBCHDigit(x.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return x.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,n){switch(e){case b.PATTERN000:return(t+n)%2==0;case b.PATTERN001:return t%2==0;case b.PATTERN010:return n%3==0;case b.PATTERN011:return(t+n)%3==0;case b.PATTERN100:return(Math.floor(t/2)+Math.floor(n/3))%2==0;case b.PATTERN101:return t*n%2+t*n%3==0;case b.PATTERN110:return(t*n%2+t*n%3)%2==0;case b.PATTERN111:return(t*n%3+(t+n)%2)%2==0;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new o([1],0),n=0;n<e;n++)t=t.multiply(new o([1,k.gexp(n)],0));return t},getLengthInBits:function(e,t){if(1<=t&&t<10)switch(e){case g.MODE_NUMBER:return 10;case g.MODE_ALPHA_NUM:return 9;case g.MODE_8BIT_BYTE:case g.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(t<27)switch(e){case g.MODE_NUMBER:return 12;case g.MODE_ALPHA_NUM:return 11;case g.MODE_8BIT_BYTE:return 16;case g.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(t<41))throw new Error("type:"+t);switch(e){case g.MODE_NUMBER:return 14;case g.MODE_ALPHA_NUM:return 13;case g.MODE_8BIT_BYTE:return 16;case g.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),n=0,r=0;r<t;r++)for(var a=0;a<t;a++){for(var i=0,o=e.isDark(r,a),s=-1;s<=1;s++)if(!(r+s<0||t<=r+s))for(var u=-1;u<=1;u++)a+u<0||t<=a+u||0==s&&0==u||o==e.isDark(r+s,a+u)&&i++;i>5&&(n+=3+i-5)}for(r=0;r<t-1;r++)for(a=0;a<t-1;a++){var c=0;e.isDark(r,a)&&c++,e.isDark(r+1,a)&&c++,e.isDark(r,a+1)&&c++,e.isDark(r+1,a+1)&&c++,0!=c&&4!=c||(n+=3)}for(r=0;r<t;r++)for(a=0;a<t-6;a++)e.isDark(r,a)&&!e.isDark(r,a+1)&&e.isDark(r,a+2)&&e.isDark(r,a+3)&&e.isDark(r,a+4)&&!e.isDark(r,a+5)&&e.isDark(r,a+6)&&(n+=40);for(a=0;a<t;a++)for(r=0;r<t-6;r++)e.isDark(r,a)&&!e.isDark(r+1,a)&&e.isDark(r+2,a)&&e.isDark(r+3,a)&&e.isDark(r+4,a)&&!e.isDark(r+5,a)&&e.isDark(r+6,a)&&(n+=40);var l=0;for(a=0;a<t;a++)for(r=0;r<t;r++)e.isDark(r,a)&&l++;return n+Math.abs(100*l/t/t-50)/5*10}},k={glog:function(e){if(e<1)throw new Error("glog("+e+")");return k.LOG_TABLE[e]},gexp:function(e){for(;e<0;)e+=255;for(;e>=256;)e-=255;return k.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},w=0;w<8;w++)k.EXP_TABLE[w]=1<<w;for(w=8;w<256;w++)k.EXP_TABLE[w]=k.EXP_TABLE[w-4]^k.EXP_TABLE[w-5]^k.EXP_TABLE[w-6]^k.EXP_TABLE[w-8];for(w=0;w<255;w++)k.LOG_TABLE[k.EXP_TABLE[w]]=w;o.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),n=0;n<this.getLength();n++)for(var r=0;r<e.getLength();r++)t[n+r]^=k.gexp(k.glog(this.get(n))+k.glog(e.get(r)));return new o(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=k.glog(this.get(0))-k.glog(e.get(0)),n=new Array(this.getLength()),r=0;r<this.getLength();r++)n[r]=this.get(r);for(r=0;r<e.getLength();r++)n[r]^=k.gexp(k.glog(e.get(r))+t);return new o(n,0).mod(e)}},s.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],s.getRSBlocks=function(e,t){var n=s.getRsBlockTable(e,t);if(n==p)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var r=n.length/3,a=[],i=0;i<r;i++)for(var o=n[3*i+0],u=n[3*i+1],c=n[3*i+2],l=0;l<o;l++)a.push(new s(u,c));return a},s.getRsBlockTable=function(e,t){switch(t){case y.L:return s.RS_BLOCK_TABLE[4*(e-1)+0];case y.M:return s.RS_BLOCK_TABLE[4*(e-1)+1];case y.Q:return s.RS_BLOCK_TABLE[4*(e-1)+2];case y.H:return s.RS_BLOCK_TABLE[4*(e-1)+3];default:return p}},u.prototype={get:function(e){var t=Math.floor(e/8);return 1==(this.buffer[t]>>>7-e%8&1)},put:function(e,t){for(var n=0;n<t;n++)this.putBit(1==(e>>>t-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var S=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],I="undefined"!=typeof CanvasRenderingContext2D?function(){function e(){if("svg"==this._htOption.drawer){var e=this._oContext.getSerializedSvg(!0);this.dataURL=e,this._el.innerHTML=e}else try{var t=this._elCanvas.toDataURL("image/png");this.dataURL=t}catch(e){console.error(e)}this._htOption.onRenderingEnd&&(this.dataURL||console.error("Can not get base64 data, please check: 1. Published the page and image to the server 2. The image request support CORS 3. Configured `crossOrigin:'anonymous'` option"),this._htOption.onRenderingEnd(this._htOption,this.dataURL))}function t(e,t){var n=this;if(n._fFail=t,n._fSuccess=e,null===n._bSupportDataURI){var r=document.createElement("img"),a=function(){n._bSupportDataURI=!1,n._fFail&&n._fFail.call(n)};return r.onabort=a,r.onerror=a,r.onload=function(){n._bSupportDataURI=!0,n._fSuccess&&n._fSuccess.call(n)},void(r.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===n._bSupportDataURI&&n._fSuccess?n._fSuccess.call(n):!1===n._bSupportDataURI&&n._fFail&&n._fFail.call(n)}if(m._android&&m._android<=2.1){var n=1/window.devicePixelRatio,r=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,t,a,i,o,s,u,c,l){if("nodeName"in e&&/img/i.test(e.nodeName))for(var p=arguments.length-1;p>=1;p--)arguments[p]=arguments[p]*n;else void 0===c&&(arguments[1]*=n,arguments[2]*=n,arguments[3]*=n,arguments[4]*=n);r.apply(this,arguments)}}var a=function(e,t){this._bIsPainted=!1,this._android=c(),this._el=e,this._htOption=t,"svg"==this._htOption.drawer?(this._oContext={},this._elCanvas={}):(this._elCanvas=document.createElement("canvas"),this._el.appendChild(this._elCanvas),this._oContext=this._elCanvas.getContext("2d")),this._bSupportDataURI=null,this.dataURL=null};return a.prototype.draw=function(e){function t(){r.quietZone>0&&r.quietZoneColor&&(s.lineWidth=0,s.fillStyle=r.quietZoneColor,s.fillRect(0,0,u._elCanvas.width,r.quietZone),s.fillRect(0,r.quietZone,r.quietZone,u._elCanvas.height-2*r.quietZone),s.fillRect(u._elCanvas.width-r.quietZone,r.quietZone,r.quietZone,u._elCanvas.height-2*r.quietZone),s.fillRect(0,u._elCanvas.height-r.quietZone,u._elCanvas.width,r.quietZone))}function n(e){r.onRenderingStart&&r.onRenderingStart(r);for(var n=0;n<a;n++)for(var u=0;u<a;u++){var c,l,p=u*i+r.quietZone,d=n*o+r.quietZone,f=e.isDark(n,u),h=e.getEye(n,u),m=r.dotScale;s.lineWidth=0,h?(c=r[h.type]||r[h.type.substring(0,2)]||r.colorDark,l=r.colorLight):r.backgroundImage?(l="rgba(0,0,0,0)",6==n?r.autoColor?(c=r.timing_H||r.timing||r.autoColorDark,l=r.autoColorLight):c=r.timing_H||r.timing||r.colorDark:6==u?r.autoColor?(c=r.timing_V||r.timing||r.autoColorDark,l=r.autoColorLight):c=r.timing_V||r.timing||r.colorDark:r.autoColor?(c=r.autoColorDark,l=r.autoColorLight):c=r.colorDark):(c=6==n?r.timing_H||r.timing||r.colorDark:6==u&&(r.timing_V||r.timing)||r.colorDark,l=r.colorLight),s.strokeStyle=f?c:l,s.fillStyle=f?c:l,h?(m="AO"==h.type?r.dotScaleAO:"AI"==h.type?r.dotScaleAI:1,r.backgroundImage&&r.autoColor?(c=("AO"==h.type?r.AI:r.AO)||r.autoColorDark,l=r.autoColorLight):c=("AO"==h.type?r.AI:r.AO)||c,f=h.isDark,s.fillRect(p+i*(1-m)/2,r.titleHeight+d+o*(1-m)/2,i*m,o*m)):6==n?(m=r.dotScaleTiming_H,s.fillRect(p+i*(1-m)/2,r.titleHeight+d+o*(1-m)/2,i*m,o*m)):6==u?(m=r.dotScaleTiming_V,s.fillRect(p+i*(1-m)/2,r.titleHeight+d+o*(1-m)/2,i*m,o*m)):(r.backgroundImage,s.fillRect(p+i*(1-m)/2,r.titleHeight+d+o*(1-m)/2,i*m,o*m)),1==r.dotScale||h||(s.strokeStyle=r.colorLight)}if(r.title&&(s.fillStyle=r.titleBackgroundColor,s.fillRect(r.quietZone,r.quietZone,r.width,r.titleHeight),s.font=r.titleFont,s.fillStyle=r.titleColor,s.textAlign="center",s.fillText(r.title,this._elCanvas.width/2,+r.quietZone+r.titleTop)),r.subTitle&&(s.font=r.subTitleFont,s.fillStyle=r.subTitleColor,s.fillText(r.subTitle,this._elCanvas.width/2,+r.quietZone+r.subTitleTop)),r.logo){var v=new Image,g=this;v.onload=function(){!function(e){var n,a,i=Math.round(r.width/3.5),o=Math.round(r.height/3.5);i!==o&&(i=o),r.logoMaxWidth?i=Math.round(r.logoMaxWidth):r.logoWidth&&(i=Math.round(r.logoWidth)),r.logoMaxHeight?o=Math.round(r.logoMaxHeight):r.logoHeight&&(o=Math.round(r.logoHeight)),void 0===e.naturalWidth?(n=e.width,a=e.height):(n=e.naturalWidth,a=e.naturalHeight),(r.logoMaxWidth||r.logoMaxHeight)&&(r.logoMaxWidth&&n<=i&&(i=n),r.logoMaxHeight&&a<=o&&(o=a),n<=i&&a<=o&&(i=n,o=a));var u=(r.width+2*r.quietZone-i)/2,c=(r.height+r.titleHeight+2*r.quietZone-o)/2,l=Math.min(i/n,o/a),p=n*l,d=a*l;(r.logoMaxWidth||r.logoMaxHeight)&&(i=p,o=d,u=(r.width+2*r.quietZone-i)/2,c=(r.height+r.titleHeight+2*r.quietZone-o)/2),r.logoBackgroundTransparent||(s.fillStyle=r.logoBackgroundColor,s.fillRect(u,c,i,o));var f=s.imageSmoothingQuality,h=s.imageSmoothingEnabled;s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.drawImage(e,u+(i-p)/2,c+(o-d)/2,p,d),s.imageSmoothingEnabled=h,s.imageSmoothingQuality=f,t(),g._bIsPainted=!0,g.makeImage()}(v)},v.onerror=function(e){console.error(e)},null!=r.crossOrigin&&(v.crossOrigin=r.crossOrigin),v.originalSrc=r.logo,v.src=r.logo}else t(),this._bIsPainted=!0,this.makeImage()}var r=this._htOption,a=e.getModuleCount(),i=Math.round(r.width/a),o=Math.round((r.height-r.titleHeight)/a);i<=1&&(i=1),o<=1&&(o=1),r.width=i*a,r.height=o*a+r.titleHeight,r.quietZone=Math.round(r.quietZone),this._elCanvas.width=r.width+2*r.quietZone,this._elCanvas.height=r.height+2*r.quietZone,"canvas"!=this._htOption.drawer&&(this._oContext=new C2S(this._elCanvas.width,this._elCanvas.height)),this.clear();var s=this._oContext;s.lineWidth=0,s.fillStyle=r.colorLight,s.fillRect(0,0,this._elCanvas.width,this._elCanvas.height),s.clearRect(r.quietZone,r.quietZone,r.width,r.titleHeight);var u=this;if(r.backgroundImage){var c=new Image;c.onload=function(){s.globalAlpha=1,s.globalAlpha=r.backgroundImageAlpha;var t=s.imageSmoothingQuality,a=s.imageSmoothingEnabled;s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high",s.drawImage(c,0,r.titleHeight,r.width+2*r.quietZone,r.height+2*r.quietZone-r.titleHeight),s.imageSmoothingEnabled=a,s.imageSmoothingQuality=t,s.globalAlpha=1,n.call(u,e)},null!=r.crossOrigin&&(c.crossOrigin=r.crossOrigin),c.originalSrc=r.backgroundImage,c.src=r.backgroundImage}else n.call(u,e)},a.prototype.makeImage=function(){this._bIsPainted&&t.call(this,e)},a.prototype.isPainted=function(){return this._bIsPainted},a.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},a.prototype.remove=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1,this._el.innerHTML=""},a.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},a}():function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){var t=this._htOption,n=this._el,r=e.getModuleCount(),a=Math.round(t.width/r),i=Math.round((t.height-t.titleHeight)/r);a<=1&&(a=1),i<=1&&(i=1),this._htOption.width=a*r,this._htOption.height=i*r+t.titleHeight,this._htOption.quietZone=Math.round(this._htOption.quietZone);var o=[],s="",u=Math.round(a*t.dotScale),c=Math.round(i*t.dotScale);u<4&&(u=4,c=4);var l=t.colorDark,p=t.colorLight;if(t.backgroundImage){t.autoColor?(t.colorDark="rgba(0, 0, 0, .6);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#99000000', EndColorStr='#99000000');",t.colorLight="rgba(255, 255, 255, .7);filter:progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr='#B2FFFFFF', EndColorStr='#B2FFFFFF');"):t.colorLight="rgba(0,0,0,0)";var d='<div style="display:inline-block; z-index:-10;position:absolute;"><img src="'+t.backgroundImage+'" widht="'+(t.width+2*t.quietZone)+'" height="'+(t.height+2*t.quietZone)+'" style="opacity:'+t.backgroundImageAlpha+";filter:alpha(opacity="+100*t.backgroundImageAlpha+'); "/></div>';o.push(d)}if(t.quietZone&&(s="display:inline-block; width:"+(t.width+2*t.quietZone)+"px; height:"+(t.width+2*t.quietZone)+"px;background:"+t.quietZoneColor+"; text-align:center;"),o.push('<div style="font-size:0;'+s+'">'),o.push('<table  style="font-size:0;border:0;border-collapse:collapse; margin-top:'+t.quietZone+'px;" border="0" cellspacing="0" cellspadding="0" align="center" valign="middle">'),o.push('<tr height="'+t.titleHeight+'" align="center"><td style="border:0;border-collapse:collapse;margin:0;padding:0" colspan="'+r+'">'),t.title){var f=t.titleColor,h=t.titleFont;o.push('<div style="width:100%;margin-top:'+t.titleTop+"px;color:"+f+";font:"+h+";background:"+t.titleBackgroundColor+'">'+t.title+"</div>")}t.subTitle&&o.push('<div style="width:100%;margin-top:'+(t.subTitleTop-t.titleTop)+"px;color:"+t.subTitleColor+"; font:"+t.subTitleFont+'">'+t.subTitle+"</div>"),o.push("</td></tr>");for(var m=0;m<r;m++){o.push('<tr style="border:0; padding:0; margin:0;" height="7">');for(var v=0;v<r;v++){var g=e.isDark(m,v),y=e.getEye(m,v);if(y){g=y.isDark;var b=y.type,x=t[b]||t[b.substring(0,2)]||l;o.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+a+"px;height:"+i+'px;"><span style="width:'+a+"px;height:"+i+"px;background-color:"+(g?x:p)+';display:inline-block"></span></td>')}else{var k=t.colorDark;6==m?(k=t.timing_H||t.timing||l,o.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+a+"px;height:"+i+"px;background-color:"+(g?k:p)+';"></td>')):6==v?(k=t.timing_V||t.timing||l,o.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+a+"px;height:"+i+"px;background-color:"+(g?k:p)+';"></td>')):o.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+a+"px;height:"+i+'px;"><div style="display:inline-block;width:'+u+"px;height:"+c+"px;background-color:"+(g?k:t.colorLight)+';"></div></td>')}}o.push("</tr>")}if(o.push("</table>"),o.push("</div>"),t.logo){var w=new Image;null!=t.crossOrigin&&(w.crossOrigin=t.crossOrigin),w.src=t.logo;var S=t.width/3.5,I=t.height/3.5;S!=I&&(S=I),t.logoWidth&&(S=t.logoWidth),t.logoHeight&&(I=t.logoHeight);var _="position:relative; z-index:1;display:table-cell;top:-"+((t.height-t.titleHeight)/2+I/2+t.quietZone)+"px;text-align:center; width:"+S+"px; height:"+I+"px;line-height:"+S+"px; vertical-align: middle;";t.logoBackgroundTransparent||(_+="background:"+t.logoBackgroundColor),o.push('<div style="'+_+'"><img  src="'+t.logo+'"  style="max-width: '+S+"px; max-height: "+I+'px;" /> <div style=" display: none; width:1px;margin-left: -1px;"></div></div>')}t.onRenderingStart&&t.onRenderingStart(t),n.innerHTML=o.join("");var N=n.childNodes[0],C=(t.width-N.offsetWidth)/2,T=(t.height-N.offsetHeight)/2;C>0&&T>0&&(N.style.margin=T+"px "+C+"px"),this._htOption.onRenderingEnd&&this._htOption.onRenderingEnd(this._htOption,null)},e.prototype.clear=function(){this._el.innerHTML=""},e}();d=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:y.H,dotScale:1,dotScaleTiming:1,dotScaleTiming_H:p,dotScaleTiming_V:p,dotScaleA:1,dotScaleAO:p,dotScaleAI:p,quietZone:0,quietZoneColor:"rgba(0,0,0,0)",title:"",titleFont:"normal normal bold 16px Arial",titleColor:"#000000",titleBackgroundColor:"#ffffff",titleHeight:0,titleTop:30,subTitle:"",subTitleFont:"normal normal normal 14px Arial",subTitleColor:"#4F4F4F",subTitleTop:60,logo:p,logoWidth:p,logoHeight:p,logoMaxWidth:p,logoMaxHeight:p,logoBackgroundColor:"#ffffff",logoBackgroundTransparent:!1,PO:p,PI:p,PO_TL:p,PI_TL:p,PO_TR:p,PI_TR:p,PO_BL:p,PI_BL:p,AO:p,AI:p,timing:p,timing_H:p,timing_V:p,backgroundImage:p,backgroundImageAlpha:1,autoColor:!1,autoColorDark:"rgba(0, 0, 0, .6)",autoColorLight:"rgba(255, 255, 255, .7)",onRenderingStart:p,onRenderingEnd:p,version:0,tooltip:!1,binary:!1,drawer:"canvas",crossOrigin:null,utf8WithoutBOM:!0},"string"==typeof t&&(t={text:t}),t)for(var n in t)this._htOption[n]=t[n];this._htOption.title||this._htOption.subTitle||(this._htOption.titleHeight=0),(this._htOption.version<0||this._htOption.version>40)&&(console.warn("QR Code version '"+this._htOption.version+"' is invalidate, reset to 0"),this._htOption.version=0),(this._htOption.dotScale<0||this._htOption.dotScale>1)&&(console.warn(this._htOption.dotScale+" , is invalidate, dotScale must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScale=1),(this._htOption.dotScaleTiming<0||this._htOption.dotScaleTiming>1)&&(console.warn(this._htOption.dotScaleTiming+" , is invalidate, dotScaleTiming must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming=1),this._htOption.dotScaleTiming_H?(this._htOption.dotScaleTiming_H<0||this._htOption.dotScaleTiming_H>1)&&(console.warn(this._htOption.dotScaleTiming_H+" , is invalidate, dotScaleTiming_H must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_H=1):this._htOption.dotScaleTiming_H=this._htOption.dotScaleTiming,this._htOption.dotScaleTiming_V?(this._htOption.dotScaleTiming_V<0||this._htOption.dotScaleTiming_V>1)&&(console.warn(this._htOption.dotScaleTiming_V+" , is invalidate, dotScaleTiming_V must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleTiming_V=1):this._htOption.dotScaleTiming_V=this._htOption.dotScaleTiming,(this._htOption.dotScaleA<0||this._htOption.dotScaleA>1)&&(console.warn(this._htOption.dotScaleA+" , is invalidate, dotScaleA must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleA=1),this._htOption.dotScaleAO?(this._htOption.dotScaleAO<0||this._htOption.dotScaleAO>1)&&(console.warn(this._htOption.dotScaleAO+" , is invalidate, dotScaleAO must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAO=1):this._htOption.dotScaleAO=this._htOption.dotScaleA,this._htOption.dotScaleAI?(this._htOption.dotScaleAI<0||this._htOption.dotScaleAI>1)&&(console.warn(this._htOption.dotScaleAI+" , is invalidate, dotScaleAI must greater than 0, less than or equal to 1, now reset to 1. "),this._htOption.dotScaleAI=1):this._htOption.dotScaleAI=this._htOption.dotScaleA,(this._htOption.backgroundImageAlpha<0||this._htOption.backgroundImageAlpha>1)&&(console.warn(this._htOption.backgroundImageAlpha+" , is invalidate, backgroundImageAlpha must between 0 and 1, now reset to 1. "),this._htOption.backgroundImageAlpha=1),this._htOption.height=this._htOption.height+this._htOption.titleHeight,"string"==typeof e&&(e=document.getElementById(e)),(!this._htOption.drawer||"svg"!=this._htOption.drawer&&"canvas"!=this._htOption.drawer)&&(this._htOption.drawer="canvas"),this._android=c(),this._el=e,this._oQRCode=null,this._htOption._element=e;var r={};for(var n in this._htOption)r[n]=this._htOption[n];this._oDrawing=new I(this._el,r),this._htOption.text&&this.makeCode(this._htOption.text)},d.prototype.makeCode=function(e){this._oQRCode=new i(l(e,this._htOption),this._htOption.correctLevel),this._oQRCode.addData(e,this._htOption.binary,this._htOption.utf8WithoutBOM),this._oQRCode.make(),this._htOption.tooltip&&(this._el.title=e),this._oDrawing.draw(this._oQRCode)},d.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},d.prototype.clear=function(){this._oDrawing.remove()},d.prototype.resize=function(e,t){this._oDrawing._htOption.width=e,this._oDrawing._htOption.height=t,this._oDrawing.draw(this._oQRCode)},d.prototype.noConflict=function(){return m.QRCode===this&&(m.QRCode=v),d},d.CorrectLevel=y,void 0===(r=function(){return d}.apply(t,[]))||(e.exports=r)}.call(this)},463:function(e,t,n){"use strict";var r=n(791),a=n(296);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),p=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},h={};function m(e,t,n,r,a,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){v[e]=new m(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];v[t]=new m(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){v[e]=new m(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){v[e]=new m(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){v[e]=new m(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){v[e]=new m(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){v[e]=new m(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){v[e]=new m(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){v[e]=new m(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var a=v.hasOwnProperty(t)?v[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!p.call(h,e)||!p.call(f,e)&&(d.test(e)?h[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);v[t]=new m(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!1,!1)})),v.xlinkHref=new m("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){v[e]=new m(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),w=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),_=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),C=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),E=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),F=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var M=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=M&&e[M]||e["@@iterator"])?e:null}var P,L=Object.assign;function z(e){if(void 0===P)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);P=t&&t[1]||""}return"\n"+P+e}var B=!1;function W(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var u="\n"+a[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?z(e):""}function U(e){switch(e.tag){case 5:return z(e.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return e=W(e.type,!1);case 11:return e=W(e.type.render,!1);case 1:return e=W(e.type,!0);default:return""}}function V(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case w:return"Portal";case _:return"Profiler";case I:return"StrictMode";case E:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case N:return(e._context.displayName||"Context")+".Provider";case T:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:V(e.type)||"Memo";case F:t=e._payload,e=e._init;try{return V(e(t))}catch(n){}}return null}function j(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return V(t);case 8:return t===I?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function G(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function H(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function q(e){e._valueTracker||(e._valueTracker=function(e){var t=H(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function K(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=H(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function X(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return L({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=G(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Z(e,t);var n=G(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,G(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&X(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+G(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return L({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:G(n)}}function ie(e,t){var n=G(t.value),r=G(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,le,pe=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},he=["Webkit","ms","Moz","O"];function me(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ve(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=me(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(fe).forEach((function(e){he.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ge=L({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,Se=null,Ie=null;function _e(e){if(e=ba(e)){if("function"!==typeof we)throw Error(i(280));var t=e.stateNode;t&&(t=ka(t),we(e.stateNode,e.type,t))}}function Ne(e){Se?Ie?Ie.push(e):Ie=[e]:Se=e}function Ce(){if(Se){var e=Se,t=Ie;if(Ie=Se=null,_e(e),t)for(e=0;e<t.length;e++)_e(t[e])}}function Te(e,t){return e(t)}function Ee(){}var Ae=!1;function Re(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Te(e,t,n)}finally{Ae=!1,(null!==Se||null!==Ie)&&(Ee(),Ce())}}function Fe(e,t){var n=e.stateNode;if(null===n)return null;var r=ka(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var De=!1;if(l)try{var Me={};Object.defineProperty(Me,"passive",{get:function(){De=!0}}),window.addEventListener("test",Me,Me),window.removeEventListener("test",Me,Me)}catch(le){De=!1}function Oe(e,t,n,r,a,i,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Pe=!1,Le=null,ze=!1,Be=null,We={onError:function(e){Pe=!0,Le=e}};function Ue(e,t,n,r,a,i,o,s,u){Pe=!1,Le=null,Oe.apply(We,arguments)}function Ve(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ge(e){if(Ve(e)!==e)throw Error(i(188))}function He(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ve(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(r=a.return)){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return Ge(a),e;if(o===r)return Ge(a),t;o=o.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,u=a.child;u;){if(u===n){s=!0,n=a,r=o;break}if(u===r){s=!0,r=a,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=a;break}if(u===r){s=!0,r=o,n=a;break}u=u.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?qe(e):null}function qe(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=qe(e);if(null!==t)return t;e=e.sibling}return null}var Ke=a.unstable_scheduleCallback,Xe=a.unstable_cancelCallback,Ye=a.unstable_shouldYield,Qe=a.unstable_requestPaint,Ze=a.unstable_now,Je=a.unstable_getCurrentPriorityLevel,$e=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,it=null;var ot=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var ct=64,lt=4194304;function pt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=pt(s):0!==(i&=o)&&(r=pt(i))}else 0!==(o=n&~a)?r=pt(o):0!==i&&(r=pt(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-ot(t)),r|=e[n],t&=~a;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ht(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function mt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var kt,wt,St,It,_t,Nt=!1,Ct=[],Tt=null,Et=null,At=null,Rt=new Map,Ft=new Map,Dt=[],Mt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":Tt=null;break;case"dragenter":case"dragleave":Et=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ft.delete(t.pointerId)}}function Pt(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=ba(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Lt(e){var t=ya(e.target);if(null!==t){var n=Ve(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=je(n)))return e.blockedOn=t,void _t(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function zt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ba(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Bt(e,t,n){zt(e)&&n.delete(t)}function Wt(){Nt=!1,null!==Tt&&zt(Tt)&&(Tt=null),null!==Et&&zt(Et)&&(Et=null),null!==At&&zt(At)&&(At=null),Rt.forEach(Bt),Ft.forEach(Bt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Nt||(Nt=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Wt)))}function Vt(e){function t(t){return Ut(t,e)}if(0<Ct.length){Ut(Ct[0],e);for(var n=1;n<Ct.length;n++){var r=Ct[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Tt&&Ut(Tt,e),null!==Et&&Ut(Et,e),null!==At&&Ut(At,e),Rt.forEach(t),Ft.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Lt(n),null===n.blockedOn&&Dt.shift()}var jt=x.ReactCurrentBatchConfig,Gt=!0;function Ht(e,t,n,r){var a=bt,i=jt.transition;jt.transition=null;try{bt=1,Kt(e,t,n,r)}finally{bt=a,jt.transition=i}}function qt(e,t,n,r){var a=bt,i=jt.transition;jt.transition=null;try{bt=4,Kt(e,t,n,r)}finally{bt=a,jt.transition=i}}function Kt(e,t,n,r){if(Gt){var a=Yt(e,t,n,r);if(null===a)Gr(e,t,r,Xt,n),Ot(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return Tt=Pt(Tt,e,t,n,r,a),!0;case"dragenter":return Et=Pt(Et,e,t,n,r,a),!0;case"mouseover":return At=Pt(At,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Rt.set(i,Pt(Rt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Ft.set(i,Pt(Ft.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Mt.indexOf(e)){for(;null!==a;){var i=ba(a);if(null!==i&&kt(i),null===(i=Yt(e,t,n,r))&&Gr(e,t,r,Xt,n),i===a)break;a=i}null!==a&&r.stopPropagation()}else Gr(e,t,r,null,n)}}var Xt=null;function Yt(e,t,n,r){if(Xt=null,null!==(e=ya(e=ke(r))))if(null===(t=Ve(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=je(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Xt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Zt=null,Jt=null,$t=null;function en(){if($t)return $t;var e,t,n=Jt,r=n.length,a="value"in Zt?Zt.value:Zt.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return $t=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,i){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return L(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=an(cn),pn=L({},cn,{view:0,detail:0}),dn=an(pn),fn=L({},pn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_n,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(on=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=on=0,un=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),hn=an(fn),mn=an(L({},fn,{dataTransfer:0})),vn=an(L({},pn,{relatedTarget:0})),gn=an(L({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=L({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=an(yn),xn=an(L({},cn,{data:0})),kn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function In(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function _n(){return In}var Nn=L({},pn,{key:function(e){if(e.key){var t=kn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_n,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Cn=an(Nn),Tn=an(L({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),En=an(L({},pn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_n})),An=an(L({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=L({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Fn=an(Rn),Dn=[9,13,27,32],Mn=l&&"CompositionEvent"in window,On=null;l&&"documentMode"in document&&(On=document.documentMode);var Pn=l&&"TextEvent"in window&&!On,Ln=l&&(!Mn||On&&8<On&&11>=On),zn=String.fromCharCode(32),Bn=!1;function Wn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var jn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!jn[e.type]:"textarea"===t}function Hn(e,t,n,r){Ne(r),0<(t=qr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var qn=null,Kn=null;function Xn(e){zr(e,0)}function Yn(e){if(K(xa(e)))return e}function Qn(e,t){if("change"===e)return t}var Zn=!1;if(l){var Jn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Jn=$n}else Jn=!1;Zn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){qn&&(qn.detachEvent("onpropertychange",nr),Kn=qn=null)}function nr(e){if("value"===e.propertyName&&Yn(Kn)){var t=[];Hn(t,Kn,e,ke(e)),Re(Xn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Kn=n,(qn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Kn)}function ir(e,t){if("click"===e)return Yn(t)}function or(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!p.call(t,a)||!sr(e[a],t[a]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function pr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?pr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=X((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function hr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&pr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=void 0===r.end?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=lr(n,i);var o=lr(n,r);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var mr=l&&"documentMode"in document&&11>=document.documentMode,vr=null,gr=null,yr=null,br=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==vr||vr!==X(r)||("selectionStart"in(r=vr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=qr(gr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=vr)))}function kr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:kr("Animation","AnimationEnd"),animationiteration:kr("Animation","AnimationIteration"),animationstart:kr("Animation","AnimationStart"),transitionend:kr("Transition","TransitionEnd")},Sr={},Ir={};function _r(e){if(Sr[e])return Sr[e];if(!wr[e])return e;var t,n=wr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ir)return Sr[e]=n[t];return e}l&&(Ir=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Nr=_r("animationend"),Cr=_r("animationiteration"),Tr=_r("animationstart"),Er=_r("transitionend"),Ar=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fr(e,t){Ar.set(e,t),u(t,[e])}for(var Dr=0;Dr<Rr.length;Dr++){var Mr=Rr[Dr];Fr(Mr.toLowerCase(),"on"+(Mr[0].toUpperCase()+Mr.slice(1)))}Fr(Nr,"onAnimationEnd"),Fr(Cr,"onAnimationIteration"),Fr(Tr,"onAnimationStart"),Fr("dblclick","onDoubleClick"),Fr("focusin","onFocus"),Fr("focusout","onBlur"),Fr(Er,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function Lr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,o,s,u,c){if(Ue.apply(this,arguments),Pe){if(!Pe)throw Error(i(198));var l=Le;Pe=!1,Le=null,ze||(ze=!0,Be=l)}}(r,t,void 0,e),e.currentTarget=null}function zr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==i&&a.isPropagationStopped())break e;Lr(a,s,c),i=u}else for(o=0;o<r.length;o++){if(u=(s=r[o]).instance,c=s.currentTarget,s=s.listener,u!==i&&a.isPropagationStopped())break e;Lr(a,s,c),i=u}}}if(ze)throw e=Be,ze=!1,Be=null,e}function Br(e,t){var n=t[ma];void 0===n&&(n=t[ma]=new Set);var r=e+"__bubble";n.has(r)||(jr(t,e,2,!1),n.add(r))}function Wr(e,t,n){var r=0;t&&(r|=4),jr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function Vr(e){if(!e[Ur]){e[Ur]=!0,o.forEach((function(t){"selectionchange"!==t&&(Pr.has(t)||Wr(t,!1,e),Wr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,Wr("selectionchange",!1,t))}}function jr(e,t,n,r){switch(Qt(t)){case 1:var a=Ht;break;case 4:a=qt;break;default:a=Kt}n=a.bind(null,t,n,e),a=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Gr(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=r.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===a||8===u.nodeType&&u.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=ya(s)))return;if(5===(u=o.tag)||6===u){r=i=o;continue e}s=s.parentNode}}r=r.return}Re((function(){var r=i,a=ke(n),o=[];e:{var s=Ar.get(e);if(void 0!==s){var u=ln,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=Cn;break;case"focusin":c="focus",u=vn;break;case"focusout":c="blur",u=vn;break;case"beforeblur":case"afterblur":u=vn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=hn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=mn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=En;break;case Nr:case Cr:case Tr:u=gn;break;case Er:u=An;break;case"scroll":u=dn;break;case"wheel":u=Fn;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Tn}var l=0!==(4&t),p=!l&&"scroll"===e,d=l?null!==s?s+"Capture":null:s;l=[];for(var f,h=r;null!==h;){var m=(f=h).stateNode;if(5===f.tag&&null!==m&&(f=m,null!==d&&(null!=(m=Fe(h,d))&&l.push(Hr(h,m,f)))),p)break;h=h.return}0<l.length&&(s=new u(s,c,null,n,a),o.push({event:s,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!ya(c)&&!c[ha])&&(u||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?ya(c):null)&&(c!==(p=Ve(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=hn,m="onMouseLeave",d="onMouseEnter",h="mouse","pointerout"!==e&&"pointerover"!==e||(l=Tn,m="onPointerLeave",d="onPointerEnter",h="pointer"),p=null==u?s:xa(u),f=null==c?s:xa(c),(s=new l(m,h+"leave",u,n,a)).target=p,s.relatedTarget=f,m=null,ya(a)===r&&((l=new l(d,h+"enter",c,n,a)).target=f,l.relatedTarget=p,m=l),p=m,u&&c)e:{for(d=c,h=0,f=l=u;f;f=Kr(f))h++;for(f=0,m=d;m;m=Kr(m))f++;for(;0<h-f;)l=Kr(l),h--;for(;0<f-h;)d=Kr(d),f--;for(;h--;){if(l===d||null!==d&&l===d.alternate)break e;l=Kr(l),d=Kr(d)}l=null}else l=null;null!==u&&Xr(o,s,u,l,!1),null!==c&&null!==p&&Xr(o,p,c,l,!0)}if("select"===(u=(s=r?xa(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var v=Qn;else if(Gn(s))if(Zn)v=or;else{v=ar;var g=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(v=ir);switch(v&&(v=v(e,r))?Hn(o,v,n,a):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?xa(r):window,e){case"focusin":(Gn(g)||"true"===g.contentEditable)&&(vr=g,gr=r,yr=null);break;case"focusout":yr=gr=vr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,xr(o,n,a);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":xr(o,n,a)}var y;if(Mn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Vn?Wn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Ln&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Vn&&(y=en()):(Jt="value"in(Zt=a)?Zt.value:Zt.textContent,Vn=!0)),0<(g=qr(r,b)).length&&(b=new xn(b,e,null,n,a),o.push({event:b,listeners:g}),y?b.data=y:null!==(y=Un(n))&&(b.data=y))),(y=Pn?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(Bn=!0,zn);case"textInput":return(e=t.data)===zn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!Mn&&Wn(e,t)?(e=en(),$t=Jt=Zt=null,Vn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ln&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=qr(r,"onBeforeInput")).length&&(a=new xn("onBeforeInput","beforeinput",null,n,a),o.push({event:a,listeners:r}),a.data=y))}zr(o,t)}))}function Hr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function qr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=Fe(e,n))&&r.unshift(Hr(e,i,a)),null!=(i=Fe(e,t))&&r.push(Hr(e,i,a))),e=e.return}return r}function Kr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Xr(e,t,n,r,a){for(var i=t._reactName,o=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,a?null!=(u=Fe(n,i))&&o.unshift(Hr(n,u,s)):a||null!=(u=Fe(n,i))&&o.push(Hr(n,u,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yr=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Zr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(Qr,"")}function Jr(e,t,n){if(t=Zr(t),Zr(e)!==t&&n)throw Error(i(425))}function $r(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,ia="function"===typeof Promise?Promise:void 0,oa="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ia?function(e){return ia.resolve(null).then(e).catch(sa)}:ra;function sa(e){setTimeout((function(){throw e}))}function ua(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void Vt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);Vt(t)}function ca(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function la(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var pa=Math.random().toString(36).slice(2),da="__reactFiber$"+pa,fa="__reactProps$"+pa,ha="__reactContainer$"+pa,ma="__reactEvents$"+pa,va="__reactListeners$"+pa,ga="__reactHandles$"+pa;function ya(e){var t=e[da];if(t)return t;for(var n=e.parentNode;n;){if(t=n[ha]||n[da]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=la(e);null!==e;){if(n=e[da])return n;e=la(e)}return t}n=(e=n).parentNode}return null}function ba(e){return!(e=e[da]||e[ha])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function ka(e){return e[fa]||null}var wa=[],Sa=-1;function Ia(e){return{current:e}}function _a(e){0>Sa||(e.current=wa[Sa],wa[Sa]=null,Sa--)}function Na(e,t){Sa++,wa[Sa]=e.current,e.current=t}var Ca={},Ta=Ia(Ca),Ea=Ia(!1),Aa=Ca;function Ra(e,t){var n=e.type.contextTypes;if(!n)return Ca;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Fa(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Da(){_a(Ea),_a(Ta)}function Ma(e,t,n){if(Ta.current!==Ca)throw Error(i(168));Na(Ta,t),Na(Ea,n)}function Oa(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,j(e)||"Unknown",a));return L({},n,r)}function Pa(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ca,Aa=Ta.current,Na(Ta,e),Na(Ea,Ea.current),!0}function La(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Oa(e,t,Aa),r.__reactInternalMemoizedMergedChildContext=e,_a(Ea),_a(Ta),Na(Ta,e)):_a(Ea),Na(Ea,n)}var za=null,Ba=!1,Wa=!1;function Ua(e){null===za?za=[e]:za.push(e)}function Va(){if(!Wa&&null!==za){Wa=!0;var e=0,t=bt;try{var n=za;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}za=null,Ba=!1}catch(a){throw null!==za&&(za=za.slice(e+1)),Ke($e,Va),a}finally{bt=t,Wa=!1}}return null}var ja=[],Ga=0,Ha=null,qa=0,Ka=[],Xa=0,Ya=null,Qa=1,Za="";function Ja(e,t){ja[Ga++]=qa,ja[Ga++]=Ha,Ha=e,qa=t}function $a(e,t,n){Ka[Xa++]=Qa,Ka[Xa++]=Za,Ka[Xa++]=Ya,Ya=e;var r=Qa;e=Za;var a=32-ot(r)-1;r&=~(1<<a),n+=1;var i=32-ot(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Qa=1<<32-ot(t)+a|n<<a|r,Za=i+e}else Qa=1<<i|n<<a|r,Za=e}function ei(e){null!==e.return&&(Ja(e,1),$a(e,1,0))}function ti(e){for(;e===Ha;)Ha=ja[--Ga],ja[Ga]=null,qa=ja[--Ga],ja[Ga]=null;for(;e===Ya;)Ya=Ka[--Xa],Ka[Xa]=null,Za=Ka[--Xa],Ka[Xa]=null,Qa=Ka[--Xa],Ka[Xa]=null}var ni=null,ri=null,ai=!1,ii=null;function oi(e,t){var n=Fc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function si(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=ca(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ya?{id:Qa,overflow:Za}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Fc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function ui(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ci(e){if(ai){var t=ri;if(t){var n=t;if(!si(e,t)){if(ui(e))throw Error(i(418));t=ca(n.nextSibling);var r=ni;t&&si(e,t)?oi(r,n):(e.flags=-4097&e.flags|2,ai=!1,ni=e)}}else{if(ui(e))throw Error(i(418));e.flags=-4097&e.flags|2,ai=!1,ni=e}}}function li(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function pi(e){if(e!==ni)return!1;if(!ai)return li(e),ai=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=ri)){if(ui(e))throw di(),Error(i(418));for(;t;)oi(e,t),t=ca(t.nextSibling)}if(li(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=ca(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?ca(e.stateNode.nextSibling):null;return!0}function di(){for(var e=ri;e;)e=ca(e.nextSibling)}function fi(){ri=ni=null,ai=!1}function hi(e){null===ii?ii=[e]:ii.push(e)}var mi=x.ReactCurrentBatchConfig;function vi(e,t){if(e&&e.defaultProps){for(var n in t=L({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var gi=Ia(null),yi=null,bi=null,xi=null;function ki(){xi=bi=yi=null}function wi(e){var t=gi.current;_a(gi),e._currentValue=t}function Si(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ii(e,t){yi=e,xi=bi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xs=!0),e.firstContext=null)}function _i(e){var t=e._currentValue;if(xi!==e)if(e={context:e,memoizedValue:t,next:null},null===bi){if(null===yi)throw Error(i(308));bi=e,yi.dependencies={lanes:0,firstContext:e}}else bi=bi.next=e;return t}var Ni=null;function Ci(e){null===Ni?Ni=[e]:Ni.push(e)}function Ti(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Ci(t)):(n.next=a.next,a.next=n),t.interleaved=n,Ei(e,r)}function Ei(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ai=!1;function Ri(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Fi(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Di(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Mi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Eu)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Ei(e,n)}return null===(a=r.interleaved)?(t.next=t,Ci(r)):(t.next=a.next,a.next=t),r.interleaved=t,Ei(e,n)}function Oi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Pi(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Li(e,t,n,r){var a=e.updateQueue;Ai=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(null!==s){a.shared.pending=null;var u=s,c=u.next;u.next=null,null===o?i=c:o.next=c,o=u;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==o&&(null===s?l.firstBaseUpdate=c:s.next=c,l.lastBaseUpdate=u))}if(null!==i){var p=a.baseState;for(o=0,l=c=u=null,s=i;;){var d=s.lane,f=s.eventTime;if((r&d)===d){null!==l&&(l=l.next={eventTime:f,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var h=e,m=s;switch(d=t,f=n,m.tag){case 1:if("function"===typeof(h=m.payload)){p=h.call(f,p,d);break e}p=h;break e;case 3:h.flags=-65537&h.flags|128;case 0:if(null===(d="function"===typeof(h=m.payload)?h.call(f,p,d):h)||void 0===d)break e;p=L({},p,d);break e;case 2:Ai=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(d=a.effects)?a.effects=[s]:d.push(s))}else f={eventTime:f,lane:d,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(c=l=f,u=p):l=l.next=f,o|=d;if(null===(s=s.next)){if(null===(s=a.shared.pending))break;s=(d=s).next,d.next=null,a.lastBaseUpdate=d,a.shared.pending=null}}if(null===l&&(u=p),a.baseState=u,a.firstBaseUpdate=c,a.lastBaseUpdate=l,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===i&&(a.shared.lanes=0);Lu|=o,e.lanes=o,e.memoizedState=p}}function zi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(i(191,a));a.call(r)}}}var Bi=(new r.Component).refs;function Wi(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:L({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Ui={isMounted:function(e){return!!(e=e._reactInternals)&&Ve(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tc(),a=nc(e),i=Di(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Mi(e,i,a))&&(rc(t,e,a,r),Oi(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tc(),a=nc(e),i=Di(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Mi(e,i,a))&&(rc(t,e,a,r),Oi(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),r=nc(e),a=Di(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Mi(e,a,r))&&(rc(t,e,r,n),Oi(t,e,r))}};function Vi(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(a,i))}function ji(e,t,n){var r=!1,a=Ca,i=t.contextType;return"object"===typeof i&&null!==i?i=_i(i):(a=Fa(t)?Aa:Ta.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ra(e,a):Ca),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Ui,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Gi(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Ui.enqueueReplaceState(t,t.state,null)}function Hi(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=Bi,Ri(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=_i(i):(i=Fa(t)?Aa:Ta.current,a.context=Ra(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(Wi(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Ui.enqueueReplaceState(a,a.state,null),Li(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function qi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var a=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;t===Bi&&(t=a.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function Ki(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Xi(e){return(0,e._init)(e._payload)}function Yi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Mc(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=zc(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===S?p(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===F&&Xi(i)===t.type)?((r=a(t,n.props)).ref=qi(e,t,n),r.return=e,r):((r=Oc(n.type,n.key,n.props,null,e.mode,r)).ref=qi(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Bc(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function p(e,t,n,r,i){return null===t||7!==t.tag?((t=Pc(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=zc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case k:return(n=Oc(t.type,t.key,t.props,null,e.mode,n)).ref=qi(e,null,t),n.return=e,n;case w:return(t=Bc(t,e.mode,n)).return=e,t;case F:return d(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Pc(t,e.mode,n,null)).return=e,t;Ki(e,t)}return null}function f(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case k:return n.key===a?c(e,t,n,r):null;case w:return n.key===a?l(e,t,n,r):null;case F:return f(e,t,(a=n._init)(n._payload),r)}if(te(n)||O(n))return null!==a?null:p(e,t,n,r,null);Ki(e,n)}return null}function h(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case k:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case w:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a);case F:return h(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||O(r))return p(t,e=e.get(n)||null,r,a,null);Ki(t,r)}return null}function m(a,i,s,u){for(var c=null,l=null,p=i,m=i=0,v=null;null!==p&&m<s.length;m++){p.index>m?(v=p,p=null):v=p.sibling;var g=f(a,p,s[m],u);if(null===g){null===p&&(p=v);break}e&&p&&null===g.alternate&&t(a,p),i=o(g,i,m),null===l?c=g:l.sibling=g,l=g,p=v}if(m===s.length)return n(a,p),ai&&Ja(a,m),c;if(null===p){for(;m<s.length;m++)null!==(p=d(a,s[m],u))&&(i=o(p,i,m),null===l?c=p:l.sibling=p,l=p);return ai&&Ja(a,m),c}for(p=r(a,p);m<s.length;m++)null!==(v=h(p,a,m,s[m],u))&&(e&&null!==v.alternate&&p.delete(null===v.key?m:v.key),i=o(v,i,m),null===l?c=v:l.sibling=v,l=v);return e&&p.forEach((function(e){return t(a,e)})),ai&&Ja(a,m),c}function v(a,s,u,c){var l=O(u);if("function"!==typeof l)throw Error(i(150));if(null==(u=l.call(u)))throw Error(i(151));for(var p=l=null,m=s,v=s=0,g=null,y=u.next();null!==m&&!y.done;v++,y=u.next()){m.index>v?(g=m,m=null):g=m.sibling;var b=f(a,m,y.value,c);if(null===b){null===m&&(m=g);break}e&&m&&null===b.alternate&&t(a,m),s=o(b,s,v),null===p?l=b:p.sibling=b,p=b,m=g}if(y.done)return n(a,m),ai&&Ja(a,v),l;if(null===m){for(;!y.done;v++,y=u.next())null!==(y=d(a,y.value,c))&&(s=o(y,s,v),null===p?l=y:p.sibling=y,p=y);return ai&&Ja(a,v),l}for(m=r(a,m);!y.done;v++,y=u.next())null!==(y=h(m,a,v,y.value,c))&&(e&&null!==y.alternate&&m.delete(null===y.key?v:y.key),s=o(y,s,v),null===p?l=y:p.sibling=y,p=y);return e&&m.forEach((function(e){return t(a,e)})),ai&&Ja(a,v),l}return function e(r,i,o,u){if("object"===typeof o&&null!==o&&o.type===S&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case k:e:{for(var c=o.key,l=i;null!==l;){if(l.key===c){if((c=o.type)===S){if(7===l.tag){n(r,l.sibling),(i=a(l,o.props.children)).return=r,r=i;break e}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===F&&Xi(c)===l.type){n(r,l.sibling),(i=a(l,o.props)).ref=qi(r,l,o),i.return=r,r=i;break e}n(r,l);break}t(r,l),l=l.sibling}o.type===S?((i=Pc(o.props.children,r.mode,u,o.key)).return=r,r=i):((u=Oc(o.type,o.key,o.props,null,r.mode,u)).ref=qi(r,i,o),u.return=r,r=u)}return s(r);case w:e:{for(l=o.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Bc(o,r.mode,u)).return=r,r=i}return s(r);case F:return e(r,i,(l=o._init)(o._payload),u)}if(te(o))return m(r,i,o,u);if(O(o))return v(r,i,o,u);Ki(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=zc(o,r.mode,u)).return=r,r=i),s(r)):n(r,i)}}var Qi=Yi(!0),Zi=Yi(!1),Ji={},$i=Ia(Ji),eo=Ia(Ji),to=Ia(Ji);function no(e){if(e===Ji)throw Error(i(174));return e}function ro(e,t){switch(Na(to,t),Na(eo,e),Na($i,Ji),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}_a($i),Na($i,t)}function ao(){_a($i),_a(eo),_a(to)}function io(e){no(to.current);var t=no($i.current),n=ue(t,e.type);t!==n&&(Na(eo,e),Na($i,n))}function oo(e){eo.current===e&&(_a($i),_a(eo))}var so=Ia(0);function uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var co=[];function lo(){for(var e=0;e<co.length;e++)co[e]._workInProgressVersionPrimary=null;co.length=0}var po=x.ReactCurrentDispatcher,fo=x.ReactCurrentBatchConfig,ho=0,mo=null,vo=null,go=null,yo=!1,bo=!1,xo=0,ko=0;function wo(){throw Error(i(321))}function So(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function Io(e,t,n,r,a,o){if(ho=o,mo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,po.current=null===e||null===e.memoizedState?ss:us,e=n(r,a),bo){o=0;do{if(bo=!1,xo=0,25<=o)throw Error(i(301));o+=1,go=vo=null,t.updateQueue=null,po.current=cs,e=n(r,a)}while(bo)}if(po.current=os,t=null!==vo&&null!==vo.next,ho=0,go=vo=mo=null,yo=!1,t)throw Error(i(300));return e}function _o(){var e=0!==xo;return xo=0,e}function No(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?mo.memoizedState=go=e:go=go.next=e,go}function Co(){if(null===vo){var e=mo.alternate;e=null!==e?e.memoizedState:null}else e=vo.next;var t=null===go?mo.memoizedState:go.next;if(null!==t)go=t,vo=e;else{if(null===e)throw Error(i(310));e={memoizedState:(vo=e).memoizedState,baseState:vo.baseState,baseQueue:vo.baseQueue,queue:vo.queue,next:null},null===go?mo.memoizedState=go=e:go=go.next=e}return go}function To(e,t){return"function"===typeof t?t(e):t}function Eo(e){var t=Co(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=vo,a=r.baseQueue,o=n.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(null!==a){o=a.next,r=r.baseState;var u=s=null,c=null,l=o;do{var p=l.lane;if((ho&p)===p)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var d={lane:p,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=d,s=r):c=c.next=d,mo.lanes|=p,Lu|=p}l=l.next}while(null!==l&&l!==o);null===c?s=r:c.next=u,sr(r,t.memoizedState)||(xs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{o=a.lane,mo.lanes|=o,Lu|=o,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ao(e){var t=Co(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);sr(o,t.memoizedState)||(xs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Ro(){}function Fo(e,t){var n=mo,r=Co(),a=t(),o=!sr(r.memoizedState,a);if(o&&(r.memoizedState=a,xs=!0),r=r.queue,Go(Oo.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,Bo(9,Mo.bind(null,n,r,a,t),void 0,null),null===Au)throw Error(i(349));0!==(30&ho)||Do(n,t,a)}return a}function Do(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Mo(e,t,n,r){t.value=n,t.getSnapshot=r,Po(t)&&Lo(e)}function Oo(e,t,n){return n((function(){Po(t)&&Lo(e)}))}function Po(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Lo(e){var t=Ei(e,1);null!==t&&rc(t,e,1,-1)}function zo(e){var t=No();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:To,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,mo,e),[t.memoizedState,e]}function Bo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=mo.updateQueue)?(t={lastEffect:null,stores:null},mo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Wo(){return Co().memoizedState}function Uo(e,t,n,r){var a=No();mo.flags|=e,a.memoizedState=Bo(1|t,n,void 0,void 0===r?null:r)}function Vo(e,t,n,r){var a=Co();r=void 0===r?null:r;var i=void 0;if(null!==vo){var o=vo.memoizedState;if(i=o.destroy,null!==r&&So(r,o.deps))return void(a.memoizedState=Bo(t,n,i,r))}mo.flags|=e,a.memoizedState=Bo(1|t,n,i,r)}function jo(e,t){return Uo(8390656,8,e,t)}function Go(e,t){return Vo(2048,8,e,t)}function Ho(e,t){return Vo(4,2,e,t)}function qo(e,t){return Vo(4,4,e,t)}function Ko(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Xo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Vo(4,4,Ko.bind(null,t,e),n)}function Yo(){}function Qo(e,t){var n=Co();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&So(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Zo(e,t){var n=Co();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&So(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Jo(e,t,n){return 0===(21&ho)?(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=n):(sr(n,t)||(n=mt(),mo.lanes|=n,Lu|=n,e.baseState=!0),t)}function $o(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=fo.transition;fo.transition={};try{e(!1),t()}finally{bt=n,fo.transition=r}}function es(){return Co().memoizedState}function ts(e,t,n){var r=nc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))as(t,n);else if(null!==(n=Ti(e,t,n,r))){rc(n,e,r,tc()),is(n,t,r)}}function ns(e,t,n){var r=nc(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))as(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,sr(s,o)){var u=t.interleaved;return null===u?(a.next=a,Ci(t)):(a.next=u.next,u.next=a),void(t.interleaved=a)}}catch(c){}null!==(n=Ti(e,t,a,r))&&(rc(n,e,r,a=tc()),is(n,t,r))}}function rs(e){var t=e.alternate;return e===mo||null!==t&&t===mo}function as(e,t){bo=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function is(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var os={readContext:_i,useCallback:wo,useContext:wo,useEffect:wo,useImperativeHandle:wo,useInsertionEffect:wo,useLayoutEffect:wo,useMemo:wo,useReducer:wo,useRef:wo,useState:wo,useDebugValue:wo,useDeferredValue:wo,useTransition:wo,useMutableSource:wo,useSyncExternalStore:wo,useId:wo,unstable_isNewReconciler:!1},ss={readContext:_i,useCallback:function(e,t){return No().memoizedState=[e,void 0===t?null:t],e},useContext:_i,useEffect:jo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Uo(4194308,4,Ko.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Uo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Uo(4,2,e,t)},useMemo:function(e,t){var n=No();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=No();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,mo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},No().memoizedState=e},useState:zo,useDebugValue:Yo,useDeferredValue:function(e){return No().memoizedState=e},useTransition:function(){var e=zo(!1),t=e[0];return e=$o.bind(null,e[1]),No().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=mo,a=No();if(ai){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Au)throw Error(i(349));0!==(30&ho)||Do(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,jo(Oo.bind(null,r,o,e),[e]),r.flags|=2048,Bo(9,Mo.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=No(),t=Au.identifierPrefix;if(ai){var n=Za;t=":"+t+"R"+(n=(Qa&~(1<<32-ot(Qa)-1)).toString(32)+n),0<(n=xo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ko++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},us={readContext:_i,useCallback:Qo,useContext:_i,useEffect:Go,useImperativeHandle:Xo,useInsertionEffect:Ho,useLayoutEffect:qo,useMemo:Zo,useReducer:Eo,useRef:Wo,useState:function(){return Eo(To)},useDebugValue:Yo,useDeferredValue:function(e){return Jo(Co(),vo.memoizedState,e)},useTransition:function(){return[Eo(To)[0],Co().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Fo,useId:es,unstable_isNewReconciler:!1},cs={readContext:_i,useCallback:Qo,useContext:_i,useEffect:Go,useImperativeHandle:Xo,useInsertionEffect:Ho,useLayoutEffect:qo,useMemo:Zo,useReducer:Ao,useRef:Wo,useState:function(){return Ao(To)},useDebugValue:Yo,useDeferredValue:function(e){var t=Co();return null===vo?t.memoizedState=e:Jo(t,vo.memoizedState,e)},useTransition:function(){return[Ao(To)[0],Co().memoizedState]},useMutableSource:Ro,useSyncExternalStore:Fo,useId:es,unstable_isNewReconciler:!1};function ls(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a,digest:null}}function ps(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fs="function"===typeof WeakMap?WeakMap:Map;function hs(e,t,n){(n=Di(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Hu||(Hu=!0,qu=r),ds(0,t)},n}function ms(e,t,n){(n=Di(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){ds(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){ds(0,t),"function"!==typeof r&&(null===Ku?Ku=new Set([this]):Ku.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function vs(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new fs;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Nc.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Di(-1,1)).tag=2,Mi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bs=x.ReactCurrentOwner,xs=!1;function ks(e,t,n,r){t.child=null===e?Zi(t,null,n,r):Qi(t,e.child,n,r)}function ws(e,t,n,r,a){n=n.render;var i=t.ref;return Ii(t,a),r=Io(e,t,n,r,i,a),n=_o(),null===e||xs?(ai&&n&&ei(t),t.flags|=1,ks(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Hs(e,t,a))}function Ss(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||Dc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Oc(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Is(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(o,r)&&e.ref===t.ref)return Hs(e,t,a)}return t.flags|=1,(e=Mc(i,r)).ref=t.ref,e.return=t,t.child=e}function Is(e,t,n,r,a){if(null!==e){var i=e.memoizedProps;if(ur(i,r)&&e.ref===t.ref){if(xs=!1,t.pendingProps=r=i,0===(e.lanes&a))return t.lanes=e.lanes,Hs(e,t,a);0!==(131072&e.flags)&&(xs=!0)}}return Cs(e,t,n,r,a)}function _s(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Na(Mu,Du),Du|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Na(Mu,Du),Du|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Na(Mu,Du),Du|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Na(Mu,Du),Du|=r;return ks(e,t,a,n),t.child}function Ns(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Cs(e,t,n,r,a){var i=Fa(n)?Aa:Ta.current;return i=Ra(t,i),Ii(t,a),n=Io(e,t,n,r,i,a),r=_o(),null===e||xs?(ai&&r&&ei(t),t.flags|=1,ks(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Hs(e,t,a))}function Ts(e,t,n,r,a){if(Fa(n)){var i=!0;Pa(t)}else i=!1;if(Ii(t,a),null===t.stateNode)Gs(e,t),ji(t,n,r),Hi(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=_i(c):c=Ra(t,c=Fa(n)?Aa:Ta.current);var l=n.getDerivedStateFromProps,p="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;p||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&Gi(t,o,r,c),Ai=!1;var d=t.memoizedState;o.state=d,Li(t,r,o,a),u=t.memoizedState,s!==r||d!==u||Ea.current||Ai?("function"===typeof l&&(Wi(t,n,l,r),u=t.memoizedState),(s=Ai||Vi(t,n,s,r,d,u,c))?(p||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Fi(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:vi(t.type,s),o.props=c,p=t.pendingProps,d=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=_i(u):u=Ra(t,u=Fa(n)?Aa:Ta.current);var f=n.getDerivedStateFromProps;(l="function"===typeof f||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==p||d!==u)&&Gi(t,o,r,u),Ai=!1,d=t.memoizedState,o.state=d,Li(t,r,o,a);var h=t.memoizedState;s!==p||d!==h||Ea.current||Ai?("function"===typeof f&&(Wi(t,n,f,r),h=t.memoizedState),(c=Ai||Vi(t,n,c,r,d,h,u)||!1)?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,h,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,h,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=h),o.props=r,o.state=h,o.context=u,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Es(e,t,n,r,i,a)}function Es(e,t,n,r,a,i){Ns(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&La(t,n,!1),Hs(e,t,i);r=t.stateNode,bs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Qi(t,e.child,null,i),t.child=Qi(t,null,s,i)):ks(e,t,s,i),t.memoizedState=r.state,a&&La(t,n,!0),t.child}function As(e){var t=e.stateNode;t.pendingContext?Ma(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Ma(0,t.context,!1),ro(e,t.containerInfo)}function Rs(e,t,n,r,a){return fi(),hi(a),t.flags|=256,ks(e,t,n,r),t.child}var Fs,Ds,Ms,Os,Ps={dehydrated:null,treeContext:null,retryLane:0};function Ls(e){return{baseLanes:e,cachePool:null,transitions:null}}function zs(e,t,n){var r,a=t.pendingProps,o=so.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Na(so,1&o),null===e)return ci(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=a.children,e=a.fallback,s?(a=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Lc(u,a,0,null),e=Pc(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ls(n),t.memoizedState=Ps,e):Bs(t,u));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,a,o,s){if(n)return 256&t.flags?(t.flags&=-257,Ws(e,t,s,r=ps(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=Lc({mode:"visible",children:r.children},a,0,null),(o=Pc(o,a,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Qi(t,e.child,null,s),t.child.memoizedState=Ls(s),t.memoizedState=Ps,o);if(0===(1&t.mode))return Ws(e,t,s,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var u=r.dgst;return r=u,Ws(e,t,s,r=ps(o=Error(i(419)),r,void 0))}if(u=0!==(s&e.childLanes),xs||u){if(null!==(r=Au)){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|s))?0:a)&&a!==o.retryLane&&(o.retryLane=a,Ei(e,a),rc(r,e,a,-1))}return vc(),Ws(e,t,s,r=ps(Error(i(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Tc.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,ri=ca(a.nextSibling),ni=t,ai=!0,ii=null,null!==e&&(Ka[Xa++]=Qa,Ka[Xa++]=Za,Ka[Xa++]=Ya,Qa=e.id,Za=e.overflow,Ya=t),t=Bs(t,r.children),t.flags|=4096,t)}(e,t,u,a,r,o,n);if(s){s=a.fallback,u=t.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:a.children};return 0===(1&u)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null):(a=Mc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Mc(r,s):(s=Pc(s,u,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,u=null===(u=e.child.memoizedState)?Ls(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Ps,a}return e=(s=e.child).sibling,a=Mc(s,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function Bs(e,t){return(t=Lc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ws(e,t,n,r){return null!==r&&hi(r),Qi(t,e.child,null,n),(e=Bs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Us(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),Si(e.return,t,n)}function Vs(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function js(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(ks(e,t,r.children,n),0!==(2&(r=so.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Us(e,n,t);else if(19===e.tag)Us(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Na(so,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===uo(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Vs(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===uo(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Vs(t,!0,n,null,i);break;case"together":Vs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Gs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Hs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Lu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Mc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Mc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function qs(e,t){if(!ai)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ks(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Xs(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ks(t),null;case 1:case 17:return Fa(t.type)&&Da(),Ks(t),null;case 3:return r=t.stateNode,ao(),_a(Ea),_a(Ta),lo(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(pi(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(sc(ii),ii=null))),Ds(e,t),Ks(t),null;case 5:oo(t);var a=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Ms(e,t,n,r,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Ks(t),null}if(e=no($i.current),pi(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[da]=t,r[fa]=o,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(a=0;a<Or.length;a++)Br(Or[a],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":Q(r,o),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Br("invalid",r);break;case"textarea":ae(r,o),Br("invalid",r)}for(var u in ye(n,o),a=null,o)if(o.hasOwnProperty(u)){var c=o[u];"children"===u?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),a=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),a=["children",""+c]):s.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&Br("scroll",r)}switch(n){case"input":q(r),$(r,o,!0);break;case"textarea":q(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=$r)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[da]=t,e[fa]=r,Fs(e,t,!1,!1),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":Br("cancel",e),Br("close",e),a=r;break;case"iframe":case"object":case"embed":Br("load",e),a=r;break;case"video":case"audio":for(a=0;a<Or.length;a++)Br(Or[a],e);a=r;break;case"source":Br("error",e),a=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),a=r;break;case"details":Br("toggle",e),a=r;break;case"input":Q(e,r),a=Y(e,r),Br("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=L({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),Br("invalid",e)}for(o in ye(n,a),c=a)if(c.hasOwnProperty(o)){var l=c[o];"style"===o?ve(e,l):"dangerouslySetInnerHTML"===o?null!=(l=l?l.__html:void 0)&&pe(e,l):"children"===o?"string"===typeof l?("textarea"!==n||""!==l)&&de(e,l):"number"===typeof l&&de(e,""+l):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=l&&"onScroll"===o&&Br("scroll",e):null!=l&&b(e,o,l,u))}switch(n){case"input":q(e),$(e,r,!1);break;case"textarea":q(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+G(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ks(t),null;case 6:if(e&&null!=t.stateNode)Os(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=no(to.current),no($i.current),pi(t)){if(r=t.stateNode,n=t.memoizedProps,r[da]=t,(o=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Jr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[da]=t,t.stateNode=r}return Ks(t),null;case 13:if(_a(so),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ai&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))di(),fi(),t.flags|=98560,o=!1;else if(o=pi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[da]=t}else fi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ks(t),o=!1}else null!==ii&&(sc(ii),ii=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Ou&&(Ou=3):vc())),null!==t.updateQueue&&(t.flags|=4),Ks(t),null);case 4:return ao(),Ds(e,t),null===e&&Vr(t.stateNode.containerInfo),Ks(t),null;case 10:return wi(t.type._context),Ks(t),null;case 19:if(_a(so),null===(o=t.memoizedState))return Ks(t),null;if(r=0!==(128&t.flags),null===(u=o.rendering))if(r)qs(o,!1);else{if(0!==Ou||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=uo(e))){for(t.flags|=128,qs(o,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(u=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,e=u.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Na(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Ze()>ju&&(t.flags|=128,r=!0,qs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=uo(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),qs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!u.alternate&&!ai)return Ks(t),null}else 2*Ze()-o.renderingStartTime>ju&&1073741824!==n&&(t.flags|=128,r=!0,qs(o,!1),t.lanes=4194304);o.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=o.last)?n.sibling=u:t.child=u,o.last=u)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Ze(),t.sibling=null,n=so.current,Na(so,r?1&n|2:1&n),t):(Ks(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Du)&&(Ks(t),6&t.subtreeFlags&&(t.flags|=8192)):Ks(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Ys(e,t){switch(ti(t),t.tag){case 1:return Fa(t.type)&&Da(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ao(),_a(Ea),_a(Ta),lo(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(_a(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));fi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return _a(so),null;case 4:return ao(),null;case 10:return wi(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Fs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(){},Ms=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,no($i.current);var i,o=null;switch(n){case"input":a=Y(e,a),r=Y(e,r),o=[];break;case"select":a=L({},a,{value:void 0}),r=L({},r,{value:void 0}),o=[];break;case"textarea":a=re(e,a),r=re(e,r),o=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in ye(n,r),n=null,a)if(!r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&null!=a[l])if("style"===l){var u=a[l];for(i in u)u.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var c=r[l];if(u=null!=a?a[l]:void 0,r.hasOwnProperty(l)&&c!==u&&(null!=c||null!=u))if("style"===l)if(u){for(i in u)!u.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&u[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(o||(o=[]),o.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(o=o||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&Br("scroll",e),o||u===c||(o=[])):(o=o||[]).push(l,c))}n&&(o=o||[]).push("style",n);var l=o;(t.updateQueue=l)&&(t.flags|=4)}},Os=function(e,t,n,r){n!==r&&(t.flags|=4)};var Qs=!1,Zs=!1,Js="function"===typeof WeakSet?WeakSet:Set,$s=null;function eu(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){_c(e,t,r)}else n.current=null}function tu(e,t,n){try{n()}catch(r){_c(e,t,r)}}var nu=!1;function ru(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&tu(t,n,i)}a=a.next}while(a!==r)}}function au(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function iu(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function ou(e){var t=e.alternate;null!==t&&(e.alternate=null,ou(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[da],delete t[fa],delete t[ma],delete t[va],delete t[ga])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function su(e){return 5===e.tag||3===e.tag||4===e.tag}function uu(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||su(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(cu(e,t,n),e=e.sibling;null!==e;)cu(e,t,n),e=e.sibling}function lu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(lu(e,t,n),e=e.sibling;null!==e;)lu(e,t,n),e=e.sibling}var pu=null,du=!1;function fu(e,t,n){for(n=n.child;null!==n;)hu(e,t,n),n=n.sibling}function hu(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(at,n)}catch(s){}switch(n.tag){case 5:Zs||eu(n,t);case 6:var r=pu,a=du;pu=null,fu(e,t,n),du=a,null!==(pu=r)&&(du?(e=pu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):pu.removeChild(n.stateNode));break;case 18:null!==pu&&(du?(e=pu,n=n.stateNode,8===e.nodeType?ua(e.parentNode,n):1===e.nodeType&&ua(e,n),Vt(e)):ua(pu,n.stateNode));break;case 4:r=pu,a=du,pu=n.stateNode.containerInfo,du=!0,fu(e,t,n),pu=r,du=a;break;case 0:case 11:case 14:case 15:if(!Zs&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,void 0!==o&&(0!==(2&i)||0!==(4&i))&&tu(n,t,o),a=a.next}while(a!==r)}fu(e,t,n);break;case 1:if(!Zs&&(eu(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){_c(n,t,s)}fu(e,t,n);break;case 21:fu(e,t,n);break;case 22:1&n.mode?(Zs=(r=Zs)||null!==n.memoizedState,fu(e,t,n),Zs=r):fu(e,t,n);break;default:fu(e,t,n)}}function mu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Js),t.forEach((function(t){var r=Ec.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function vu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var o=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:pu=u.stateNode,du=!1;break e;case 3:case 4:pu=u.stateNode.containerInfo,du=!0;break e}u=u.return}if(null===pu)throw Error(i(160));hu(o,s,a),pu=null,du=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(l){_c(a,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)gu(t,e),t=t.sibling}function gu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vu(t,e),yu(e),4&r){try{ru(3,e,e.return),au(3,e)}catch(v){_c(e,e.return,v)}try{ru(5,e,e.return)}catch(v){_c(e,e.return,v)}}break;case 1:vu(t,e),yu(e),512&r&&null!==n&&eu(n,n.return);break;case 5:if(vu(t,e),yu(e),512&r&&null!==n&&eu(n,n.return),32&e.flags){var a=e.stateNode;try{de(a,"")}catch(v){_c(e,e.return,v)}}if(4&r&&null!=(a=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,u=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===u&&"radio"===o.type&&null!=o.name&&Z(a,o),be(u,s);var l=be(u,o);for(s=0;s<c.length;s+=2){var p=c[s],d=c[s+1];"style"===p?ve(a,d):"dangerouslySetInnerHTML"===p?pe(a,d):"children"===p?de(a,d):b(a,p,d,l)}switch(u){case"input":J(a,o);break;case"textarea":ie(a,o);break;case"select":var f=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var h=o.value;null!=h?ne(a,!!o.multiple,h,!1):f!==!!o.multiple&&(null!=o.defaultValue?ne(a,!!o.multiple,o.defaultValue,!0):ne(a,!!o.multiple,o.multiple?[]:"",!1))}a[fa]=o}catch(v){_c(e,e.return,v)}}break;case 6:if(vu(t,e),yu(e),4&r){if(null===e.stateNode)throw Error(i(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(v){_c(e,e.return,v)}}break;case 3:if(vu(t,e),yu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Vt(t.containerInfo)}catch(v){_c(e,e.return,v)}break;case 4:default:vu(t,e),yu(e);break;case 13:vu(t,e),yu(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Vu=Ze())),4&r&&mu(e);break;case 22:if(p=null!==n&&null!==n.memoizedState,1&e.mode?(Zs=(l=Zs)||p,vu(t,e),Zs=l):vu(t,e),yu(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!p&&0!==(1&e.mode))for($s=e,p=e.child;null!==p;){for(d=$s=p;null!==$s;){switch(h=(f=$s).child,f.tag){case 0:case 11:case 14:case 15:ru(4,f,f.return);break;case 1:eu(f,f.return);var m=f.stateNode;if("function"===typeof m.componentWillUnmount){r=f,n=f.return;try{t=r,m.props=t.memoizedProps,m.state=t.memoizedState,m.componentWillUnmount()}catch(v){_c(r,n,v)}}break;case 5:eu(f,f.return);break;case 22:if(null!==f.memoizedState){wu(d);continue}}null!==h?(h.return=f,$s=h):wu(d)}p=p.sibling}e:for(p=null,d=e;;){if(5===d.tag){if(null===p){p=d;try{a=d.stateNode,l?"function"===typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(u=d.stateNode,s=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,u.style.display=me("display",s))}catch(v){_c(e,e.return,v)}}}else if(6===d.tag){if(null===p)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(v){_c(e,e.return,v)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;p===d&&(p=null),d=d.return}p===d&&(p=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:vu(t,e),yu(e),4&r&&mu(e);case 21:}}function yu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(su(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(de(a,""),r.flags&=-33),lu(e,uu(e),a);break;case 3:case 4:var o=r.stateNode.containerInfo;cu(e,uu(e),o);break;default:throw Error(i(161))}}catch(s){_c(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function bu(e,t,n){$s=e,xu(e,t,n)}function xu(e,t,n){for(var r=0!==(1&e.mode);null!==$s;){var a=$s,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||Qs;if(!o){var s=a.alternate,u=null!==s&&null!==s.memoizedState||Zs;s=Qs;var c=Zs;if(Qs=o,(Zs=u)&&!c)for($s=a;null!==$s;)u=(o=$s).child,22===o.tag&&null!==o.memoizedState?Su(a):null!==u?(u.return=o,$s=u):Su(a);for(;null!==i;)$s=i,xu(i,t,n),i=i.sibling;$s=a,Qs=s,Zs=c}ku(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,$s=i):ku(e)}}function ku(e){for(;null!==$s;){var t=$s;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Zs||au(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Zs)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:vi(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&zi(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}zi(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var p=l.memoizedState;if(null!==p){var d=p.dehydrated;null!==d&&Vt(d)}}}break;default:throw Error(i(163))}Zs||512&t.flags&&iu(t)}catch(f){_c(t,t.return,f)}}if(t===e){$s=null;break}if(null!==(n=t.sibling)){n.return=t.return,$s=n;break}$s=t.return}}function wu(e){for(;null!==$s;){var t=$s;if(t===e){$s=null;break}var n=t.sibling;if(null!==n){n.return=t.return,$s=n;break}$s=t.return}}function Su(e){for(;null!==$s;){var t=$s;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{au(4,t)}catch(u){_c(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(u){_c(t,a,u)}}var i=t.return;try{iu(t)}catch(u){_c(t,i,u)}break;case 5:var o=t.return;try{iu(t)}catch(u){_c(t,o,u)}}}catch(u){_c(t,t.return,u)}if(t===e){$s=null;break}var s=t.sibling;if(null!==s){s.return=t.return,$s=s;break}$s=t.return}}var Iu,_u=Math.ceil,Nu=x.ReactCurrentDispatcher,Cu=x.ReactCurrentOwner,Tu=x.ReactCurrentBatchConfig,Eu=0,Au=null,Ru=null,Fu=0,Du=0,Mu=Ia(0),Ou=0,Pu=null,Lu=0,zu=0,Bu=0,Wu=null,Uu=null,Vu=0,ju=1/0,Gu=null,Hu=!1,qu=null,Ku=null,Xu=!1,Yu=null,Qu=0,Zu=0,Ju=null,$u=-1,ec=0;function tc(){return 0!==(6&Eu)?Ze():-1!==$u?$u:$u=Ze()}function nc(e){return 0===(1&e.mode)?1:0!==(2&Eu)&&0!==Fu?Fu&-Fu:null!==mi.transition?(0===ec&&(ec=mt()),ec):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function rc(e,t,n,r){if(50<Zu)throw Zu=0,Ju=null,Error(i(185));gt(e,n,r),0!==(2&Eu)&&e===Au||(e===Au&&(0===(2&Eu)&&(zu|=n),4===Ou&&uc(e,Fu)),ac(e,r),1===n&&0===Eu&&0===(1&t.mode)&&(ju=Ze()+500,Ba&&Va()))}function ac(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-ot(i),s=1<<o,u=a[o];-1===u?0!==(s&n)&&0===(s&r)||(a[o]=ft(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=dt(e,e===Au?Fu:0);if(0===r)null!==n&&Xe(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Xe(n),1===t)0===e.tag?function(e){Ba=!0,Ua(e)}(cc.bind(null,e)):Ua(cc.bind(null,e)),oa((function(){0===(6&Eu)&&Va()})),n=null;else{switch(xt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ac(n,ic.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ic(e,t){if($u=-1,ec=0,0!==(6&Eu))throw Error(i(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var r=dt(e,e===Au?Fu:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=gc(e,r);else{t=r;var a=Eu;Eu|=2;var o=mc();for(Au===e&&Fu===t||(Gu=null,ju=Ze()+500,fc(e,t));;)try{bc();break}catch(u){hc(e,u)}ki(),Nu.current=o,Eu=a,null!==Ru?t=0:(Au=null,Fu=0,t=Ou)}if(0!==t){if(2===t&&(0!==(a=ht(e))&&(r=a,t=oc(e,a))),1===t)throw n=Pu,fc(e,0),uc(e,r),ac(e,Ze()),n;if(6===t)uc(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!sr(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=gc(e,r))&&(0!==(o=ht(e))&&(r=o,t=oc(e,o))),1===t))throw n=Pu,fc(e,0),uc(e,r),ac(e,Ze()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:wc(e,Uu,Gu);break;case 3:if(uc(e,r),(130023424&r)===r&&10<(t=Vu+500-Ze())){if(0!==dt(e,0))break;if(((a=e.suspendedLanes)&r)!==r){tc(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(wc.bind(null,e,Uu,Gu),t);break}wc(e,Uu,Gu);break;case 4:if(uc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>a&&(a=s),r&=~o}if(r=a,10<(r=(120>(r=Ze()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*_u(r/1960))-r)){e.timeoutHandle=ra(wc.bind(null,e,Uu,Gu),r);break}wc(e,Uu,Gu);break;default:throw Error(i(329))}}}return ac(e,Ze()),e.callbackNode===n?ic.bind(null,e):null}function oc(e,t){var n=Wu;return e.current.memoizedState.isDehydrated&&(fc(e,t).flags|=256),2!==(e=gc(e,t))&&(t=Uu,Uu=n,null!==t&&sc(t)),e}function sc(e){null===Uu?Uu=e:Uu.push.apply(Uu,e)}function uc(e,t){for(t&=~Bu,t&=~zu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function cc(e){if(0!==(6&Eu))throw Error(i(327));Sc();var t=dt(e,0);if(0===(1&t))return ac(e,Ze()),null;var n=gc(e,t);if(0!==e.tag&&2===n){var r=ht(e);0!==r&&(t=r,n=oc(e,r))}if(1===n)throw n=Pu,fc(e,0),uc(e,t),ac(e,Ze()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,wc(e,Uu,Gu),ac(e,Ze()),null}function lc(e,t){var n=Eu;Eu|=1;try{return e(t)}finally{0===(Eu=n)&&(ju=Ze()+500,Ba&&Va())}}function pc(e){null!==Yu&&0===Yu.tag&&0===(6&Eu)&&Sc();var t=Eu;Eu|=1;var n=Tu.transition,r=bt;try{if(Tu.transition=null,bt=1,e)return e()}finally{bt=r,Tu.transition=n,0===(6&(Eu=t))&&Va()}}function dc(){Du=Mu.current,_a(Mu)}function fc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Ru)for(n=Ru.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Da();break;case 3:ao(),_a(Ea),_a(Ta),lo();break;case 5:oo(r);break;case 4:ao();break;case 13:case 19:_a(so);break;case 10:wi(r.type._context);break;case 22:case 23:dc()}n=n.return}if(Au=e,Ru=e=Mc(e.current,null),Fu=Du=t,Ou=0,Pu=null,Bu=zu=Lu=0,Uu=Wu=null,null!==Ni){for(t=0;t<Ni.length;t++)if(null!==(r=(n=Ni[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}Ni=null}return e}function hc(e,t){for(;;){var n=Ru;try{if(ki(),po.current=os,yo){for(var r=mo.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}yo=!1}if(ho=0,go=vo=mo=null,bo=!1,xo=0,Cu.current=null,null===n||null===n.return){Ou=1,Pu=t,Ru=null;break}e:{var o=e,s=n.return,u=n,c=t;if(t=Fu,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,p=u,d=p.tag;if(0===(1&p.mode)&&(0===d||11===d||15===d)){var f=p.alternate;f?(p.updateQueue=f.updateQueue,p.memoizedState=f.memoizedState,p.lanes=f.lanes):(p.updateQueue=null,p.memoizedState=null)}var h=gs(s);if(null!==h){h.flags&=-257,ys(h,s,u,0,t),1&h.mode&&vs(o,l,t),c=l;var m=(t=h).updateQueue;if(null===m){var v=new Set;v.add(c),t.updateQueue=v}else m.add(c);break e}if(0===(1&t)){vs(o,l,t),vc();break e}c=Error(i(426))}else if(ai&&1&u.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),ys(g,s,u,0,t),hi(ls(c,u));break e}}o=c=ls(c,u),4!==Ou&&(Ou=2),null===Wu?Wu=[o]:Wu.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Pi(o,hs(0,c,t));break e;case 1:u=c;var y=o.type,b=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Ku||!Ku.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Pi(o,ms(o,u,t));break e}}o=o.return}while(null!==o)}kc(n)}catch(x){t=x,Ru===n&&null!==n&&(Ru=n=n.return);continue}break}}function mc(){var e=Nu.current;return Nu.current=os,null===e?os:e}function vc(){0!==Ou&&3!==Ou&&2!==Ou||(Ou=4),null===Au||0===(268435455&Lu)&&0===(268435455&zu)||uc(Au,Fu)}function gc(e,t){var n=Eu;Eu|=2;var r=mc();for(Au===e&&Fu===t||(Gu=null,fc(e,t));;)try{yc();break}catch(a){hc(e,a)}if(ki(),Eu=n,Nu.current=r,null!==Ru)throw Error(i(261));return Au=null,Fu=0,Ou}function yc(){for(;null!==Ru;)xc(Ru)}function bc(){for(;null!==Ru&&!Ye();)xc(Ru)}function xc(e){var t=Iu(e.alternate,e,Du);e.memoizedProps=e.pendingProps,null===t?kc(e):Ru=t,Cu.current=null}function kc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xs(n,t,Du)))return void(Ru=n)}else{if(null!==(n=Ys(n,t)))return n.flags&=32767,void(Ru=n);if(null===e)return Ou=6,void(Ru=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Ru=t);Ru=t=e}while(null!==t);0===Ou&&(Ou=5)}function wc(e,t,n){var r=bt,a=Tu.transition;try{Tu.transition=null,bt=1,function(e,t,n,r){do{Sc()}while(null!==Yu);if(0!==(6&Eu))throw Error(i(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-ot(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,o),e===Au&&(Ru=Au=null,Fu=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xu||(Xu=!0,Ac(tt,(function(){return Sc(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Tu.transition,Tu.transition=null;var s=bt;bt=1;var u=Eu;Eu|=4,Cu.current=null,function(e,t){if(ea=Gt,fr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(k){n=null;break e}var s=0,u=-1,c=-1,l=0,p=0,d=e,f=null;t:for(;;){for(var h;d!==n||0!==a&&3!==d.nodeType||(u=s+a),d!==o||0!==r&&3!==d.nodeType||(c=s+r),3===d.nodeType&&(s+=d.nodeValue.length),null!==(h=d.firstChild);)f=d,d=h;for(;;){if(d===e)break t;if(f===n&&++l===a&&(u=s),f===o&&++p===r&&(c=s),null!==(h=d.nextSibling))break;f=(d=f).parentNode}d=h}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},Gt=!1,$s=t;null!==$s;)if(e=(t=$s).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,$s=e;else for(;null!==$s;){t=$s;try{var m=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==m){var v=m.memoizedProps,g=m.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?v:vi(t.type,v),g);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(i(163))}}catch(k){_c(t,t.return,k)}if(null!==(e=t.sibling)){e.return=t.return,$s=e;break}$s=t.return}m=nu,nu=!1}(e,n),gu(n,e),hr(ta),Gt=!!ea,ta=ea=null,e.current=n,bu(n,e,a),Qe(),Eu=u,bt=s,Tu.transition=o}else e.current=n;if(Xu&&(Xu=!1,Yu=e,Qu=a),o=e.pendingLanes,0===o&&(Ku=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ac(e,Ze()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)a=t[n],r(a.value,{componentStack:a.stack,digest:a.digest});if(Hu)throw Hu=!1,e=qu,qu=null,e;0!==(1&Qu)&&0!==e.tag&&Sc(),o=e.pendingLanes,0!==(1&o)?e===Ju?Zu++:(Zu=0,Ju=e):Zu=0,Va()}(e,t,n,r)}finally{Tu.transition=a,bt=r}return null}function Sc(){if(null!==Yu){var e=xt(Qu),t=Tu.transition,n=bt;try{if(Tu.transition=null,bt=16>e?16:e,null===Yu)var r=!1;else{if(e=Yu,Yu=null,Qu=0,0!==(6&Eu))throw Error(i(331));var a=Eu;for(Eu|=4,$s=e.current;null!==$s;){var o=$s,s=o.child;if(0!==(16&$s.flags)){var u=o.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for($s=l;null!==$s;){var p=$s;switch(p.tag){case 0:case 11:case 15:ru(8,p,o)}var d=p.child;if(null!==d)d.return=p,$s=d;else for(;null!==$s;){var f=(p=$s).sibling,h=p.return;if(ou(p),p===l){$s=null;break}if(null!==f){f.return=h,$s=f;break}$s=h}}}var m=o.alternate;if(null!==m){var v=m.child;if(null!==v){m.child=null;do{var g=v.sibling;v.sibling=null,v=g}while(null!==v)}}$s=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,$s=s;else e:for(;null!==$s;){if(0!==(2048&(o=$s).flags))switch(o.tag){case 0:case 11:case 15:ru(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,$s=y;break e}$s=o.return}}var b=e.current;for($s=b;null!==$s;){var x=(s=$s).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,$s=x;else e:for(s=b;null!==$s;){if(0!==(2048&(u=$s).flags))try{switch(u.tag){case 0:case 11:case 15:au(9,u)}}catch(w){_c(u,u.return,w)}if(u===s){$s=null;break e}var k=u.sibling;if(null!==k){k.return=u.return,$s=k;break e}$s=u.return}}if(Eu=a,Va(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(at,e)}catch(w){}r=!0}return r}finally{bt=n,Tu.transition=t}}return!1}function Ic(e,t,n){e=Mi(e,t=hs(0,t=ls(n,t),1),1),t=tc(),null!==e&&(gt(e,1,t),ac(e,t))}function _c(e,t,n){if(3===e.tag)Ic(e,e,n);else for(;null!==t;){if(3===t.tag){Ic(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ku||!Ku.has(r))){t=Mi(t,e=ms(t,e=ls(n,e),1),1),e=tc(),null!==t&&(gt(t,1,e),ac(t,e));break}}t=t.return}}function Nc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,Au===e&&(Fu&n)===n&&(4===Ou||3===Ou&&(130023424&Fu)===Fu&&500>Ze()-Vu?fc(e,0):Bu|=n),ac(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=tc();null!==(e=Ei(e,t))&&(gt(e,t,n),ac(e,n))}function Tc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cc(e,n)}function Ec(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Cc(e,n)}function Ac(e,t){return Ke(e,t)}function Rc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fc(e,t,n,r){return new Rc(e,t,n,r)}function Dc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Mc(e,t){var n=e.alternate;return null===n?((n=Fc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Oc(e,t,n,r,a,o){var s=2;if(r=e,"function"===typeof e)Dc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Pc(n.children,a,o,t);case I:s=8,a|=8;break;case _:return(e=Fc(12,n,t,2|a)).elementType=_,e.lanes=o,e;case E:return(e=Fc(13,n,t,a)).elementType=E,e.lanes=o,e;case A:return(e=Fc(19,n,t,a)).elementType=A,e.lanes=o,e;case D:return Lc(n,a,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case N:s=10;break e;case C:s=9;break e;case T:s=11;break e;case R:s=14;break e;case F:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Fc(s,n,t,a)).elementType=e,t.type=r,t.lanes=o,t}function Pc(e,t,n,r){return(e=Fc(7,e,r,t)).lanes=n,e}function Lc(e,t,n,r){return(e=Fc(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function zc(e,t,n){return(e=Fc(6,e,null,t)).lanes=n,e}function Bc(e,t,n){return(t=Fc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Wc(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=vt(0),this.expirationTimes=vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,r,a,i,o,s,u){return e=new Wc(e,t,n,s,u),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Fc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ri(i),e}function Vc(e){if(!e)return Ca;e:{if(Ve(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Fa(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Fa(n))return Oa(e,n,t)}return t}function jc(e,t,n,r,a,i,o,s,u){return(e=Uc(n,r,!0,e,0,i,0,s,u)).context=Vc(null),n=e.current,(i=Di(r=tc(),a=nc(n))).callback=void 0!==t&&null!==t?t:null,Mi(n,i,a),e.current.lanes=a,gt(e,a,r),ac(e,r),e}function Gc(e,t,n,r){var a=t.current,i=tc(),o=nc(a);return n=Vc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Di(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Mi(a,t,o))&&(rc(e,a,o,i),Oi(e,a,o)),o}function Hc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function qc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Kc(e,t){qc(e,t),(e=e.alternate)&&qc(e,t)}Iu=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ea.current)xs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xs=!1,function(e,t,n){switch(t.tag){case 3:As(t),fi();break;case 5:io(t);break;case 1:Fa(t.type)&&Pa(t);break;case 4:ro(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Na(gi,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Na(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?zs(e,t,n):(Na(so,1&so.current),null!==(e=Hs(e,t,n))?e.sibling:null);Na(so,1&so.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return js(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Na(so,so.current),r)break;return null;case 22:case 23:return t.lanes=0,_s(e,t,n)}return Hs(e,t,n)}(e,t,n);xs=0!==(131072&e.flags)}else xs=!1,ai&&0!==(1048576&t.flags)&&$a(t,qa,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Gs(e,t),e=t.pendingProps;var a=Ra(t,Ta.current);Ii(t,n),a=Io(null,t,r,e,a,n);var o=_o();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Fa(r)?(o=!0,Pa(t)):o=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Ri(t),a.updater=Ui,t.stateNode=a,a._reactInternals=t,Hi(t,r,e,n),t=Es(null,t,r,!0,o,n)):(t.tag=0,ai&&o&&ei(t),ks(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Gs(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Dc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===T)return 11;if(e===R)return 14}return 2}(r),e=vi(r,e),a){case 0:t=Cs(null,t,r,e,n);break e;case 1:t=Ts(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=Ss(null,t,r,vi(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Cs(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 1:return r=t.type,a=t.pendingProps,Ts(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 3:e:{if(As(t),null===e)throw Error(i(387));r=t.pendingProps,a=(o=t.memoizedState).element,Fi(e,t),Li(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Rs(e,t,r,n,a=ls(Error(i(423)),t));break e}if(r!==a){t=Rs(e,t,r,n,a=ls(Error(i(424)),t));break e}for(ri=ca(t.stateNode.containerInfo.firstChild),ni=t,ai=!0,ii=null,n=Zi(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(fi(),r===a){t=Hs(e,t,n);break e}ks(e,t,r,n)}t=t.child}return t;case 5:return io(t),null===e&&ci(t),r=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,na(r,a)?s=null:null!==o&&na(r,o)&&(t.flags|=32),Ns(e,t),ks(e,t,s,n),t.child;case 6:return null===e&&ci(t),null;case 13:return zs(e,t,n);case 4:return ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Qi(t,null,r,n):ks(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,ws(e,t,r,a=t.elementType===r?a:vi(r,a),n);case 7:return ks(e,t,t.pendingProps,n),t.child;case 8:case 12:return ks(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,Na(gi,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===a.children&&!Ea.current){t=Hs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var u=o.dependencies;if(null!==u){s=o.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Di(-1,n&-n)).tag=2;var l=o.updateQueue;if(null!==l){var p=(l=l.shared).pending;null===p?c.next=c:(c.next=p.next,p.next=c),l.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),Si(o.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),Si(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}ks(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Ii(t,n),r=r(a=_i(a)),t.flags|=1,ks(e,t,r,n),t.child;case 14:return a=vi(r=t.type,t.pendingProps),Ss(e,t,r,a=vi(r.type,a),n);case 15:return Is(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:vi(r,a),Gs(e,t),t.tag=1,Fa(r)?(e=!0,Pa(t)):e=!1,Ii(t,n),ji(t,r,a),Hi(t,r,a,n),Es(null,t,r,!0,e,n);case 19:return js(e,t,n);case 22:return _s(e,t,n)}throw Error(i(156,t.tag))};var Xc="function"===typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $c(){}function el(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if("function"===typeof a){var s=a;a=function(){var e=Hc(o);s.call(e)}}Gc(t,o,e,a)}else o=function(e,t,n,r,a){if(a){if("function"===typeof r){var i=r;r=function(){var e=Hc(o);i.call(e)}}var o=jc(t,r,e,0,null,!1,0,"",$c);return e._reactRootContainer=o,e[ha]=o.current,Vr(8===e.nodeType?e.parentNode:e),pc(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var s=r;r=function(){var e=Hc(u);s.call(e)}}var u=Uc(e,0,!1,null,0,!1,0,"",$c);return e._reactRootContainer=u,e[ha]=u.current,Vr(8===e.nodeType?e.parentNode:e),pc((function(){Gc(t,u,n,r)})),u}(n,t,e,a,r);return Hc(o)}Qc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Gc(e,t,null,null)},Qc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;pc((function(){Gc(null,e,null,null)})),t[ha]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=It();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Lt(e)}},kt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=pt(t.pendingLanes);0!==n&&(yt(t,1|n),ac(t,Ze()),0===(6&Eu)&&(ju=Ze()+500,Va()))}break;case 13:pc((function(){var t=Ei(e,1);if(null!==t){var n=tc();rc(t,e,1,n)}})),Kc(e,1)}},wt=function(e){if(13===e.tag){var t=Ei(e,134217728);if(null!==t)rc(t,e,134217728,tc());Kc(e,134217728)}},St=function(e){if(13===e.tag){var t=nc(e),n=Ei(e,t);if(null!==n)rc(n,e,t,tc());Kc(e,t)}},It=function(){return bt},_t=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=ka(r);if(!a)throw Error(i(90));K(r),J(r,a)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Te=lc,Ee=pc;var tl={usingClientEntryPoint:!1,Events:[ba,xa,ka,Ne,Ce,lc]},nl={findFiberByHostInstance:ya,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rl={bundleType:nl.bundleType,version:nl.version,rendererPackageName:nl.rendererPackageName,rendererConfig:nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=He(e))?null:e.stateNode},findFiberByHostInstance:nl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var al=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!al.isDisabled&&al.supportsFiber)try{at=al.inject(rl),it=al}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Zc(t))throw Error(i(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Zc(e))throw Error(i(299));var n=!1,r="",a=Xc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,r,a),e[ha]=t.current,Vr(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=He(t))?null:e.stateNode},t.flushSync=function(e){return pc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(i(200));return el(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Zc(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,a=!1,o="",s=Xc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=jc(t,null,e,1,null!=n?n:null,a,0,o,s),e[ha]=t.current,Vr(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Qc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(i(200));return el(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(i(40));return!!e._reactRootContainer&&(pc((function(){el(null,null,e,!1,(function(){e._reactRootContainer=null,e[ha]=null}))})),!0)},t.unstable_batchedUpdates=lc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return el(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},250:function(e,t,n){"use strict";var r=n(164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(463)},374:function(e,t,n){"use strict";var r=n(791),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!u.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:l,props:i,_owner:s.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},117:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var h={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,v={};function g(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||h}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||h}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var x=b.prototype=new y;x.constructor=b,m(x,g.prototype),x.isPureReactComponent=!0;var k=Array.isArray,w=Object.prototype.hasOwnProperty,S={current:null},I={key:!0,ref:!0,__self:!0,__source:!0};function _(e,t,r){var a,i={},o=null,s=null;if(null!=t)for(a in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,a)&&!I.hasOwnProperty(a)&&(i[a]=t[a]);var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(a in u=e.defaultProps)void 0===i[a]&&(i[a]=u[a]);return{$$typeof:n,type:e,key:o,ref:s,props:i,_owner:S.current}}function N(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var C=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function E(e,t,a,i,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return o=o(u=e),e=""===i?"."+T(u,0):i,k(o)?(a="",null!=e&&(a=e.replace(C,"$&/")+"/"),E(o,t,a,"",(function(e){return e}))):null!=o&&(N(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+e)),t.push(o)),1;if(u=0,i=""===i?".":i+":",k(e))for(var c=0;c<e.length;c++){var l=i+T(s=e[c],c);u+=E(s,t,a,l,o)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)u+=E(s=s.value,t,a,l=i+T(s,c++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function A(e,t,n){if(null==e)return e;var r=[],a=0;return E(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var F={current:null},D={transition:null},M={ReactCurrentDispatcher:F,ReactCurrentBatchConfig:D,ReactCurrentOwner:S};t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!N(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=a,t.Profiler=o,t.PureComponent=b,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=M,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=m({},e.props),i=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=S.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)w.call(t,c)&&!I.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){u=Array(c);for(var l=0;l<c;l++)u[l]=arguments[l+2];a.children=u}return{$$typeof:n,type:e.type,key:i,ref:o,props:a,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=_,t.createFactory=function(e){var t=_.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=N,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:p,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return F.current.useCallback(e,t)},t.useContext=function(e){return F.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return F.current.useDeferredValue(e)},t.useEffect=function(e,t){return F.current.useEffect(e,t)},t.useId=function(){return F.current.useId()},t.useImperativeHandle=function(e,t,n){return F.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return F.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return F.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return F.current.useMemo(e,t)},t.useReducer=function(e,t,n){return F.current.useReducer(e,t,n)},t.useRef=function(e){return F.current.useRef(e)},t.useState=function(e){return F.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return F.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return F.current.useTransition()},t.version="18.2.0"},791:function(e,t,n){"use strict";e.exports=n(117)},184:function(e,t,n){"use strict";e.exports=n(374)},813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,u=e[s],c=s+1,l=e[c];if(0>i(u,n))c<a&&0>i(l,u)?(e[r]=l,e[c]=n,r=c):(e[r]=u,e[s]=n,r=s);else{if(!(c<a&&0>i(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var c=[],l=[],p=1,d=null,f=3,h=!1,m=!1,v=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(l);null!==t;){if(null===t.callback)a(l);else{if(!(t.startTime<=e))break;a(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function k(e){if(v=!1,x(e),!m)if(null!==r(c))m=!0,D(w);else{var t=r(l);null!==t&&M(k,t.startTime-e)}}function w(e,n){m=!1,v&&(v=!1,y(N),N=-1),h=!0;var i=f;try{for(x(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!E());){var o=d.callback;if("function"===typeof o){d.callback=null,f=d.priorityLevel;var s=o(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?d.callback=s:d===r(c)&&a(c),x(n)}else a(c);d=r(c)}if(null!==d)var u=!0;else{var p=r(l);null!==p&&M(k,p.startTime-n),u=!1}return u}finally{d=null,f=i,h=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,I=!1,_=null,N=-1,C=5,T=-1;function E(){return!(t.unstable_now()-T<C)}function A(){if(null!==_){var e=t.unstable_now();T=e;var n=!0;try{n=_(!0,e)}finally{n?S():(I=!1,_=null)}}else I=!1}if("function"===typeof b)S=function(){b(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,F=R.port2;R.port1.onmessage=A,S=function(){F.postMessage(null)}}else S=function(){g(A,0)};function D(e){_=e,I||(I=!0,S())}function M(e,n){N=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){m||h||(m=!0,D(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):C=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:p++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(l,e),null===r(c)&&e===r(l)&&(v?(y(N),N=-1):v=!0,M(k,i-o))):(e.sortIndex=s,n(c,e),m||h||(m=!0,D(w))),e},t.unstable_shouldYield=E,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},296:function(e,t,n){"use strict";e.exports=n(813)},621:function(e){e.exports=function(e,t){var n=0,r={};e.addEventListener("message",(function(t){var n=t.data;if("RPC"===n.type)if(n.id){var a=r[n.id];a&&(delete r[n.id],n.error?a[1](Object.assign(Error(n.error.message),n.error)):a[0](n.result))}else{var i=document.createEvent("Event");i.initEvent(n.method,!1,!1),i.data=n.params,e.dispatchEvent(i)}})),t.forEach((function(t){e[t]=function(){var a=arguments;return new Promise((function(i,o){var s=++n;r[s]=[i,o],e.postMessage({type:"RPC",id:s,method:t,params:[].slice.call(a)})}))}}))}},864:function(e,t,n){var r=n(621),a=["main"];e.exports=function(){var e=new Worker(n.p+"auto-camera-demo/build/d58c1927226318e88805.worker.js",{name:"[fullhash].worker.js"});return URL.revokeObjectURL(n.p+"auto-camera-demo/build/d58c1927226318e88805.worker.js"),r(e,a),e}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.amdO={},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.p="/",function(){"use strict";var e=n(791),t=n(250),r={gradient:"App_gradient__-SnfK",App:"App_App__XVtYz"};function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){if(e){if("string"===typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,s=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(l){c=!0,a=l}finally{try{if(!u&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw a}}return s}}(e,t)||i(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function u(e){var t=function(e,t){if("object"!==s(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===s(t)?t:String(t)}function c(e,t,n){return(t=u(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={Layer:"Layer_Layer__JQMs4",layerContent:"Layer_layerContent__7phdk",layersRoot:"Layer_layersRoot__YxkQd",children:"Layer_children__H2ywW",backdrop:"Layer_backdrop__qu2ZM"};function f(){f=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(A){c=function(e,t,n){return e[t]=n}}function l(e,t,n,a){var i=t&&t.prototype instanceof h?t:h,o=Object.create(i.prototype),s=new C(a||[]);return r(o,"_invoke",{value:S(e,n,s)}),o}function p(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(A){return{type:"throw",arg:A}}}e.wrap=l;var d={};function h(){}function m(){}function v(){}var g={};c(g,i,(function(){return this}));var y=Object.getPrototypeOf,b=y&&y(y(T([])));b&&b!==t&&n.call(b,i)&&(g=b);var x=v.prototype=h.prototype=Object.create(g);function k(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function a(r,i,o,u){var c=p(e[r],e,i);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==s(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){a("next",e,o,u)}),(function(e){a("throw",e,o,u)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return a("throw",e,o,u)}))}u(c.arg)}var i;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){a(e,n,t,r)}))}return i=i?i.then(r,r):r()}})}function S(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return E()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=I(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function I(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,I(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var a=p(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,d;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function T(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:E}}function E(){return{value:void 0,done:!0}}return m.prototype=v,r(x,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:m,configurable:!0}),m.displayName=c(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},k(w.prototype),c(w.prototype,o,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new w(l(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(x),c(x,u,"Generator"),c(x,i,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=T,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(N),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),N(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;N(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:T(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,u(r.key),r)}}function v(e,t,n){return t&&m(e.prototype,t),n&&m(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function y(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){g(i,r,a,o,s,"next",e)}function s(e){g(i,r,a,o,s,"throw",e)}o(void 0)}))}}function b(e,t){var n,r;return function(){for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];t?(clearTimeout(n),n=setTimeout((function(){e.apply(void 0,i)}),t)):(cancelAnimationFrame(r),r=requestAnimationFrame((function(){e.apply(void 0,i)})))}}function x(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw Error("[Immer] minified error nr: "+e+(n.length?" "+n.map((function(e){return"'"+e+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function k(e){return!!e&&!!e[ue]}function w(e){var t;return!!e&&(function(e){if(!e||"object"!=typeof e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===ce}(e)||Array.isArray(e)||!!e[se]||!!(null===(t=e.constructor)||void 0===t?void 0:t[se])||E(e)||A(e))}function S(e,t,n){void 0===n&&(n=!1),0===I(e)?(n?Object.keys:le)(e).forEach((function(r){n&&"symbol"==typeof r||t(r,e[r],e)})):e.forEach((function(n,r){return t(r,n,e)}))}function I(e){var t=e[ue];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:E(e)?2:A(e)?3:0}function _(e,t){return 2===I(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function N(e,t){return 2===I(e)?e.get(t):e[t]}function C(e,t,n){var r=I(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function T(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}function E(e){return re&&e instanceof Map}function A(e){return ae&&e instanceof Set}function R(e){return e.o||e.t}function F(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=pe(e);delete t[ue];for(var n=le(t),r=0;r<n.length;r++){var a=n[r],i=t[a];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[a]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[a]})}return Object.create(Object.getPrototypeOf(e),t)}function D(e,t){return void 0===t&&(t=!1),O(e)||k(e)||!w(e)||(I(e)>1&&(e.set=e.add=e.clear=e.delete=M),Object.freeze(e),t&&S(e,(function(e,t){return D(t,!0)}),!0)),e}function M(){x(2)}function O(e){return null==e||"object"!=typeof e||Object.isFrozen(e)}function P(e){var t=de[e];return t||x(18,e),t}function L(){return te}function z(e,t){t&&(P("Patches"),e.u=[],e.s=[],e.v=t)}function B(e){W(e),e.p.forEach(V),e.p=null}function W(e){e===te&&(te=e.l)}function U(e){return te={p:[],l:te,h:e,m:!0,_:0}}function V(e){var t=e[ue];0===t.i||1===t.i?t.j():t.O=!0}function j(e,t){t._=t.p.length;var n=t.p[0],r=void 0!==e&&e!==n;return t.h.g||P("ES5").S(t,e,r),r?(n[ue].P&&(B(t),x(4)),w(e)&&(e=G(t,e),t.l||q(t,e)),t.u&&P("Patches").M(n[ue].t,e,t.u,t.s)):e=G(t,n,[]),B(t),t.u&&t.v(t.u,t.s),e!==oe?e:void 0}function G(e,t,n){if(O(t))return t;var r=t[ue];if(!r)return S(t,(function(a,i){return H(e,r,t,a,i,n)}),!0),t;if(r.A!==e)return t;if(!r.P)return q(e,r.t,!0),r.t;if(!r.I){r.I=!0,r.A._--;var a=4===r.i||5===r.i?r.o=F(r.k):r.o,i=a,o=!1;3===r.i&&(i=new Set(a),a.clear(),o=!0),S(i,(function(t,i){return H(e,r,a,t,i,n,o)})),q(e,a,!1),n&&e.u&&P("Patches").N(r,n,e.u,e.s)}return r.o}function H(e,t,n,r,a,i,o){if(k(a)){var s=G(e,a,i&&t&&3!==t.i&&!_(t.R,r)?i.concat(r):void 0);if(C(n,r,s),!k(s))return;e.m=!1}else o&&n.add(a);if(w(a)&&!O(a)){if(!e.h.D&&e._<1)return;G(e,a),t&&t.A.l||q(e,a)}}function q(e,t,n){void 0===n&&(n=!1),!e.l&&e.h.D&&e.m&&D(t,n)}function K(e,t){var n=e[ue];return(n?R(n):e)[t]}function X(e,t){if(t in e)for(var n=Object.getPrototypeOf(e);n;){var r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=Object.getPrototypeOf(n)}}function Y(e){e.P||(e.P=!0,e.l&&Y(e.l))}function Q(e){e.o||(e.o=F(e.t))}function Z(e,t,n){var r=E(t)?P("MapSet").F(t,n):A(t)?P("MapSet").T(t,n):e.g?function(e,t){var n=Array.isArray(e),r={i:n?1:0,A:t?t.A:L(),P:!1,I:!1,R:{},l:t,t:e,k:null,o:null,j:null,C:!1},a=r,i=fe;n&&(a=[r],i=he);var o=Proxy.revocable(a,i),s=o.revoke,u=o.proxy;return r.k=u,r.j=s,u}(t,n):P("ES5").J(t,n);return(n?n.A:L()).p.push(r),r}function J(e){return k(e)||x(22,e),function e(t){if(!w(t))return t;var n,r=t[ue],a=I(t);if(r){if(!r.P&&(r.i<4||!P("ES5").K(r)))return r.t;r.I=!0,n=$(t,a),r.I=!1}else n=$(t,a);return S(n,(function(t,a){r&&N(r.t,t)===a||C(n,t,e(a))})),3===a?new Set(n):n}(e)}function $(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return F(e)}var ee,te,ne="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),re="undefined"!=typeof Map,ae="undefined"!=typeof Set,ie="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,oe=ne?Symbol.for("immer-nothing"):((ee={})["immer-nothing"]=!0,ee),se=ne?Symbol.for("immer-draftable"):"__$immer_draftable",ue=ne?Symbol.for("immer-state"):"__$immer_state",ce=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),le="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,pe=Object.getOwnPropertyDescriptors||function(e){var t={};return le(e).forEach((function(n){t[n]=Object.getOwnPropertyDescriptor(e,n)})),t},de={},fe={get:function(e,t){if(t===ue)return e;var n=R(e);if(!_(n,t))return function(e,t,n){var r,a=X(t,n);return a?"value"in a?a.value:null===(r=a.get)||void 0===r?void 0:r.call(e.k):void 0}(e,n,t);var r=n[t];return e.I||!w(r)?r:r===K(e.t,t)?(Q(e),e.o[t]=Z(e.A.h,r,e)):r},has:function(e,t){return t in R(e)},ownKeys:function(e){return Reflect.ownKeys(R(e))},set:function(e,t,n){var r=X(R(e),t);if(null==r?void 0:r.set)return r.set.call(e.k,n),!0;if(!e.P){var a=K(R(e),t),i=null==a?void 0:a[ue];if(i&&i.t===n)return e.o[t]=n,e.R[t]=!1,!0;if(T(n,a)&&(void 0!==n||_(e.t,t)))return!0;Q(e),Y(e)}return e.o[t]===n&&(void 0!==n||t in e.o)||Number.isNaN(n)&&Number.isNaN(e.o[t])||(e.o[t]=n,e.R[t]=!0),!0},deleteProperty:function(e,t){return void 0!==K(e.t,t)||t in e.t?(e.R[t]=!1,Q(e),Y(e)):delete e.R[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var n=R(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.i||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty:function(){x(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){x(12)}},he={};S(fe,(function(e,t){he[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),he.deleteProperty=function(e,t){return he.set.call(this,e,t,void 0)},he.set=function(e,t,n){return fe.set.call(this,e[0],t,n,e[0])};var me=function(){function e(e){var t=this;this.g=ie,this.D=!0,this.produce=function(e,n,r){if("function"==typeof e&&"function"!=typeof n){var a=n;n=e;var i=t;return function(e){var t=this;void 0===e&&(e=a);for(var r=arguments.length,o=Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];return i.produce(e,(function(e){var r;return(r=n).call.apply(r,[t,e].concat(o))}))}}var o;if("function"!=typeof n&&x(6),void 0!==r&&"function"!=typeof r&&x(7),w(e)){var s=U(t),u=Z(t,e,void 0),c=!0;try{o=n(u),c=!1}finally{c?B(s):W(s)}return"undefined"!=typeof Promise&&o instanceof Promise?o.then((function(e){return z(s,r),j(e,s)}),(function(e){throw B(s),e})):(z(s,r),j(o,s))}if(!e||"object"!=typeof e){if(void 0===(o=n(e))&&(o=e),o===oe&&(o=void 0),t.D&&D(o,!0),r){var l=[],p=[];P("Patches").M(e,o,l,p),r(l,p)}return o}x(21,e)},this.produceWithPatches=function(e,n){if("function"==typeof e)return function(n){for(var r=arguments.length,a=Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];return t.produceWithPatches(n,(function(t){return e.apply(void 0,[t].concat(a))}))};var r,a,i=t.produce(e,n,(function(e,t){r=e,a=t}));return"undefined"!=typeof Promise&&i instanceof Promise?i.then((function(e){return[e,r,a]})):[i,r,a]},"boolean"==typeof(null==e?void 0:e.useProxies)&&this.setUseProxies(e.useProxies),"boolean"==typeof(null==e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze)}var t=e.prototype;return t.createDraft=function(e){w(e)||x(8),k(e)&&(e=J(e));var t=U(this),n=Z(this,e,void 0);return n[ue].C=!0,W(t),n},t.finishDraft=function(e,t){var n=(e&&e[ue]).A;return z(n,t),j(void 0,n)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!ie&&x(20),this.g=e},t.applyPatches=function(e,t){var n;for(n=t.length-1;n>=0;n--){var r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));var a=P("Patches").$;return k(e)?a(e,t):this.produce(e,(function(e){return a(e,t)}))},e}(),ve=new me,ge=ve.produce,ye=(ve.produceWithPatches.bind(ve),ve.setAutoFreeze.bind(ve),ve.setUseProxies.bind(ve),ve.applyPatches.bind(ve),ve.createDraft.bind(ve),ve.finishDraft.bind(ve),ge);function be(e){return e instanceof Error?e:new Error(String(e))}var xe=/(ipad|iphone|ios|ipod|mobile|android|ipad)/i.test(window.navigator.userAgent);function ke(e){return e&&xe?window.navigator.maxTouchPoints>1:xe}function we(e){return we=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},we(e)}function Se(){return Se="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=we(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},Se.apply(this,arguments)}function Ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _e(e,t){return _e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_e(e,t)}function Ne(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Ce(e,t,n){return Ce=Ne()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&_e(a,n.prototype),a},Ce.apply(null,arguments)}function Te(e){var t="function"===typeof Map?new Map:void 0;return Te=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Ce(e,arguments,we(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_e(n,e)},Te(e)}function Ee(e,t){if(t&&("object"===s(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ie(e)}function Ae(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_e(e,t)}function Re(e){var t=Ne();return function(){var n,r=we(e);if(t){var a=we(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return Ee(this,n)}}function Fe(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function De(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}var Me="/index.js",Oe=Object.defineProperty,Pe=n(741),Le=function(e,t){for(var n in t)Oe(e,n,{get:t[n],enumerable:!0})};Le({},{Abs:function(){return bn},Acos:function(){return xn},Acosh:function(){return kn},AdadeltaOptimizer:function(){return pm},AdagradOptimizer:function(){return dm},AdamOptimizer:function(){return fm},AdamaxOptimizer:function(){return hm},Add:function(){return wn},AddN:function(){return Sn},All:function(){return In},Any:function(){return _n},ArgMax:function(){return Nn},ArgMin:function(){return Cn},Asin:function(){return Tn},Asinh:function(){return En},Atan:function(){return An},Atan2:function(){return Fn},Atanh:function(){return Rn},AvgPool:function(){return Dn},AvgPool3D:function(){return On},AvgPool3DGrad:function(){return Pn},AvgPoolGrad:function(){return Mn},BackendWasm:function(){return hJ},BatchMatMul:function(){return Ln},BatchToSpaceND:function(){return zn},Bincount:function(){return Bn},BroadcastArgs:function(){return Un},BroadcastTo:function(){return Wn},Callback:function(){return aT},CallbackList:function(){return Mw},Cast:function(){return Vn},Ceil:function(){return jn},ClipByValue:function(){return Gn},Complex:function(){return Hn},ComplexAbs:function(){return qn},Concat:function(){return Kn},Conv2D:function(){return Xn},Conv2DBackpropFilter:function(){return Yn},Conv2DBackpropInput:function(){return Qn},Conv3D:function(){return Zn},Conv3DBackpropFilterV2:function(){return Jn},Conv3DBackpropInputV2:function(){return $n},Cos:function(){return er},Cosh:function(){return tr},CropAndResize:function(){return ar},Cumprod:function(){return nr},Cumsum:function(){return rr},CustomCallback:function(){return Lw},DataStorage:function(){return ht},DenseBincount:function(){return ir},DepthToSpace:function(){return or},DepthwiseConv2dNative:function(){return sr},DepthwiseConv2dNativeBackpropFilter:function(){return ur},DepthwiseConv2dNativeBackpropInput:function(){return cr},Diag:function(){return lr},Dilation2D:function(){return pr},Dilation2DBackpropFilter:function(){return fr},Dilation2DBackpropInput:function(){return dr},ENV:function(){return vn},EarlyStopping:function(){return sT},Einsum:function(){return mr},Elu:function(){return vr},EluGrad:function(){return gr},Environment:function(){return dn},Equal:function(){return br},Erf:function(){return yr},Exp:function(){return xr},ExpandDims:function(){return kr},Expm1:function(){return wr},FFT:function(){return Sr},Fill:function(){return Ir},FlipLeftRight:function(){return _r},Floor:function(){return Nr},FloorDiv:function(){return Cr},FromPixels:function(){return Ci},FusedBatchNorm:function(){return Tr},FusedConv2D:function(){return Ai},FusedDepthwiseConv2D:function(){return Ri},GPGPUContext:function(){return NW},GatherNd:function(){return Ar},GatherV2:function(){return Er},GraphModel:function(){return mA},Greater:function(){return Rr},GreaterEqual:function(){return Fr},History:function(){return Pw},IFFT:function(){return Mr},Identity:function(){return Dr},Imag:function(){return Or},InputSpec:function(){return Mk},IsFinite:function(){return Pr},IsInf:function(){return Lr},IsNan:function(){return zr},KernelBackend:function(){return mt},LRN:function(){return Zr},LRNGrad:function(){return Jr},LayerVariable:function(){return Rk},LayersModel:function(){return HS},LeakyRelu:function(){return Br},Less:function(){return Wr},LessEqual:function(){return Ur},LinSpace:function(){return Vr},Log:function(){return jr},Log1p:function(){return Gr},LogSoftmax:function(){return Yr},LogicalAnd:function(){return Hr},LogicalNot:function(){return qr},LogicalOr:function(){return Kr},LogicalXor:function(){return Xr},LowerBound:function(){return Qr},MathBackendWebGL:function(){return XU},Max:function(){return $r},MaxPool:function(){return ta},MaxPool3D:function(){return ra},MaxPool3DGrad:function(){return aa},MaxPoolGrad:function(){return na},MaxPoolWithArgmax:function(){return ia},Maximum:function(){return ea},Mean:function(){return oa},Min:function(){return sa},Minimum:function(){return ua},MirrorPad:function(){return ca},Mod:function(){return la},MomentumOptimizer:function(){return vm},Multinomial:function(){return pa},Multiply:function(){return da},Neg:function(){return fa},NonMaxSuppressionV3:function(){return ma},NonMaxSuppressionV4:function(){return va},NonMaxSuppressionV5:function(){return ga},NotEqual:function(){return ha},OP_SCOPE_SUFFIX:function(){return us},OneHot:function(){return ba},OnesLike:function(){return ya},Optimizer:function(){return lm},OptimizerConstructors:function(){return Nv},Pack:function(){return xa},PadV2:function(){return ka},Pool:function(){return wa},Pow:function(){return Sa},Prelu:function(){return Ia},Prod:function(){return _a},RMSPropOptimizer:function(){return gm},RNN:function(){return n_},RaggedGather:function(){return Na},RaggedRange:function(){return Ca},RaggedTensorToTensor:function(){return Ta},Range:function(){return Ea},Rank:function(){return Ro},Real:function(){return Aa},RealDiv:function(){return hr},Reciprocal:function(){return Ra},Reduction:function(){return Oh},Relu:function(){return Fa},Relu6:function(){return za},Reshape:function(){return Da},ResizeBilinear:function(){return Pa},ResizeBilinearGrad:function(){return La},ResizeNearestNeighbor:function(){return Ma},ResizeNearestNeighborGrad:function(){return Oa},Reverse:function(){return Ba},RotateWithOffset:function(){return Ti},Round:function(){return Wa},Rsqrt:function(){return Ua},SGDOptimizer:function(){return mm},ScatterNd:function(){return Va},SearchSorted:function(){return ja},Select:function(){return Ga},Selu:function(){return Ha},Sequential:function(){return eI},Sigmoid:function(){return Qa},Sign:function(){return Ya},Sin:function(){return Ka},Sinh:function(){return Xa},Slice:function(){return qa},Softmax:function(){return ni},Softplus:function(){return Za},SpaceToBatchND:function(){return ei},SparseFillEmptyRows:function(){return ri},SparseReshape:function(){return ai},SparseSegmentMean:function(){return ii},SparseSegmentSum:function(){return oi},SparseToDense:function(){return si},SplitV:function(){return ti},Sqrt:function(){return Ja},Square:function(){return ci},SquaredDifference:function(){return ui},Step:function(){return Ni},StridedSlice:function(){return li},StringNGrams:function(){return pi},StringSplit:function(){return di},StringToHashBucketFast:function(){return fi},Sub:function(){return hi},Sum:function(){return $a},SymbolicTensor:function(){return Ok},Tan:function(){return mi},Tanh:function(){return vi},Tensor:function(){return To},TensorBuffer:function(){return _o},Tile:function(){return gi},TopK:function(){return yi},Transform:function(){return bi},Transpose:function(){return xi},Unique:function(){return ki},Unpack:function(){return wi},UnsortedSegmentSum:function(){return Si},UpperBound:function(){return Ii},Variable:function(){return Ao},ZerosLike:function(){return _i},_FusedMatMul:function(){return Ei},abs:function(){return Ju},acos:function(){return $u},acosh:function(){return ec},add:function(){return Xu},addN:function(){return tc},all:function(){return nc},any:function(){return rc},argMax:function(){return ac},argMin:function(){return ic},asin:function(){return oc},asinh:function(){return sc},atan:function(){return uc},atan2:function(){return cc},atanh:function(){return lc},avgPool:function(){return Cc},avgPool3d:function(){return Tc},backend:function(){return qu},backend_util:function(){return Rv},basicLSTMCell:function(){return Mc},batchNorm:function(){return Lc},batchNorm2d:function(){return zc},batchNorm3d:function(){return Bc},batchNorm4d:function(){return Wc},batchToSpaceND:function(){return Oc},bincount:function(){return Uc},booleanMaskAsync:function(){return Ef},broadcastArgs:function(){return Vc},broadcastTo:function(){return jc},broadcast_util:function(){return fl},browser:function(){return Ym},buffer:function(){return Su},callbacks:function(){return lT},cast:function(){return Iu},ceil:function(){return Gc},clipByValue:function(){return qc},clone:function(){return _u},complex:function(){return ls},concat:function(){return Ec},concat1d:function(){return Kc},concat2d:function(){return Xc},concat3d:function(){return Yc},concat4d:function(){return Qc},constraints:function(){return Qk},conv1d:function(){return Jc},conv2d:function(){return Zc},conv2dTranspose:function(){return el},conv3d:function(){return tl},conv3dTranspose:function(){return rl},copyRegisteredKernels:function(){return ji},cos:function(){return al},cosh:function(){return il},cosineWindow:function(){return Uf},cumprod:function(){return ol},cumsum:function(){return sl},customGrad:function(){return hp},data:function(){return kA},denseBincount:function(){return ul},deprecationWarn:function(){return Au},depthToSpace:function(){return cl},depthwiseConv2d:function(){return ll},deregisterOp:function(){return hT},device_util:function(){return Jo},diag:function(){return pl},dilation2d:function(){return dl},disableDeprecationWarnings:function(){return Eu},dispose:function(){return Pu},disposeVariables:function(){return Ru},div:function(){return Qu},divNoNan:function(){return xl},dot:function(){return kl},dropout:function(){return Bf},einsum:function(){return wl},elu:function(){return Sl},enableDebugMode:function(){return Tu},enableProdMode:function(){return Cu},enclosingPowerOfTwo:function(){return Wf},engine:function(){return Fu},env:function(){return hn},equal:function(){return gl},erf:function(){return Il},euclideanNorm:function(){return Vl},exp:function(){return jl},expandDims:function(){return Gl},expm1:function(){return Hl},eye:function(){return Kl},fft:function(){return ef},fill:function(){return Hc},findBackend:function(){return ju},findBackendFactory:function(){return Gu},floor:function(){return Xl},floorDiv:function(){return Yu},forceHalfFloat:function(){return QU},fused:function(){return Gf},gather:function(){return Yl},gatherND:function(){return zf},gather_util:function(){return rv},getBackend:function(){return Uu},getGradient:function(){return Li},getKernel:function(){return Pi},getKernelsForBackend:function(){return zi},getThreadsCount:function(){return AJ},gpgpu_util:function(){return rW},grad:function(){return cp},grads:function(){return lp},greater:function(){return Ql},greaterEqual:function(){return Zl},ifft:function(){return tf},imag:function(){return Jl},image:function(){return tm},inTopKAsync:function(){return jf},initializers:function(){return pw},input:function(){return rI},io:function(){return bm},irfft:function(){return nf},isFinite:function(){return $l},isInf:function(){return ep},isNaN:function(){return tp},keep:function(){return Lu},kernel_impls:function(){return Lg},layers:function(){return Tw},leakyRelu:function(){return np},less:function(){return rp},lessEqual:function(){return ap},linalg:function(){return nm},linspace:function(){return ip},loadGraphModel:function(){return vA},loadGraphModelSync:function(){return yA},loadLayersModel:function(){return YS},localResponseNormalization:function(){return op},log:function(){return sp},log1p:function(){return up},logSigmoid:function(){return yp},logSoftmax:function(){return xp},logSumExp:function(){return kp},logicalAnd:function(){return wp},logicalNot:function(){return Sp},logicalOr:function(){return Ip},logicalXor:function(){return _p},losses:function(){return rm},lowerBound:function(){return Tp},matMul:function(){return Ac},math:function(){return qm},max:function(){return Dl},maxPool:function(){return Ep},maxPool3d:function(){return Ap},maxPoolWithArgmax:function(){return Rp},maximum:function(){return Fp},mean:function(){return Dp},memory:function(){return Du},meshgrid:function(){return Pp},metrics:function(){return LC},min:function(){return Ml},minimum:function(){return Lp},mirrorPad:function(){return zp},mod:function(){return Bp},model:function(){return tI},models:function(){return $C},moments:function(){return Wp},movingAverage:function(){return Rf},mul:function(){return Zu},multiRNNCell:function(){return Up},multinomial:function(){return Vp},neg:function(){return vp},nextFrame:function(){return Ev},norm:function(){return Ul},notEqual:function(){return jp},oneHot:function(){return Gp},ones:function(){return Op},onesLike:function(){return Hp},op:function(){return cs},outerProduct:function(){return qp},pad:function(){return Kp},pad1d:function(){return Xp},pad2d:function(){return Yp},pad3d:function(){return Qp},pad4d:function(){return Zp},pool:function(){return $p},pow:function(){return Ol},prelu:function(){return ed},print:function(){return Nu},prod:function(){return td},profile:function(){return Mu},raggedGather:function(){return nd},raggedRange:function(){return rd},raggedTensorToTensor:function(){return ad},rand:function(){return id},randomGamma:function(){return Nd},randomNormal:function(){return Cd},randomStandardNormal:function(){return Td},randomUniform:function(){return Ed},range:function(){return Ad},ready:function(){return Wu},real:function(){return Rd},reciprocal:function(){return Fd},registerBackend:function(){return Hu},registerCallbackConstructor:function(){return aI},registerGradient:function(){return Wi},registerKernel:function(){return Bi},registerOp:function(){return dT},regularizers:function(){return eT},relu:function(){return Dd},relu6:function(){return Md},removeBackend:function(){return Vu},reshape:function(){return Nc},reverse:function(){return Od},reverse1d:function(){return Pd},reverse2d:function(){return Ld},reverse3d:function(){return zd},reverse4d:function(){return Bd},rfft:function(){return af},round:function(){return Wd},rsqrt:function(){return Ud},scalar:function(){return Pl},scatterND:function(){return Pf},scatter_util:function(){return Ff},searchSorted:function(){return Cp},selu:function(){return Vd},separableConv2d:function(){return jd},sequential:function(){return nI},serialization:function(){return om},setBackend:function(){return Bu},setPlatform:function(){return Ku},setThreadsCount:function(){return EJ},setWasmPath:function(){return _J},setWasmPaths:function(){return NJ},setWebGLContext:function(){return wz},setdiff1dAsync:function(){return Hd},sigmoid:function(){return Rc},sign:function(){return qd},signal:function(){return em},sin:function(){return Kd},sinh:function(){return Xd},slice:function(){return Fc},slice1d:function(){return Yd},slice2d:function(){return Qd},slice3d:function(){return Zd},slice4d:function(){return Jd},slice_util:function(){return iv},softmax:function(){return $d},softplus:function(){return gp},spaceToBatchND:function(){return Jp},sparse:function(){return am},sparseToDense:function(){return Lf},spectral:function(){return $h},split:function(){return rf},sqrt:function(){return Ll},square:function(){return zl},squaredDifference:function(){return of},squeeze:function(){return sf},stack:function(){return uf},step:function(){return cf},stridedSlice:function(){return lf},string:function(){return im},sub:function(){return bp},sum:function(){return Bl},sumOutType:function(){return Bo},tan:function(){return pf},tanh:function(){return Dc},tensor:function(){return ds},tensor1d:function(){return df},tensor2d:function(){return ff},tensor3d:function(){return hf},tensor4d:function(){return mf},tensor5d:function(){return vf},tensor6d:function(){return gf},tensor_util:function(){return Po},test_util:function(){return sd},tidy:function(){return Ou},tile:function(){return ql},time:function(){return zu},topk:function(){return yf},train:function(){return Cv},transpose:function(){return Af},truncatedNormal:function(){return bf},unique:function(){return xf},unregisterGradient:function(){return Vi},unregisterKernel:function(){return Ui},unsortedSegmentSum:function(){return kf},unstack:function(){return wf},upcastType:function(){return zo},upperBound:function(){return Sf},util:function(){return Hi},valueAndGrad:function(){return pp},valueAndGrads:function(){return dp},variable:function(){return If},variableGrads:function(){return fp},version:function(){return DJ},version_converter:function(){return xA},version_core:function(){return _v},version_layers:function(){return yS},version_wasm:function(){return RJ},version_webgl:function(){return YU},webgl:function(){return ZU},webgl_util:function(){return vz},where:function(){return yl},whereAsync:function(){return Cf},zeros:function(){return Mp},zerosLike:function(){return bl}});var ze=Object.create,Be=Object.defineProperty,We=Object.getOwnPropertyDescriptor,Ue=Object.getOwnPropertyNames,Ve=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty,Ge=function(e,t){return function(){return t||e((t={exports:{}}).exports,t),t.exports}},He=function(e,t){for(var n in t)Be(e,n,{get:t[n],enumerable:!0})},qe=function(e,t,n){return n=null!=e?ze(Ve(e)):{},function(e,t,n,r){if(t&&"object"==typeof t||"function"==typeof t){var a,i=De(Ue(t));try{var o=function(){var i=a.value;!je.call(e,i)&&i!==n&&Be(e,i,{get:function(){return t[i]},enumerable:!(r=We(t,i))||r.enumerable})};for(i.s();!(a=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}}return e}(!t&&e&&e.__esModule?n:Be(n,"default",{value:e,enumerable:!0}),e)},Ke=Ge((function(e,t){t.exports=r;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(V){}function r(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function a(e){return!0===(e&&e.__isLong__)}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=a;var i={},o={};function s(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=o[e])?r:(n=c(e,(0|e)<0?-1:0,!0),a&&(o[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=i[e])?r:(n=c(e,e<0?-1:0,!1),a&&(i[e]=n),n)}function u(e,t){if(isNaN(e))return t?y:g;if(t){if(e<0)return y;if(e>=h)return S}else{if(e<=-m)return I;if(e+1>=m)return w}return e<0?u(-e,t).neg():c(e%f|0,e/f|0,t)}function c(e,t,n){return new r(e,t,n)}r.fromInt=s,r.fromNumber=u,r.fromBits=c;var l=Math.pow;function p(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return g;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return p(e.substring(1),t,n).neg();for(var a=u(l(n,8)),i=g,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+s),n);if(s<8){var d=u(l(n,s));i=i.mul(d).add(u(c))}else i=(i=i.mul(a)).add(u(c))}return i.unsigned=t,i}function d(e,t){return"number"==typeof e?u(e,t):"string"==typeof e?p(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=p,r.fromValue=d;var f=4294967296,h=f*f,m=h/2,v=s(1<<24),g=s(0);r.ZERO=g;var y=s(0,!0);r.UZERO=y;var b=s(1);r.ONE=b;var x=s(1,!0);r.UONE=x;var k=s(-1);r.NEG_ONE=k;var w=c(-1,2147483647,!1);r.MAX_VALUE=w;var S=c(-1,-1,!0);r.MAX_UNSIGNED_VALUE=S;var I=c(0,-2147483648,!1);r.MIN_VALUE=I;var _=r.prototype;_.toInt=function(){return this.unsigned?this.low>>>0:this.low},_.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},_.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(I)){var t=u(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=u(l(e,6),this.unsigned),i=this,o="";;){var s=i.div(a),c=(i.sub(s.mul(a)).toInt()>>>0).toString(e);if((i=s).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},_.getHighBits=function(){return this.high},_.getHighBitsUnsigned=function(){return this.high>>>0},_.getLowBits=function(){return this.low},_.getLowBitsUnsigned=function(){return this.low>>>0},_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(I)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},_.isZero=function(){return 0===this.high&&0===this.low},_.eqz=_.isZero,_.isNegative=function(){return!this.unsigned&&this.high<0},_.isPositive=function(){return this.unsigned||this.high>=0},_.isOdd=function(){return 1===(1&this.low)},_.isEven=function(){return 0===(1&this.low)},_.equals=function(e){return a(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},_.eq=_.equals,_.notEquals=function(e){return!this.eq(e)},_.neq=_.notEquals,_.ne=_.notEquals,_.lessThan=function(e){return this.comp(e)<0},_.lt=_.lessThan,_.lessThanOrEqual=function(e){return this.comp(e)<=0},_.lte=_.lessThanOrEqual,_.le=_.lessThanOrEqual,_.greaterThan=function(e){return this.comp(e)>0},_.gt=_.greaterThan,_.greaterThanOrEqual=function(e){return this.comp(e)>=0},_.gte=_.greaterThanOrEqual,_.ge=_.greaterThanOrEqual,_.compare=function(e){if(a(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},_.comp=_.compare,_.negate=function(){return!this.unsigned&&this.eq(I)?I:this.not().add(b)},_.neg=_.negate,_.add=function(e){a(e)||(e=d(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,u=e.low>>>16,l=0,p=0,f=0,h=0;return f+=(h+=i+(65535&e.low))>>>16,p+=(f+=r+u)>>>16,l+=(p+=n+s)>>>16,l+=t+o,c((f&=65535)<<16|(h&=65535),(l&=65535)<<16|(p&=65535),this.unsigned)},_.subtract=function(e){return a(e)||(e=d(e)),this.add(e.neg())},_.sub=_.subtract,_.multiply=function(e){if(this.isZero())return g;if(a(e)||(e=d(e)),n)return c(n.mul(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned);if(e.isZero())return g;if(this.eq(I))return e.isOdd()?I:g;if(e.eq(I))return this.isOdd()?I:g;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(v)&&e.lt(v))return u(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,s=e.high>>>16,l=65535&e.high,p=e.low>>>16,f=65535&e.low,h=0,m=0,y=0,b=0;return y+=(b+=o*f)>>>16,m+=(y+=i*f)>>>16,y&=65535,m+=(y+=o*p)>>>16,h+=(m+=r*f)>>>16,m&=65535,h+=(m+=i*p)>>>16,m&=65535,h+=(m+=o*l)>>>16,h+=t*f+r*p+i*l+o*s,c((y&=65535)<<16|(b&=65535),(h&=65535)<<16|(m&=65535),this.unsigned)},_.mul=_.multiply,_.divide=function(e){if(a(e)||(e=d(e)),e.isZero())throw Error("division by zero");var t,r,i;if(n)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?n.div_u:n.div_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?y:g;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return y;if(e.gt(this.shru(1)))return x;i=y}else{if(this.eq(I))return e.eq(b)||e.eq(k)?I:e.eq(I)?b:(t=this.shr(1).div(e).shl(1)).eq(g)?e.isNegative()?b:k:(r=this.sub(e.mul(t)),i=t.add(r.div(e)));if(e.eq(I))return this.unsigned?y:g;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=g}for(r=this;r.gte(e);){t=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(t)/Math.LN2),s=o<=48?1:l(2,o-48),p=u(t),f=p.mul(e);f.isNegative()||f.gt(r);)f=(p=u(t-=s,this.unsigned)).mul(e);p.isZero()&&(p=b),i=i.add(p),r=r.sub(f)}return i},_.div=_.divide,_.modulo=function(e){return a(e)||(e=d(e)),n?c((this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,e.low,e.high),n.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},_.mod=_.modulo,_.rem=_.modulo,_.not=function(){return c(~this.low,~this.high,this.unsigned)},_.and=function(e){return a(e)||(e=d(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},_.or=function(e){return a(e)||(e=d(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},_.xor=function(e){return a(e)||(e=d(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},_.shiftLeft=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},_.shl=_.shiftLeft,_.shiftRight=function(e){return a(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},_.shr=_.shiftRight,_.shiftRightUnsigned=function(e){if(a(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?c(this.low>>>e|t<<32-e,t>>>e,this.unsigned):c(32===e?t:t>>>e-32,0,this.unsigned)},_.shru=_.shiftRightUnsigned,_.shr_u=_.shiftRightUnsigned,_.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},_.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},_.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},_.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},_.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}})),Xe=Ge((function(){})),Ye=Ge((function(){})),Qe=Ge((function(e,t){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function a(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function i(e,t){var n=new r(e),i=t&&t.state,o=n.next;return o.int32=function(){return 4294967296*n.next()|0},o.double=function(){return o()+11102230246251565e-32*(2097152*o()|0)},o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.alea=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),Ze=Ge((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor128=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),Je=Ge((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function a(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorwow=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),$e=Ge((function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function a(e,t){return t.x=e.x.slice(),t.i=e.i,t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.x&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xorshift7=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),et=Ge((function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function a(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function i(e,t){null==e&&(e=+new Date);var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&(i.X&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.xor4096=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),tt=Ge((function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function a(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function i(e,t){var n=new r(e),i=t&&t.state,o=function(){return(n.next()>>>0)/4294967296};return o.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},o.int32=n.next,o.quick=o,i&&("object"==typeof i&&a(i,n),o.state=function(){return a(n,{})}),o}t&&t.exports?t.exports=i:n&&n.amd?n((function(){return i})):this.tychei=i}(0,"object"==typeof t&&t,"function"==typeof define&&define)})),nt=Ge((function(){})),rt=Ge((function(e,t){!function(e,r,a){var i,o=256,s=6,u="random",c=a.pow(o,s),l=a.pow(2,52),p=2*l,d=o-1;function f(t,n,d){var f=[],b=g(v((n=1==n?{entropy:!0}:n||{}).entropy?[t,y(r)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(o):(t=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(t)),y(t)}catch(f){var n=e.navigator,a=n&&n.plugins;return[+new Date,e,a,e.screen,y(r)]}}():t,3),f),x=new h(f),k=function(){for(var e=x.g(s),t=c,n=0;e<l;)e=(e+n)*o,t*=o,n=x.g(1);for(;e>=p;)e/=2,t/=2,n>>>=1;return(e+n)/t};return k.int32=function(){return 0|x.g(4)},k.quick=function(){return x.g(4)/4294967296},k.double=k,g(y(x.S),r),(n.pass||d||function(e,t,n,r){return r&&(r.S&&m(r,x),e.state=function(){return m(x,{})}),n?(a[u]=e,t):e})(k,b,"global"in n?n.global:this==a,n.state)}function h(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);a<o;)s[a]=a++;for(a=0;a<o;a++)s[a]=s[i=d&i+e[a%n]+(t=s[a])],s[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,s=r.S;e--;)t=s[a=d&a+1],n=n*o+s[d&(s[a]=s[i=d&i+t])+(s[i]=t)];return r.i=a,r.j=i,n})(o)}function m(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function v(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(v(e[n],t-1))}catch(J){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[d&a]=d&(n^=19*t[d&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(g(a.random(),r),"object"==typeof t&&t.exports){t.exports=f;try{i=nt()}catch(X){}}else"function"==typeof define&&n.amdO?define((function(){return f})):a["seed"+u]=f}("undefined"!=typeof self?self:e,[],Math)})),at=Ge((function(e,t){var n=Qe(),r=Ze(),a=Je(),i=$e(),o=et(),s=tt(),u=rt();u.alea=n,u.xor128=r,u.xorwow=a,u.xorshift7=i,u.xor4096=o,u.tychei=s,t.exports=u})),it=Ge((function(){})),ot=Ge((function(){})),st=Ge((function(){})),ut=Ge((function(){})),ct=Ge((function(){})),lt=Ge((function(){})),pt=Ge((function(e,t){var r=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return e=e||Me,function(t){function r(){return F.buffer!=P&&H(F.buffer),z}function a(){return F.buffer!=P&&H(F.buffer),B}function i(){return F.buffer!=P&&H(F.buffer),W}function o(){return F.buffer!=P&&H(F.buffer),U}var s,u,c,l="undefined"!=typeof(t=t||{})?t:{};l.ready=new Promise((function(e,t){s=e,u=t})),"undefined"!=typeof process&&process.listeners&&(c={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var p,d,f,h=Object.assign({},l),m=[],v=function(e,t){throw t},g="object"==typeof window,y="function"==typeof importScripts,b="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,x=l.ENVIRONMENT_IS_PTHREAD||!1,k="";function w(e){return l.locateFile?l.locateFile(e,k):k+e}if(b){var S,I=ot(),_=st();k=y?_.dirname(k)+"/":"//",p=function(e,t){return e=ce(e)?new URL(e):_.normalize(e),I.readFileSync(e,t?void 0:"utf8")},f=function(e){var t=p(e,!0);return t.buffer||(t=new Uint8Array(t)),t},d=function(e,t,n){e=ce(e)?new URL(e):_.normalize(e),I.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),m=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof de))throw e})),process.on("unhandledRejection",(function(e){throw e})),v=function(e,t){if(Z())throw process.exitCode=e,t;(function(e){e instanceof de||E("exiting due to exception: "+e)})(t),process.exit(e)},l.inspect=function(){return"[Emscripten Module object]"};try{S=ut()}catch(ae){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),ae}n.g.Worker=S.Worker}else(g||y)&&(y?k=self.location.href:"undefined"!=typeof document&&document.currentScript&&(k=document.currentScript.src),"undefined"!=typeof e&&e&&(k=e),k=0!==k.indexOf("blob:")?k.substr(0,k.replace(/[?#].*/,"").lastIndexOf("/")+1):"",b||(p=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},y&&(f=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),d=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}),function(e){return document.title=e});b&&"undefined"==typeof performance&&(n.g.performance=ct().performance);var N=console.log.bind(console),C=console.warn.bind(console);b&&(N=function(e){return I.writeSync(1,e+"\n")},C=function(e){return I.writeSync(2,e+"\n")});var T=l.print||N,E=l.printErr||C;Object.assign(l,h),h=null,l.arguments&&(m=l.arguments),l.thisProgram&&l.thisProgram,l.quit&&(v=l.quit);var A;Atomics.load,Atomics.store,Atomics.compareExchange;l.wasmBinary&&(A=l.wasmBinary);var R=l.noExitRuntime||!0;"object"!=typeof WebAssembly&&ie("no native wasm support detected");var F,D,M,O=!1;var P,L,z,B,W,U,V="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function j(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&V)return V.decode(e.buffer instanceof SharedArrayBuffer?e.slice(t,a):e.subarray(t,a));for(var i="";t<a;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(o);else{var c=o-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&o)<<6|s)}else i+=String.fromCharCode(o)}return i}function G(e,t){return e?j(r(),e,t):""}function H(e){P=e,l.HEAP8=L=new Int8Array(e),l.HEAP16=new Int16Array(e),l.HEAP32=B=new Int32Array(e),l.HEAPU8=z=new Uint8Array(e),l.HEAPU16=new Uint16Array(e),l.HEAPU32=W=new Uint32Array(e),l.HEAPF32=new Float32Array(e),l.HEAPF64=U=new Float64Array(e)}x&&(P=l.buffer);var q=l.INITIAL_MEMORY||16777216;if(x)F=l.wasmMemory,P=l.buffer;else if(l.wasmMemory)F=l.wasmMemory;else if(!((F=new WebAssembly.Memory({initial:q/65536,maximum:32768,shared:!0})).buffer instanceof SharedArrayBuffer))throw E("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),b&&E("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and/or recent version)"),Error("bad memory");F&&(P=F.buffer),q=P.byteLength,H(P);var K,X=[],Y=[],Q=[];function Z(){return R}function J(){!0,!x&&ye(Y)}function $(e){X.unshift(e)}function ee(e){Q.unshift(e)}var te=0,ne=null,re=null;function ie(e){l.onAbort&&l.onAbort(e),E(e="Aborted("+e+")"),O=!0,M=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw u(t),t}var oe,se="data:application/octet-stream;base64,";function ue(e){return e.startsWith(se)}function ce(e){return e.startsWith("file://")}function le(e){try{if(e==oe&&A)return new Uint8Array(A);if(f)return f(e);throw"both async and sync fetching of the wasm failed"}catch(ae){ie(ae)}}ue(oe="tfjs-backend-wasm-threaded-simd.wasm")||(oe=w(oe));var pe={};function de(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function fe(e){var t=ge.pthreads[e];(function(e,t){e||ie(t)})(t),ge.returnWorkerToPool(t)}function he(e){var t=ge.getNewWorker();if(!t)return 6;ge.runningWorkers.push(t),ge.pthreads[e.pthread_ptr]=t,t.pthread_ptr=e.pthread_ptr;var n={cmd:"run",start_routine:e.startRoutine,arg:e.arg,pthread_ptr:e.pthread_ptr};return t.runPthread=function(){b&&t.ref(),t.postMessage(n,e.transferList),delete t.runPthread},t.loaded&&t.runPthread(),0}function me(e){if(x)return Ce(1,1,e);M=e,Z()||(ge.terminateAllThreads(),l.onExit&&l.onExit(e),O=!0),v(e,new de(e))}var ve=function(e,t){if(M=e,!t&&x)throw be(e),"unwind";me(e)};var ge={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init:function(){x?ge.initWorker():ge.initMainThread()},initMainThread:function(){for(var e=8;e--;)ge.allocateUnusedWorker()},initWorker:function(){R=!1},setExitStatus:function(e){M=e},terminateAllThreads:function(){for(var e=0,t=Object.values(ge.pthreads);e<t.length;e++){var n=t[e];ge.returnWorkerToPool(n)}var r,a=De(ge.unusedWorkers);try{for(a.s();!(r=a.n()).done;){(n=r.value).terminate()}}catch(i){a.e(i)}finally{a.f()}ge.unusedWorkers=[]},returnWorkerToPool:function(e){var t=e.pthread_ptr;delete ge.pthreads[t],ge.unusedWorkers.push(e),ge.runningWorkers.splice(ge.runningWorkers.indexOf(e),1),e.pthread_ptr=0,b&&e.unref(),Ye(t)},receiveObjectTransfer:function(e){},threadInitTLS:function(){ge.tlsInitFunctions.forEach((function(e){return e()}))},loadWasmModuleToWorker:function(t,n){t.onmessage=function(e){var r=e.data,a=r.cmd;if(t.pthread_ptr&&(ge.currentProxiedOperationCallerThread=t.pthread_ptr),r.targetThread&&r.targetThread!=He()){var i=ge.pthreads[r.targetThread];return i?i.postMessage(r,r.transferList):E('Internal error! Worker sent a message "'+a+'" to target pthread '+r.targetThread+", but that thread no longer exists!"),void(ge.currentProxiedOperationCallerThread=void 0)}"processProxyingQueue"===a?_e(r.queue):"spawnThread"===a?he(r):"cleanupThread"===a?fe(r.thread):"killThread"===a?function(e){var t=ge.pthreads[e];delete ge.pthreads[e],t.terminate(),Ye(e),ge.runningWorkers.splice(ge.runningWorkers.indexOf(t),1),t.pthread_ptr=0}(r.thread):"cancelThread"===a?function(e){ge.pthreads[e].postMessage({cmd:"cancel"})}(r.thread):"loaded"===a?(t.loaded=!0,b&&t.unref(),n&&n(t),t.runPthread&&t.runPthread()):"print"===a?T("Thread "+r.threadId+": "+r.text):"printErr"===a?E("Thread "+r.threadId+": "+r.text):"alert"===a?alert("Thread "+r.threadId+": "+r.text):"setimmediate"===r.target?t.postMessage(r):"callHandler"===a?l[r.handler].apply(l,Fe(r.args)):a&&E("worker sent an unknown command "+a),ge.currentProxiedOperationCallerThread=void 0},t.onerror=function(e){throw E("worker sent an error! "+e.filename+":"+e.lineno+": "+e.message),e},b&&(t.on("message",(function(e){t.onmessage({data:e})})),t.on("error",(function(e){t.onerror(e)})),t.on("detachedExit",(function(){})));for(var r=[],a=0,i=["onExit","onAbort","print","printErr"];a<i.length;a++){var o=i[a];l.hasOwnProperty(o)&&r.push(o)}t.postMessage({cmd:"load",handlers:r,urlOrBlob:l.mainScriptUrlOrBlob||e,wasmMemory:F,wasmModule:D})},allocateUnusedWorker:function(){var e,t=w("tfjs-backend-wasm-threaded-auto-camera-demo/build/simd.worker.js");e=new Worker(t),ge.unusedWorkers.push(e)},getNewWorker:function(){return 0==ge.unusedWorkers.length&&(ge.allocateUnusedWorker(),ge.loadWasmModuleToWorker(ge.unusedWorkers[0])),ge.unusedWorkers.pop()}};function ye(e){for(;e.length>0;)e.shift()(l)}function be(e){if(x)return Ce(2,0,e);try{ve(e)}catch(ae){!function(e){if(e instanceof de||"unwind"==e)return M;v(1,e)}(ae)}}l.PThread=ge,l.establishStackSpace=function(){var e=He(),t=a()[e+52>>2],n=a()[e+56>>2];Ze(t,t-n),$e(t)};var xe=[];function ke(e,t,n,r){return x?Ce(3,1,e,t,n,r):we(e,t,n,r)}function we(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return E("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];if(x&&0===a.length)return ke(e,t,n,r);var i={startRoutine:n,pthread_ptr:e,arg:r,transferList:a};return x?(i.cmd="spawnThread",postMessage(i,a),0):he(i)}l.invokeEntryPoint=function(e,t){var n=function(e){var t=xe[e];return t||(e>=xe.length&&(xe.length=e+1),xe[e]=t=K.get(e)),t}(e)(t);Z()?ge.setExitStatus(n):Qe(n)};var Se,Ie=!0;function _e(e){Atomics.store(a(),e>>2,1),He()&&Xe(e),Atomics.compareExchange(a(),e>>2,1,0)}function Ne(e){Ne.shown||(Ne.shown={}),Ne.shown[e]||(Ne.shown[e]=1,b&&(e="warning: "+e),E(e))}function Ce(e,t){var n=arguments.length-2,r=arguments;return function(e){var t=Je(),n=e();return $e(t),n}((function(){for(var a=n,i=et(8*a),s=i>>3,u=0;u<n;u++){var c=r[2+u];o()[s+u]=c}return Ke(e,a,i,t)}))}l.executeNotifiedProxyingQueue=_e,Se=b?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:function(){return performance.timeOrigin+performance.now()};var Te=[];function Ee(e){try{return F.grow(e-P.byteLength+65535>>>16),H(F.buffer),1}catch(ae){}}function Ae(e){return x?Ce(4,1,e):52}function Re(e,t,n,r,a){return x?Ce(5,1,e,t,n,r,a):70}var Me=[null,[],[]];function Oe(e,t){var n=Me[e];0===t||10===t?((1===e?T:E)(j(n,0)),n.length=0):n.push(t)}function Pe(e,t,n,a){if(x)return Ce(6,1,e,t,n,a);for(var o=0,s=0;s<n;s++){var u=i()[t>>2],c=i()[t+4>>2];t+=8;for(var l=0;l<c;l++)Oe(e,r()[u+l]);o+=c}return i()[a>>2]=o,0}function Le(e){return l["_"+e]}function ze(e,t){(F.buffer!=P&&H(F.buffer),L).set(e,t)}function Be(e,t,n,a,i){var o={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){(function(e,t,n,r){if(!(r>0))return 0;for(var a=n,i=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=i)break;t[n++]=s}else if(s<=2047){if(n+1>=i)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=i)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}t[n]=0})(e,r(),t,n)})(e,t=et(n),n)}return t},array:function(e){var t=et(e.length);return ze(e,t),t}};var s=Le(e),u=[],c=0;if(a)for(var l=0;l<a.length;l++){var p=o[n[l]];p?(0===c&&(c=Je()),u[l]=p(a[l])):u[l]=a[l]}var d,f=s.apply(null,u);return d=f,0!==c&&$e(c),f=function(e){return"string"===t?G(e):"boolean"===t?Boolean(e):e}(d),f}ge.init();var We,Ue,Ve,je=[null,me,be,ke,Ae,Re,Pe],Ge={__emscripten_init_main_thread_js:function(e){qe(e,!y,1,!g),ge.threadInitTLS()},__emscripten_thread_cleanup:function(e){x?postMessage({cmd:"cleanupThread",thread:e}):fe(e)},__pthread_create_js:we,_emscripten_default_pthread_stack_size:function(){return 65536},_emscripten_get_now_is_monotonic:function(){return Ie},_emscripten_notify_task_queue:function(e,t,n,r){if(e==t)setTimeout((function(){return _e(r)}));else if(x)postMessage({targetThread:e,cmd:"processProxyingQueue",queue:r});else{var a=ge.pthreads[e];if(!a)return;a.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},_emscripten_set_offscreencanvas_size:function(e,t,n){return-1},abort:function(){ie("")},emscripten_check_blocking_allowed:function(){b||y||Ne("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")},emscripten_date_now:function(){return Date.now()},emscripten_get_heap_max:function(){return 2147483648},emscripten_get_now:Se,emscripten_memcpy_big:function(e,t,n){r().copyWithin(e,t,t+n)},emscripten_num_logical_cores:function(){return b?lt().cpus().length:navigator.hardwareConcurrency},emscripten_receive_on_main_thread_js:function(e,t,n){Te.length=t;for(var r=n>>3,a=0;a<t;a++)Te[a]=o()[r+a];return(e<0?pe[-e-1]:je[e]).apply(null,Te)},emscripten_resize_heap:function(e){var t=r().length;if((e>>>=0)<=t)return!1;var n=2147483648;if(e>n)return!1;for(var a,i,o=1;o<=4;o*=2){var s=t*(1+.2/o);if(s=Math.min(s,e+100663296),Ee(Math.min(n,(a=Math.max(e,s))+((i=65536)-a%i)%i)))return!0}return!1},emscripten_unwind_to_js_event_loop:function(){throw"unwind"},exit:ve,fd_close:Ae,fd_seek:Re,fd_write:Pe,memory:F||l.wasmMemory},He=(function(){var e={env:Ge,wasi_snapshot_preview1:Ge};function t(e,t){var n=e.exports;if(l.asm=n,function(e){ge.tlsInitFunctions.push(e)}(l.asm._emscripten_tls_init),K=l.asm.__indirect_function_table,function(e){Y.unshift(e)}(l.asm.__wasm_call_ctors),D=t,!x){var r=ge.unusedWorkers.length;ge.unusedWorkers.forEach((function(e){ge.loadWasmModuleToWorker(e,(function(){--r||function(e){if(te--,l.monitorRunDependencies&&l.monitorRunDependencies(te),0==te&&(null!==ne&&(clearInterval(ne),ne=null),re)){var t=re;re=null,t()}}()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return function(){if(!A&&(g||y)){if("function"==typeof fetch&&!ce(oe))return fetch(oe,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+oe+"'";return e.arrayBuffer()})).catch((function(){return le(oe)}));if(d)return new Promise((function(e,t){d(oe,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return le(oe)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){E("failed to asynchronously prepare wasm: "+e),ie(e)}))}if(x||(te++,l.monitorRunDependencies&&l.monitorRunDependencies(te)),l.instantiateWasm)try{return l.instantiateWasm(e,t)}catch(a){E("Module.instantiateWasm callback failed with error: "+a),u(a)}(A||"function"!=typeof WebAssembly.instantiateStreaming||ue(oe)||ce(oe)||b||"function"!=typeof fetch?r(n):fetch(oe,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return E("wasm streaming compile failed: "+e),E("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(u)}(),l.___wasm_call_ctors=function(){return(l.___wasm_call_ctors=l.asm.__wasm_call_ctors).apply(null,arguments)},l._init=function(){return(l._init=l.asm.init).apply(null,arguments)},l._init_with_threads_count=function(){return(l._init_with_threads_count=l.asm.init_with_threads_count).apply(null,arguments)},l._get_threads_count=function(){return(l._get_threads_count=l.asm.get_threads_count).apply(null,arguments)},l._register_tensor=function(){return(l._register_tensor=l.asm.register_tensor).apply(null,arguments)},l._dispose_data=function(){return(l._dispose_data=l.asm.dispose_data).apply(null,arguments)},l._dispose=function(){return(l._dispose=l.asm.dispose).apply(null,arguments)},l._Abs=function(){return(l._Abs=l.asm.Abs).apply(null,arguments)},l._Add=function(){return(l._Add=l.asm.Add).apply(null,arguments)},l._AddN=function(){return(l._AddN=l.asm.AddN).apply(null,arguments)},l._All=function(){return(l._All=l.asm.All).apply(null,arguments)},l._Any=function(){return(l._Any=l.asm.Any).apply(null,arguments)},l._ArgMax=function(){return(l._ArgMax=l.asm.ArgMax).apply(null,arguments)},l._AvgPool=function(){return(l._AvgPool=l.asm.AvgPool).apply(null,arguments)},l._BatchMatMul=function(){return(l._BatchMatMul=l.asm.BatchMatMul).apply(null,arguments)},l._Ceil=function(){return(l._Ceil=l.asm.Ceil).apply(null,arguments)},l._ClipByValue=function(){return(l._ClipByValue=l.asm.ClipByValue).apply(null,arguments)},l._Conv2D=function(){return(l._Conv2D=l.asm.Conv2D).apply(null,arguments)},l._Conv2DBackpropInput=function(){return(l._Conv2DBackpropInput=l.asm.Conv2DBackpropInput).apply(null,arguments)},l._Cos=function(){return(l._Cos=l.asm.Cos).apply(null,arguments)},l._Cosh=function(){return(l._Cosh=l.asm.Cosh).apply(null,arguments)},l._CropAndResize=function(){return(l._CropAndResize=l.asm.CropAndResize).apply(null,arguments)},l._Cumprod=function(){return(l._Cumprod=l.asm.Cumprod).apply(null,arguments)},l._Cumsum=function(){return(l._Cumsum=l.asm.Cumsum).apply(null,arguments)},l._DepthToSpace=function(){return(l._DepthToSpace=l.asm.DepthToSpace).apply(null,arguments)},l._DepthwiseConv2dNative=function(){return(l._DepthwiseConv2dNative=l.asm.DepthwiseConv2dNative).apply(null,arguments)},l._Elu=function(){return(l._Elu=l.asm.Elu).apply(null,arguments)},l._Equal=function(){return(l._Equal=l.asm.Equal).apply(null,arguments)},l._Exp=function(){return(l._Exp=l.asm.Exp).apply(null,arguments)},l._FlipLeftRight=function(){return(l._FlipLeftRight=l.asm.FlipLeftRight).apply(null,arguments)},l._Floor=function(){return(l._Floor=l.asm.Floor).apply(null,arguments)},l._FloorDiv=function(){return(l._FloorDiv=l.asm.FloorDiv).apply(null,arguments)},l._FusedBatchNorm=function(){return(l._FusedBatchNorm=l.asm.FusedBatchNorm).apply(null,arguments)},l._FusedConv2D=function(){return(l._FusedConv2D=l.asm.FusedConv2D).apply(null,arguments)},l._FusedDepthwiseConv2D=function(){return(l._FusedDepthwiseConv2D=l.asm.FusedDepthwiseConv2D).apply(null,arguments)},l._Gather=function(){return(l._Gather=l.asm.Gather).apply(null,arguments)},l._GatherNd=function(){return(l._GatherNd=l.asm.GatherNd).apply(null,arguments)},l._Greater=function(){return(l._Greater=l.asm.Greater).apply(null,arguments)},l._GreaterEqual=function(){return(l._GreaterEqual=l.asm.GreaterEqual).apply(null,arguments)},l._IsNan=function(){return(l._IsNan=l.asm.IsNan).apply(null,arguments)},l._LeakyRelu=function(){return(l._LeakyRelu=l.asm.LeakyRelu).apply(null,arguments)},l._Less=function(){return(l._Less=l.asm.Less).apply(null,arguments)},l._LessEqual=function(){return(l._LessEqual=l.asm.LessEqual).apply(null,arguments)},l._Log=function(){return(l._Log=l.asm.Log).apply(null,arguments)},l._LogicalAnd=function(){return(l._LogicalAnd=l.asm.LogicalAnd).apply(null,arguments)},l._LogicalNot=function(){return(l._LogicalNot=l.asm.LogicalNot).apply(null,arguments)},l._LogicalOr=function(){return(l._LogicalOr=l.asm.LogicalOr).apply(null,arguments)},l._LogicalXor=function(){return(l._LogicalXor=l.asm.LogicalXor).apply(null,arguments)},l._Max=function(){return(l._Max=l.asm.Max).apply(null,arguments)},l._MaxPool=function(){return(l._MaxPool=l.asm.MaxPool).apply(null,arguments)},l._Maximum=function(){return(l._Maximum=l.asm.Maximum).apply(null,arguments)},l._Mean=function(){return(l._Mean=l.asm.Mean).apply(null,arguments)},l._Min=function(){return(l._Min=l.asm.Min).apply(null,arguments)},l._Minimum=function(){return(l._Minimum=l.asm.Minimum).apply(null,arguments)},l._MirrorPad=function(){return(l._MirrorPad=l.asm.MirrorPad).apply(null,arguments)},l._Multiply=function(){return(l._Multiply=l.asm.Multiply).apply(null,arguments)},l._Neg=function(){return(l._Neg=l.asm.Neg).apply(null,arguments)},l._NonMaxSuppressionV3=function(){return(l._NonMaxSuppressionV3=l.asm.NonMaxSuppressionV3).apply(null,arguments)},l._NonMaxSuppressionV4=function(){return(l._NonMaxSuppressionV4=l.asm.NonMaxSuppressionV4).apply(null,arguments)},l._NonMaxSuppressionV5=function(){return(l._NonMaxSuppressionV5=l.asm.NonMaxSuppressionV5).apply(null,arguments)},l._NotEqual=function(){return(l._NotEqual=l.asm.NotEqual).apply(null,arguments)},l._OneHot=function(){return(l._OneHot=l.asm.OneHot).apply(null,arguments)},l._PadV2=function(){return(l._PadV2=l.asm.PadV2).apply(null,arguments)},l._Pow=function(){return(l._Pow=l.asm.Pow).apply(null,arguments)},l._Prelu=function(){return(l._Prelu=l.asm.Prelu).apply(null,arguments)},l._Prod=function(){return(l._Prod=l.asm.Prod).apply(null,arguments)},l._RealDiv=function(){return(l._RealDiv=l.asm.RealDiv).apply(null,arguments)},l._Reciprocal=function(){return(l._Reciprocal=l.asm.Reciprocal).apply(null,arguments)},l._Relu=function(){return(l._Relu=l.asm.Relu).apply(null,arguments)},l._Relu6=function(){return(l._Relu6=l.asm.Relu6).apply(null,arguments)},l._ResizeBilinear=function(){return(l._ResizeBilinear=l.asm.ResizeBilinear).apply(null,arguments)},l._ResizeNearestNeighbor=function(){return(l._ResizeNearestNeighbor=l.asm.ResizeNearestNeighbor).apply(null,arguments)},l._Reverse=function(){return(l._Reverse=l.asm.Reverse).apply(null,arguments)},l._RotateWithOffset=function(){return(l._RotateWithOffset=l.asm.RotateWithOffset).apply(null,arguments)},l._Round=function(){return(l._Round=l.asm.Round).apply(null,arguments)},l._Rsqrt=function(){return(l._Rsqrt=l.asm.Rsqrt).apply(null,arguments)},l._ScatterNd=function(){return(l._ScatterNd=l.asm.ScatterNd).apply(null,arguments)},l._SelectV2=function(){return(l._SelectV2=l.asm.SelectV2).apply(null,arguments)},l._Sigmoid=function(){return(l._Sigmoid=l.asm.Sigmoid).apply(null,arguments)},l._Sin=function(){return(l._Sin=l.asm.Sin).apply(null,arguments)},l._Softmax=function(){return(l._Softmax=l.asm.Softmax).apply(null,arguments)},l._SparseFillEmptyRows=function(){return(l._SparseFillEmptyRows=l.asm.SparseFillEmptyRows).apply(null,arguments)},l._SparseReshape=function(){return(l._SparseReshape=l.asm.SparseReshape).apply(null,arguments)},l._SparseSegmentReduction=function(){return(l._SparseSegmentReduction=l.asm.SparseSegmentReduction).apply(null,arguments)},l._Sqrt=function(){return(l._Sqrt=l.asm.Sqrt).apply(null,arguments)},l._Square=function(){return(l._Square=l.asm.Square).apply(null,arguments)},l._SquaredDifference=function(){return(l._SquaredDifference=l.asm.SquaredDifference).apply(null,arguments)},l._Step=function(){return(l._Step=l.asm.Step).apply(null,arguments)},l._StridedSlice=function(){return(l._StridedSlice=l.asm.StridedSlice).apply(null,arguments)},l._Sub=function(){return(l._Sub=l.asm.Sub).apply(null,arguments)},l._Sum=function(){return(l._Sum=l.asm.Sum).apply(null,arguments)},l._Tan=function(){return(l._Tan=l.asm.Tan).apply(null,arguments)},l._Tanh=function(){return(l._Tanh=l.asm.Tanh).apply(null,arguments)},l._Tile=function(){return(l._Tile=l.asm.Tile).apply(null,arguments)},l._TopK=function(){return(l._TopK=l.asm.TopK).apply(null,arguments)},l._Transform=function(){return(l._Transform=l.asm.Transform).apply(null,arguments)},l._Transpose=function(){return(l._Transpose=l.asm.Transpose).apply(null,arguments)},l.__FusedMatMul=function(){return(l.__FusedMatMul=l.asm._FusedMatMul).apply(null,arguments)},l._malloc=function(){return(l._malloc=l.asm.malloc).apply(null,arguments)},l._free=function(){return(l._free=l.asm.free).apply(null,arguments)},l.__emscripten_tls_init=function(){return(l.__emscripten_tls_init=l.asm._emscripten_tls_init).apply(null,arguments)},l._pthread_self=function(){return(He=l._pthread_self=l.asm.pthread_self).apply(null,arguments)}),qe=(l.___errno_location=function(){return(l.___errno_location=l.asm.__errno_location).apply(null,arguments)},l.__emscripten_thread_init=function(){return(qe=l.__emscripten_thread_init=l.asm._emscripten_thread_init).apply(null,arguments)}),Ke=(l.__emscripten_thread_crashed=function(){return(l.__emscripten_thread_crashed=l.asm._emscripten_thread_crashed).apply(null,arguments)},l._emscripten_main_thread_process_queued_calls=function(){return(l._emscripten_main_thread_process_queued_calls=l.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},l._emscripten_main_browser_thread_id=function(){return(l._emscripten_main_browser_thread_id=l.asm.emscripten_main_browser_thread_id).apply(null,arguments)},l._emscripten_run_in_main_runtime_thread_js=function(){return(Ke=l._emscripten_run_in_main_runtime_thread_js=l.asm.emscripten_run_in_main_runtime_thread_js).apply(null,arguments)}),Xe=(l._emscripten_dispatch_to_thread_=function(){return(l._emscripten_dispatch_to_thread_=l.asm.emscripten_dispatch_to_thread_).apply(null,arguments)},l.__emscripten_proxy_execute_task_queue=function(){return(Xe=l.__emscripten_proxy_execute_task_queue=l.asm._emscripten_proxy_execute_task_queue).apply(null,arguments)}),Ye=l.__emscripten_thread_free_data=function(){return(Ye=l.__emscripten_thread_free_data=l.asm._emscripten_thread_free_data).apply(null,arguments)},Qe=l.__emscripten_thread_exit=function(){return(Qe=l.__emscripten_thread_exit=l.asm._emscripten_thread_exit).apply(null,arguments)},Ze=l._emscripten_stack_set_limits=function(){return(Ze=l._emscripten_stack_set_limits=l.asm.emscripten_stack_set_limits).apply(null,arguments)},Je=l.stackSave=function(){return(Je=l.stackSave=l.asm.stackSave).apply(null,arguments)},$e=l.stackRestore=function(){return($e=l.stackRestore=l.asm.stackRestore).apply(null,arguments)},et=l.stackAlloc=function(){return(et=l.stackAlloc=l.asm.stackAlloc).apply(null,arguments)};l.dynCall_iijjiiii=function(){return(l.dynCall_iijjiiii=l.asm.dynCall_iijjiiii).apply(null,arguments)},l.dynCall_jiji=function(){return(l.dynCall_jiji=l.asm.dynCall_jiji).apply(null,arguments)};function tt(e){if(e=e||m,!(te>0)){if(x)return s(l),J(),void startWorker(l);(function(){if(l.preRun)for("function"==typeof l.preRun&&(l.preRun=[l.preRun]);l.preRun.length;)$(l.preRun.shift());ye(X)})(),te>0||(l.setStatus?(l.setStatus("Running..."),setTimeout((function(){setTimeout((function(){l.setStatus("")}),1),t()}),1)):t())}function t(){We||(We=!0,l.calledRun=!0,!O&&(J(),s(l),l.onRuntimeInitialized&&l.onRuntimeInitialized(),function(){if(!x){if(l.postRun)for("function"==typeof l.postRun&&(l.postRun=[l.postRun]);l.postRun.length;)ee(l.postRun.shift());ye(Q)}}()))}}if(l.keepRuntimeAlive=Z,l.wasmMemory=F,l.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e||"boolean"===e}));return"string"!==t&&a&&!r?Le(e):function(){return Be(e,t,n,arguments)}},l.ExitStatus=de,l.PThread=ge,re=function e(){We||tt(),We||(re=e)},l.preInit)for("function"==typeof l.preInit&&(l.preInit=[l.preInit]);l.preInit.length>0;)l.preInit.pop()();if(tt(),c&&(Ue={uncaughtException:process.listeners("uncaughtException").filter((function(e){return!c.uncaughtException.indexOf(e)>-1})),unhandledRejection:process.listeners("unhandledRejection").filter((function(e){return!c.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof WasmBackendModule)Ve=WasmBackendModule;else{if("undefined"==typeof t)throw new Error("Could not find wasm module in post.js");Ve=t}if(Ue){var nt=Ve._dispose;Ve._dispose=function(){nt(),Ue.uncaughtException.forEach((function(e){process.removeListener("uncaughtException",e)})),Ue.unhandledRejection.forEach((function(e){process.removeListener("unhandledRejection",e)}))}}return t.ready}}();"object"==typeof e&&"object"==typeof t?t.exports=r:"function"==typeof define&&n.amdO?define([],(function(){return r})):"object"==typeof e&&(e.WasmBackendModuleThreadedSimd=r)})),dt=Ge((function(e,t){t.exports.wasmWorkerContents='"use strict";var Module={};var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads");var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",data=>onmessage({data:data}));var fs=require("fs");Object.assign(global,{self:global,require:require,Module:Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:function(f){(0,eval)(fs.readFileSync(f,"utf8")+"//# sourceURL="+f)},postMessage:function(msg){parentPort.postMessage(msg)},performance:global.performance||{now:function(){return Date.now()}}})}var initializedJS=false;var pendingNotifiedProxyingQueues=[];function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"\n");return}console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;self.alert=threadAlert;Module["instantiateWasm"]=(info,receiveInstance)=>{var instance=new WebAssembly.Instance(Module["wasmModule"],info);receiveInstance(instance);Module["wasmModule"]=null;return instance.exports};self.onunhandledrejection=e=>{throw e.reason??e};self.startWorker=instance=>{Module=instance;postMessage({"cmd":"loaded"})};self.onmessage=e=>{try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;for(const handler of e.data.handlers){Module[handler]=function(){postMessage({cmd:"callHandler",handler:handler,args:[...arguments]})}}Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob=="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module)}else if(e.data.cmd==="run"){Module["__emscripten_thread_init"](e.data.pthread_ptr,0,0,1);Module["establishStackSpace"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].threadInitTLS();if(!initializedJS){pendingNotifiedProxyingQueues.forEach(queue=>{Module["executeNotifiedProxyingQueue"](queue)});pendingNotifiedProxyingQueues=[];initializedJS=true}try{Module["invokeEntryPoint"](e.data.start_routine,e.data.arg)}catch(ex){if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["keepRuntimeAlive"]()){}else{Module["__emscripten_thread_exit"](ex.status)}}else{throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["__emscripten_thread_exit"](-1)}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processProxyingQueue"){if(initializedJS){Module["executeNotifiedProxyingQueue"](e.data.queue)}else{pendingNotifiedProxyingQueues.push(e.data.queue)}}else if(e.data.cmd){err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){if(Module["__emscripten_thread_crashed"]){Module["__emscripten_thread_crashed"]()}throw ex}};'})),ft=Ge((function(e,t){var r=function(){var e="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return e=e||Me,function(t){var n,r,a,i="undefined"!=typeof(t=t||{})?t:{};i.ready=new Promise((function(e,t){n=e,r=t})),"undefined"!=typeof process&&process.listeners&&(a={uncaughtException:process.listeners("uncaughtException"),unhandledRejection:process.listeners("unhandledRejection")});var o,s,u,c=Object.assign({},i),l=[],p="object"==typeof window,d="function"==typeof importScripts,f="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,h="";if(f){var m=ot(),v=st();h=d?v.dirname(h)+"/":"//",o=function(e,t){return e=j(e)?new URL(e):v.normalize(e),m.readFileSync(e,t?void 0:"utf8")},u=function(e){var t=o(e,!0);return t.buffer||(t=new Uint8Array(t)),t},s=function(e,t,n){e=j(e)?new URL(e):v.normalize(e),m.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),l=process.argv.slice(2),process.on("uncaughtException",(function(e){if(!(e instanceof H))throw e})),process.on("unhandledRejection",(function(e){throw e})),function(e,t){if(x)throw process.exitCode=e,t;(function(e){e instanceof H||y("exiting due to exception: "+e)})(t),process.exit(e)},i.inspect=function(){return"[Emscripten Module object]"}}else(p||d)&&(d?h=self.location.href:"undefined"!=typeof document&&document.currentScript&&(h=document.currentScript.src),e&&(h=e),h=0!==h.indexOf("blob:")?h.substr(0,h.replace(/[?#].*/,"").lastIndexOf("/")+1):"",o=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},d&&(u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),s=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)},function(e){return document.title=e});var g=i.print||console.log.bind(console),y=i.printErr||console.warn.bind(console);Object.assign(i,c),c=null,i.arguments&&(l=i.arguments),i.thisProgram&&i.thisProgram,i.quit&&i.quit;var b;i.wasmBinary&&(b=i.wasmBinary);var x=i.noExitRuntime||!0;"object"!=typeof WebAssembly&&B("no native wasm support detected");var k,w=!1;var S,I,_,N,C="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function T(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&C)return C.decode(e.subarray(t,a));for(var i="";t<a;){var o=e[t++];if(128&o){var s=63&e[t++];if(192!=(224&o)){var u=63&e[t++];if((o=224==(240&o)?(15&o)<<12|s<<6|u:(7&o)<<18|s<<12|u<<6|63&e[t++])<65536)i+=String.fromCharCode(o);else{var c=o-65536;i+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else i+=String.fromCharCode((31&o)<<6|s)}else i+=String.fromCharCode(o)}return i}function E(e,t){return e?T(_,e,t):""}function A(e){S=e,i.HEAP8=I=new Int8Array(e),i.HEAP16=new Int16Array(e),i.HEAP32=new Int32Array(e),i.HEAPU8=_=new Uint8Array(e),i.HEAPU16=new Uint16Array(e),i.HEAPU32=N=new Uint32Array(e),i.HEAPF32=new Float32Array(e),i.HEAPF64=new Float64Array(e)}i.INITIAL_MEMORY;var R=[],F=[],D=[];function M(e){R.unshift(e)}function O(e){D.unshift(e)}var P=0,L=null,z=null;function B(e){i.onAbort&&i.onAbort(e),y(e="Aborted("+e+")"),w=!0,1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw r(t),t}var W,U="data:application/octet-stream;base64,";function V(e){return e.startsWith(U)}function j(e){return e.startsWith("file://")}function G(e){try{if(e==W&&b)return new Uint8Array(b);if(u)return u(e);throw"both async and sync fetching of the wasm failed"}catch(t){B(t)}}function H(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function q(e){for(;e.length>0;)e.shift()(i)}function K(e){try{return k.grow(e-S.byteLength+65535>>>16),A(k.buffer),1}catch(t){}}V(W="tfjs-backend-wasm.wasm")||(W=function(e){return i.locateFile?i.locateFile(e,h):h+e}(W));var X=[null,[],[]];function Y(e,t){var n=X[e];0===t||10===t?((1===e?g:y)(T(n,0)),n.length=0):n.push(t)}function Q(e){return i["_"+e]}function Z(e,t,n,r,a){var i={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);(function(e,t,n){(function(e,t,n,r){if(!(r>0))return 0;for(var a=n,i=n+r-1,o=0;o<e.length;++o){var s=e.charCodeAt(o);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++o)),s<=127){if(n>=i)break;t[n++]=s}else if(s<=2047){if(n+1>=i)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=i)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=i)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}t[n]=0})(e,_,t,n)})(e,t=ae(n),n)}return t},array:function(e){var t=ae(e.length);return function(e,t){I.set(e,t)}(e,t),t}};var o=Q(e),s=[],u=0;if(r)for(var c=0;c<r.length;c++){var l=i[n[c]];l?(0===u&&(u=ne()),s[c]=l(r[c])):s[c]=r[c]}var p,d=o.apply(null,s);return p=d,0!==u&&re(u),d=function(e){return"string"===t?E(e):"boolean"===t?Boolean(e):e}(p),d}var J,$,ee,te={abort:function(){B("")},emscripten_get_heap_max:function(){return 2147483648},emscripten_memcpy_big:function(e,t,n){_.copyWithin(e,t,t+n)},emscripten_resize_heap:function(e){var t=_.length,n=2147483648;if((e>>>=0)>n)return!1;for(var r,a,i=1;i<=4;i*=2){var o=t*(1+.2/i);if(o=Math.min(o,e+100663296),K(Math.min(n,(r=Math.max(e,o))+((a=65536)-r%a)%a)))return!0}return!1},fd_close:function(e){return 52},fd_seek:function(e,t,n,r,a){return 70},fd_write:function(e,t,n,r){for(var a=0,i=0;i<n;i++){var o=N[t>>2],s=N[t+4>>2];t+=8;for(var u=0;u<s;u++)Y(e,_[o+u]);a+=s}return N[r>>2]=a,0}},ne=(function(){var e={env:te,wasi_snapshot_preview1:te};function t(e,t){var n=e.exports;i.asm=n,A((k=i.asm.memory).buffer),i.asm.__indirect_function_table,function(e){F.unshift(e)}(i.asm.__wasm_call_ctors),function(e){if(P--,i.monitorRunDependencies&&i.monitorRunDependencies(P),0==P&&(null!==L&&(clearInterval(L),L=null),z)){var t=z;z=null,t()}}()}function n(e){t(e.instance)}function a(t){return function(){if(!b&&(p||d)){if("function"==typeof fetch&&!j(W))return fetch(W,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+W+"'";return e.arrayBuffer()})).catch((function(){return G(W)}));if(s)return new Promise((function(e,t){s(W,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return G(W)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){y("failed to asynchronously prepare wasm: "+e),B(e)}))}if(P++,i.monitorRunDependencies&&i.monitorRunDependencies(P),i.instantiateWasm)try{return i.instantiateWasm(e,t)}catch(o){y("Module.instantiateWasm callback failed with error: "+o),r(o)}(b||"function"!=typeof WebAssembly.instantiateStreaming||V(W)||j(W)||f||"function"!=typeof fetch?a(n):fetch(W,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return y("wasm streaming compile failed: "+e),y("falling back to ArrayBuffer instantiation"),a(n)}))}))).catch(r)}(),i.___wasm_call_ctors=function(){return(i.___wasm_call_ctors=i.asm.__wasm_call_ctors).apply(null,arguments)},i._init=function(){return(i._init=i.asm.init).apply(null,arguments)},i._init_with_threads_count=function(){return(i._init_with_threads_count=i.asm.init_with_threads_count).apply(null,arguments)},i._get_threads_count=function(){return(i._get_threads_count=i.asm.get_threads_count).apply(null,arguments)},i._register_tensor=function(){return(i._register_tensor=i.asm.register_tensor).apply(null,arguments)},i._dispose_data=function(){return(i._dispose_data=i.asm.dispose_data).apply(null,arguments)},i._dispose=function(){return(i._dispose=i.asm.dispose).apply(null,arguments)},i._Abs=function(){return(i._Abs=i.asm.Abs).apply(null,arguments)},i._Add=function(){return(i._Add=i.asm.Add).apply(null,arguments)},i._AddN=function(){return(i._AddN=i.asm.AddN).apply(null,arguments)},i._All=function(){return(i._All=i.asm.All).apply(null,arguments)},i._Any=function(){return(i._Any=i.asm.Any).apply(null,arguments)},i._ArgMax=function(){return(i._ArgMax=i.asm.ArgMax).apply(null,arguments)},i._AvgPool=function(){return(i._AvgPool=i.asm.AvgPool).apply(null,arguments)},i._BatchMatMul=function(){return(i._BatchMatMul=i.asm.BatchMatMul).apply(null,arguments)},i._Ceil=function(){return(i._Ceil=i.asm.Ceil).apply(null,arguments)},i._ClipByValue=function(){return(i._ClipByValue=i.asm.ClipByValue).apply(null,arguments)},i._Conv2D=function(){return(i._Conv2D=i.asm.Conv2D).apply(null,arguments)},i._Conv2DBackpropInput=function(){return(i._Conv2DBackpropInput=i.asm.Conv2DBackpropInput).apply(null,arguments)},i._Cos=function(){return(i._Cos=i.asm.Cos).apply(null,arguments)},i._Cosh=function(){return(i._Cosh=i.asm.Cosh).apply(null,arguments)},i._CropAndResize=function(){return(i._CropAndResize=i.asm.CropAndResize).apply(null,arguments)},i._Cumprod=function(){return(i._Cumprod=i.asm.Cumprod).apply(null,arguments)},i._Cumsum=function(){return(i._Cumsum=i.asm.Cumsum).apply(null,arguments)},i._DepthToSpace=function(){return(i._DepthToSpace=i.asm.DepthToSpace).apply(null,arguments)},i._DepthwiseConv2dNative=function(){return(i._DepthwiseConv2dNative=i.asm.DepthwiseConv2dNative).apply(null,arguments)},i._Elu=function(){return(i._Elu=i.asm.Elu).apply(null,arguments)},i._Equal=function(){return(i._Equal=i.asm.Equal).apply(null,arguments)},i._Exp=function(){return(i._Exp=i.asm.Exp).apply(null,arguments)},i._FlipLeftRight=function(){return(i._FlipLeftRight=i.asm.FlipLeftRight).apply(null,arguments)},i._Floor=function(){return(i._Floor=i.asm.Floor).apply(null,arguments)},i._FloorDiv=function(){return(i._FloorDiv=i.asm.FloorDiv).apply(null,arguments)},i._FusedBatchNorm=function(){return(i._FusedBatchNorm=i.asm.FusedBatchNorm).apply(null,arguments)},i._FusedConv2D=function(){return(i._FusedConv2D=i.asm.FusedConv2D).apply(null,arguments)},i._FusedDepthwiseConv2D=function(){return(i._FusedDepthwiseConv2D=i.asm.FusedDepthwiseConv2D).apply(null,arguments)},i._Gather=function(){return(i._Gather=i.asm.Gather).apply(null,arguments)},i._GatherNd=function(){return(i._GatherNd=i.asm.GatherNd).apply(null,arguments)},i._Greater=function(){return(i._Greater=i.asm.Greater).apply(null,arguments)},i._GreaterEqual=function(){return(i._GreaterEqual=i.asm.GreaterEqual).apply(null,arguments)},i._IsNan=function(){return(i._IsNan=i.asm.IsNan).apply(null,arguments)},i._LeakyRelu=function(){return(i._LeakyRelu=i.asm.LeakyRelu).apply(null,arguments)},i._Less=function(){return(i._Less=i.asm.Less).apply(null,arguments)},i._LessEqual=function(){return(i._LessEqual=i.asm.LessEqual).apply(null,arguments)},i._Log=function(){return(i._Log=i.asm.Log).apply(null,arguments)},i._LogicalAnd=function(){return(i._LogicalAnd=i.asm.LogicalAnd).apply(null,arguments)},i._LogicalNot=function(){return(i._LogicalNot=i.asm.LogicalNot).apply(null,arguments)},i._LogicalOr=function(){return(i._LogicalOr=i.asm.LogicalOr).apply(null,arguments)},i._LogicalXor=function(){return(i._LogicalXor=i.asm.LogicalXor).apply(null,arguments)},i._Max=function(){return(i._Max=i.asm.Max).apply(null,arguments)},i._MaxPool=function(){return(i._MaxPool=i.asm.MaxPool).apply(null,arguments)},i._Maximum=function(){return(i._Maximum=i.asm.Maximum).apply(null,arguments)},i._Mean=function(){return(i._Mean=i.asm.Mean).apply(null,arguments)},i._Min=function(){return(i._Min=i.asm.Min).apply(null,arguments)},i._Minimum=function(){return(i._Minimum=i.asm.Minimum).apply(null,arguments)},i._MirrorPad=function(){return(i._MirrorPad=i.asm.MirrorPad).apply(null,arguments)},i._Multiply=function(){return(i._Multiply=i.asm.Multiply).apply(null,arguments)},i._Neg=function(){return(i._Neg=i.asm.Neg).apply(null,arguments)},i._NonMaxSuppressionV3=function(){return(i._NonMaxSuppressionV3=i.asm.NonMaxSuppressionV3).apply(null,arguments)},i._NonMaxSuppressionV4=function(){return(i._NonMaxSuppressionV4=i.asm.NonMaxSuppressionV4).apply(null,arguments)},i._NonMaxSuppressionV5=function(){return(i._NonMaxSuppressionV5=i.asm.NonMaxSuppressionV5).apply(null,arguments)},i._NotEqual=function(){return(i._NotEqual=i.asm.NotEqual).apply(null,arguments)},i._OneHot=function(){return(i._OneHot=i.asm.OneHot).apply(null,arguments)},i._PadV2=function(){return(i._PadV2=i.asm.PadV2).apply(null,arguments)},i._Pow=function(){return(i._Pow=i.asm.Pow).apply(null,arguments)},i._Prelu=function(){return(i._Prelu=i.asm.Prelu).apply(null,arguments)},i._Prod=function(){return(i._Prod=i.asm.Prod).apply(null,arguments)},i._RealDiv=function(){return(i._RealDiv=i.asm.RealDiv).apply(null,arguments)},i._Reciprocal=function(){return(i._Reciprocal=i.asm.Reciprocal).apply(null,arguments)},i._Relu=function(){return(i._Relu=i.asm.Relu).apply(null,arguments)},i._Relu6=function(){return(i._Relu6=i.asm.Relu6).apply(null,arguments)},i._ResizeBilinear=function(){return(i._ResizeBilinear=i.asm.ResizeBilinear).apply(null,arguments)},i._ResizeNearestNeighbor=function(){return(i._ResizeNearestNeighbor=i.asm.ResizeNearestNeighbor).apply(null,arguments)},i._Reverse=function(){return(i._Reverse=i.asm.Reverse).apply(null,arguments)},i._RotateWithOffset=function(){return(i._RotateWithOffset=i.asm.RotateWithOffset).apply(null,arguments)},i._Round=function(){return(i._Round=i.asm.Round).apply(null,arguments)},i._Rsqrt=function(){return(i._Rsqrt=i.asm.Rsqrt).apply(null,arguments)},i._ScatterNd=function(){return(i._ScatterNd=i.asm.ScatterNd).apply(null,arguments)},i._SelectV2=function(){return(i._SelectV2=i.asm.SelectV2).apply(null,arguments)},i._Sigmoid=function(){return(i._Sigmoid=i.asm.Sigmoid).apply(null,arguments)},i._Sin=function(){return(i._Sin=i.asm.Sin).apply(null,arguments)},i._Softmax=function(){return(i._Softmax=i.asm.Softmax).apply(null,arguments)},i._SparseFillEmptyRows=function(){return(i._SparseFillEmptyRows=i.asm.SparseFillEmptyRows).apply(null,arguments)},i._SparseReshape=function(){return(i._SparseReshape=i.asm.SparseReshape).apply(null,arguments)},i._SparseSegmentReduction=function(){return(i._SparseSegmentReduction=i.asm.SparseSegmentReduction).apply(null,arguments)},i._Sqrt=function(){return(i._Sqrt=i.asm.Sqrt).apply(null,arguments)},i._Square=function(){return(i._Square=i.asm.Square).apply(null,arguments)},i._SquaredDifference=function(){return(i._SquaredDifference=i.asm.SquaredDifference).apply(null,arguments)},i._Step=function(){return(i._Step=i.asm.Step).apply(null,arguments)},i._StridedSlice=function(){return(i._StridedSlice=i.asm.StridedSlice).apply(null,arguments)},i._Sub=function(){return(i._Sub=i.asm.Sub).apply(null,arguments)},i._Sum=function(){return(i._Sum=i.asm.Sum).apply(null,arguments)},i._Tan=function(){return(i._Tan=i.asm.Tan).apply(null,arguments)},i._Tanh=function(){return(i._Tanh=i.asm.Tanh).apply(null,arguments)},i._Tile=function(){return(i._Tile=i.asm.Tile).apply(null,arguments)},i._TopK=function(){return(i._TopK=i.asm.TopK).apply(null,arguments)},i._Transform=function(){return(i._Transform=i.asm.Transform).apply(null,arguments)},i._Transpose=function(){return(i._Transpose=i.asm.Transpose).apply(null,arguments)},i.__FusedMatMul=function(){return(i.__FusedMatMul=i.asm._FusedMatMul).apply(null,arguments)},i._malloc=function(){return(i._malloc=i.asm.malloc).apply(null,arguments)},i._free=function(){return(i._free=i.asm.free).apply(null,arguments)},i.___errno_location=function(){return(i.___errno_location=i.asm.__errno_location).apply(null,arguments)},i.stackSave=function(){return(ne=i.stackSave=i.asm.stackSave).apply(null,arguments)}),re=i.stackRestore=function(){return(re=i.stackRestore=i.asm.stackRestore).apply(null,arguments)},ae=i.stackAlloc=function(){return(ae=i.stackAlloc=i.asm.stackAlloc).apply(null,arguments)};i.dynCall_iijjiiii=function(){return(i.dynCall_iijjiiii=i.asm.dynCall_iijjiiii).apply(null,arguments)},i.dynCall_jiji=function(){return(i.dynCall_jiji=i.asm.dynCall_jiji).apply(null,arguments)};function ie(e){function t(){J||(J=!0,i.calledRun=!0,!w&&(!0,q(F),n(i),i.onRuntimeInitialized&&i.onRuntimeInitialized(),function(){if(i.postRun)for("function"==typeof i.postRun&&(i.postRun=[i.postRun]);i.postRun.length;)O(i.postRun.shift());q(D)}()))}e=e||l,P>0||(function(){if(i.preRun)for("function"==typeof i.preRun&&(i.preRun=[i.preRun]);i.preRun.length;)M(i.preRun.shift());q(R)}(),P>0)||(i.setStatus?(i.setStatus("Running..."),setTimeout((function(){setTimeout((function(){i.setStatus("")}),1),t()}),1)):t())}if(i.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e||"boolean"===e}));return"string"!==t&&a&&!r?Q(e):function(){return Z(e,t,n,arguments)}},z=function e(){J||ie(),J||(z=e)},i.preInit)for("function"==typeof i.preInit&&(i.preInit=[i.preInit]);i.preInit.length>0;)i.preInit.pop()();if(ie(),a&&($={uncaughtException:process.listeners("uncaughtException").filter((function(e){return!a.uncaughtException.indexOf(e)>-1})),unhandledRejection:process.listeners("unhandledRejection").filter((function(e){return!a.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof t)ee=t;else{if("undefined"==typeof WasmBackendModuleThreadedSimd)throw new Error("Could not find wasm module in post.js");ee=WasmBackendModuleThreadedSimd}if($){var oe=ee._dispose;ee._dispose=function(){oe(),$.uncaughtException.forEach((function(e){process.removeListener("uncaughtException",e)})),$.unhandledRejection.forEach((function(e){process.removeListener("unhandledRejection",e)}))}}return t.ready}}();"object"==typeof e&&"object"==typeof t?t.exports=r:"function"==typeof define&&n.amdO?define([],(function(){return r})):"object"==typeof e&&(e.WasmBackendModule=r)})),ht=function(){function e(t,n){h(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return v(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),mt=function(){function e(){h(this,e)}return v(e,[{key:"refCount",value:function(e){return vt("refCount")}},{key:"incRef",value:function(e){return vt("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return vt("time")}},{key:"read",value:function(e){return vt("read")}},{key:"readSync",value:function(e){return vt("readSync")}},{key:"readToGPU",value:function(e,t){return vt("readToGPU")}},{key:"numDataIds",value:function(){return vt("numDataIds")}},{key:"disposeData",value:function(e,t){return vt("disposeData")}},{key:"write",value:function(e,t,n){return vt("write")}},{key:"move",value:function(e,t,n,r,a){return vt("move")}},{key:"createTensorFromGPUData",value:function(e,t,n){return vt("createTensorFromGPUData")}},{key:"memory",value:function(){return vt("memory")}},{key:"floatPrecision",value:function(){return vt("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return vt("dispose")}}]),e}();function vt(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function gt(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,kt(e,--t,n)}function yt(e,t){if(e.length!==t.length)throw new Error("Array sizes must match to be shuffled together First array length was ".concat(e.length,"Second array length was ").concat(t.length));for(var n=e.length,r=0;n>0;)r=Math.random()*n|0,kt(e,--n,r),kt(t,n,r)}function bt(e,t,n){return Math.max(e,Math.min(t,n))}function xt(e){return e%2===0?e:e+1}function kt(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function wt(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function St(e,t){var n=Math.random();return t*n+(1-n)*e}function It(e,t){for(var n=0,r=0;r<e.length;r++){var a=Number(e[r])-Number(t[r]);n+=a*a}return n}function _t(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function Nt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";_t(At(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function Ct(e){_t(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function Tt(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Et(e){return 0===e.length}function At(e,t){if(e===t)return!0;if(null==e||null==t||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Rt(e){return e%1===0}function Ft(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function Dt(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Mt(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return gt(t),t}function Ot(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Pt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return new Promise((function(a,i){var o=0;!function s(){if(e())a();else{o++;var u=t(o);null!=n&&o>=n?i():null!=r?r(s,u):setTimeout(s,u)}}()}))}function Lt(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!==0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function zt(e,t){var n=t.length;return e=null==e?t.map((function(e,t){return t})):[].concat(e),_t(e.every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ").concat(e)})),_t(e.every((function(e){return Rt(e)})),(function(){return"All values in axis param must be integers but got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function Bt(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:zt(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Wt(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function Ut(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function Vt(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}function jt(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function Gt(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function Ht(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function qt(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function Kt(e){return"string"==typeof e||e instanceof String}function Xt(e){return"boolean"==typeof e}function Yt(e){return"number"==typeof e}function Qt(e){return Array.isArray(e)?Qt(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":Yt(e)?"float32":Kt(e)?"string":Xt(e)?"bool":"float32"}function Zt(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Jt(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function $t(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function en(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=en(e+l*c,u,n,r);return a}function tn(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return en(0,e,t,n)}function nn(e,t){if(Array.isArray(e))return e;if("float32"===t)return e instanceof Float32Array?e:new Float32Array(e);if("int32"===t)return e instanceof Int32Array?e:new Int32Array(e);if("bool"===t||"string"===t)return Uint8Array.from(new Int32Array(e));throw new Error("Unknown dtype ".concat(t))}function rn(e,t){for(var n=an(e,t),r=0;r<n.length;r++)n[r]=1;return n}function an(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function on(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return tn(e,new Float32Array(n));if("int32"===t)return tn(e,new Int32Array(n));if("bool"===t)return tn(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function sn(e){e.forEach((function(t){_t(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function un(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function cn(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function ln(e){return e&&e.then&&"function"==typeof e.then}var pn="tfjsflags",dn=function(){function e(t){h(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=fn,this.populateURLFlags()}return v(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(hn().getBool("IS_TEST")||hn().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];hn().getBool("IS_TEST")||hn().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=4;break}e.t0=this.flags[t],e.next=8;break;case 4:return e.next=6,this.evaluateFlag(t);case 6:this.flags[t]=e.sent,e.t0=this.flags[t];case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(ln(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!=typeof this.global&&"undefined"!=typeof this.global.location&&"undefined"!=typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);pn in t&&t[pn].split(",").forEach((function(t){var n=o(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if(t=t.toLowerCase(),"true"===t||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(r,a)}))}}}]),e}();function fn(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}function hn(){return vn}var mn,vn=null;function gn(){if(null==mn){var e;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof n.g)e=n.g;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}mn=e}return mn}function yn(e,t){var n=function(){var e=gn();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var bn="Abs",xn="Acos",kn="Acosh",wn="Add",Sn="AddN",In="All",_n="Any",Nn="ArgMax",Cn="ArgMin",Tn="Asin",En="Asinh",An="Atan",Rn="Atanh",Fn="Atan2",Dn="AvgPool",Mn="AvgPoolGrad",On="AvgPool3D",Pn="AvgPool3DGrad",Ln="BatchMatMul",zn="BatchToSpaceND",Bn="Bincount",Wn="BroadcastTo",Un="BroadcastArgs",Vn="Cast",jn="Ceil",Gn="ClipByValue",Hn="Complex",qn="ComplexAbs",Kn="Concat",Xn="Conv2D",Yn="Conv2DBackpropFilter",Qn="Conv2DBackpropInput",Zn="Conv3D",Jn="Conv3DBackpropFilterV2",$n="Conv3DBackpropInputV2",er="Cos",tr="Cosh",nr="Cumprod",rr="Cumsum",ar="CropAndResize",ir="DenseBincount",or="DepthToSpace",sr="DepthwiseConv2dNative",ur="DepthwiseConv2dNativeBackpropFilter",cr="DepthwiseConv2dNativeBackpropInput",lr="Diag",pr="Dilation2D",dr="Dilation2DBackpropInput",fr="Dilation2DBackpropFilter",hr="RealDiv",mr="Einsum",vr="Elu",gr="EluGrad",yr="Erf",br="Equal",xr="Exp",kr="ExpandDims",wr="Expm1",Sr="FFT",Ir="Fill",_r="FlipLeftRight",Nr="Floor",Cr="FloorDiv",Tr="FusedBatchNorm",Er="GatherV2",Ar="GatherNd",Rr="Greater",Fr="GreaterEqual",Dr="Identity",Mr="IFFT",Or="Imag",Pr="IsFinite",Lr="IsInf",zr="IsNan",Br="LeakyRelu",Wr="Less",Ur="LessEqual",Vr="LinSpace",jr="Log",Gr="Log1p",Hr="LogicalAnd",qr="LogicalNot",Kr="LogicalOr",Xr="LogicalXor",Yr="LogSoftmax",Qr="LowerBound",Zr="LRN",Jr="LRNGrad",$r="Max",ea="Maximum",ta="MaxPool",na="MaxPoolGrad",ra="MaxPool3D",aa="MaxPool3DGrad",ia="MaxPoolWithArgmax",oa="Mean",sa="Min",ua="Minimum",ca="MirrorPad",la="Mod",pa="Multinomial",da="Multiply",fa="Neg",ha="NotEqual",ma="NonMaxSuppressionV3",va="NonMaxSuppressionV4",ga="NonMaxSuppressionV5",ya="OnesLike",ba="OneHot",xa="Pack",ka="PadV2",wa="Pool",Sa="Pow",Ia="Prelu",_a="Prod",Na="RaggedGather",Ca="RaggedRange",Ta="RaggedTensorToTensor",Ea="Range",Aa="Real",Ra="Reciprocal",Fa="Relu",Da="Reshape",Ma="ResizeNearestNeighbor",Oa="ResizeNearestNeighborGrad",Pa="ResizeBilinear",La="ResizeBilinearGrad",za="Relu6",Ba="Reverse",Wa="Round",Ua="Rsqrt",Va="ScatterNd",ja="SearchSorted",Ga="Select",Ha="Selu",qa="Slice",Ka="Sin",Xa="Sinh",Ya="Sign",Qa="Sigmoid",Za="Softplus",Ja="Sqrt",$a="Sum",ei="SpaceToBatchND",ti="SplitV",ni="Softmax",ri="SparseFillEmptyRows",ai="SparseReshape",ii="SparseSegmentMean",oi="SparseSegmentSum",si="SparseToDense",ui="SquaredDifference",ci="Square",li="StridedSlice",pi="StringNGrams",di="StringSplit",fi="StringToHashBucketFast",hi="Sub",mi="Tan",vi="Tanh",gi="Tile",yi="TopK",bi="Transform",xi="Transpose",ki="Unique",wi="Unpack",Si="UnsortedSegmentSum",Ii="UpperBound",_i="ZerosLike",Ni="Step",Ci="FromPixels",Ti="RotateWithOffset",Ei="_FusedMatMul",Ai="FusedConv2D",Ri="FusedDepthwiseConv2D";function Fi(){var e;hn().getBool("IS_TEST")||hn().getBool("PROD")||(e=console).warn.apply(e,arguments)}function Di(){var e;hn().getBool("IS_TEST")||hn().getBool("PROD")||(e=console).log.apply(e,arguments)}var Mi=yn("kernelRegistry",(function(){return new Map})),Oi=yn("gradRegistry",(function(){return new Map}));function Pi(e,t){var n=Gi(e,t);return Mi.get(n)}function Li(e){return Oi.get(e)}function zi(e){for(var t=Mi.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var s=o(i,2),u=s[0],c=s[1];o(u.split("_"),1)[0]===e&&n.push(c)}return n}function Bi(e){var t=e.kernelName,n=e.backendName,r=Gi(t,n);Mi.has(r)&&Fi("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),Mi.set(r,e)}function Wi(e){var t=e.kernelName;Oi.has(t)&&hn().getBool("DEBUG")&&Fi("Overriding the gradient for '".concat(t,"'")),Oi.set(t,e)}function Ui(e,t){var n=Gi(e,t);if(!Mi.has(n))throw new Error("The kernel '".concat(e,"' for backend '").concat(t,"' is not registered"));Mi.delete(n)}function Vi(e){if(!Oi.has(e))throw new Error("The gradient '".concat(e,"' for backend is not registered"));Oi.delete(e)}function ji(e,t){zi(e).forEach((function(e){Bi(Object.assign({},e,{backendName:t}))}))}function Gi(e,t){return"".concat(t,"_").concat(e)}var Hi={};He(Hi,{arraysEqual:function(){return At},assert:function(){return _t},assertNonNegativeIntegerDimensions:function(){return sn},assertNonNull:function(){return Ct},assertShapesMatch:function(){return Nt},bytesFromStringArray:function(){return qt},bytesPerElement:function(){return Ht},checkConversionForErrors:function(){return Vt},clamp:function(){return bt},computeStrides:function(){return $t},convertBackendValuesAndArrayBuffer:function(){return nn},createScalarValue:function(){return oo},createShuffledIndices:function(){return Mt},decodeString:function(){return po},distSquared:function(){return It},encodeString:function(){return lo},fetch:function(){return co},fingerPrint64:function(){return io},flatten:function(){return ho},getArrayFromDType:function(){return Ut},getTypedArrayFromDType:function(){return Wt},hasEncodingLoss:function(){return Gt},hexToLong:function(){return Xi},indexToLoc:function(){return cn},inferDtype:function(){return Qt},inferFromImplicitShape:function(){return Lt},isBoolean:function(){return Xt},isFunction:function(){return Zt},isInt:function(){return Rt},isNumber:function(){return Yt},isPromise:function(){return ln},isScalarShape:function(){return Et},isString:function(){return Kt},isTypedArray:function(){return fo},isValidDtype:function(){return jt},locToIndex:function(){return un},makeOnesTypedArray:function(){return rn},makeZerosNestedTypedArray:function(){return on},makeZerosTypedArray:function(){return an},nearestDivisor:function(){return Jt},nearestLargerEven:function(){return xt},now:function(){return uo},parseAxisParam:function(){return zt},randUniform:function(){return St},repeatedTry:function(){return Pt},rightPad:function(){return Ot},shuffle:function(){return gt},shuffleCombo:function(){return yt},sizeFromShape:function(){return Tt},sizeToSquarishShape:function(){return Dt},squeezeShape:function(){return Bt},sum:function(){return wt},swap:function(){return kt},tanh:function(){return Ft},toNestedArray:function(){return tn},toTypedArray:function(){return so}});var qi=qe(Ke()),Ki=qi.default||qi;function Xi(e){return Ki.fromString(e,!0,16)}var Yi=Xi("c3a5c85c97cb3127"),Qi=Xi("b492b66fbe98f273"),Zi=Xi("9ae16a3b2f90404f");function Ji(e){return e.xor(e.shru(47))}function $i(e,t,n){var r=e.slice(t,t+n);return Ki.fromBytes(Array.from(r),!0,!0)}function eo(e,t){return $i(e,t,8)}function to(e,t){return $i(e,t,4)}function no(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function ro(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Xi("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function ao(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=no(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(no(a,44)),[a.add(r),i.add(o)]}(eo(e,t),eo(e,t+8),eo(e,t+16),eo(e,t+24),n,r)}function io(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,r=Ki.fromNumber(81,!0);if(n<=32)return n<=16?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=Zi.add(2*t),r=eo(e,0).add(Zi),a=eo(e,t-8);return ro(no(a,37).mul(n).add(r),no(r,25).add(a).mul(n),n)}if(t>=4){var i=Zi.add(2*t);return ro(to(e,0).shl(3).add(t),to(e,t-4),i)}if(t>0){var o=e[0]+(e[t>>1]<<8),s=t+(e[t-1]<<2);return Ji(Zi.mul(o).xor(Yi.mul(s))).mul(Zi)}return Zi}(e,n):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Zi.add(2*t),r=eo(e,0).mul(Qi),a=eo(e,8),i=eo(e,t-8).mul(n),o=eo(e,t-16).mul(Zi);return ro(no(r.add(a),43).add(no(i,30)).add(o),r.add(no(a.add(Zi),18)).add(i),n)}(e,n);if(n<=64)return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=Zi.add(2*t),r=eo(e,0).mul(Zi),a=eo(e,8),i=eo(e,t-8).mul(n),o=eo(e,t-16).mul(Zi),s=no(r.add(a),43).add(no(i,30)).add(o),u=ro(s,r.add(no(a.add(Zi),18)).add(i),n),c=eo(e,16).mul(n),l=eo(e,24),p=s.add(eo(e,t-32)).mul(n),d=u.add(eo(e,t-24)).mul(n);return ro(no(c.add(l),43).add(no(p,30)).add(d),c.add(no(l.add(r),18)).add(p),n)}(e,n);var a=r,i=r.mul(Qi).add(113),o=Ji(i.mul(Zi).add(113)).mul(Zi),s=[Ki.UZERO,Ki.UZERO],u=[Ki.UZERO,Ki.UZERO];a=a.mul(Zi).add(eo(e,0));var c=0,l=64*(n-1>>6),p=l+(n-1&63)-63;do{var d;a=no(a.add(i).add(s[0]).add(eo(e,c+8)),37).mul(Qi),i=no(i.add(s[1]).add(eo(e,c+48)),42).mul(Qi),a=a.xor(u[1]),i=i.add(s[0]).add(eo(e,c+40)),o=no(o.add(u[0]),33).mul(Qi),s=ao(e,c,s[1].mul(Qi),a.add(u[0])),u=ao(e,c+32,o.add(u[1]),i.add(eo(e,c+16))),o=(d=[a,o])[0],a=d[1],c+=64}while(c!==l);var f=Qi.add(o.and(255).shl(1));return c=p,u[0]=u[0].add(n-1&63),s[0]=s[0].add(u[0]),u[0]=u[0].add(s[0]),a=no(a.add(i).add(s[0]).add(eo(e,c+8)),37).mul(f),i=no(i.add(s[1]).add(eo(e,c+48)),42).mul(f),a=a.xor(u[1].mul(9)),i=i.add(s[0].mul(9).add(eo(e,c+40))),o=no(o.add(u[0]),33).mul(f),s=ao(e,c,s[1].mul(f),a.add(u[0])),u=ao(e,c+32,o.add(u[1]),i.add(eo(e,c+16))),o=(t=[a,o])[0],a=t[1],ro(ro(s[0],u[0],f).add(Ji(i).mul(Yi)).add(o),ro(s[1],u[1],f).add(a),f)}function oo(e,t){return"string"===t?lo(e):so([e],t)}function so(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=ho(e)),hn().getBool("DEBUG")&&Vt(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function uo(){return hn().platform.now()}function co(e,t){return hn().platform.fetch(e,t)}function lo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",hn().platform.encode(e,t)}function po(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",hn().platform.decode(e,t)}function fo(e){return hn().platform.isTypedArray(e)}function ho(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),"boolean"==typeof e||"number"==typeof e||"string"==typeof e||ln(e)||null==e||fo(e)&&n)t.push(e);else if(Array.isArray(e)||fo(e))for(var r=0;r<e.length;++r)ho(e[r],t,n);else{for(var a=-1,i=0,o=Object.keys(e);i<o.length;i++){var s=o[i];/^([1-9]+[0-9]*|0)$/.test(s)&&(a=Math.max(a,Number(s)))}for(var u=0;u<=a;u++)ho(e[u],t,n)}return t}var mo=function(){function e(t,n){h(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new vo)}return v(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=uo();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=De(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch(p){u.e(p)}finally{u.f()}a=Promise.resolve({kernelMs:uo()-o})}if(hn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var c=function(){var t=r[l];t.data().then((function(n){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(n,t.dtype,e)}))},l=0;l<r.length;l++)c();return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var vo=function(){function e(){h(this,e)}return v(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"==typeof r?Ot("".concat(r,"ms"),9):r.error,s=Ot(e,25),u=t.rank,c=t.size,l=Ot(t.shape.toString(),14),p="";for(var d in a){var f=a[d];if(null!=f){var h=f.shape||t.shape,m=h.length;p+="".concat(d,": ").concat(m,"D ").concat(m>0?h:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(p,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();var go=20,yo=3,bo=7;function xo(e,t,n,r){var a=$t(t),i=function(e,t,n,r){var a=Tt(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?Io(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,p=0;p<i;p++)o[p]=Math.max(o[p],ko(u[l+p],0,n).length);return o}(e,t,n,a),o=t.length,s=So(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function ko(e,t,n){return Ot(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(bo))," + ").concat(parseFloat(e[1].toFixed(bo)),"j"):Kt(e)?"'".concat(e,"'"):"bool"===n?wo(e):parseFloat(e.toFixed(bo)).toString(),t)}function wo(e){return 0===e?"false":"true"}function So(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u)return"complex64"===n?[ko(Io(e)[0],0,n)]:"bool"===n?[wo(e[0])]:[e[0].toString()];if(1===u){if(s>go){var c=yo*o,l=Array.from(e.slice(0,c)),p=Array.from(e.slice((s-yo)*o,s*o));return"complex64"===n&&(l=Io(l),p=Io(p)),["["+l.map((function(e,t){return ko(e,a[t],n)})).join(", ")+", ..., "+p.map((function(e,t){return ko(e,a[s-yo+t],n)})).join(", ")+"]"]}return["["+("complex64"===n?Io(e):Array.from(e)).map((function(e,t){return ko(e,a[t],n)})).join(", ")+"]"]}var d=t.slice(1),f=r.slice(1),h=r[0]*o,m=[];if(s>go){for(var v=0;v<yo;v++){var g=v*h,y=g+h;m.push.apply(m,Fe(So(e.slice(g,y),d,n,f,a,!1)))}m.push("...");for(var b=s-yo;b<s;b++){var x=b*h,k=x+h;m.push.apply(m,Fe(So(e.slice(x,k),d,n,f,a,b===s-1)))}}else for(var w=0;w<s;w++){var S=w*h,I=S+h;m.push.apply(m,Fe(So(e.slice(S,I),d,n,f,a,w===s-1)))}var _=2===u?",":"";m[0]="["+(s>0?m[0]+_:"");for(var N=1;N<m.length-1;N++)m[N]=" "+m[N]+_;for(var C=",\n",T=2;T<u;T++)C+="\n";return m[m.length-1]=" "+m[m.length-1]+"]"+(i?"":C),m}function Io(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var _o=function(){function e(t,n,r){var a=this;if(h(this,e),this.dtype=n,this.shape=t.slice(),this.size=Tt(t),null!=r){var i=r.length;_t(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size inferred by the shape '").concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ut(n,this.size),this.strides=$t(t)}return v(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),_t(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must match the rank (").concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,".   Buffer shape=").concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return No().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),No=null,Co=null;var To=function(){function e(t,n,r,a){h(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=Tt(t),this.strides=$t(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return v(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Co.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return Co.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",tn(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return tn(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=y(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=No().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return po(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),No().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=No().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return po(e)}))}catch(w){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,No().read(this.dataId);case 3:return t=e.sent,e.abrupt("return","string"===this.dtype?t:new Uint8Array(t.buffer));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(No().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return Co.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),Co.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return xo(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),Co.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),No().makeVariable(this,e,t,n)}}]),e}();function Eo(){return yn("Tensor",(function(){return To}))}Object.defineProperty(To,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),Eo();var Ao=function(e){Ae(n,e);var t=Re(n);function n(e,r,a,i){var o;return h(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return v(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!At(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));No().disposeTensor(this),this.dataId=e.dataId,No().incRef(this,null)}},{key:"dispose",value:function(){No().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(To);Object.defineProperty(Ao,Symbol.hasInstance,{value:function(e){return e instanceof To&&null!=e.assign&&e.assign instanceof Function}});var Ro,Fo,Do,Mo,Oo,Po={};He(Po,{assertTypesMatch:function(){return Uo},getTensorsInContainer:function(){return jo},isTensorInList:function(){return Vo},makeTypesMatch:function(){return Wo}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Ro||(Ro={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Fo||(Fo={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Do||(Do={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Mo||(Mo={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Oo||(Oo={}));var Lo={float32:Mo,int32:Fo,bool:Do,complex64:Oo};function zo(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Lo[e][t]}function Bo(e){return zo(e,"int32")}function Wo(e,t){if(e.dtype===t.dtype)return[e,t];var n=zo(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Uo(e,t){_t(e.dtype===t.dtype,(function(){return"The dtypes of the first(".concat(e.dtype,") and second(").concat(t.dtype,") input must match")}))}function Vo(e,t){return t.some((function(t){return t.id===e.id}))}function jo(e){var t=[];return Go(e,t,new Set),t}function Go(e,t,n){if(null!=e)if(e instanceof To)t.push(e);else if(function(e){return Array.isArray(e)||"object"==typeof e}(e)){var r=e;for(var a in r){var i=r[a];n.has(i)||(n.add(i),Go(i,t,n))}}}function Ho(e){return null!=e.kernelName}var qo=function(){function e(){h(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return v(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),Ko=function(){function e(t){h(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new qo}return v(e,[{key:"ready",value:function(){var e=y(f().mark((function e(){var t,n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=17;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=14;break}return e.next=13,this.setBackend(r);case 13:return e.abrupt("return");case 14:n++,e.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(Fi("".concat(e," backend was already registered. Reusing existing backend factory.")),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=y(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=14;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=11;break}return e.next=8,r;case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=r;case 12:if(e.t0){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",(this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new mo(this.backendInstance),!0));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;zi(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;zi(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof mt||"function"!=typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,Fi("Initialization of backend ".concat(e," failed")),Fi(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(r){return Fi("Initialization of backend ".concat(e," failed")),Fi(r.stack||r.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(r){throw t(),r}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=Yo.runKernel(Dr,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return Yo.runKernel(Vn,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,null==Pi(e,this.backendName))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r=this,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var u,c=Ho(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Ho(e)){var l=e.kernelName,p=e.inputs,d=e.attrs;null==this.backendName&&this.backend;var f=Pi(l,this.backendName);_t(null!=f,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(r.backendName,"'")})),n=function(){var e=r.backend.numDataIds();u=f.kernelFunc({inputs:p,attrs:d,backend:r.backend});var t=Array.isArray(u)?u:[u];r.shouldCheckForMemLeaks()&&r.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:r.makeTensorFromTensorInfo(e)}));if(i){var o=r.getTensorsForGradient(l,p,n);a=r.saveTensorsForBackwardMode(o)}return n}}else{var h=e.forwardFunc,m=function(e){i&&(a=e.map((function(e){return r.keep(r.clone(e))})))};n=function(){var e=r.backend.numDataIds();u=r.tidy((function(){return h(r.backend,m)}));var t=Array.isArray(u)?u:[u];return r.shouldCheckForMemLeaks()&&r.checkKernelForMemLeak(c,e,t),t}}var v,g=e.inputs,y=e.attrs,b=Ho(e)?null:e.backwardsFunc;return this.scopedRun((function(){return r.state.kernelDepth++}),(function(){return r.state.kernelDepth--}),(function(){r.ENV.getBool("DEBUG")||r.state.profiling?(v=r.profiler.profileKernel(c,g,(function(){return n()})),r.ENV.getBool("DEBUG")&&r.profiler.logKernelProfile(v),t=v.outputs):t=n()})),i&&this.addTapeNode(c,g,t,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map((function(e){return null!=g[e]?g[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(u)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=Li(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(_t(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&Kt(e[0])&&(a=e.map((function(e){return lo(e)})));var i=r.write(a,t,n),o=new To(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=qt(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new To(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new Ao(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*Ht(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Ao||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*Ht(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=y(f().mark((function e(t){var n,r,a,i,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=5,t();case 5:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Fe(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=De(this.state.activeProfile.kernels),e.prev=11,a.s();case 13:if((i=a.n()).done){e.next=23;break}return o=i.value,e.next=17,o.kernelTimeMs;case 17:return o.kernelTimeMs=e.sent,e.next=20,o.extraInfo;case 20:o.extraInfo=e.sent;case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),a.e(e.t0);case 28:return e.prev=28,a.f(),e.finish(28);case 31:return e.abrupt("return",this.state.activeProfile);case 32:case"end":return e.stop()}}),e,this,[[11,25,28,31]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=Li(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=an(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=jo(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];!i.kept&&!r.has(i.id)&&i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){!e.kept&&e.scopeId===o.id&&t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(_t(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));_t(i instanceof To,(function(){return"The result y returned by f() must be a tensor."}));var o=function(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],p=!1,d=0;d<t.length;d++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),p=!0,a[s.id]=!0;break}if(p)break}}var f={};f[n.id]=!0;for(var h={},m=e.length-1;m>=0;m--)for(var v=e[m],g=v.inputs,y=0;y<v.outputs.length;y++)if(f[v.outputs[y].id]){for(var b in g)f[g[b].id]=!0,h[v.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&h[w.id]){var S={};for(var I in w.inputs){var _=w.inputs[I];r[_.id]&&(S[I]=_)}var N=Object.assign({},w);N.inputs=S,N.outputs=w.outputs,x.push(N)}}return x}(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?function(e){var t=rn(Tt(e),"float32");return Yo.makeTensor(t,e,"float32")}(i.shape):n,function(e,t,n,r){for(var a=function(){var a=t[i],o=[];if(a.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==a.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(a.kernelName,"."));var s=a.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));var i=n((function(){return s[t]()}));if("float32"!==i.dtype)throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(i.dtype,"'"));var o=a.inputs[t];if(!At(i.shape,o.shape))throw new Error("Error in gradient for op ".concat(a.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(i.shape,"', which does not match the shape of the input '").concat(o.shape,"'"));if(null==e[o.id])e[o.id]=i;else{var u=e[o.id];e[o.id]=r(u,i),u.dispose()}};for(var c in a.inputs)u(c)},i=t.length-1;i>=0;i--)a()}(e,o,(function(e){return r.tidy(e)}),Qo);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=De(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return _t(Zt(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];_t(r.every((function(e){return e instanceof To})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var i,o={};r.forEach((function(e,t){o[t]=e}));return t.runKernelFunc({forwardFunc:function(t,n){return _t((i=e.apply(void 0,r.concat([n]))).value instanceof To,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),_t(Zt(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},backwardsFunc:function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];_t(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),_t(a.every((function(e){return e instanceof To})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o},inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=y(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=uo(),e.next=3,this.backend.time(t);case 3:return r=e.sent,e.abrupt("return",(r.wallMs=uo()-n,r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new qo,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function Xo(){var e=gn();if(null==e._tfengine){var t=new dn(e);e._tfengine=new Ko(t)}return function(e){vn=e}(e._tfengine.ENV),function(e){No=e}((function(){return e._tfengine})),e._tfengine}Ko.nextTensorId=0,Ko.nextVariableId=0;var Yo=Xo();function Qo(e,t){var n={a:e,b:t};return Yo.runKernel(wn,n)}var Zo,Jo={};function $o(e){Zo=e}function es(e){if(void 0!==Zo)return Zo;if(e||"undefined"!=typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function ts(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}He(Jo,{isBrowser:function(){return ts},isMobile:function(){return es},mockIsMobile:function(){return $o}});var ns=hn();function rs(e,t){var n=e;if(fo(e))return"string"===t?[]:[e.length];if("object"==typeof e){if("texture"in e){var r=e.channels||"RGBA";return[e.height,e.width*r.length]}if("buffer"in e&&!(e.buffer instanceof ArrayBuffer))return[e.buffer.size/(null==t?4:Ht(t))]}if(!Array.isArray(e))return[];for(var a=[];Array.isArray(n)||fo(n)&&"string"!==t;)a.push(n.length),n=n[0];return Array.isArray(e)&&hn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&as(e,a,[]),a}function as(e,t,n){if(n=n||[],Array.isArray(e)||fo(e)){_t(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, but is an array of ").concat(e.length," elements")})),_t(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," elements, but has ").concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)as(e[a],r,n.concat(a))}else _t(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(t[0]," elements")}))}function is(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}}function os(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof To)return is(r,e.dtype,t,n),e;var a=Qt(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),is(r,a,t,n),null==e||!fo(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(i,"'"))}var o=rs(e,a);!fo(e)&&!Array.isArray(e)&&(e=[e]);var s="string"!==a?so(e,a):ho(e,[],!0);return Yo.makeTensor(s,o,a)}function ss(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map((function(e,a){return os(e,"".concat(t,"[").concat(a,"]"),n,r)}))}ns.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),ns.registerFlag("IS_BROWSER",(function(){return ts()})),ns.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&"undefined"!=typeof process.versions&&"undefined"!=typeof process.versions.node})),ns.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),ns.registerFlag("PROD",(function(){return!1})),ns.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return ns.getBool("DEBUG")})),ns.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),ns.registerFlag("IS_TEST",(function(){return!1})),ns.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),ns.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),ns.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(function(){return!1})),ns.registerFlag("USE_SETTIMEOUTCUSTOM",(function(){return!1}));var us="__op";function cs(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with ".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=us;var a=function(){Yo.startScope(n);try{var e=r.apply(void 0,arguments);return ln(e)&&console.error("Cannot return a Promise inside of tidy."),Yo.endScope(e),e}catch(e){throw Yo.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var ls=cs({complex_:function(e,t){var n=os(e,"real","complex"),r=os(t,"imag","complex");Nt(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex()."));var a={real:n,imag:r};return Yo.runKernel(Hn,a)}});function ps(e,t,n,r){if(null==r)r=Qt(e);else if("complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if("object"==typeof e&&("texture"in e||"buffer"in e&&!(e.buffer instanceof ArrayBuffer))){if("float32"!==r&&"int32"!==r)throw new Error("Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return Yo.backend.createTensorFromGPUData(e,t||n,r)}if(!fo(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){sn(t);var a=Tt(t),i=Tt(n);_t(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==Tt(t.slice(o));_t(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return!fo(e)&&!Array.isArray(e)&&(e=[e]),t=t||n,e="string"!==r?so(e,r):ho(e,[],!0),Yo.makeTensor(e,t,r)}function ds(e,t,n){return ps(e,t,rs(e,n),n)}var fs={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},hs=4;function ms(e,t){return vs.apply(this,arguments)}function vs(){return vs=y(f().mark((function e(t,n){var r,a,i,o,s,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=f().mark((function e(){var o,u,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i[s],"float32"===(u=Array.isArray(t)?t[s].tensor:t[o]).dtype||"int32"===u.dtype||"bool"===u.dtype||"string"===u.dtype||"complex64"===u.dtype){e.next=3;break}throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(u.dtype));case 3:c={name:o,shape:u.shape,dtype:u.dtype},"string"===u.dtype?(l=new Promise(function(){var e=y(f().mark((function e(t){var n,r,a,i,o,s,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+hs*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)s=n[o],c=new Uint8Array(new Uint32Array([s.length]).buffer),a.set(c,i),i+=hs,a.set(s,i),i+=s.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.push(l)):a.push(u.data()),null!=n&&(c.group=n),r.push(c);case 6:case"end":return e.stop()}}),e)})),s=0;case 3:if(!(s<i.length)){e.next=8;break}return e.delegateYield(o(),"t0",5);case 5:++s,e.next=3;break;case 8:return e.next=10,Promise.all(a);case 10:return u=e.sent,e.abrupt("return",{data:ys(u),specs:r});case 12:case"end":return e.stop()}}),e)}))),vs.apply(this,arguments)}function gs(e,t){var n,r,a={},i=0,o=De(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,p=Tt(l),d=void 0;if("quantization"in s){var f=s.quantization;if("uint8"===f.dtype||"uint16"===f.dtype){if(!("min"in f)||!("scale"in f))throw new Error("Weight ".concat(s.name," with quantization ").concat(f.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==f.dtype)throw new Error("Weight ".concat(s.name," has unknown quantization dtype ").concat(f.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(f.dtype," which only supports weights of type float32 not ").concat(c,"."))}var h=fs[f.dtype],m=e.slice(i,i+p*h),v="uint8"===f.dtype?new Uint8Array(m):new Uint16Array(m);if("float32"===c)if("uint8"===f.dtype||"uint16"===f.dtype){d=new Float32Array(v.length);for(var g=0;g<v.length;g++){var y=v[g];d[g]=y*f.scale+f.min}}else{if("float16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," for weight type float32."));void 0===n&&(n=Rs()),d=n(v)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==f.dtype&&"uint16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," for weight type int32."));d=new Int32Array(v.length);for(var b=0;b<v.length;b++){var x=v[b];d[b]=Math.round(x*f.scale+f.min)}}i+=p*h}else if("string"===c){var k=Tt(s.shape);d=[];for(var w=0;w<k;w++){var S=new Uint32Array(e.slice(i,i+hs))[0];i+=hs;var I=new Uint8Array(e.slice(i,i+S));d.push(I),i+=S}}else{var _=fs[c],N=e.slice(i,i+p*_);if("float32"===c)d=new Float32Array(N);else if("int32"===c)d=new Int32Array(N);else if("bool"===c)d=new Uint8Array(N);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));d=new Float32Array(N);for(var C=new Float32Array(d.length/2),T=new Float32Array(d.length/2),E=0;E<C.length;E++)C[E]=d[2*E],T[E]=d[2*E+1];var A=ds(C,l,"float32"),R=ds(T,l,"float32");a[u]=ls(A,R),A.dispose(),R.dispose()}i+=p*_}"complex64"!==c&&(a[u]=ds(d,l,c))}}catch(F){o.e(F)}finally{o.f()}return a}function ys(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var bs="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function xs(e){return bs?Buffer.byteLength(e):new Blob([e]).size}function ks(e){if(bs)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function ws(e){if(bs){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function Ss(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Is(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function _s(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(n.initializerSignature=e.initializerSignature),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function Ns(e,t,n){var r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),null!=e.initializerSignature&&(r.initializerSignature=e.initializerSignature),r}function Cs(e,t){return Ts.apply(this,arguments)}function Ts(){return Ts=y(f().mark((function e(t,n){var r,a,i,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=t.weightsManifest,!e.t0){e.next=9;break}return e.next=4,n(t.weightsManifest);case 4:r=e.sent,a=o(r,2),i=a[0],s=a[1];case 9:return e.abrupt("return",Ns(t,i,s));case 10:case"end":return e.stop()}}),e)}))),Ts.apply(this,arguments)}function Es(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:xs(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:xs(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function As(e){var t,n=[],r=De(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push.apply(n,Fe(a.weights))}}catch(i){r.e(i)}finally{r.f()}return n}function Rs(){var e=function(){var e=function(e){for(var t=e<<13,n=0;!(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var Fs=function(){function e(){h(this,e),this.saveRouters=[],this.loadRouters=[]}return v(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),Ds=function(e){return Fs.registerSaveRouter(e)},Ms=function(e){return Fs.registerLoadRouter(e)},Os=function(e){return Fs.getSaveHandlers(e)},Ps=function(e,t){return Fs.getLoadHandlers(e,t)},Ls="tensorflowjs",zs="models_store",Bs="model_info_store";function Ws(){if(!hn().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function Us(e){var t=e.result;t.createObjectStore(zs,{keyPath:"modelPath"}),t.createObjectStore(Bs,{keyPath:"modelPath"})}var Vs=function(){function e(t){if(h(this,e),this.indexedDB=Ws(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return v(e,[{key:"save",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(Ls,1);a.onupgradeneeded=function(){return Us(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(zs,"readonly"),s=o.objectStore(zs).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' in IndexedDB.")));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=Es(t),l=i.transaction(Bs,"readwrite"),p=l.objectStore(Bs),d=p.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var a=(u=i.transaction(zs,"readwrite")).objectStore(zs).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(p=l.objectStore(Bs)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},d.onerror=function(e){return i.close(),r(d.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();Vs.URL_SCHEME="indexeddb://";var js=function(e){return hn().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Vs.URL_SCHEME)?function(e){return new Vs(e)}(e.slice(Vs.URL_SCHEME.length)):null};function Gs(e){return e.startsWith(Vs.URL_SCHEME)?e.slice(Vs.URL_SCHEME.length):e}Fs.registerSaveRouter(js),Fs.registerLoadRouter(js);var Hs=function(){function e(){h(this,e),this.indexedDB=Ws()}return v(e,[{key:"listModels",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(Ls,1);r.onupgradeneeded=function(){return Us(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(Bs,"readonly"),i=a.objectStore(Bs).getAll();i.onsuccess=function(){var t,n={},r=De(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=y(f().mark((function e(t){var n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=Gs(t),new Promise((function(e,r){var a=n.indexedDB.open(Ls,1);a.onupgradeneeded=function(){return Us(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(Bs,"readwrite"),s=o.objectStore(Bs),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' in IndexedDB.")));var a=s.delete(t),o=function(){var a=(n=i.transaction(zs,"readwrite")).objectStore(zs).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),qs="/",Ks="tensorflowjs_models",Xs="info",Ys="model_topology",Qs="weight_specs",Zs="weight_data",Js="model_metadata";function $s(e){return{info:[Ks,e,Xs].join(qs),topology:[Ks,e,Ys].join(qs),weightSpecs:[Ks,e,Qs].join(qs),weightData:[Ks,e,Zs].join(qs),modelMetadata:[Ks,e,Js].join(qs)}}function eu(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function tu(e){var t=e.split(qs);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(qs)}function nu(e){return e.startsWith(ru.URL_SCHEME)?e.slice(ru.URL_SCHEME.length):e}var ru=function(){function e(t){if(h(this,e),!hn().getBool("IS_BROWSER")||"undefined"==typeof window||"undefined"==typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=$s(this.modelPath)}return v(e,[{key:"save",value:function(){var e=y(f().mark((function e(t){var n,r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=Es(t),e.prev=3,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,ks(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,initializerSignature:null!=t.initializerSignature?t.initializerSignature:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},e.abrupt("return",(this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}));case 9:throw e.prev=9,e.t0=e.catch(3),eu(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(a.modelTopologyBytes,", weightSpecsBytes=").concat(a.weightSpecsBytes,", weightDataBytes=").concat(a.weightDataBytes,"."));case 12:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.initializerSignature&&(n.initializerSignature=o.initializerSignature),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return e.abrupt("return",(n.weightData=ws(s),n));case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();ru.URL_SCHEME="localstorage://";var au=function(e){return hn().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ru.URL_SCHEME)?function(e){return new ru(e)}(e.slice(ru.URL_SCHEME.length)):null};Fs.registerSaveRouter(au),Fs.registerLoadRouter(au);var iu=function(){function e(){h(this,e),_t(hn().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),_t("undefined"==typeof window||"undefined"!=typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return v(e,[{key:"listModels",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=Ks+qs,r=qs+Xs,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=tu(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=y(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=nu(t),n=$s(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),e.abrupt("return",(eu(n),r));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ou="://",su=function(){function e(){h(this,e),this.managers={}}return v(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){_t(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(ou)&&(t=t.slice(0,t.indexOf(ou))),_t(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();_t(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function uu(e){if(-1===e.indexOf(ou))throw new Error("The url string provided does not contain a scheme. Supported schemes are: ".concat(su.getSchemes().join(",")));return{scheme:e.split(ou)[0],path:e.split(ou)[1]}}function cu(e,t){return lu.apply(this,arguments)}function lu(){return lu=y(f().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,d,h=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.length>2&&void 0!==h[2]&&h[2],_t(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),_t((a=Fs.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),_t(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") load handlers for source URL ").concat(t,".")})),i=a[0],_t((o=Fs.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL ".concat(n,".")})),_t(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") save handlers for destination URL ").concat(n,".")})),s=o[0],u=uu(t).scheme,c=uu(t).path,l=u===uu(t).scheme,e.next=12,i.load();case 12:if(p=e.sent,e.t0=r&&l,!e.t0){e.next=17;break}return e.next=17,su.getManager(u).removeModel(c);case 17:return e.next=19,s.save(p);case 19:if(d=e.sent,e.t1=r&&!l,!e.t1){e.next=24;break}return e.next=24,su.getManager(u).removeModel(c);case 24:return e.abrupt("return",d.modelArtifactsInfo);case 25:case"end":return e.stop()}}),e)}))),lu.apply(this,arguments)}function pu(){return du.apply(this,arguments)}function du(){return du=y(f().mark((function e(){var t,n,r,a,i,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=su.getSchemes(),n={},r=De(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return i=a.value,e.next=8,su.getManager(i).listModels();case 8:for(s in o=e.sent)n[i+ou+s]=o[s];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])}))),du.apply(this,arguments)}function fu(e){return hu.apply(this,arguments)}function hu(){return hu=y(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=uu(t),e.abrupt("return",su.getManager(n.scheme).removeModel(n.path));case 2:case"end":return e.stop()}}),e)}))),hu.apply(this,arguments)}function mu(e,t){return vu.apply(this,arguments)}function vu(){return vu=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",cu(t,n,!1));case 1:case"end":return e.stop()}}),e)}))),vu.apply(this,arguments)}function gu(e,t){return yu.apply(this,arguments)}function yu(){return yu=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",cu(t,n,!0));case 1:case"end":return e.stop()}}),e)}))),yu.apply(this,arguments)}var bu=function(){function e(){h(this,e),this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return v(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}},{key:"setTimeoutCustom",value:function(e,t){var n=this;"undefined"!=typeof window&&hn().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(function(e){e.source===window&&e.data.name===n.messageName&&(e.stopPropagation(),(0,n.functionRefs[e.data.index])(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0))}),!0))):setTimeout(e,t)}},{key:"isTypedArray",value:function(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}}]),e}();if(hn().get("IS_BROWSER")){hn().setPlatform("browser",new bu);try{su.registerManager(ru.URL_SCHEME,new iu)}catch(C4){}try{su.registerManager(Vs.URL_SCHEME,new Hs)}catch(C4){}}var xu,ku=function(){return Xe()},wu=function(){function e(){h(this,e),this.util=Ye(),this.textEncoder=new this.util.TextEncoder}return v(e,[{key:"fetch",value:function(e,t){return null!=hn().global.fetch?hn().global.fetch(e,t):(null==xu&&(xu=ku()),xu(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}},{key:"isTypedArray",value:function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}]),e}();function Su(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",sn(e),new _o(e,t,n)}hn().get("IS_NODE")&&!hn().get("IS_BROWSER")&&hn().setPlatform("node",new wu);var Iu=cs({cast_:function(e,t){var n=os(e,"x","cast");if(!jt(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return Yo.runKernel(Vn,r,a)}});var _u=cs({clone_:function(e){var t={x:os(e,"x","clone","string_or_numeric")};return Yo.runKernel(Dr,t)}});function Nu(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}function Cu(){hn().set("PROD",!0)}function Tu(){hn().set("DEBUG",!0)}function Eu(){hn().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function Au(e){hn().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Ru(){Yo.disposeVariables()}function Fu(){return Yo}function Du(){return Yo.memory()}function Mu(e){return Yo.profile(e)}function Ou(e,t){return Yo.tidy(e,t)}function Pu(e){jo(e).forEach((function(e){return e.dispose()}))}function Lu(e){return Yo.keep(e)}function zu(e){return Yo.time(e)}function Bu(e){return Yo.setBackend(e)}function Wu(){return Yo.ready()}function Uu(){return Yo.backendName}function Vu(e){Yo.removeBackend(e)}function ju(e){return Yo.findBackend(e)}function Gu(e){return Yo.findBackendFactory(e)}function Hu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Yo.registerBackend(e,t,n)}function qu(){return Yo.backend}function Ku(e,t){hn().setPlatform(e,t)}Xo(),function(e){Co=e}({buffer:Su,cast:Iu,clone:_u,print:Nu}),function(e){e}(Au);var Xu=cs({add_:function(e,t){var n=os(e,"a","add"),r=os(t,"b","add"),a=o(Wo(n,r),2),i={a:n=a[0],b:r=a[1]};return Yo.runKernel(wn,i)}});var Yu=cs({floorDiv_:function(e,t){var n=os(e,"a","floorDiv"),r=os(t,"b","floorDiv"),a=o(Wo(n,r),2),i={a:n=a[0],b:r=a[1]};return Yo.runKernel(Cr,i)}});var Qu=cs({div_:function(e,t){var n,r=os(e,"a","div"),a=os(t,"b","div");if(r=(n=o(Wo(r,a),2))[0],a=n[1],"int32"===r.dtype&&"int32"===a.dtype)return Yu(r,a);var i={a:r,b:a};return Yo.runKernel(hr,i,{})}});var Zu=cs({mul_:function(e,t){var n=os(e,"a","mul"),r=os(t,"b","mul"),a=o(Wo(n,r),2),i={a:n=a[0],b:r=a[1]};return Yo.runKernel(da,i)}});var Ju=cs({abs_:function(e){var t=os(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return Yo.runKernel(qn,n)}var r={x:t};return Yo.runKernel(bn,r)}});var $u=cs({acos_:function(e){var t={x:os(e,"x","acos")};return Yo.runKernel(xn,t)}});var ec=cs({acosh_:function(e){var t={x:os(e,"x","acosh")};return Yo.runKernel(kn,t)}});var tc=cs({addN_:function(e){_t(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),_t(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got ".concat(e.length)}));var t=e.map((function(e,t){return os(e,"tensors".concat(t),"addN")})),n=t[0];t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!At(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=t;return Yo.runKernel(Sn,r)}});var nc=cs({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:os(e,"x","all","bool")},a={axis:t,keepDims:n};return Yo.runKernel(In,r,a)}});var rc=cs({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:os(e,"x","any","bool")},a={axis:t,keepDims:n};return Yo.runKernel(_n,r,a)}});var ac=cs({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:os(e,"x","argMax")},r={axis:t};return Yo.runKernel(Nn,n,r)}});var ic=cs({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:os(e,"x","argMin")},r={axis:t};return Yo.runKernel(Cn,n,r)}});var oc=cs({asin_:function(e){var t={x:os(e,"x","asin")};return Yo.runKernel(Tn,t)}});var sc=cs({asinh_:function(e){var t={x:os(e,"x","asinh")};return Yo.runKernel(En,t)}});var uc=cs({atan_:function(e){var t={x:os(e,"x","atan")};return Yo.runKernel(An,t)}});var cc=cs({atan2_:function(e,t){var n=os(e,"a","atan2"),r=os(t,"b","atan2"),a=o(Wo(n,r),2),i={a:n=a[0],b:r=a[1]};return Yo.runKernel(Fn,i)}});var lc=cs({atanh_:function(e){var t={x:os(e,"x","atanh")};return Yo.runKernel(Rn,t)}});function pc(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3];return hc(e,[].concat(Fe(t),[o]),n,i,r,null,null,Ic(a))}function dc(e,t,n,r,a,i){var s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",c=o(gc(t),2),l=c[0],p=c[1];if("channelsLast"===u)s=[l,p,e[3],e[3]];else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));s=[l,p,e[1],e[1]]}return hc(e,s,n,r,a,i,!1,u)}function fc(e,t,n,r,a,i){var s,u,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",l=o(yc(t),3),p=l[0],d=l[1],f=l[2];if("NDHWC"===c)u="channelsLast",s=[p,d,f,e[4],e[4]];else{if("NCDHW"!==c)throw new Error("Unknown dataFormat ".concat(c));u="channelsFirst",s=[p,d,f,e[1],e[1]]}return mc(e,s,n,r,a,!1,u,i)}function hc(e,t,n,r,a,i){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",c=-1,l=-1,p=-1,d=-1;if("channelsLast"===u){var f=o(e,4);c=f[0],l=f[1],p=f[2],d=f[3]}else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));var h=o(e,4);c=h[0],d=h[1],l=h[2],p=h[3]}var m,v=o(t,4),g=v[0],y=v[1],b=v[3],x=o(gc(n),2),k=x[0],w=x[1],S=o(gc(r),2),I=S[0],_=S[1],N=bc(g,I),C=bc(y,_),T=function(e,t,n,r,a,i,o,s,u){var c,l,p;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var d=function(e,t,n,r,a){null==r&&(r=vc(e,t,n));var i=e[0],o=e[1],s=xc((i-t+2*r)/n+1,a),u=xc((o-t+2*r)/n+1,a);return[s,u]}([t,n],i,r,e,s);l=d[0],p=d[1]}else if("same"===e){l=Math.ceil(t/r),p=Math.ceil(n/a);var f=Math.max(0,(l-1)*r+i-t),h=Math.max(0,(p-1)*a+o-n),m=Math.floor(f/2),v=f-m,g=Math.floor(h/2);c={top:m,bottom:v,left:g,right:h-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),p=Math.ceil((n-o+1)/a);else{if("object"!=typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:k,type:0===y&&0===b&&0===x&&0===k?"VALID":"EXPLICIT"},l=xc((t-i+y+b)/r+1,s),p=xc((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:p}}(a,l,p,k,w,N,C,i,u),E=T.padInfo,A=T.outHeight,R=T.outWidth,F=s?b*d:b;return"channelsFirst"===u?m=[c,F,A,R]:"channelsLast"===u&&(m=[c,A,R,F]),{batchSize:c,dataFormat:u,inHeight:l,inWidth:p,inChannels:d,outHeight:A,outWidth:R,outChannels:F,padInfo:E,strideHeight:k,strideWidth:w,filterHeight:g,filterWidth:y,effectiveFilterHeight:N,effectiveFilterWidth:C,dilationHeight:I,dilationWidth:_,inShape:e,outShape:m,filterShape:t}}function mc(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=arguments.length>7?arguments[7]:void 0,c=-1,l=-1,p=-1,d=-1,f=-1;if("channelsLast"===s){var h=o(e,5);c=h[0],l=h[1],p=h[2],d=h[3],f=h[4]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var m=o(e,5);c=m[0],f=m[1],l=m[2],p=m[3],d=m[4]}var v,g=o(t,5),y=g[0],b=g[1],x=g[2],k=g[4],w=o(yc(n),3),S=w[0],I=w[1],_=w[2],N=o(yc(r),3),C=N[0],T=N[1],E=N[2],A=bc(y,C),R=bc(b,T),F=bc(x,E),D=function(e,t,n,r,a,i,o,s,u,c,l){var p,d,f,h;if("valid"===e&&(e=0),"number"==typeof e){p={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,i){null==a&&(a=vc(e,t[0],r[0]));for(var o=[0,0,0,n],s=0;s<3;s++)e[s]+2*a>=t[s]&&(o[s]=xc((e[s]-t[s]+2*a)/r[s]+1,i));return o}([t,n,r,1],[s,u,c],1,[a,i,o],e,l);d=m[0],f=m[1],h=m[2]}else{if("same"!==e)throw Error("Unknown padding parameter: ".concat(e));var v=((d=Math.ceil(t/a))-1)*a+s-t,g=((f=Math.ceil(n/i))-1)*i+u-n,y=((h=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(v/2),x=v-b,k=Math.floor(g/2),w=g-k,S=Math.floor(y/2);p={top:k,bottom:w,left:S,right:y-S,front:b,back:x,type:"SAME"}}return{padInfo:p,outDepth:d,outHeight:f,outWidth:h}}(a,l,p,d,S,I,_,A,R,F,u),M=D.padInfo,O=D.outDepth,P=D.outHeight,L=D.outWidth,z=i?k*f:k;return"channelsFirst"===s?v=[c,z,O,P,L]:"channelsLast"===s&&(v=[c,O,P,L,z]),{batchSize:c,dataFormat:s,inDepth:l,inHeight:p,inWidth:d,inChannels:f,outDepth:O,outHeight:P,outWidth:L,outChannels:z,padInfo:M,strideDepth:S,strideHeight:I,strideWidth:_,filterDepth:y,filterHeight:b,filterWidth:x,effectiveFilterDepth:A,effectiveFilterHeight:R,effectiveFilterWidth:F,dilationDepth:C,dilationHeight:T,dilationWidth:E,inShape:e,outShape:v,filterShape:t}}function vc(e,t,n){var r=bc(t,arguments.length>3&&void 0!==arguments[3]?arguments[3]:1);return Math.floor((e[0]*(n-1)-n+r)/2)}function gc(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function yc(e){return"number"==typeof e?[e,e,e]:e}function bc(e,t){return t<=1?e:e+(e-1)*(t-1)}function xc(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function kc(e){var t=o(gc(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function wc(e,t){return kc(e)||kc(t)}function Sc(e){return gc(e).every((function(e){return e>0}))}function Ic(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function _c(e,t,n){if(null!=n){if("string"==typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,"."));if("number"==typeof t)_t(Rt(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}));else{if("object"!=typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){_t(Rt(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}))}))}))}}}var Nc=cs({reshape_:function(e,t){var n={x:os(e,"x","reshape","string_or_numeric")},r={shape:t};return Yo.runKernel(Da,n,r)}});var Cc=cs({avgPool_:function(e,t,n,r,a){var i=os(e,"x","avgPool","float32");_t(wc(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Nc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),_t(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),_c("avgPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Yo.runKernel(Dn,u,c);return l=Iu(l,i.dtype),s?Nc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Tc=cs({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=os(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),_t(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),_t("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),_t("number"==typeof n&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,(function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(n,"'")})),_c("avgPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=Yo.runKernel(On,c,l);return p=Iu(p,s.dtype),u?Nc(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var Ec=cs({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_t(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=ss(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return _u(n[0]);var r=n,a={axis:t};return Yo.runKernel(Kn,r,a)}});var Ac=cs({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=os(e,"a","matMul"),i=os(t,"b","matMul"),s=o(Wo(a,i),2),u={a:a=s[0],b:i=s[1]},c={transposeA:n,transposeB:r};return Yo.runKernel(Ln,u,c)}});var Rc=cs({sigmoid_:function(e){var t={x:os(e,"x","sigmoid","float32")};return Yo.runKernel(Qa,t)}});var Fc=cs({slice_:function(e,t,n){var r=os(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return Yo.runKernel(qa,a,i)}});var Dc=cs({tanh_:function(e){var t={x:os(e,"x","tanh","float32")};return Yo.runKernel(vi,t)}});var Mc=cs({basicLSTMCell_:function(e,t,n,r,a,i){var o=os(e,"forgetBias","basicLSTMCell"),s=os(t,"lstmKernel","basicLSTMCell"),u=os(n,"lstmBias","basicLSTMCell"),c=os(r,"data","basicLSTMCell"),l=os(a,"c","basicLSTMCell"),p=os(i,"h","basicLSTMCell"),d=Ec([c,p],1),f=Ac(d,s),h=Xu(f,u),m=h.shape[0],v=h.shape[1]/4,g=[m,v],y=Fc(h,[0,0],g),b=Fc(h,[0,v],g),x=Fc(h,[0,2*v],g),k=Fc(h,[0,3*v],g),w=Xu(Zu(Rc(y),Dc(b)),Zu(l,Rc(Xu(o,x))));return[w,Zu(Dc(w),Rc(k))]}});var Oc=cs({batchToSpaceND_:function(e,t,n){var r=os(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));_t(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),_t(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),_t(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of the elements of blockShape ").concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return Yo.runKernel(zn,i,o)}});function Pc(e){return 0===e.rank||1===e.rank?Nc(e,[1,1,1,e.size]):2===e.rank?Nc(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?Nc(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}var Lc=cs({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=os(e,"x","batchNorm"),c=os(t,"mean","batchNorm"),l=os(n,"variance","batchNorm");null!=a&&(o=os(a,"scale","batchNorm")),null!=r&&(s=os(r,"offset","batchNorm")),_t(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),_t(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),_t(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var p={x:Pc(u),scale:o,offset:s,mean:c,variance:l},d={varianceEpsilon:i},f=Yo.runKernel(Tr,p,d);return Nc(f,u.shape)}});var zc=cs({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=os(e,"x","batchNorm"),c=os(t,"mean","batchNorm"),l=os(n,"variance","batchNorm");return null!=a&&(o=os(a,"scale","batchNorm")),null!=r&&(s=os(r,"offset","batchNorm")),_t(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank ".concat(u.rank,".")})),_t(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ".concat(c.rank,".")})),_t(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&_t(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&_t(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ".concat(s.rank,".")})),Lc(u,c,l,s,o,i)}});var Bc=cs({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=os(e,"x","batchNorm"),c=os(t,"mean","batchNorm"),l=os(n,"variance","batchNorm");return null!=a&&(o=os(a,"scale","batchNorm")),null!=r&&(s=os(r,"offset","batchNorm")),_t(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank ".concat(u.rank,".")})),_t(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ".concat(c.rank,".")})),_t(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&_t(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&_t(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ".concat(s.rank,".")})),Lc(u,c,l,s,o,i)}});var Wc=cs({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=os(e,"x","batchNorm"),c=os(t,"mean","batchNorm"),l=os(n,"variance","batchNorm");return null!=a&&(o=os(a,"scale","batchNorm")),null!=r&&(s=os(r,"offset","batchNorm")),_t(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank ".concat(u.rank,".")})),_t(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ".concat(c.rank,".")})),_t(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ".concat(l.rank,".")})),null!=o&&_t(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ".concat(o.rank,".")})),null!=s&&_t(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ".concat(s.rank,".")})),Lc(u,c,l,s,o,i)}});var Uc=cs({bincount_:function(e,t,n){var r=os(e,"x","bincount"),a=os(t,"weights","bincount");_t("int32"===r.dtype,(function(){return"Error in bincount: input dtype must be int32, but got ".concat(r.dtype)})),_t(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),_t(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or0-length, but got input shape: ".concat(r.shape,", weights shape: ").concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return Yo.runKernel(Bn,i,o)}});var Vc=cs({broadcastArgs_:function(e,t){var n=os(e,"s0","broadcastArgs","int32"),r=os(t,"s1","broadcastArgs","int32");if(1!==n.rank)throw new Error("broadcastArgs(): first input must be a vector (rank=1). Has rank ".concat(n.rank));if(1!==r.rank)throw new Error("broadcastArgs(): second input must be a vector (rank=1). Has rank ".concat(r.rank));var a={s0:n,s1:r};return Yo.runKernel(Un,a)}});var jc=cs({broadcastTo_:function(e,t){var n=os(e,"broadcastTo","x"),r=n.shape;if(sn(t),t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=Nc(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));if(0===o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length)return _u(n);var u={x:n},c={reps:o};return Yo.runKernel(gi,u,c)}});var Gc=cs({ceil_:function(e){var t={x:os(e,"x","ceil","float32")};return Yo.runKernel(jn,t)}});function Hc(e,t,n){sn(e);var r={shape:e,value:t,dtype:n};return Yo.runKernel(Ir,{},r)}var qc=cs({clipByValue_:function(e,t,n){var r=os(e,"x","clipByValue");if(_t(t<=n,(function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")})),t===n)return Hc(r.shape,t,r.dtype);var a={x:r},i={clipValueMin:t,clipValueMax:n};return Yo.runKernel(Gn,a,i)}});var Kc=cs({concat1d_:function(e){return Ec(e,0)}});var Xc=cs({concat2d_:function(e,t){return Ec(e,t)}});var Yc=cs({concat3d_:function(e,t){return Ec(e,t)}});var Qc=cs({concat4d_:function(e,t){return Ec(e,t)}});var Zc=cs({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=os(e,"x","conv2d","float32"),u=os(t,"filter","conv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=Nc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),_t(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),_t(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank ".concat(u.rank,".")})),_c("conv2d",r,o);var p="NHWC"===a?c.shape[3]:c.shape[1];_t(p===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(p,") must match input depth for filter ").concat(u.shape[2],".")})),_t(wc(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),_t(Sc(i),(function(){return"Error in conv2D: Dilated rates should be larger than 0."})),_t(Sc(n),(function(){return"Error in conv2D: Strides should be larger than 0."}));var d={x:c,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},h=Yo.runKernel(Xn,d,f);return l?Nc(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var Jc=cs({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=os(e,"x","conv1d"),u=os(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=Nc(s,[1,s.shape[0],s.shape[1]])),_t(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),_t(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank ".concat(u.rank,".")})),_c("conv1d",r,o),_t(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match input depth for filter ").concat(u.shape[1],".")})),_t(wc(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride ".concat(n," and dilation '").concat(i,"'")})),_t(Sc(i),(function(){return"Error in conv1D: Dilated rates should be larger than 0."})),_t(Sc(n),(function(){return"Error in conv1D: Stride should be larger than 0."})),_t("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var p=Nc(u,[1,u.shape[0],u.shape[1],u.shape[2]]),d=Nc(c,[c.shape[0],1,c.shape[1],c.shape[2]]),f=Zc(d,p,[1,n],r,"NHWC",[1,i],o);return Nc(f,l?[f.shape[2],f.shape[3]]:[f.shape[0],f.shape[2],f.shape[3]])}});var $c=cs({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;_t(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),_t(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length ".concat(s.length,".")})),_t(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank ".concat(u.rank)})),_t(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],p="NHWC"===i?u.shape[3]:u.shape[1];_t(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must match input depth for filter ").concat(n.shape[2],".")})),_t(p===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(p,") must match output depth for filter ").concat(n.shape[3],".")})),_c("conv2dDerInput",a,o);var d={dy:u,filter:n},f={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},h=Yo.runKernel(Qn,d,f);return c?Nc(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var el=cs({conv2dTranspose_:function(e,t,n,r,a,i){var o=os(e,"x","conv2dTranspose"),s=os(t,"filter","conv2dTranspose");return $c(n,o,s,r,a,"NHWC",i)}});var tl=cs({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=os(e,"x","conv3d"),s=os(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),_t(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),_t(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank ".concat(s.rank,".")})),_t(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match input depth for filter ").concat(s.shape[3],".")})),_t(wc(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(i,"'")})),_t("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")})),_t(Sc(i),(function(){return"Error in conv3D: Dilated rates should be larger than 0."})),_t(Sc(n),(function(){return"Error in conv3D: Strides should be larger than 0."}));var l={x:u,filter:s},p={strides:n,pad:r,dataFormat:a,dilations:i},d=Yo.runKernel(Zn,l,p);return c?Nc(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});var nl=cs({conv3DBackpropInput_:function(e,t,n,r,a){_t(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];_t(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length ".concat(i.length,".")})),_t(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank ".concat(o.rank)})),_t(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank ".concat(n.rank)})),_t(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must match input depth for filter ").concat(n.shape[3],".")})),_t(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must match output depth for filter ").concat(n.shape[4],".")}));var l={dy:o,filter:n},p={pad:a,strides:r,inputShape:i},d=Yo.runKernel($n,l,p);return s?Nc(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}});var rl=cs({conv3dTranspose_:function(e,t,n,r,a){var i=os(e,"x","conv3dTranspose"),o=os(t,"filter","conv3dTranspose");return nl(n,i,o,r,a)}});var al=cs({cos_:function(e){var t={x:os(e,"x","cos","float32")};return Yo.runKernel(er,t)}});var il=cs({cosh_:function(e){var t={x:os(e,"x","cosh","float32")};return Yo.runKernel(tr,t)}});var ol=cs({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:os(e,"x","cumprod")},i={axis:t,exclusive:n,reverse:r};return Yo.runKernel(nr,a,i)}});var sl=cs({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a={x:os(e,"x","cumsum")},i={axis:t,exclusive:n,reverse:r};return Yo.runKernel(rr,a,i)}});var ul=cs({denseBincount_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=os(e,"x","denseBincount"),i=os(t,"weights","denseBincount");_t("int32"===a.dtype,(function(){return"Error in denseBincount: input dtype must be int32, but got ".concat(a.dtype)})),_t(a.rank<=2,(function(){return"Error in denseBincount: input must be at most rank 2, but got rank ".concat(a.rank,".")})),_t(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),_t(i.size===a.size||0===i.size,(function(){return"Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ".concat(a.shape,", weights shape: ").concat(i.shape,".")}));var o={x:a,weights:i},s={size:n,binaryOutput:r};return Yo.runKernel(ir,o,s)}});var cl=cs({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=os(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];_t(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),_t(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),_t(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),_t(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return Yo.runKernel(or,s,u)}});var ll=cs({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=os(e,"x","depthwiseConv2d","float32"),u=os(t,"filter","depthwiseConv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=Nc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),_t(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),_t(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank ".concat(u.rank,".")}));var p="NHWC"===a?c.shape[3]:c.shape[1];_t(p===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels (".concat(p,") must match the inChannels dimension in filter ").concat(u.shape[2],".")})),_c("depthwiseConv2d",r,o);var d={x:c,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},h=Yo.runKernel(sr,d,f);return l?Nc(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});var pl=cs({diag_:function(e){var t={x:os(e,"x","diag")};return Yo.runKernel(lr,t)}});var dl=cs({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=os(e,"x","dilation2d"),s=os(t,"filter","dilation2d");_t(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank ".concat(o.rank,".")})),_t(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank ".concat(s.rank,".")})),_t("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),_t(u.shape[3]===s.shape[2],(function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])}));var l={x:u,filter:s},p={strides:n,pad:r,dilations:a},d=Yo.runKernel(pr,l,p);return c?Nc(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),fl={};function hl(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function ml(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function vl(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}He(fl,{assertAndGetBroadcastShape:function(){return vl},getBroadcastDims:function(){return hl},getReductionAxes:function(){return ml}});var gl=cs({equal_:function(e,t){var n,r=os(e,"a","equal","string_or_numeric"),a=os(t,"b","equal","string_or_numeric");r=(n=o(Wo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Yo.runKernel(br,i)}});var yl=cs({where_:function(e,t,n){var r=os(t,"a","where"),a=os(n,"b","where"),i=os(e,"condition","where","bool"),o=vl(vl(i.shape,r.shape),a.shape),s={condition:jc(i,o),t:jc(r,o),e:jc(a,o)};return Yo.runKernel(Ga,s)}});var bl=cs({zerosLike_:function(e){var t={x:os(e,"x","zerosLike")};return Yo.runKernel(_i,t)}});var xl=cs({divNoNan_:function(e,t){var n=os(e,"a","div"),r=os(t,"b","div"),a=o(Wo(n,r),2);n=a[0],r=a[1];var i=Qu(n,r),s=bl(i),u=gl(r,s);return yl(u,s,i)}});var kl=cs({dot_:function(e,t){var n=os(e,"t1","dot"),r=os(t,"t2","dot");_t((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(_t(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got ".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=Nc(n,[1,-1]),s=Nc(r,[-1,1]),u=Ac(o,s);return Nc(u,[])}if(1===n.rank&&2===r.rank){var c=Nc(n,[1,-1]),l=Nc(r,[r.shape[0],r.shape[1]]),p=Ac(c,l);return Nc(p,[p.size])}if(2===n.rank&&1===r.rank){var d=Nc(r,[-1,1]),f=Ac(n,d);return Nc(f,[f.size])}var h=Nc(r,[r.shape[0],r.shape[1]]);return Ac(n,h)}});var wl=cs({einsum_:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map((function(e,t){return os(e,"tensors".concat(t),"einsum")})),i={equation:e};return Yo.runKernel(mr,a,i)}});var Sl=cs({elu_:function(e){var t={x:os(e,"x","elu","float32")};return Yo.runKernel(vr,t)}});var Il=cs({erf_:function(e){var t=os(e,"x","erf");_t("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=Iu(t,"float32"));var n={x:t};return Yo.runKernel(yr,n)}});function _l(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Nl(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}function Cl(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function Tl(e,t){return Nl(e,t.map((function(e){return 1})),t)}function El(e,t,n){_t(_l(t,n),(function(){return"".concat(e," supports only inner-most axes for now. Got axes ").concat(t," and rank-").concat(n," input.")}))}function Al(e,t){if(_l(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function Rl(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Fl(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var Dl=cs({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:os(e,"x","max")},a={reductionIndices:t,keepDims:n};return Yo.runKernel($r,r,a)}});var Ml=cs({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:os(e,"x","min")},a={axis:t,keepDims:n};return Yo.runKernel(sa,r,a)}});var Ol=cs({pow_:function(e,t){var n=os(e,"base","pow"),r=os(t,"exp","pow"),a=o(Wo(n,r),2),i={a:n=a[0],b:r=a[1]};return Yo.runKernel(Sa,i)}});function Pl(e,t){if((fo(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&fo(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ps(e,[],[],t)}var Ll=cs({sqrt_:function(e){var t={x:os(e,"x","sqrt","float32")};return Yo.runKernel(Ja,t)}});var zl=cs({square_:function(e){var t=os(e,"x","square");return Yo.runKernel("Square",{x:t},{})}});var Bl=cs({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=os(e,"x","sum");"bool"===r.dtype&&(r=Iu(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Yo.runKernel($a,a,i)}});function Wl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return Ju(e);if(1!==e.rank&&null===n)return Wl(Nc(e,[-1]),t,n);if(1===e.rank||"number"==typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Bl(Ju(e),n);if(t===1/0)return Dl(Ju(e),n);if(t===-1/0)return Ml(Ju(e),n);if("euclidean"===t||2===t)return Ll(Bl(Ol(Ju(e),Pl(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return Dl(Bl(Ju(e),n[0]),n[1]-1);if(t===1/0)return Dl(Bl(Ju(e),n[1]),n[0]);if(t===-1/0)return Ml(Bl(Ju(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Ll(Bl(zl(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var Ul=cs({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Wl(e=os(e,"x","norm"),t,n),i=a.shape;if(r){var o=zt(n,e.shape);i=Tl(a.shape,o)}return Nc(a,i)}});var Vl=cs({euclideanNorm_:function(e){return Ul(e,"euclidean",arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}});var jl=cs({exp_:function(e){var t={x:os(e,"x","exp")};return Yo.runKernel(xr,t)}});var Gl=cs({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=os(e,"x","expandDims","string_or_numeric");_t(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return Yo.runKernel(kr,r,a)}});var Hl=cs({expm1_:function(e){var t={x:os(e,"x","expm1")};return Yo.runKernel(wr,t)}});var ql=cs({tile_:function(e,t){var n=os(e,"x","tile","string_or_numeric");_t(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")}));var r={x:n},a={reps:t};return Yo.runKernel(gi,r,a)}});var Kl=cs({eye_:function(e,t,n){null==t&&(t=e);for(var r=Su([e,t],arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32"),a=e<=t?e:t,i=0;i<a;++i)r.set(1,i,i);var o=Nc(r.toTensor(),[e,t]);if(null==n)return o;if(1===n.length)return ql(Gl(o,0),[n[0],1,1]);if(2===n.length)return ql(Gl(Gl(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return ql(Gl(Gl(Gl(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received ".concat(n.length,"D."))}});var Xl=cs({floor_:function(e){var t={x:os(e,"x","floor","float32")};return Yo.runKernel(Nr,t)}});var Yl=cs({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a={x:os(e,"x","gather"),indices:os(t,"indices","gather","int32")},i={axis:n,batchDims:r};return Yo.runKernel(Er,a,i)}});var Ql=cs({greater_:function(e,t){var n,r=os(e,"a","greater","string_or_numeric"),a=os(t,"b","greater","string_or_numeric");r=(n=o(Wo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Yo.runKernel(Rr,i)}});var Zl=cs({greaterEqual_:function(e,t){var n,r=os(e,"a","greaterEqual","string_or_numeric"),a=os(t,"b","greaterEqual","string_or_numeric");r=(n=o(Wo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Yo.runKernel(Fr,i)}});var Jl=cs({imag_:function(e){var t={input:os(e,"input","imag")};return Yo.runKernel(Or,t)}});var $l=cs({isFinite_:function(e){var t={x:os(e,"x","isFinite")};return Yo.runKernel(Pr,t)}});var ep=cs({isInf_:function(e){var t={x:os(e,"x","isInf")};return Yo.runKernel(Lr,t)}});var tp=cs({isNaN_:function(e){var t={x:os(e,"x","isNaN")};return Yo.runKernel(zr,t)}});var np=cs({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:os(e,"x","leakyRelu")},r={alpha:t};return Yo.runKernel(Br,n,r)}});var rp=cs({less_:function(e,t){var n,r=os(e,"a","less","string_or_numeric"),a=os(t,"b","less","string_or_numeric");r=(n=o(Wo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Yo.runKernel(Wr,i)}});var ap=cs({lessEqual_:function(e,t){var n,r=os(e,"a","lessEqual","string_or_numeric"),a=os(t,"b","lessEqual","string_or_numeric");r=(n=o(Wo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Yo.runKernel(Ur,i)}});function ip(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return Yo.runKernel(Vr,{},r)}var op=cs({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=os(e,"x","localResponseNormalization");_t(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),_t(Rt(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=Nc(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=Yo.runKernel(Zr,u,c);return s?Nc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var sp=cs({log_:function(e){var t={x:os(e,"x","log","float32")};return Yo.runKernel(jr,t)}});var up=cs({log1p_:function(e){var t={x:os(e,"x","log1p")};return Yo.runKernel(Gr,t)}});function cp(e){return _t(Zt(e),(function(){return"The f passed in grad(f) must be a function"})),function(t,n){var r=os(t,"x","tf.grad","string_or_numeric"),a=null!=n?os(n,"dy","tf.grad"):null;return Yo.tidy((function(){var t=Yo.gradients((function(){return e(r)}),[r],a),n=t.value,i=t.grads;return null!=a&&Nt(n.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),mp(i),i[0]}))}}function lp(e){return _t(Zt(e),(function(){return"The f passed in grads(f) must be a function"})),function(t,n){_t(Array.isArray(t),(function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"}));var r=ss(t,"args","tf.grads","string_or_numeric"),a=null!=n?os(n,"dy","tf.grads"):null;return Yo.tidy((function(){var t=Yo.gradients((function(){return e.apply(void 0,Fe(r))}),r,a),n=t.value,i=t.grads;return null!=a&&Nt(n.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),mp(i),i}))}}function pp(e){return _t(Zt(e),(function(){return"The f passed in valueAndGrad(f) must be a function"})),function(t,n){_t(t instanceof To,(function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"})),_t(null==n||n instanceof To,(function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"}));var r=Yo.gradients((function(){return e(t)}),[t],n),a=r.grads,i=r.value;return mp(a),{grad:a[0],value:i}}}function dp(e){return _t(Zt(e),(function(){return"The f passed in valueAndGrads(f) must be a function"})),function(t,n){_t(Array.isArray(t)&&t.every((function(e){return e instanceof To})),(function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"})),_t(null==n||n instanceof To,(function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"}));var r=Yo.gradients((function(){return e.apply(void 0,Fe(t))}),t,n);return null!=n&&Nt(r.value.shape,n.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),mp(r.grads),r}}function fp(e,t){_t(Zt(e),(function(){return"The f passed in variableGrads(f) must be a function"})),_t(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof Ao})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Yo.registeredVariables)t.push(Yo.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;t=t.filter((function(e){return e.trainable})),_t(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the ".concat(i," variables is trainable.")}));var o=Yo.gradients(e,t,null,!0),s=o.value,u=o.grads;_t(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),_t(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}function hp(e){return Yo.customGrad(e)}function mp(e){if(e.filter((function(e){return null==e})).length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that\n    the f you passed encloses all operations that lead from x to y.")}var vp=cs({neg_:function(e){var t={x:os(e,"x","neg")};return Yo.runKernel(fa,t)}});var gp=cs({softplus_:function(e){var t={x:os(e,"x","softplus")};return Yo.runKernel(Za,t)}});var yp=cs({logSigmoid_:function(e){var t=os(e,"x","logSigmoid");return hp((function(e){return{value:vp(gp(vp(e))),gradFunc:function(t){return Zu(t,Rc(vp(e)))}}}))(t)}});var bp=cs({sub_:function(e,t){var n=os(e,"a","sub"),r=os(t,"b","sub"),a=o(Wo(n,r),2),i={a:n=a[0],b:r=a[1]};return Yo.runKernel(hi,i)}});var xp=cs({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=os(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and axis was ").concat(t));return hp((function(e,n){var r=Dl(e,t,!0),a=bp(e,r),i=bp(Iu(a,"float32"),sp(Bl(jl(a),t,!0)));return n([i]),{value:i,gradFunc:function(e,n){var r=o(n,1)[0],a=jl(r);return bp(e,Zu(Bl(e,t,!0),a))}}}))(n)}});var kp=cs({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=os(e,"x","logSumExp"),a=zt(t,r.shape),i=Dl(r,a,!0),o=bp(r,i),s=jl(o),u=Bl(s,a),c=sp(u),l=Xu(Nc(i,c.shape),c);if(n){var p=Tl(l.shape,a);return Nc(l,p)}return l}});var wp=cs({logicalAnd_:function(e,t){var n=os(e,"a","logicalAnd","bool"),r=os(t,"b","logicalAnd","bool");vl(n.shape,r.shape);var a={a:n,b:r};return Yo.runKernel(Hr,a)}});var Sp=cs({logicalNot_:function(e){var t={x:os(e,"x","logicalNot","bool")};return Yo.runKernel(qr,t)}});var Ip=cs({logicalOr_:function(e,t){var n=os(e,"a","logicalOr","bool"),r=os(t,"b","logicalOr","bool");vl(n.shape,r.shape);var a={a:n,b:r};return Yo.runKernel(Kr,a)}});var _p=cs({logicalXor_:function(e,t){var n=os(e,"a","logicalXor","bool"),r=os(t,"b","logicalXor","bool");return vl(n.shape,r.shape),wp(Ip(e,t),Sp(wp(e,t)))}}),Np=2147483648;var Cp=cs({searchSorted_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"left",r=os(e,"sortedSequence","searchSorted"),a=os(t,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=Nc(r,[-1,i]),u=Nc(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Tt(u.shape)>=Np)throw new Error("values tensor size must less than ".concat(Np));if(s.shape[1]>=Np)throw new Error("trailing dim_size must less than ".concat(Np," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:n};return Yo.runKernel(ja,c,l)}});function Tp(e,t){return Cp(e,t,"left")}var Ep=cs({maxPool_:function(e,t,n,r,a){var i=os(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=Nc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),_t(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),_t(wc(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(1,"'")})),_c("maxPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=Yo.runKernel(ta,u,c);return s?Nc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Ap=cs({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=os(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),_t(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),_t("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ".concat(i)})),_c("maxPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},p=Yo.runKernel(ra,c,l);return u?Nc(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}});var Rp=cs({maxPoolWithArgmax_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i={x:os(e,"x","maxPoolWithArgmax")},o={filterSize:t,strides:n,pad:r,includeBatchInIndex:a},s=Yo.runKernel(ia,i,o);return{result:s[0],indexes:s[1]}}});var Fp=cs({maximum_:function(e,t){var n,r=os(e,"a","maximum"),a=os(t,"b","maximum");r=(n=o(Wo(r,a),2))[0],a=n[1],"bool"===r.dtype&&(r=Iu(r,"int32"),a=Iu(a,"int32")),vl(r.shape,a.shape);var i={a:r,b:a};return Yo.runKernel(ea,i)}});var Dp=cs({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r={x:os(e,"x","mean")},a={axis:t,keepDims:n};return Yo.runKernel(oa,r,a)}});function Mp(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(sn(e),"complex64"===t){var n=Mp(e,"float32"),r=Mp(e,"float32");return ls(n,r)}var a=an(Tt(e),t);return Yo.makeTensor(a,e,t)}function Op(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if(sn(e),"complex64"===t){var n=Op(e,"float32"),r=Mp(e,"float32");return ls(n,r)}var a=rn(Tt(e),t);return Yo.makeTensor(a,e,t)}function Pp(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).indexing,r=void 0===n?"xy":n;if("xy"!==r&&"ij"!==r)throw new TypeError("".concat(r," is not a valid third argument to meshgrid"));if(void 0===e)return[];var a=os(e,"x","meshgrid",e instanceof To?e.dtype:"float32");if(void 0===t)return[a];var i=os(t,"y","meshgrid",t instanceof To?t.dtype:"float32"),o=Tt(a.shape),s=Tt(i.shape);return"xy"===r?(a=Nc(a,[1,-1]),i=Nc(i,[-1,1]),[Ac(Op([s,1],a.dtype),a),Ac(i,Op([1,o],i.dtype))]):(a=Nc(a,[-1,1]),i=Nc(i,[1,-1]),[Ac(a,Op([1,s],a.dtype)),Ac(Op([o,1],i.dtype),i)])}var Lp=cs({minimum_:function(e,t){var n,r=os(e,"a","minimum"),a=os(t,"b","minimum");r=(n=o(Wo(r,a),2))[0],a=n[1],"bool"===r.dtype&&(r=Iu(r,"int32"),a=Iu(a,"int32")),vl(r.shape,a.shape);var i={a:r,b:a};return Yo.runKernel(ua,i)}});var zp=cs({mirrorPad_:function(e,t,n){_t("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")}));var r=os(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");_t(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){_t(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),_t(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal to ").concat(r.shape[e]-a," or less than 0 for input of shape ").concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return Yo.runKernel(ca,u,s)}});var Bp=cs({mod_:function(e,t){var n=os(e,"a","mod"),r=os(t,"b","mod"),a=o(Wo(n,r),2),i={a:n=a[0],b:r=a[1]};return Yo.runKernel(la,i)}});var Wp=cs({moments_:function(e){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=zt(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,(e=os(e,"x","moments")).shape),r=Dp(e,n,t),a=r.shape;t||(a=Tl(r.shape,n));var i=zl(bp(Iu(e,"float32"),Nc(r,a)));return{mean:r,variance:Dp(i,n,t)}}});var Up=cs({multiRNNCell_:function(e,t,n,r){for(var a=os(t,"data","multiRNNCell"),i=ss(n,"c","multiRNNCell"),o=ss(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var p=[],d=[],f=0;f<u.length;f+=2)p.push(u[f]),d.push(u[f+1]);return[p,d]}});var Vp=cs({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=os(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got ".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s={logits:1===o?Nc(a,[1,-1]):a},u={numSamples:t,seed:n,normalized:r},c=Yo.runKernel(pa,s,u);return 1===o?Nc(c,[c.size]):c}});var jp=cs({notEqual_:function(e,t){var n,r=os(e,"a","notEqual","string_or_numeric"),a=os(t,"b","notEqual","string_or_numeric");r=(n=o(Wo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Yo.runKernel(ha,i)}});var Gp=cs({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var i={indices:os(e,"indices","oneHot","int32")},o={dtype:a,depth:t,onValue:n,offValue:r};return Yo.runKernel(ba,i,o)}});var Hp=cs({onesLike_:function(e){var t={x:os(e,"x","onesLike")};return Yo.runKernel(ya,t)}});var qp=cs({outerProduct_:function(e,t){var n=os(e,"v1","outerProduct"),r=os(t,"v2","outerProduct");_t(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks ".concat(n.rank," and ").concat(r.rank,".")}));var a=Nc(n,[-1,1]),i=Nc(r,[1,-1]);return Ac(a,i)}});var Kp=cs({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=os(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return Yo.runKernel(ka,i,a)}});var Xp=cs({pad1d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return _t(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),Kp(e,[t],n)}});var Yp=cs({pad2d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return _t(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Kp(e,t,n)}});var Qp=cs({pad3d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return _t(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Kp(e,t,n)}});var Zp=cs({pad4d_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return _t(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Kp(e,t,n)}});var Jp=cs({spaceToBatchND_:function(e,t,n){var r=os(e,"x","spaceToBatchND");_t(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),_t(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),_t(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return Yo.runKernel(ei,a,i)}});var $p=cs({pool_:function(e,t,n,r,a,i,s){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var u=os(e,"x","maxPool"),c=u,l=!1;3===u.rank&&(l=!0,c=Nc(u,[1,u.shape[0],u.shape[1],u.shape[2]])),_t(wc(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(a,"'")}));var p,d=dc(c.shape,t,i,a,r),f=[d.dilationHeight,d.dilationWidth];p="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([d.filterHeight,d.filterWidth],f):[[0,0],[0,0]];var h=1===f[0]&&1===f[1],m=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([d.inHeight,d.inWidth],f,p),v=o(m,2),g=v[0],y=v[1],b=h?r:"valid",x=h?c:Jp(c,f,g),k=("avg"===n?function(){return Cc(x,t,i,b,s)}:function(){return Ep(x,t,i,b,s)})(),w=h?k:Oc(k,f,y);return l?Nc(w,[w.shape[1],w.shape[2],w.shape[3]]):w}});var ed=cs({prelu_:function(e,t){var n={x:os(e,"x","prelu"),alpha:os(t,"alpha","prelu")};return Yo.runKernel(Ia,n)}});var td=cs({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=os(e,"x","prod");"bool"===r.dtype&&(r=Iu(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Yo.runKernel(_a,a,i)}});var nd=cs({raggedGather_:function(e,t,n,r){var a=e.map((function(e,t){return os(e,"tensors".concat(t),"raggedGather","int32")})),i={paramsNestedSplits:a,paramsDenseValues:os(t,"paramsDenseValues","raggedGather"),indices:os(n,"indices","raggedGather","int32")},o={outputRaggedRank:r},s=Yo.runKernel(Na,i,o);return{outputNestedSplits:s.slice(0,s.length-1),outputDenseValues:s[s.length-1]}}});var rd=cs({raggedRange_:function(e,t,n){var r=os(e,"starts","raggedRange"),a={starts:r,limits:os(t,"limits","raggedRange",r.dtype),deltas:os(n,"deltas","raggedRange",r.dtype)},i=Yo.runKernel(Ca,a);return{rtNestedSplits:i[0],rtDenseValues:i[1]}}});var ad=cs({raggedTensorToTensor_:function(e,t,n,r,a){var i=os(e,"shape","raggedTensorToTensor","int32"),o=os(t,"values","raggedTensorToTensor"),s=os(n,"defaultValue","raggedTensorToTensor",o.dtype),u=r.map((function(e,t){return os(e,"tensors".concat(t),"raggedTensorToTensor","int32")})),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return Yo.runKernel(Ta,c,l)}});var id=cs({rand_:function(e,t,n){sn(e);var r=Tt(e),a=null;if(null==n||"float32"===n)a=new Float32Array(r);else if("int32"===n)a=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type ".concat(n));a=new Uint8Array(r)}for(var i=0;i<r;i++)a[i]=t();return Yo.makeTensor(a,e,n)}}),od=qe(at()),sd={};He(sd,{TEST_EPSILON_FLOAT16:function(){return cd},createVideoElement:function(){return xd},encodeStrings:function(){return bd},expectArrayBuffersEqual:function(){return yd},expectArraysClose:function(){return ld},expectArraysEqual:function(){return hd},expectNumbersClose:function(){return md},expectPromiseToFail:function(){return fd},expectValuesInRange:function(){return gd},play:function(){return kd},testEpsilon:function(){return pd}});var ud=.001,cd=.1;function ld(e,t,n){return null==n&&(n=pd()),dd(e,t,(function(e,t){return vd(e,t,n)}))}function pd(){return 32===Yo.backend.floatPrecision()?ud:cd}function dd(e,t,n){var r=!0;if((fo(e)||fo(t))&&(r=!1),fo(e)&&fo(t)&&(r=!0),r){var a=e.constructor.name,i=t.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". Expected: ").concat(i))}if(Array.isArray(e)&&Array.isArray(t)){var o=rs(e),s=rs(t);if(!At(o,s))throw new Error("Arrays have different shapes. Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=fo(e)?e:ho(e),c=fo(t)?t:ho(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs expected: ").concat(c.length,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."));for(var l=0;l<c.length;++l){var p=u[l],d=c[l];if(!n(p,d))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(p,", expected[").concat(l,"] = ").concat(d,".\nActual:   ").concat(u,".\nExpected: ").concat(c,"."))}"undefined"!=typeof expect&&expect().nothing()}function fd(e,t){e().then((function(){return t.fail()}),(function(){return t()})),"undefined"!=typeof expect&&expect().nothing()}function hd(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Kt(e)||Kt(e[0])||Kt(t)||Kt(t[0])?dd(e,n,(function(e,t){return e==t})):dd(e,t,(function(e,t){return vd(e,t,0)}))}function md(e,t,n){if(null==n&&(n=pd()),!vd(e,t,n))throw new Error("Numbers differ: actual === ".concat(e,", expected === ").concat(t));"undefined"!=typeof expect&&expect().nothing()}function vd(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}function gd(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:".concat(e[r]," low: ").concat(t,", high: ").concat(n))}function yd(e,t){var n=new Float32Array(e),r=new Float32Array(t);if(n.length!==r.length)throw new Error("Expected ArrayBuffer to be of length ".concat(r.length,", but it was ").concat(n.length));for(var a=0;a<r.length;a++)if(n[a]!==r[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ").concat(r[a]," but got ").concat(n[a]," instead"))}function bd(e){for(var t=0;t<e.length;t++){var n=e[t];Array.isArray(n)?bd(n):e[t]=lo(n)}return e}function xd(e){var t=document.createElement("video");return"playsInline"in t&&(t.playsInline=!0),t.muted=!0,t.loop=!0,t.style.position="fixed",t.style.left="0px",t.style.top="0px",t.preload="auto",t.appendChild(e),new Promise((function(e){t.addEventListener("loadeddata",(function(n){return e(t)})),t.load()}))}function kd(e){return wd.apply(this,arguments)}function wd(){return wd=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.play();case 2:if(e.t0="requestVideoFrameCallback"in t,!e.t0){e.next=6;break}return e.next=6,new Promise((function(e){t.requestVideoFrameCallback(e)}));case 6:case"end":return e.stop()}}),e)}))),wd.apply(this,arguments)}var Sd=function(){function e(t,n,r,a,i){h(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=od.alea(o.toString())}return v(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,(!this.truncated||this.isValidTruncated(t))&&(r=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),Id=function(){function e(t,n,r,a){h(this,e),this.alpha=t,this.beta=1/n,this.dtype=r;var i=a||Math.random();this.randu=od.alea(i.toString()),this.randn=new Sd(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return v(e,[{key:"nextValue",value:function(){for(var e,t,n,r,a,i;;){do{r=this.randn.nextValue(),i=1+this.c*r}while(i<=0);if(i*=i*i,t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-i+Math.log(i)),(a=this.randu())<t||Math.log(a)<n)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)}},{key:"convertValue",value:function(e){return"float32"===this.dtype?e:Math.round(e)}}]),e}(),_d=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(h(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"==typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=od.alea(i)}return v(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var Nd=cs({randomGamma_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;if(sn(e),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type ".concat(r));for(var i=new Id(t,n,r,a),o=Su(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Cd=cs({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(sn(e),null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new Sd(t,n,r,!1,a),o=Su(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Td=cs({randomStandardNormal_:function(e,t,n){if(null!=t&&"bool"===t)throw new Error("Unsupported data type ".concat(t));return Cd(e,0,1,t,n)}});var Ed=cs({randomUniform_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0;sn(e);for(var i=Su(e,r),o=new _d(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});function Ad(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return Yo.runKernel(Ea,{},a)}var Rd=cs({real_:function(e){var t={input:os(e,"input","real")};return Yo.runKernel(Aa,t)}});var Fd=cs({reciprocal_:function(e){var t={x:os(e,"x","reciprocal")};return Yo.runKernel(Ra,t)}});var Dd=cs({relu_:function(e){var t={x:os(e,"x","relu")};return Yo.runKernel(Fa,t)}});var Md=cs({relu6_:function(e){var t={x:os(e,"x","relu6")};return Yo.runKernel(za,t)}});var Od=cs({reverse_:function(e,t){var n={x:os(e,"x","reverse")},r={dims:t};return Yo.runKernel(Ba,n,r)}});var Pd=cs({reverse1d_:function(e){var t=os(e,"x","reverse");return _t(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(t.rank,".")})),Od(t,0)}});var Ld=cs({reverse2d_:function(e,t){var n=os(e,"x","reverse");return _t(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(n.rank,".")})),Od(n,t)}});var zd=cs({reverse3d_:function(e,t){var n=os(e,"x","reverse");return _t(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(n.rank,".")})),Od(n,t)}});var Bd=cs({reverse4d_:function(e,t){var n=os(e,"x","reverse");return _t(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(n.rank,".")})),Od(n,t)}});var Wd=cs({round_:function(e){var t={x:os(e,"x","round")};return Yo.runKernel(Wa,t)}});var Ud=cs({rsqrt_:function(e){var t={x:os(e,"x","rsqrt","float32")};return Yo.runKernel(Ua,t)}});var Vd=cs({selu_:function(e){var t={x:os(e,"x","selu")};return Yo.runKernel(Ha,t)}});var jd=cs({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=os(e,"x","separableConv2d"),u=os(t,"depthwiseFilter","separableConv2d"),c=os(n,"pointwiseFilter","separableConv2d"),l=s,p=!1;if(3===s.rank&&(p=!0,l=Nc(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");_t(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank ".concat(l.rank,".")})),_t(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank ".concat(u.rank,".")})),_t(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank ".concat(u.rank,".")})),_t(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ".concat(c.shape[0],".")})),_t(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ".concat(c.shape[1],".")}));var d=u.shape[2],f=u.shape[3];_t(c.shape[2]===d*f,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be ".concat(d*f,", but got ").concat(c.shape[2],".")}));var h=ll(l,u,r,a,o,i),m=Zc(h,c,1,"valid",o);return p?Nc(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});function Gd(){return Gd=y(f().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,d,h;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=os(t,"x","setdiff1d"),a=os(n,"y","setdiff1d"),_t(r.dtype===a.dtype,(function(){return"x and y should have the same dtype, but got x (".concat(r.dtype,") and y (").concat(a.dtype,").")})),_t(1===r.rank,(function(){return"x should be 1D tensor, but got x (".concat(r.shape,").")})),_t(1===a.rank,(function(){return"y should be 1D tensor, but got y (".concat(a.shape,").")})),e.next=4,r.data();case 4:return i=e.sent,e.next=7,a.data();case 7:for(o=e.sent,s=new Set(o),u=0,c=0;c<i.length;c++)s.has(i[c])||u++;for(l=new _o([u],r.dtype),p=new _o([u],"int32"),d=0,h=0;d<i.length;d++)s.has(i[d])||(l.values[h]=i[d],p.values[h]=d,h++);return e.abrupt("return",[l.toTensor(),p.toTensor()]);case 14:case"end":return e.stop()}}),e)}))),Gd.apply(this,arguments)}var Hd=function(e,t){return Gd.apply(this,arguments)};var qd=cs({sign_:function(e){var t={x:os(e,"x","sign")};return Yo.runKernel(Ya,t)}});var Kd=cs({sin_:function(e){var t={x:os(e,"x","sin","float32")};return Yo.runKernel(Ka,t)}});var Xd=cs({sinh_:function(e){var t={x:os(e,"x","sinh")};return Yo.runKernel(Xa,t)}});var Yd=cs({slice1d_:function(e,t,n){var r=os(e,"x","slice1d");return _t(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),Fc(r,[t],[n])}});var Qd=cs({slice2d_:function(e,t,n){var r=os(e,"x","slice2d");return _t(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),Fc(r,t,n)}});var Zd=cs({slice3d_:function(e,t,n){var r=os(e,"x","slice3d");return _t(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),Fc(r,t,n)}});var Jd=cs({slice4d_:function(e,t,n){var r=os(e,"x","slice4d");return _t(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),Fc(r,t,n)}});var $d=cs({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=os(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return Yo.runKernel(ni,r,a)}});var ef=cs({fft_:function(e){_t("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Yo.runKernel(Sr,t)}});var tf=cs({ifft_:function(e){_t("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got ".concat(e.dtype,".")}));var t={input:e};return Yo.runKernel(Mr,t)}});var nf=cs({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=Nc(e,[r,n]);t=tf(a)}else{var i=[r,2*(n-1)],o=Nc(Rd(e),[r,n]),s=Nc(Jl(e),[r,n]),u=Od(Fc(o,[0,1],[r,n-2]),1),c=Zu(Od(Fc(s,[0,1],[r,n-2]),1),Pl(-1)),l=Ec([o,u],1),p=Ec([s,c],1),d=Nc(ls(l,p),[i[0],i[1]]);t=tf(d)}if(t=Rd(t),3===e.rank&&0!==e.shape[0]){var f=t,h=e.shape[0];t=Nc(t,[h,t.shape[0]/h,t.shape[1]]),f.dispose()}return t}});var rf=cs({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:os(e,"x","split")},a={numOrSizeSplits:t,axis:n};return Yo.runKernel(ti,r,a)}});var af=cs({rfft_:function(e,t){_t("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=Fc(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=Ec([e,Mp(s)],e.shape.length-1),r=t}else n=e;var u=bl(n),c=Nc(ls(n,u),[a,r]),l=ef(c),p=Math.floor(r/2)+1,d=Rd(l),f=Jl(l),h=rf(d,[p,r-p],d.shape.length-1),m=rf(f,[p,r-p],f.shape.length-1),v=n.shape.slice();return v[n.shape.length-1]=p,Nc(ls(h[0],m[0]),v)}});var of=cs({squaredDifference_:function(e,t){var n,r=os(e,"a","squaredDifference"),a=os(t,"b","squaredDifference");r=(n=o(Wo(r,a),2))[0],a=n[1],vl(r.shape,a.shape);var i={a:r,b:a};return Yo.runKernel(ui,i,{})}});var sf=cs({squeeze_:function(e,t){var n=os(e,"x","squeeze","string_or_numeric");return Nc(n,Bt(n.shape,t).newShape)}});var uf=cs({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=ss(e,"tensors","stack","string_or_numeric");_t(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&_t(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return Yo.runKernel(xa,r,a)}});var cf=cs({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:os(e,"x","step")},r={alpha:t};return Yo.runKernel(Ni,n,r)}});var lf=cs({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c={x:os(e,"x","stridedSlice","string_or_numeric")},l={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Yo.runKernel(li,c,l)}});var pf=cs({tan_:function(e){var t={x:os(e,"x","tan","float32")};return Yo.runKernel(mi,t)}});function df(e,t){Ct(e);var n=rs(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ps(e,null,n,t)}function ff(e,t,n){if(Ct(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=rs(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ps(e,t,r,n)}function hf(e,t,n){if(Ct(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=rs(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ps(e,t,r,n)}function mf(e,t,n){if(Ct(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=rs(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ps(e,t,r,n)}function vf(e,t,n){if(Ct(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=rs(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ps(e,t,r,n)}function gf(e,t,n){if(Ct(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=rs(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return ps(e,t=t||r,r,n)}var yf=cs({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=os(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") but got ").concat(t));var i={x:r},s={k:t,sorted:n},u=o(Yo.runKernel(yi,i,s),2);return{values:u[0],indices:u[1]}}});var bf=cs({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(sn(e),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new Sd(t,n,r,!0,a),o=Su(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var xf=cs({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=os(e,"x","unique","string_or_numeric");_t(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=o(Yo.runKernel(ki,r,a),2);return{values:i[0],indices:i[1]}}});var kf=cs({unsortedSegmentSum_:function(e,t,n){var r=os(e,"x","unsortedSegmentSum"),a=os(t,"segmentIds","unsortedSegmentSum","int32");_t(Rt(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return Yo.runKernel(Si,i,o)}});var wf=cs({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=os(e,"x","unstack","string_or_numeric");_t(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return Yo.runKernel(wi,r,a)}});function Sf(e,t){return Cp(e,t,"right")}function If(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return Yo.makeVariable(e,t,n,r)}function _f(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=Su(e,"int32"),i=Su([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}function Nf(){return Nf=y(f().mark((function e(t){var n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=os(t,"condition","whereAsync","bool"),e.next=3,n.data();case 3:return r=e.sent,a=_f(n.shape,r),e.abrupt("return",(t!==n&&n.dispose(),a));case 6:case"end":return e.stop()}}),e)}))),Nf.apply(this,arguments)}var Cf=function(e){return Nf.apply(this,arguments)};function Tf(){return Tf=y(f().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,h,m,v,g;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=os(t,"tensor","boolMask"),i=os(n,"mask","boolMask","bool"),o=null==r?0:r,s=i.rank,u=a.shape,_t(s>0,(function(){return"mask cannot be scalar"})),Nt(u.slice(o,o+s),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),c=1,l=o;l<o+s;l++)c*=u[l];return p=u.slice(0,o).concat([c],u.slice(o+s)),d=Nc(a,p),h=Nc(i,[-1]),e.next=9,Cf(h);case 9:return m=e.sent,v=sf(m,[1]),g=Yl(d,v,o),e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),v.dispose(),d.dispose(),h.dispose(),m.dispose(),g));case 13:case"end":return e.stop()}}),e)}))),Tf.apply(this,arguments)}var Ef=function(e,t,n){return Tf.apply(this,arguments)};var Af=cs({transpose_:function(e,t,n){var r=os(e,"x","transpose");if(null==t&&(t=r.shape.map((function(e,t){return t})).reverse()),_t(r.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(r.rank," must match length of perm ").concat(t,".")})),t.forEach((function(e){_t(e>=0&&e<r.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1," but got ").concat(t)}))})),r.rank<=1)return r.clone();var a={x:r},i={perm:t};return"complex64"===r.dtype?Ou((function(){var e=Rd(r),t=Jl(r);return e=Yo.runKernel(xi,{x:e},i),t=Yo.runKernel(xi,{x:t},i),n&&(t=vp(t)),ls(e,t)})):Yo.runKernel(xi,a,i)}});var Rf=cs({movingAverage_:function(e,t,n,r){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=os(e,"v","movingAverage"),o=os(t,"x","movingAverage"),s=os(n,"decay","movingAverage");Uo(i,o),_t(At(i.shape,o.shape),(function(){return"Shape mismatch in v and x"}));var u=Pl(1),c=bp(u,s),l=Zu(bp(o,i),c);if(a){_t(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var p=os(r,"step","movingAverage");l=Qu(l,bp(u,Ol(s,p)))}return Xu(i,l)}}),Ff={};function Df(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ".concat(n.shape,", indices.shape: ").concat(t.shape,", shape: ").concat(e,", sliceDim: ").concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(i+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(i+" update.rank != ".concat(a+e.length-r));for(var o=0;o<a;++o)if(n.shape[o]!==t.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(n.shape[o],") != indices.shape[").concat(o,"] (").concat(t.shape[o],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(i+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function Mf(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}Df(n,t,e)}function Of(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:Tt(t.shape)/u,sliceSize:o,strides:[].concat(Fe($t(n.slice(0,a))),[1]),outputSize:Tt(n)}}He(Ff,{calculateShapes:function(){return Of},validateInput:function(){return Mf},validateUpdateShape:function(){return Df}});var Pf=cs({scatterND_:function(e,t,n){sn(n);var r=os(e,"indices","scatterND","int32"),a=os(t,"updates","scatterND");Mf(a,r,n);var i={indices:r,updates:a},o={shape:n};return Yo.runKernel(Va,i,o)}});var Lf=cs({sparseToDense_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;sn(n);var a=os(e,"sparseIndices","sparseToDense","int32"),i=os(t,"sparseValues","sparseToDense","string_or_numeric"),o=os(r,"defaultValue","sparseToDense",i.dtype);!function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was ".concat(e.dtype,"."));if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape ".concat(e.shape,"."));var a=e.rank>0?e.shape[0]:1,i=e.rank>1?e.shape[1]:1;if(n.length!==i)throw new Error("outputShape has incorrect number of elements:, ".concat(n.length,", should be: ").concat(i,"."));var o=t.size;if(0!==t.rank&&(1!==t.rank||o!==a))throw new Error("sparseValues has incorrect shape ".concat(t.shape,", should be [] or [").concat(a,"]"));if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,i,n,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:n};return Yo.runKernel(si,s,u)}});var zf=cs({gatherND_:function(e,t){var n=os(t,"indices","gatherND","int32"),r={params:os(e,"x","gatherND","string_or_numeric"),indices:n};return Yo.runKernel(Ar,r)}});var Bf=cs({dropout_:function(e,t,n,r){var a=os(e,"x","dropout");if(_t("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a ".concat(a.dtype," tensor instead.")})),_t(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof To?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(At(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=Qu(Xl(Xu(Ed(i,0,1,"float32",r),o)),o);return Zu(a,s)}});function Wf(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function Uf(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return df(a,"float32")}function Vf(){return Vf=y(f().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,d,h,m,v,g,y,b=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=b.length>2&&void 0!==b[2]?b[2]:1,a=os(t,"predictions","inTopK"),i=os(n,"targets","inTopK"),_t(a.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got ".concat(a.rank)})),_t(a.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank ".concat(a.rank," and targets rank ").concat(i.rank)})),Nt(a.shape.slice(0,a.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=a.shape[a.shape.length-1],_t(r>0&&r<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension (".concat(o,"), but got ").concat(r)})),e.next=7,a.data();case 7:return s=e.sent,e.next=10,i.data();case 10:u=e.sent,c=s.length/o,l=o,p=Wt("bool",c),d=0;case 15:if(!(d<c)){e.next=30;break}for(h=d*l,m=s.subarray(h,h+l),v=[],g=0;g<m.length;g++)v.push({value:m[g],index:g});v.sort((function(e,t){return t.value-e.value})),p[d]=0,y=0;case 20:if(!(y<r)){e.next=27;break}if(v[y].index!==u[d]){e.next=24;break}return p[d]=1,e.abrupt("break",27);case 24:y++,e.next=20;break;case 27:d++,e.next=15;break;case 30:return e.abrupt("return",(t!==a&&a.dispose(),n!==i&&i.dispose(),ds(p,i.shape,"bool")));case 31:case"end":return e.stop()}}),e)}))),Vf.apply(this,arguments)}var jf=function(e,t){return Vf.apply(this,arguments)},Gf={};He(Gf,{conv2d:function(){return Qf},depthwiseConv2d:function(){return $f},matMul:function(){return eh}});var Hf=cs({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Nc(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2]])),_t(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape ".concat(s.shape,".")})),_t(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape ".concat(u.shape,".")})),_t(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got ".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];_t(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must match input depth in filter (").concat(n[2],".")})),_t(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must match output depth for filter (").concat(n[3],").")})),_c("conv2dDerFilter",a,o);var p={x:s,dy:u},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return Yo.runKernel(Yn,p,d)}});function qf(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Zu(e,cf(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function Kf(e,t){var n=t,r=ml(e.shape,t.shape);return r.length>0&&(n=Bl(n,r)),Nc(n,e.shape)}function Xf(e,t,n,r){if("linear"===t)return e;if("relu"===t)return Dd(e);if("elu"===t)return Sl(e);if("relu6"===t)return Md(e);if("prelu"===t)return ed(e,n);if("leakyrelu"===t)return np(e,r);if("sigmoid"===t)return Rc(e);throw new Error("Unknown fused activation ".concat(t,"."))}var Yf=function(e,t){return!(e>0)||"linear"===t};var Qf=cs({fusedConv2d_:function(e){var t,n=e.x,r=e.filter,a=e.strides,i=e.pad,s=e.dataFormat,u=void 0===s?"NHWC":s,c=e.dilations,l=void 0===c?[1,1]:c,p=e.dimRoundingMode,d=e.bias,f=e.activation,h=void 0===f?"linear":f,m=e.preluActivationWeights,v=e.leakyreluAlpha;if(h=h||"linear",!1===Yf(Yo.state.gradientDepth,h)){_t("NHWC"===u,(function(){return"Error in fused conv2d: got dataFormat of ".concat(u," but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.")}));var g=Zc(n,r,a,i,u,l,p);return null!=d&&(g=Xu(g,d)),Xf(g,h,m,v)}var y=os(n,"x","conv2d","float32"),b=os(r,"filter","conv2d","float32"),x=y,k=!1;3===y.rank&&(k=!0,x=Nc(y,[1,y.shape[0],y.shape[1],y.shape[2]])),_t(4===x.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank ".concat(x.rank,".")})),_t(4===b.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank ".concat(b.rank,".")})),_c("fused conv2d",i,p);var w="NHWC"===u?x.shape[3]:x.shape[1];_t(b.shape[2]===w,(function(){return"Error in conv2d: depth of input (".concat(w,") must match input depth for filter ").concat(b.shape[2],".")})),_t(wc(a,l),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(l,"'")}));var S,I,_=hc(x.shape,b.shape,a,l,i,p);if(null!=d&&(t=o(Wo(S=os(d,"bias","fused conv2d"),y),1),S=t[0],"NHWC"===u?vl(_.outShape,S.shape):(_t(S.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-".concat(S.shape.length,".")})),_t(0===S.shape.length||S.shape[0]===_.outChannels||1===S.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(S.shape,") is not compatible with the number of output channels (").concat(_.outChannels,")")})))),null!=m){var N=m.shape;if(_t(N.length<=1||3===N.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-".concat(N.length,".")})),1===N.length)_t(1===N[0]||N[0]===_.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights (".concat(N,") is not compatible with the number of output channels (").concat(_.outChannels,").")}));else if(3===N.length)try{vl(N,_.outShape)}catch(R){var C="Error in fused conv2d: PReLU activation weights (".concat(N,") is not compatible with the output shape of the conv2d (").concat(_.outShape,").");throw Error(C)}I=os(m,"prelu weights","fused conv2d")}var T=function(e,t){_t("NHWC"===u,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(u," but only NHWC is currently supported.")}));var n=o(t,4),r=n[0],s=n[1],c=n[2],p=n[3],d=qf(e,c,h);_t(kc(l),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(l,"'")}));var f=[$c(s.shape,d,r,a,i),Hf(s,d,r.shape,a,i)];if(null!=p){var m=Kf(p,d);f.push(m)}return f},E={x:x,filter:b,bias:S,preluActivationWeights:I},A={strides:a,pad:i,dataFormat:u,dilations:l,dimRoundingMode:p,activation:h,leakyreluAlpha:v};return null==d?hp((function(e,t,n){var r=Yo.runKernel(Ai,E,A);return n([t,e,r]),k&&(r=Nc(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:T}}))(x,b):hp((function(e,t,n,r){var a=Yo.runKernel(Ai,E,A);return r([t,e,a,n]),k&&(a=Nc(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:T}}))(x,b,S)}});var Zf=cs({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=Nc(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return Yo.runKernel(ur,c,l)}});var Jf=cs({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},p=Yo.runKernel(cr,c,l);return u?Nc(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var $f=cs({fusedDepthwiseConv2d_:function(e){var t,n=e.x,r=e.filter,a=e.strides,i=e.pad,s=e.dataFormat,u=void 0===s?"NHWC":s,c=e.dilations,l=void 0===c?[1,1]:c,p=e.dimRoundingMode,d=e.bias,f=e.activation,h=void 0===f?"linear":f,m=e.preluActivationWeights,v=e.leakyreluAlpha;if(!1===Yf(Yo.state.gradientDepth,h)){var g=ll(n,r,a,i,u,l,p);return null!=d&&(g=Xu(g,d)),Xf(g,h,m,v)}var y=os(n,"x","depthwiseConv2d","float32"),b=os(r,"filter","depthwiseConv2d","float32"),x=y,k=!1;3===y.rank&&(k=!0,x=Nc(y,[1,y.shape[0],y.shape[1],y.shape[2]])),_t(4===x.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(x.rank,".")})),_t(4===b.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(b.rank,".")})),_t(x.shape[3]===b.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels (".concat(x.shape[3],") must match the inChannels dimension in filter ").concat(b.shape[2],".")})),null==l&&(l=[1,1]),_t(wc(a,l),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(a," and dilations '").concat(l,"'")})),_c("fused depthwiseConv2d",i,p);var w,S,I=hc(x.shape,b.shape,a,l,i,p,!0);null!=d&&(t=o(Wo(w=os(d,"bias","fused conv2d"),y),1),w=t[0],vl(I.outShape,w.shape)),null!=m&&(S=os(m,"prelu weights","fused depthwiseConv2d"));var _=function(e,t){_t(kc(l),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(l,"'")}));var n=o(t,4),r=n[0],s=n[1],u=n[2],c=n[3],d=qf(e,u,h),f=Jf(s.shape,d,r,a,i,l,p),m=Zf(s,d,r.shape,a,i,l,p);return null!=c?[f,m,Kf(w,d)]:[f,m]},N={x:x,filter:b,bias:w,preluActivationWeights:S},C={strides:a,pad:i,dataFormat:u,dilations:l,dimRoundingMode:p,activation:h,leakyreluAlpha:v};return null==d?hp((function(e,t,n){var r=Yo.runKernel(Ri,N,C);return n([t,e,r]),k&&(r=Nc(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:_}}))(x,b):hp((function(e,t,n,r){var a=Yo.runKernel(Ri,N,C);return r([t,e,a,n]),k&&(a=Nc(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:_}}))(x,b,w)}});var eh=cs({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,s=void 0!==i&&i,u=e.bias,c=e.activation,l=void 0===c?"linear":c,p=e.preluActivationWeights,d=e.leakyreluAlpha,f=void 0===d?.2:d;if(!1===Yf(Yo.state.gradientDepth,l)){var h=Ac(t,n,a,s);return null!=u&&(h=Xu(h,u)),Xf(h,l,p,f)}var m=os(t,"a","fused matMul"),v=os(n,"b","fused matMul"),g=o(Wo(m,v),2);m=g[0],v=g[1];var y=a?m.shape[m.rank-2]:m.shape[m.rank-1],b=s?v.shape[v.rank-1]:v.shape[v.rank-2],x=a?m.shape[m.rank-1]:m.shape[m.rank-2],k=s?v.shape[v.rank-2]:v.shape[v.rank-1],w=m.shape.slice(0,-2),S=v.shape.slice(0,-2),I=Tt(w),_=Tt(S);_t(y===b,(function(){return"Error in fused matMul: inner shapes (".concat(y,") and (").concat(b,") of Tensors with shapes ").concat(m.shape," and ").concat(v.shape," and transposeA=").concat(a," and transposeB=").concat(s," must match.")}));var N,C,T=vl(m.shape.slice(0,-2),v.shape.slice(0,-2)).concat([x,k]),E=Nc(m,a?[I,y,x]:[I,x,y]),A=Nc(v,s?[_,k,b]:[_,b,k]);null!=u&&(N=o(Wo(N=os(u,"bias","fused matMul"),m),1)[0],vl(T,N.shape)),null!=p&&(C=os(p,"prelu weights","fused matMul"));var R=function(e,t){var n,r,i=o(t,4),c=i[0],p=i[1],d=i[2],f=i[3],h=qf(Nc(e,d.shape),d,l);return a||s?!a&&s?(n=Ac(h,p,!1,!1),r=Ac(h,c,!0,!1)):a&&!s?(n=Ac(p,h,!1,!0),r=Ac(c,h,!1,!1)):(n=Ac(p,h,!0,!0),r=Ac(h,c,!0,!0)):(n=Ac(h,p,!1,!0),r=Ac(c,h,!0,!1)),null!=u?[n,r,Kf(f,h)]:[n,r]},F={a:E,b:A,bias:N,preluActivationWeights:C},D={transposeA:a,transposeB:s,activation:l,leakyreluAlpha:f};return null==u?hp((function(e,t,n){var r=Yo.runKernel(Ei,F,D);return n([e,t,r]),{value:Nc(r,T),gradFunc:R}}))(E,A):hp((function(e,t,n,r){var a=Yo.runKernel(Ei,F,D);return r([e,t,a,n]),{value:Nc(a,T),gradFunc:R}}))(E,A,N)}});var th=cs({hammingWindow_:function(e){return Uf(e,.54,.46)}});var nh=cs({hannWindow_:function(e){return Uf(e,.5,.5)}});var rh=cs({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(Fc(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Ec([Fc(e,i,t-s),Hc([s],a)]);o.push(u),i+=n}return 0===o.length?ff([],[0,t]):Nc(Ec(o),[o.length,t])}});var ah=cs({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:nh;null==r&&(r=Wf(t));var i=rh(e,t,n),o=Zu(i,a(t));return af(o,r)}});var ih=cs({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=os(e,"image","cropAndResize"),s=os(t,"boxes","cropAndResize","float32"),u=os(n,"boxInd","cropAndResize","int32"),c=s.shape[0];_t(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(o.rank,".")})),_t(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] but had shape ").concat(s.shape,".")})),_t(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] but had shape ").concat(s.shape,".")})),_t(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")})),_t(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),_t("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},p={method:a,extrapolationValue:i,cropSize:r};return Yo.runKernel(ar,l,p)}});var oh=cs({flipLeftRight_:function(e){var t=os(e,"image","flipLeftRight","float32");_t(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")}));var n={image:t};return Yo.runKernel(_r,n,{})}});var sh=cs({grayscaleToRGB_:function(e){var t=os(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];_t(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, but got rank ".concat(t.rank,".")})),_t(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,ql(t,a)}});var uh=cs({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=os(e,"image","rotateWithOffset","float32");_t(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r};return Yo.runKernel(Ti,i,o)}});function ch(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),_t(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),_t(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),_t(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),_t(1===t.rank,(function(){return"scores must be a 1D tensor"})),_t(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", but was ").concat(t.shape[0])})),_t(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var lh=cs({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=os(e,"boxes","nonMaxSuppression","float32"),o=os(t,"scores","nonMaxSuppression","float32"),s=ch(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return Yo.runKernel(ma,{boxes:i,scores:o},u)}});function ph(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,i=0,o=!1;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||dh)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function dh(e,t){return e>t?1:e<t?-1:0}function fh(e,t,n,r,a){return vh(e,t,n,r,a,0)}function hh(e,t,n,r,a,i){return vh(e,t,n,r,a,0,!1,i,!0)}function mh(e,t,n,r,a,i){return vh(e,t,n,r,a,i,!0)}function vh(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(bh);for(var p=i>0?-.5/i:0,d=[],f=[];d.length<n&&c.length>0;){var h=c.pop(),m=h.score,v=h.boxIndex,g=h.suppressBeginIndex;if(m<a)break;for(var y=!1,b=d.length-1;b>=g;--b){var x=gh(e,v,d[b]);if(x>=r){y=!0;break}if(h.score=h.score*yh(r,p,x),h.score<=a)break}h.suppressBeginIndex=d.length,y||(h.score===m?(d.push(v),f.push(h.score)):h.score>a&&ph(c,h,bh))}var k=d.length,w=n-k;s&&w>0&&(d.push.apply(d,Fe(new Array(w).fill(0))),f.push.apply(f,Fe(new Array(w).fill(0))));var S={selectedIndices:d};return o&&(S.selectedScores=f),u&&(S.validOutputs=k),S}function gh(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),f=(s-i)*(u-o),h=(p-c)*(d-l);if(f<=0||h<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,p),y=Math.min(u,d),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(f+h-b)}function yh(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function bh(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function xh(){return xh=y(f().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,h,m=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=m.length>3&&void 0!==m[3]?m[3]:.5,i=m.length>4&&void 0!==m[4]?m[4]:Number.NEGATIVE_INFINITY,o=os(t,"boxes","nonMaxSuppressionAsync"),s=os(n,"scores","nonMaxSuppressionAsync"),u=ch(o,s,r,a,i),r=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,e.next=6,Promise.all([o.data(),s.data()]);case 6:return c=e.sent,l=c[0],p=c[1],d=fh(l,p,r,a,i),h=d.selectedIndices,e.abrupt("return",(o!==t&&o.dispose(),s!==n&&s.dispose(),df(h,"int32")));case 12:case"end":return e.stop()}}),e)}))),xh.apply(this,arguments)}var kh=function(e,t,n){return xh.apply(this,arguments)};var wh=cs({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=os(e,"boxes","nonMaxSuppression"),s=os(t,"scores","nonMaxSuppression"),u=ch(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},p=Yo.runKernel(ga,c,l);return{selectedIndices:p[0],selectedScores:p[1]}}});function Sh(){return Sh=y(f().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,h,m,v,g=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g.length>3&&void 0!==g[3]?g[3]:.5,i=g.length>4&&void 0!==g[4]?g[4]:Number.NEGATIVE_INFINITY,o=g.length>5&&void 0!==g[5]?g[5]:0,s=os(t,"boxes","nonMaxSuppressionAsync"),u=os(n,"scores","nonMaxSuppressionAsync"),c=ch(s,u,r,a,i,o),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,o=c.softNmsSigma,e.next=7,Promise.all([s.data(),u.data()]);case 7:return l=e.sent,p=l[0],d=l[1],h=mh(p,d,r,a,i,o),m=h.selectedIndices,v=h.selectedScores,e.abrupt("return",(s!==t&&s.dispose(),u!==n&&u.dispose(),{selectedIndices:df(m,"int32"),selectedScores:df(v)}));case 14:case"end":return e.stop()}}),e)}))),Sh.apply(this,arguments)}var Ih=function(e,t,n){return Sh.apply(this,arguments)};var _h=cs({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=os(e,"boxes","nonMaxSuppression"),s=os(t,"scores","nonMaxSuppression"),u=ch(o,s,n,r,a,null),c={boxes:o,scores:s},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:i},p=Yo.runKernel(va,c,l);return{selectedIndices:p[0],validOutputs:p[1]}}});function Nh(){return Nh=y(f().mark((function e(t,n,r){var a,i,s,u,c,l,p,d,h,m,v,g,y,b,x,k,w=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=w.length>3&&void 0!==w[3]?w[3]:.5,i=w.length>4&&void 0!==w[4]?w[4]:Number.NEGATIVE_INFINITY,s=w.length>5&&void 0!==w[5]&&w[5],u=os(t,"boxes","nonMaxSuppressionAsync"),c=os(n,"scores","nonMaxSuppressionAsync"),l=ch(u,c,r,a,i,null),p=l.maxOutputSize,d=l.iouThreshold,h=l.scoreThreshold,e.next=11,Promise.all([u.data(),c.data()]);case 11:return m=e.sent,v=o(m,2),g=v[0],y=v[1],b=hh(g,y,p,d,h,s),x=b.selectedIndices,k=b.validOutputs,e.abrupt("return",(u!==t&&u.dispose(),c!==n&&c.dispose(),{selectedIndices:df(x,"int32"),validOutputs:Pl(k,"int32")}));case 19:case"end":return e.stop()}}),e)}))),Nh.apply(this,arguments)}var Ch=function(e,t,n){return Nh.apply(this,arguments)};var Th=cs({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=os(e,"images","resizeBilinear");_t(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),_t(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape ".concat(t,".")})),_t(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,s=!1;3===a.rank&&(s=!0,i=Nc(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o(t,0);var u={images:i},c={alignCorners:n,halfPixelCenters:r,size:t},l=Yo.runKernel(Pa,u,c);return s?Nc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Eh=cs({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=os(e,"images","resizeNearestNeighbor");_t(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),_t(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape ".concat(t,".")})),_t("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),_t(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,s=!1;3===a.rank&&(s=!0,i=Nc(a,[1,a.shape[0],a.shape[1],a.shape[2]])),o(t,0);var u={images:i},c={alignCorners:n,halfPixelCenters:r,size:t},l=Yo.runKernel(Ma,u,c);return s?Nc(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Ah=cs({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,c=os(e,"image","threshold"),l=c.shape[0]*c.shape[1],p=Zu(df([u]),255);if(_t(3===c.rank,(function(){return"Error in threshold: image must be rank 3,but got rank ".concat(c.rank,".")})),_t(3===c.shape[2]||1===c.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1but got ".concat(c.shape[2],".")})),_t("int32"===c.dtype||"float32"===c.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,but got dtype ".concat(c.dtype,".")})),_t("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===c.shape[2]){var d=o(rf(c,[1,1,1],-1),3);t=d[0],n=d[1],r=d[2];var f=Zu(t,.2989),h=Zu(n,.587),m=Zu(r,.114);a=Xu(Xu(f,h),m)}else a=e;"otsu"===i&&(p=function(e,t){for(var n,r,a,i,o,s,u=df([-1]),c=df([0]),l=df([0]),p=0;p<e.size-1;p++){n=Fc(e,0,p+1),r=Fc(e,p+1),o=Qu(Bl(n),t),s=Qu(Bl(r),t);var d=Bl(Zu(n,Ad(0,n.size)));a=Qu(d,Bl(n));var f=Hc(r.shape,n.size),h=Xu(Ad(0,r.size),f),m=Zu(r,h);i=Qu(Bl(m),Bl(r));var v=bp(a,i),g=bp(a,i),y=Zu(o,s);l=Zu(Zu(y,v),g);var b=Ql(l,c);c=yl(b,l,c),u=yl(b,df([p]),u)}return u}(Uc(Iu(Wd(a),"int32"),ds([]),256),l));var v=s?ap(a,p):Ql(a,p);return Iu(Zu(v,255),"int32")}});var Rh=cs({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=os(e,"image","transform","float32"),s=os(t,"transforms","transform","float32");_t(4===o.rank,(function(){return"Error in transform: image must be rank 4,but got rank ".concat(o.rank,".")})),_t(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),_t(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, but got ".concat(i,".")}));var u={image:o,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return Yo.runKernel(bi,u,c)}});var Fh=cs({bandPart_:function(e,t,n){_t(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),_t(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=os(e,"a","bandPart");_t(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=o(r.shape.slice(-2),2),s=i[0],u=i[1];if(!(t<=s))throw new Error("bandPart(): numLower (".concat(t,") must not be greater than the number of rows (").concat(s,")."));if(!(n<=u))throw new Error("bandPart(): numUpper (".concat(n,") must not be greater than the number of columns (").concat(u,")."));t<0&&(t=s),n<0&&(n=u);var c=Nc(Ad(0,s,1,"int32"),[-1,1]),l=Ad(0,u,1,"int32"),p=bp(c,l),d=wp(ap(p,Pl(+t,"int32")),Zl(p,Pl(-n,"int32"))),f=Mp([s,u],r.dtype);return Nc(uf(wf(Nc(r,[-1,s,u])).map((function(e){return yl(d,e,f)}))),a)}});var Dh=cs({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,_t(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){_t(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: (".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}else t=!0,e=rf(e,e.shape[0],0).map((function(e){return sf(e,[0])}));_t(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds number of dimensions (").concat(e[0].shape[0],").")}));for(var i=[],o=e,s=function(e){i.push(Yo.tidy((function(){var t=o[e];if(e>0)for(var n=0;n<e;++n){var r=Zu(Bl(Zu(i[n],t)),i[n]);t=bp(t,r)}return Qu(t,Ul(t,"euclidean"))})))},u=0;u<e.length;++u)s(u);return t?uf(i,0):i}});function Mh(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Yo.tidy((function(){_t(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=Kl(n),i=_u(e),s=ff([[1]],[1,1]),u=_u(s),c=n>=r?r:n,l=function(e){var t,c,l=i,p=u,d=a;t=Yo.tidy((function(){var t=Fc(i,[e,e],[n-e,1]),o=Ul(t),c=Fc(i,[e,e],[1,1]),l=yl(Ql(c,0),ff([[-1]]),ff([[1]])),p=bp(c,Zu(l,o)),d=Qu(t,p);u=1===d.shape[0]?_u(s):Ec([s,Fc(d,[1,0],[d.shape[0]-1,d.shape[1]])],0);var f=vp(Qu(Ac(l,p),o)),h=Fc(i,[e,0],[n-e,r]),m=Zu(f,u),v=Af(u);if(0===e)i=bp(h,Ac(m,Ac(v,h)));else{var g=bp(h,Ac(m,Ac(v,h)));i=Ec([Fc(i,[0,0],[e,r]),g],0)}var y=Af(m),b=Fc(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=bp(b,Ac(Ac(b,u),y));else{var x=bp(b,Ac(Ac(b,u),y));a=Ec([Fc(a,[0,0],[n,e]),x],1)}return[u,i,a]})),c=o(t,3),u=c[0],i=c[1],a=c[2],Pu([l,p,d])},p=0;p<c;++p)l(p);return!t&&n>r&&(a=Fc(a,[0,0],[n,r]),i=Fc(i,[0,0],[r,r])),[a,i]}))}var Oh,Ph=cs({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(_t(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return Mh(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=wf(Nc(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];return r.forEach((function(e){var n=o(Mh(e,t),2),r=n[0],s=n[1];a.push(r),i.push(s)})),[Nc(uf(a,0),e.shape),Nc(uf(i,0),e.shape)]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Oh||(Oh={}));var Lh=cs({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Oh.SUM_BY_NONZERO_WEIGHTS,r=os(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=os(t,"weights","computeWeightedLoss"));var i=null==a?r:Zu(r,a);if(n===Oh.NONE)return i;if(n===Oh.SUM)return Bl(i);if(n===Oh.MEAN){if(null==a)return Dp(i);var o=r.size/a.size,s=Qu(Bl(i),Bl(a));return o>1?Qu(s,Pl(o)):s}if(n===Oh.SUM_BY_NONZERO_WEIGHTS){if(null==a)return Qu(Bl(i),Pl(r.size));var u=Zu(a,Op(r.shape)),c=Iu(Bl(jp(u,Pl(0))),"float32");return Qu(Bl(i),c)}throw Error("Unknown reduction: ".concat(n))}});var zh=cs({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Oh.SUM_BY_NONZERO_WEIGHTS,a=os(e,"labels","absoluteDifference"),i=os(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=os(n,"weights","absoluteDifference")),Nt(a.shape,i.shape,"Error in absoluteDifference: ");var s=Ju(bp(a,i));return Lh(s,o,r)}});var Bh=cs({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Oh.SUM_BY_NONZERO_WEIGHTS,i=os(e,"labels","cosineDistance"),o=os(t,"predictions","cosineDistance"),s=null;null!=r&&(s=os(r,"weights","cosineDistance")),Nt(i.shape,o.shape,"Error in cosineDistance: ");var u=Pl(1),c=bp(u,Bl(Zu(i,o),n,!0));return Lh(c,s,a)}});var Wh=cs({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Oh.SUM_BY_NONZERO_WEIGHTS,a=os(e,"labels","hingeLoss"),i=os(t,"predictions","hingeLoss"),o=null;null!=n&&(o=os(n,"weights","hingeLoss")),Nt(a.shape,i.shape,"Error in hingeLoss: ");var s=Pl(1);a=bp(Zu(Pl(2),a),s);var u=Dd(bp(s,Zu(a,i)));return Lh(u,o,r)}});var Uh=cs({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Oh.SUM_BY_NONZERO_WEIGHTS,i=os(e,"labels","huberLoss"),o=os(t,"predictions","huberLoss"),s=null;null!=n&&(s=os(n,"weights","huberLoss")),Nt(i.shape,o.shape,"Error in huberLoss: ");var u=Pl(r),c=Ju(bp(o,i)),l=Lp(c,u),p=bp(c,l),d=Xu(Zu(Pl(.5),zl(l)),Zu(u,p));return Lh(d,s,a)}});var Vh=cs({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Oh.SUM_BY_NONZERO_WEIGHTS,i=os(e,"labels","logLoss"),o=os(t,"predictions","logLoss"),s=null;null!=n&&(s=os(n,"weights","logLoss")),Nt(i.shape,o.shape,"Error in logLoss: ");var u=Pl(1),c=Pl(r),l=vp(Zu(i,sp(Xu(o,c)))),p=Zu(bp(u,i),sp(Xu(bp(u,o),c))),d=bp(l,p);return Lh(d,s,a)}});var jh=cs({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Oh.SUM_BY_NONZERO_WEIGHTS,a=os(e,"labels","meanSquaredError"),i=os(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=os(n,"weights","meanSquaredError")),Nt(a.shape,i.shape,"Error in meanSquaredError: ");var s=of(a,i);return Lh(s,o,r)}});var Gh=cs({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Oh.SUM_BY_NONZERO_WEIGHTS,i=os(e,"multiClassLabels","sigmoidCrossEntropy"),o=os(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=os(n,"weights","sigmoidCrossEntropy")),Nt(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Pl(r),c=Pl(1),l=Pl(.5);i=Xu(Zu(i,bp(c,u)),Zu(l,u))}var p=function(e,t){var n=os(e,"labels","sigmoidCrossEntropyWithLogits"),r=os(t,"logits","sigmoidCrossEntropyWithLogits");Nt(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Dd(r),i=Zu(r,n),o=up(jl(vp(Ju(r))));return Xu(bp(a,i),o)}(i,o);return Lh(p,s,a)}});var Hh=cs({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Oh.SUM_BY_NONZERO_WEIGHTS,i=os(e,"onehotLabels","softmaxCrossEntropy"),s=os(t,"logits","softmaxCrossEntropy"),u=null;if(null!=n&&(u=os(n,"weights","softmaxCrossEntropy")),Nt(i.shape,s.shape,"Error in softmaxCrossEntropy: "),r>0){var c=Pl(r),l=Pl(1),p=Pl(i.shape[1]);i=Xu(Zu(i,bp(l,c)),Qu(c,p))}var d=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ".concat(t.rank," and dim was ").concat(n));return hp((function(e,t,r){var a=kp(t,[n],!0),i=bp(Iu(t,"float32"),a);r([e,i]);var s=vp(Zu(i,e));return{value:Bl(s,[n]),gradFunc:function(e,t){var r=o(t,2),a=r[0],i=r[1],s=Tl(e.shape,[n]);return[Zu(Nc(e,s),bp(Iu(a,"float32"),jl(i))),Zu(Nc(e,s),bp(jl(i),Iu(a,"float32")))]}}}))(e,t)}(i,s);return Lh(d,u,a)}});var qh=cs({sparseFillEmptyRows_:function(e,t,n,r){var a=os(e,"indices","sparseFillEmptyRows","int32"),i=os(t,"values","sparseFillEmptyRows"),o=os(n,"denseShape","sparseFillEmptyRows","int32"),s=os(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Yo.runKernel(ri,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});var Kh=cs({sparseReshape_:function(e,t,n){var r=os(e,"inputIndices","sparseReshape","int32"),a=os(t,"inputShape","sparseReshape","int32"),i=os(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=Yo.runKernel(ai,o);return{outputIndices:s[0],outputShape:s[1]}}});var Xh=cs({sparseSegmentMean_:function(e,t,n){var r=os(e,"data","sparseSegmentMean"),a=os(t,"indices","sparseSegmentMean","int32"),i=os(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Yo.runKernel(ii,o)}});var Yh=cs({sparseSegmentSum_:function(e,t,n){var r=os(e,"data","sparseSegmentSum"),a=os(t,"indices","sparseSegmentSum","int32"),i=os(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Yo.runKernel(oi,o)}});var Qh=cs({stringNGrams_:function(e,t,n,r,a,i,o,s){var u=os(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=os(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");var l={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},p={data:u,dataSplits:c},d=Yo.runKernel(pi,p,l);return{nGrams:d[0],nGramsSplits:d[1]}}});var Zh=cs({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=os(e,"input","stringSplit","string"),a=os(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=Yo.runKernel(di,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});var Jh=cs({stringToHashBucketFast_:function(e,t){var n=os(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return Yo.runKernel(fi,a,r)}}),$h={fft:ef,ifft:tf,rfft:af,irfft:nf},em={hammingWindow:th,hannWindow:nh,frame:rh,stft:ah},tm={flipLeftRight:oh,grayscaleToRGB:sh,resizeNearestNeighbor:Eh,resizeBilinear:Th,rotateWithOffset:uh,cropAndResize:ih,nonMaxSuppression:lh,nonMaxSuppressionAsync:kh,nonMaxSuppressionWithScore:wh,nonMaxSuppressionWithScoreAsync:Ih,nonMaxSuppressionPadded:_h,nonMaxSuppressionPaddedAsync:Ch,threshold:Ah,transform:Rh},nm={bandPart:Fh,gramSchmidt:Dh,qr:Ph},rm={absoluteDifference:zh,computeWeightedLoss:Lh,cosineDistance:Bh,hingeLoss:Wh,huberLoss:Uh,logLoss:Vh,meanSquaredError:jh,sigmoidCrossEntropy:Gh,softmaxCrossEntropy:Hh},am={sparseFillEmptyRows:qh,sparseReshape:Kh,sparseSegmentMean:Xh,sparseSegmentSum:Yh},im={stringNGrams:Qh,stringSplit:Zh,stringToHashBucketFast:Jh},om={};He(om,{Serializable:function(){return sm},SerializationMap:function(){return um},registerClass:function(){return cm}});var sm=function(){function e(){h(this,e)}return v(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),um=function(){function e(){h(this,e),this.classNameMap={}}return v(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function cm(e){_t(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),_t("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),_t(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),um.register(e)}var lm=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return Pu(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return fp(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&Pu(this.iterations_)}},{key:"saveIterations",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:Pl(this.iterations_,"int32")}));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class ".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(sm);Object.defineProperty(lm,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var pm=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return h(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=Yo.backend.epsilon()),a}return v(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Yo.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:Ou((function(){return bl(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:Ou((function(){return bl(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Ou((function(){var e=Xu(Zu(o,t.rho),Zu(zl(i),1-t.rho)),n=Zu(Qu(Ll(Xu(s,t.epsilon)),Ll(Xu(o,t.epsilon))),i),r=Xu(Zu(s,t.rho),Zu(zl(n),1-t.rho));o.assign(e),s.assign(r);var u=Xu(Zu(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(Pu(this.accumulatedGrads.map((function(e){return e.variable}))),Pu(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Fe(this.accumulatedGrads),Fe(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=y(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adadelta"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(lm),dm=function(e){Ae(n,e);var t=Re(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return h(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return v(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Yo.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:Ou((function(){return Hc(a.shape,t.initialAccumulatorValue).variable(!1)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;Ou((function(){var e=Xu(o,zl(i));o.assign(e);var n=Xu(Zu(Qu(i,Ll(Xu(e,Yo.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&Pu(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"className",get:function(){return"Adagrad"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(lm),fm=function(e){Ae(n,e);var t=Re(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return h(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],Ou((function(){i.accBeta1=Pl(r).variable(),i.accBeta2=Pl(a).variable()})),null==o&&(i.epsilon=Yo.backend.epsilon()),i}return v(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Ou((function(){var r=bp(1,t.accBeta1),a=bp(1,t.accBeta2);n.forEach((function(n,i){var o=Yo.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Ou((function(){return bl(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:Ou((function(){return bl(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=Xu(Zu(u,t.beta1),Zu(s,1-t.beta1)),p=Xu(Zu(c,t.beta2),Zu(zl(s),1-t.beta2)),d=Qu(l,r),f=Qu(p,a);u.assign(l),c.assign(p);var h=Xu(Zu(Qu(d,Xu(Ll(f),t.epsilon)),-t.learningRate),o);o.assign(h)}})),t.accBeta1.assign(Zu(t.accBeta1,t.beta1)),t.accBeta2.assign(Zu(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Pu(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Pu(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Fe(this.accumulatedFirstMoment),Fe(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=y(f().mark((function e(t){var n,r=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,Ou((function(){r.accBeta1.assign(Ol(r.beta1,r.iterations_+1)),r.accBeta2.assign(Ol(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"className",get:function(){return"Adam"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(lm),hm=function(e){Ae(n,e);var t=Re(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return h(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],Ou((function(){i.iteration=Pl(0).variable(),i.accBeta1=Pl(r).variable()})),null==o&&(i.epsilon=Yo.backend.epsilon()),i}return v(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Ou((function(){var r=bp(1,t.accBeta1),a=Qu(-t.learningRate,Xu(Zu(t.iteration,t.decay),1));n.forEach((function(n,i){var o=Yo.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:bl(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:bl(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=Xu(Zu(u,t.beta1),Zu(s,1-t.beta1)),p=Zu(c,t.beta2),d=Ju(s),f=Fp(p,d);u.assign(l),c.assign(f);var h=Xu(Zu(Qu(a,r),Qu(l,Xu(f,t.epsilon))),o);o.assign(h)}})),t.iteration.assign(Xu(t.iteration,1)),t.accBeta1.assign(Zu(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Pu(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Pu(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"className",get:function(){return"Adamax"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(lm),mm=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return v(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=Yo.registeredVariables[n];Ou((function(){var e=Xu(Zu(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=Lu(Pl(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"className",get:function(){return"SGD"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(lm),vm=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return h(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=Pl(a.momentum),a}return v(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Yo.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:Ou((function(){return bl(a).variable(!1)}))});var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&Ou((function(){var e,n=Xu(Zu(t.m,i),o);e=t.useNesterov?Xu(Zu(t.c,Xu(o,Zu(n,t.m))),a):Xu(Zu(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&Pu(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"className",get:function(){return"Momentum"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(mm),gm=function(e){Ae(n,e);var t=Re(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(h(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=Yo.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return Ee(r)}return v(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=Yo.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:Ou((function(){return bl(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:Ou((function(){return bl(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:Ou((function(){return bl(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;Ou((function(){var e=Xu(Zu(s,t.decay),Zu(zl(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=Xu(Zu(n,t.decay),Zu(o,1-t.decay)),c=Qu(Zu(o,t.learningRate),Ll(bp(e,Xu(zl(i),t.epsilon)))),l=Xu(Zu(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var p=bp(a,l);a.assign(p)}else{var d=Xu(Zu(s,t.decay),Zu(zl(o),1-t.decay)),f=Xu(Zu(u,t.momentum),Qu(Zu(o,t.learningRate),Ll(Xu(d,t.epsilon))));s.assign(d),u.assign(f);var h=bp(a,f);a.assign(h)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&Pu(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Pu(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Pu(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Fe(this.accumulatedMeanSquares),Fe(this.accumulatedMoments)),this.centered&&t.push.apply(t,Fe(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=y(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"className",get:function(){return"RMSProp"}},{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(lm),ym=[pm,dm,fm,hm,vm,gm,mm];var bm={};He(bm,{browserFiles:function(){return Nm},browserHTTPRequest:function(){return zm},concatenateArrayBuffers:function(){return Ss},copyModel:function(){return mu},decodeWeights:function(){return gs},encodeWeights:function(){return ms},fromMemory:function(){return Vm},fromMemorySync:function(){return jm},getLoadHandlers:function(){return Ps},getModelArtifactsForJSON:function(){return Cs},getModelArtifactsForJSONSync:function(){return Ns},getModelArtifactsInfoForJSON:function(){return Es},getSaveHandlers:function(){return Os},getWeightSpecs:function(){return As},http:function(){return Lm},isHTTPScheme:function(){return Om},listModels:function(){return pu},loadWeights:function(){return Am},moveModel:function(){return gu},registerLoadRouter:function(){return Ms},registerSaveRouter:function(){return Ds},removeModel:function(){return fu},weightsLoaderFactory:function(){return Fm},withSaveHandler:function(){return Gm},withSaveHandlerSync:function(){return Hm}});var xm="model",km=".json",wm=".weights.bin";function Sm(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Im=function(){function e(t){if(h(this,e),!hn().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),(null==t||0===t.length)&&(t=xm),this.modelJsonFileName=t+km,this.weightDataFileName=t+wm}return v(e,[{key:"save",value:function(){var e=y(f().mark((function e(t){var n,r,a,i,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a=_s(t,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=i,e.next=10,Sm((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 10:if(null==t.weightData){e.next=16;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=16,Sm((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 16:return e.abrupt("return",{modelArtifactsInfo:Es(t)});case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();Im.URL_SCHEME="downloads://";var _m=function(){function e(t){if(h(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return v(e,[{key:"load",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=Cs(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading Keras-style tf.Model artifacts only."))},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=De(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,Fe(o.weights)),a.push.apply(a,Fe(o.paths))}}catch(c){i.e(c)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,Ss(e)]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return Is(e.name)})),i={},o=De(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=Is(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: '".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(s){o.e(s)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest (".concat(r.length,") and the number of weight files provided (").concat(this.weightsFiles.length,")."));return i}}]),e}();function Nm(e){return new _m(e)}function Cm(e,t,n,r){(function(e){_t(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))})(e),function(e,t){_t(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction ".concat(e)})),_t(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction ".concat(t)})),_t(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ").concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function Tm(e,t){return Em.apply(this,arguments)}function Em(){return Em=y(f().mark((function e(t,n){var r,a,i,o,s,u,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?hn().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,Cm(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0.map((function(e){return e.arrayBuffer()})),u=.5,c=1,null!=n.onProgress){e.next=23;break}return e.next=20,Promise.all(s);case 20:e.t1=e.sent,e.next=26;break;case 23:return e.next=25,Cm(s,n.onProgress,u,c);case 25:e.t1=e.sent;case 26:return e.abrupt("return",e.t1);case 27:case"end":return e.stop()}}),e)}))),Em.apply(this,arguments)}function Am(e){return Rm.apply(this,arguments)}function Rm(){return Rm=y(f().mark((function e(t){var n,r,a,i=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:"",r=i.length>2?i[2]:void 0,a=i.length>3?i[3]:void 0,e.abrupt("return",Fm((function(e){return Tm(e,{requestInit:a})}))(t,n,r));case 4:case"end":return e.stop()}}),e)}))),Rm.apply(this,arguments)}function Fm(e){return function(){var t=y(f().mark((function t(n){var r,a,i,o,s,u,c,l,p,d,h,m,v=arguments;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=v.length>1&&void 0!==v[1]?v[1]:"",a=v.length>2?v[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=fs[r]*Tt(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=6;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: ".concat(c.join(", "),". \nManifest JSON has weights with names: ").concat(u.join(", "),"."));case 6:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),p=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;p.push(t)}))})),t.next=10,e(p);case 10:return d=t.sent,h={},m=0,t.abrupt("return",(l.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=d[m+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(d[m+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=gs(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)h[n]=t[n]})),m+=t})),h));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}Fs.registerSaveRouter((function(e){return hn().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Im.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Im(e)}(e.slice(Im.URL_SCHEME.length)):null}));var Dm=function(){function e(t,n){if(h(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(_t("function"==typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=hn().platform.fetch,_t(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&_t(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return v(e,[{key:"save",value:function(){var e=y(f().mark((function e(t){var n,r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=_s(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=8,this.fetch(this.path,n);case 8:if(!(i=e.sent).ok){e.next=11;break}return e.abrupt("return",{modelArtifactsInfo:Es(t),responses:[i]});case 11:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status ".concat(i.status,"."));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i,o=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ").concat(t.status,". Please verify this URL points to the model JSON of the model to load."));case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 15:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));case 18:return e.abrupt("return",Cs(n,(function(e){return o.loadWeights(e)})));case 19:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=y(f().mark((function e(t){var n,r,a,i,s,u,c,l,p,d,h,m,v,g,y,b;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=Mm(n),a=o(r,2),i=a[0],s=a[1],u=this.weightPathPrefix||i,c=As(t),l=[],p=[],d=De(t);try{for(d.s();!(h=d.n()).done;){m=h.value,v=De(m.paths);try{for(v.s();!(g=v.n()).done;)y=g.value,null!=this.weightUrlConverter?p.push(this.weightUrlConverter(y)):l.push(u+y+s)}catch(f){v.e(f)}finally{v.f()}}}catch(f){d.e(f)}finally{d.f()}if(e.t0=this.weightUrlConverter,!e.t0){e.next=13;break}return e.t1=l.push,e.t2=l,e.t3=Fe,e.next=10,Promise.all(p);case 10:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 13:return e.next=15,Tm(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 15:return b=e.sent,e.abrupt("return",[c,Ss(b)]);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Mm(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function Om(e){return null!=e.match(Dm.URL_SCHEME_REGEX)}Dm.URL_SCHEME_REGEX=/^https?:\/\//;var Pm=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;var n=!0;return n=Array.isArray(e)?e.every((function(e){return Om(e)})):Om(e),n?Lm(e,t):null};function Lm(e,t){return new Dm(e,t)}function zm(e,t){return Lm(e,t)}Fs.registerSaveRouter(Pm),Fs.registerLoadRouter(Pm);var Bm=function(){function e(t){h(this,e),this.modelArtifacts=t}return v(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),Wm=function(){function e(t){h(this,e),this.saveHandler=t}return v(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),Um=v((function e(t){h(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})}));function Vm(e,t,n,r){var a=arguments;return new Um(jm.apply(void 0,Fe(a)))}function jm(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new Bm(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Bm({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Bm({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}function Gm(e){return new Wm(e)}function Hm(e){return new Wm(e)}var qm={};He(qm,{confusionMatrix:function(){return Xm}});var Km,Xm=cs({confusionMatrix_:function(e,t,n){var r=os(e,"labels","confusionMatrix"),a=os(t,"predictions","confusionMatrix");_t(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got ".concat(n)})),_t(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)})),_t(1===a.rank,(function(){return"Expected the rank of predictions to be 1, but got ".concat(a.rank)})),_t(r.shape[0]===a.shape[0],(function(){return"Mismatch in the number of examples: ".concat(r.shape[0]," vs. ").concat(a.shape[0],". Labels and predictions should have the same number of elements.")})),_t(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got ".concat(n)}));var i=Gp(Iu(r,"int32"),n),o=Gp(Iu(a,"int32"),n),s=Af(i),u=Ac(s,o);return Iu(u,"int32")}}),Ym={};function Qm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,s=!1,u=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)s=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ".concat(e.constructor.name));u=!0}if(null!=Pi(Ci,Yo.backendName)){var c={pixels:e},l={numChannels:t};return Yo.runKernel(Ci,c,l)}var p,d,f=o(a?[e.videoWidth,e.videoHeight]:[e.width,e.height],2),h=f[0],m=f[1];if(s)p=e.getContext("2d").getImageData(0,0,h,m).data;else if(r||n)p=e.data;else if(i||a||u){if(null==Km)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");Km=new OffscreenCanvas(1,1).getContext("2d")}else Km=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Km.canvas.width=h,Km.canvas.height=m,Km.drawImage(e,0,0,h,m),p=Km.getImageData(0,0,h,m).data}if(4===t)d=new Int32Array(p);else{var v=h*m;d=new Int32Array(v*t);for(var g=0;g<v;g++)for(var y=0;y<t;++y)d[g*t+y]=p[4*g+y]}return hf(d,[m,h,t],"int32")}function Zm(e){return"undefined"!=typeof window&&"undefined"!=typeof ImageBitmap&&window.hasOwnProperty("createImageBitmap")&&!(e instanceof ImageBitmap)&&function(e){return null!=e&&0!==e.width&&0!==e.height}(e)&&!function(e){return null!=e&&e.data instanceof Uint8Array}(e)}function Jm(e){return $m.apply(this,arguments)}function $m(){return $m=y(f().mark((function e(t){var n,r,a,i=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:3,r=null,!hn().getBool("WRAP_TO_IMAGEBITMAP")||!Zm(t)){e.next=15;break}return e.prev=3,e.next=6,createImageBitmap(t,{premultiplyAlpha:"none"});case 6:a=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a=null;case 12:r=null!=a&&a.width===t.width&&a.height===t.height?a:t,e.next=16;break;case 15:r=t;case 16:return e.abrupt("return",Qm(r,n));case 17:case"end":return e.stop()}}),e,null,[[3,9]])}))),$m.apply(this,arguments)}function ev(e,t){return tv.apply(this,arguments)}function tv(){return tv=y(f().mark((function e(t,n){var r,a,i,s,u,c,l,p,d,h,m,v,g,y,b,x,k;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=os(t,"img","toPixels"),t instanceof To||(r=Iu(a=r,"int32"),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(i=r.shape.slice(0,2),s=o(i,2),u=s[0],c=s[1],!((l=2===r.rank?1:r.shape[2])>4||2===l)){e.next=7;break}throw new Error("toPixels only supports depth of size 1, 3 or 4 but got ".concat(l));case 7:if("float32"===r.dtype||"int32"===r.dtype){e.next=9;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,". Please use float32 or int32 tensors."));case 9:return e.next=11,r.data();case 11:p=e.sent,d="float32"===r.dtype?255:1,h=new Uint8ClampedArray(c*u*4),m=0;case 15:if(!(m<u*c)){e.next=36;break}v=[0,0,0,255],g=0;case 18:if(!(g<l)){e.next=31;break}if(y=p[m*l+g],"float32"!==r.dtype){e.next=25;break}if(!(y<0||y>1)){e.next=23;break}throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(y,"."));case 23:e.next=27;break;case 25:if("int32"!==r.dtype||!(y<0||y>255)){e.next=27;break}throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(y,"."));case 27:1===l?(v[0]=y*d,v[1]=y*d,v[2]=y*d):v[g]=y*d;case 28:g++,e.next=18;break;case 31:h[(b=4*m)+0]=Math.round(v[0]),h[b+1]=Math.round(v[1]),h[b+2]=Math.round(v[2]),h[b+3]=Math.round(v[3]);case 33:++m,e.next=15;break;case 36:return null!=n&&(n.width=c,n.height=u,x=n.getContext("2d"),k=new ImageData(h,c,u),x.putImageData(k,0,0)),e.abrupt("return",(r!==t&&r.dispose(),h));case 38:case"end":return e.stop()}}),e)}))),tv.apply(this,arguments)}He(Ym,{fromPixels:function(){return nv},fromPixelsAsync:function(){return Jm},toPixels:function(){return ev}});var nv=cs({fromPixels_:Qm}),rv={};function av(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[r-1]," vs. ").concat(n));if(0===Tt(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,p=i;p<n;++p)l*=u[p],c.push(u[p]);var d=[].concat(Fe($t(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,d]}He(rv,{prepareAndValidate:function(){return av}});var iv={};He(iv,{assertParamsValid:function(){return uv},computeFlatOffset:function(){return kv},computeOutShape:function(){return lv},getNormalizedAxes:function(){return hv},isSliceContinous:function(){return xv},maskToAxes:function(){return cv},parseSliceParams:function(){return wv},sliceInfo:function(){return Sv},startForAxis:function(){return yv},startIndicesWithElidedDims:function(){return mv},stopForAxis:function(){return bv},stopIndicesWithElidedDims:function(){return vv},stridesForAxis:function(){return gv},stridesWithElidedDims:function(){return pv}});var ov=-2,sv=-1;function uv(e,t,n){var r=e.shape.length;_t(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),_t(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var a=function(a){_t(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] (").concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function cv(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function lv(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function pv(e,t,n,r){for(var a=Fe(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}function dv(e,t,n){return n<=e?n:n-(t-1)}function fv(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function hv(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),p=new Array(c),d=new Array(c);if(t.length&&n>0){var f=t[0],h=n+1;l=mv(o,f,h,r,e),p=vv(s,f,h,a,e),d=pv(i,f,h,e)}else for(var m=0;m<c;m++)l[m]=yv(o,r,i,e,m,u),p[m]=bv(s,a,i,e,m,u),d[m]=gv(i,m,u);return{begin:l,end:p,strides:d}}function mv(e,t,n,r,a){for(var i=Fe(a),o=fv(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=dv(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}function vv(e,t,n,r,a){for(var i=Fe(a),o=fv(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=dv(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var p=a[l];i[l]<0&&(i[l]+=p),i[l]=bt(0,i[l],a[l])}return i}function gv(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function yv(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=bt(0,o,u-1)}function bv(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?bt(0,o,u):bt(-1,o,u-1)}function xv(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function kv(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function wv(e,t,n){var r,a,i=e.shape.length;return(r="number"==typeof t?[t].concat(Fe(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){_t(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"==typeof n?[n].concat(Fe(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(_t(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function Sv(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&o&o-1)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,p={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},d=0;d<p.dims;d++)l&&1<<d&s&&p.numAddAxisAfterEllipsis++,1<<d&o&&(l=!0);l||(p.ellipsisMask|=1<<p.dims,p.dims++);var f={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(ov),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input has only ").concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(sv),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(p,f);for(var h=!0,m=!0,v=!0,g=[],y=[],b=0;b<e.length;++b){if(0===f.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(f.shrinkAxisMask&1<<b),k=e[b];if(-1!==k){var w=[f.beginMask&1<<b,f.endMask&1<<b],S=[f.strides[b]>0?0:-1,f.strides[b]>0?k:k-1];if(x&&f.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&1===f.strides[b];var I=!!(f.beginMask&1<<b&&f.endMask&1<<b);if(f.beginValid&&f.endValid){if(x){var _=f.begin[b]<0?k+f.begin[b]:f.begin[b];if(f.begin[b]=_,f.end[b]=f.begin[b]+1,_<0||_>=k)throw Error("slice index ".concat(f.begin[b]," of dimension ").concat(b," out of bounds."))}else f.begin[b]=Iv(f.begin[b],0,f.strides[b],k,w,S),f.end[b]=Iv(f.end[b],1,f.strides[b],k,w,S);var N=1===f.strides[b]&&0===f.begin[b]&&f.end[b]===k;h=h&&N,m=m&&(0===b&&1===f.strides[b]||N)}else h=h&&1===f.strides[b]&&I,m=m&&(0===b&&1===f.strides[b]||I);var C=void 0,T=!1;if(f.beginValid&&f.endValid?(C=f.end[b]-f.begin[b],T=!0):x?(C=1,T=!0):I&&k>=0&&(C=f.strides[b]<0?-k:k,T=!0),T){var E=void 0;E=0===C||C<0!=f.strides[b]<0?0:Math.trunc(C/f.strides[b])+(C%f.strides[b]!==0?1:0),g.push(E)}else g.push(-1)}else g.push(x?1:-1)}for(var A=0;A<f.finalShapeGatherIndices.length;++A){var R=f.finalShapeGatherIndices[A];R>=0?y.push(g[R]):R===ov&&y.push(1)}return{finalShapeSparse:y.filter((function(e,t){return f.finalShapeGatherIndices[t]!==ov})),finalShape:y,isIdentity:h,sliceDim0:m,isSimpleSlice:v,begin:f.begin,end:f.end,strides:f.strides}}function Iv(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}var _v="4.2.0",Nv=function(){function e(){h(this,e)}return v(e,null,[{key:"sgd",value:function(e){return new mm(e)}},{key:"momentum",value:function(e,t){return new vm(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2])}},{key:"rmsprop",value:function(e){return new gm(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}},{key:"adam",value:function(){return new fm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},{key:"adadelta",value:function(){return new pm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},{key:"adamax",value:function(){return new hm(arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,arguments.length>4&&void 0!==arguments[4]?arguments[4]:0)}},{key:"adagrad",value:function(e){return new dm(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1)}}]),e}(),Cv=Nv,Tv="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function Ev(){return new Promise((function(e){return Tv((function(){return e()}))}))}var Av,Rv={};function Fv(e,t){var n=e[0].length;e.forEach((function(e,t){_t(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),_t(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)_t(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function Dv(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Mv(e,t,n){var r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(var a=1;a<n.length;++a){var i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}function Ov(e){var t,n={FIRST_DIM_SIZE:Av.FIRST_DIM_SIZE,VALUE_ROWIDS:Av.VALUE_ROWIDS,ROW_LENGTHS:Av.ROW_LENGTHS,ROW_SPLITS:Av.ROW_SPLITS,ROW_LIMITS:Av.ROW_LIMITS,ROW_STARTS:Av.ROW_STARTS},r=[],a=De(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!(i in n))break;r.push(n[i])}}catch(o){a.e(o)}finally{a.f()}return r}function Pv(e){return 0===e.length?0:e[0]===Av.FIRST_DIM_SIZE?e.length-1:e.length}function Lv(e,t){if(null!=e&&null!=t){var n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(n,r-1);++a){var i=e[a],o=t[a+1];if(i>=0&&o>=0&&1!==i&&i!==o)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(o))}}}He(Rv,{ERF_A1:function(){return Yv},ERF_A2:function(){return Qv},ERF_A3:function(){return Zv},ERF_A4:function(){return Jv},ERF_A5:function(){return $v},ERF_P:function(){return Xv},PARALLELIZE_THRESHOLD:function(){return zv},RowPartitionType:function(){return Av},SELU_SCALE:function(){return Kv},SELU_SCALEALPHA:function(){return qv},applyActivation:function(){return Xf},assertAndGetBroadcastShape:function(){return vl},assertAxesAreInnerMostDims:function(){return El},assertParamsConsistent:function(){return Fv},assignToTypedArray:function(){return ig},axesAreInnerMostDims:function(){return _l},calculateShapes:function(){return Of},checkEinsumDimSizes:function(){return hg},checkPadOnDimRoundingMode:function(){return _c},combineLocations:function(){return Nl},combineRaggedTensorToTensorShapes:function(){return Mv},complexWithEvenIndex:function(){return ng},complexWithOddIndex:function(){return rg},computeConv2DInfo:function(){return hc},computeConv3DInfo:function(){return mc},computeDefaultPad:function(){return vc},computeDilation2DInfo:function(){return pc},computeOptimalWindowSize:function(){return Bv},computeOutAndReduceShapes:function(){return Cl},computeOutShape:function(){return Dv},computePool2DInfo:function(){return dc},computePool3DInfo:function(){return fc},convertConv2DDataFormat:function(){return Ic},decodeEinsumEquation:function(){return dg},eitherStridesOrDilationsAreOne:function(){return wc},expandShapeToKeepDim:function(){return Tl},exponent:function(){return sg},exponents:function(){return og},fromStringArrayToUint8:function(){return Pg},fromUint8ToStringArray:function(){return Og},getAxesPermutation:function(){return Al},getBroadcastDims:function(){return hl},getComplexWithIndex:function(){return ag},getEinsumComputePath:function(){return mg},getEinsumPermutation:function(){return fg},getFusedBiasGradient:function(){return Kf},getFusedDyActivation:function(){return qf},getImageCenter:function(){return Wv},getInnerMostAxes:function(){return Fl},getPermuted:function(){return Vv},getRaggedRank:function(){return Pv},getReductionAxes:function(){return ml},getReshaped:function(){return Uv},getReshapedPermuted:function(){return jv},getRowPartitionTypesHelper:function(){return Ov},getSliceBeginCoords:function(){return Gv},getSliceSize:function(){return Hv},getSparseFillEmptyRowsIndicesDenseShapeMismatch:function(){return bg},getSparseFillEmptyRowsNegativeIndexErrorMessage:function(){return xg},getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:function(){return kg},getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return Ig},getSparseReshapeInputOutputMismatchErrorMessage:function(){return Ng},getSparseReshapeInputOutputMultipleErrorMessage:function(){return _g},getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:function(){return wg},getSparseReshapeNegativeOutputDimErrorMessage:function(){return Sg},getSparseSegmentReductionIndicesOutOfRangeErrorMessage:function(){return Ag},getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return Cg},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return Tg},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:function(){return Eg},getUndoAxesPermutation:function(){return Rl},isIdentityPermutation:function(){return vg},log:function(){return Di},mergeRealAndImagArrays:function(){return eg},prepareAndValidate:function(){return av},prepareSplitSize:function(){return yg},segment_util:function(){return Rg},shouldFuse:function(){return Yf},slice_util:function(){return iv},splitRealAndImagArrays:function(){return tg},stridesOrDilationsArePositive:function(){return Sc},tupleValuesAreOne:function(){return kc},upcastType:function(){return zo},validateDefaultValueShape:function(){return Lv},validateInput:function(){return Mf},validateUpdateShape:function(){return Df},warn:function(){return Fi}}),function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(Av||(Av={}));var zv=30;function Bv(e){return e<=zv?e:Jt(e,Math.floor(Math.sqrt(e)))}function Wv(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function Uv(e,t,n){var r=[];if(!(arguments.length>3&&void 0!==arguments[3])||arguments[3])(r=r.concat(t.slice(0))).push(e[0]/n),r=r.concat(e.slice(1));else{r=r.concat(e[0]);for(var a=t.length,i=0;i<a;++i)r=r.concat([e[i+1]/t[i],t[i]]);r=r.concat(e.slice(a+1))}return r}function Vv(e,t){var n=[];if(!(arguments.length>2&&void 0!==arguments[2])||arguments[2]){n.push(t);for(var r=t+1;r<e;++r)r<=2*t?(n.push(r),n.push(r-(t+1))):n.push(r)}else{for(var a=[],i=[],o=1;o<e;++o)o>=2*t+1||o%2===1?i.push(o):a.push(o);n.push.apply(n,a),n.push(0),n.push.apply(n,i)}return n}function jv(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function Gv(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Hv(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var qv=1.7580993408473768,Kv=1.0507009873554805,Xv=.3275911,Yv=.254829592,Qv=-.284496736,Zv=1.421413741,Jv=-1.453152027,$v=1.061405429;function eg(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function tg(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}function ng(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function rg(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}function ag(e,t){return{real:e[2*t],imag:e[2*t+1]}}function ig(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function og(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}function sg(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var ug="->",cg=/->/g,lg=",",pg="...";function dg(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(cg,"").length)/ug.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(ug,'").'));var r=o(e.split(ug),2),a=r[0],i=r[1];_t(-1===a.indexOf(pg),(function(){return'The ellipsis notation ("'.concat(pg,'") is not supported yet.')}));var s=a.split(lg),u=s.length;if(t!==u)throw new Error("Expected ".concat(u," input tensors, received ").concat(t));if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var c=[],l=function(){var e=i[p];if(!s.some((function(t){return-1!==t.indexOf(e)})))throw new Error("Output subscripts contain the label ".concat(e," not present in the input subscripts."));-1===c.indexOf(e)&&c.push(e)},p=0;p<i.length;++p)l();for(var d=0;d<a.length;++d){var f=a[d];-1===c.indexOf(f)&&f!==lg&&c.push(f)}for(var h=new Array(s.length),m=0;m<u;++m){if(new Set(s[m].split("")).size!==s[m].length)throw new Error("Found duplicate axes in input component ".concat(s[m],". Support for duplicate axes in input is not implemented yet."));h[m]=[];for(var v=0;v<s[m].length;++v)h[m].push(c.indexOf(s[m][v]))}for(var g=c.length,y=[],b=i.length;b<g;++b)y.push(b);return{allDims:c,summedDims:y,idDims:h}}function fg(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return n=n.filter((function(e){return-1!==e})),{permutationIndices:n,expandDims:a}}function hg(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:_t(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," of input shaped ").concat(JSON.stringify(a),", but got dimension ").concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function mg(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=De(gg(t,r[s]));try{for(c.s();!(u=c.n()).done;){var l=u.value;-1===o.indexOf(l)&&(a[s].push(l),o.push(l))}}catch(p){c.e(p)}finally{c.f()}}return{path:r,steps:a}}function vg(e){return e.every((function(e,t){return e===t}))}function gg(e,t){for(var n=[],r=0;r<e.length;++r)(0===e[r].length||-1!==e[r].indexOf(t)||-1===t)&&n.push(r);return n}function yg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)_t(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);_t(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}_t(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function bg(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function xg(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function kg(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function wg(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function Sg(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function Ig(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function _g(e,t){var n=Tt(e),r=Tt(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}function Ng(e,t){var n=Tt(e),r=Tt(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}function Cg(){return"segment ids must be >= 0"}function Tg(){return"segment ids are not increasing"}function Eg(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function Ag(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}var Rg={};function Fg(e,t){var n,r=!1;for(e<=zv?(n=e,r=!0):n=Jt(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Jt(e,n+1);return n}function Dg(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}function Mg(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,p=1,d=0;d<r;++d)u.push(e.shape[d]),c*=e.shape[d];for(var f=r;f<n;f++)u.push(e.shape[f]),l*=e.shape[f];for(var h=r;h<a;h++)u.push(t.shape[h]);for(var m=n+1;m<i;m++)u.push(e.shape[m]),p*=e.shape[m];return{batchSize:c,sliceSize:p,outerSize:l,dimSize:s,outputShape:u}}function Og(e){try{return e.map((function(e){return po(e)}))}catch(w){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(w))}}function Pg(e){return e.map((function(e){return lo(e)}))}He(Rg,{collectGatherOpShapeInfo:function(){return Mg},computeOutShape:function(){return Dg},segOpComputeOptimalWindowSize:function(){return Fg}});var Lg={};He(Lg,{nonMaxSuppressionV3Impl:function(){return fh},nonMaxSuppressionV4Impl:function(){return hh},nonMaxSuppressionV5Impl:function(){return mh},whereImpl:function(){return _f}}),function(){for(var e=0,t=ym;e<t.length;e++){cm(t[e])}}();var zg={kernelName:bn,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(e,cf(Iu(n,"float32"),-1))}}}},Bg={kernelName:xn,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){var t=zl(Iu(n,"float32")),r=Ll(bp(Pl(1),t));return vp(Qu(e,r))}}}},Wg={kernelName:kn,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){var t=Ll(bp(zl(Iu(n,"float32")),1));return Qu(e,t)}}}},Ug={kernelName:wn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=e,n=ml(r.shape,i);return n.length>0&&(t=Bl(t,n)),Nc(t,r.shape)},b:function(){var t=e,n=ml(a.shape,i);return n.length>0&&(t=Bl(t,n)),Nc(t,a.shape)}}}},Vg={kernelName:Sn,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},jg={kernelName:Nn,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return bl(n)}}}},Gg={kernelName:Cn,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return bl(n)}}}},Hg={kernelName:Tn,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Qu(e,Ll(bp(Pl(1),zl(Iu(n,"float32")))))}}}},qg={kernelName:En,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){var t=Ll(Xu(Pl(1),zl(Iu(n,"float32"))));return Qu(e,t)}}}},Kg={kernelName:Fn,inputsToSave:["a","b"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=Xu(zl(r),zl(a)),n=Zu(e,Qu(a,t)),o=ml(r.shape,i);return o.length>0&&(n=Bl(n,o)),Nc(n,r.shape)},b:function(){var t=Xu(zl(r),zl(a)),n=vp(Zu(e,Qu(r,t))),o=ml(a.shape,i);return o.length>0&&(n=Bl(n,o)),Nc(n,a.shape)}}}},Xg={kernelName:An,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Qu(e,Xu(zl(Iu(n,"float32")),1))}}}},Yg={kernelName:Rn,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Qu(e,bp(Pl(1),zl(Iu(n,"float32"))))}}}};var Qg=cs({avgPool3dGrad_:function(e,t,n,r,a,i){var o=os(e,"dy","avgPool3dGrad"),s=os(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=Nc(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),_t(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank ".concat(u.rank,".")})),_t(5===c.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank ".concat(c.rank,".")})),_c("avgPool3dGrad",a,i);var p={dy:u,input:c},d={filterSize:n,strides:r,pad:a,dimRoundingMode:i},f=Yo.runKernel(Pn,p,d);return l?Nc(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),Zg={kernelName:On,inputsToSave:["x"],gradFunc:function(e,t,n){var r=o(t,1)[0],a=n.filterSize,i=n.strides,s=n.pad,u=n.dimRoundingMode;return{x:function(){return Qg(e,r,a,i,s,u)}}}};var Jg=cs({avgPoolGrad_:function(e,t,n,r,a){var i=os(e,"dy","avgPoolGrad"),o=os(t,"input","avgPoolGrad");_t(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=Nc(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Nc(i,[1,i.shape[0],i.shape[1],i.shape[2]])),_t(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank ".concat(u.rank,".")})),_t(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank ".concat(s.rank,".")}));var l={dy:u,input:s},p={filterSize:n,strides:r,pad:a},d=Yo.runKernel(Mn,l,p);return c?Nc(d,[d.shape[1],d.shape[2],d.shape[3]]):d}}),$g={kernelName:Dn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=o(t,1)[0],a=n.filterSize,i=n.strides,s=n.pad;return{x:function(){return Jg(e,r,a,i,s)}}}},ey={kernelName:Ln,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=o(t,2),a=r[0],i=r[1],s=n.transposeA,u=n.transposeB;return s||u?!s&&u?{a:function(){return Ac(e,i,!1,!1)},b:function(){return Ac(e,a,!0,!1)}}:s&&!u?{a:function(){return Ac(i,e,!1,!0)},b:function(){return Ac(a,e,!1,!1)}}:{a:function(){return Ac(i,e,!0,!0)},b:function(){return Ac(e,a,!0,!0)}}:{a:function(){return Ac(e,i,!1,!0)},b:function(){return Ac(a,e,!0,!1)}}}},ty={kernelName:zn,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return Jp(e,r,a)}}}},ny={kernelName:Wn,gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return Bl(e,u,!0)}}}},ry={kernelName:Vn,gradFunc:function(e){return{x:function(){return e.clone()}}}},ay={kernelName:jn,gradFunc:function(e){return{x:function(){return bl(e)}}}},iy={kernelName:Gn,inputsToSave:["x"],gradFunc:function(e,t,n){var r=o(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return yl(wp(Zl(r,a),ap(r,i)),e,bl(e))}}}},oy={kernelName:qn,inputsToSave:["x"],gradFunc:zg.gradFunc},sy={kernelName:Kn,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=zt(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return rf(e,i,a).map((function(e){return function(){return e}}))}},uy={kernelName:Xn,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=o(t,2),a=r[0],i=r[1],s=n.dilations,u=n.strides,c=n.pad,l=n.dataFormat;return _t(kc(s),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(s,"'")})),{x:function(){return $c(a.shape,e,i,u,c,l)},filter:function(){return Hf(a,e,i.shape,u,c,l)}}}},cy={kernelName:Qn,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=o(t,2),a=r[0],i=r[1],s=n.strides,u=n.pad,c=n.dataFormat,l=n.dimRoundingMode;return{dy:function(){return Zc(e,i,s,u,c,1,l)},filter:function(){return Hf(e,a,i.shape,s,u,c,l)}}}};var ly=cs({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=Nc(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=Nc(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),_t(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape ".concat(i.shape,".")})),_t(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape ".concat(o.shape,".")})),_t(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got ".concat(n,".")})),_t(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must match input depth in filter (").concat(n[3],".")})),_t(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must match output depth for filter (").concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return Yo.runKernel(Jn,s,u)}}),py={kernelName:Zn,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;_t(kc(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(r,"'")}));var s=o(t,2),u=s[0],c=s[1];return{x:function(){return nl(u.shape,e,c,a,i)},filter:function(){return ly(u,e,c.shape,a,i)}}}},dy={kernelName:er,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(vp(Kd(Iu(n,"float32"))),e)}}}},fy={kernelName:tr,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(Xd(Iu(n,"float32")),e)}}}},hy={kernelName:rr,inputsToSave:["x"],gradFunc:function(e,t,n){var r=o(t,1)[0],a=n.axis,i=n.exclusive,s=n.reverse;return{x:function(){var t=Al([a],r.rank),n=sl(e,a,i,!s);return null!=t&&(n=Af(n,t)),n}}}},my={kernelName:sr,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,s=n.dimRoundingMode,u=null==r?[1,1]:r;_t(kc(u),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '".concat(u,"'")}));var c=o(t,2),l=c[0],p=c[1];return _t(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ".concat(l.rank,".")})),_t(4===p.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ".concat(p.rank,".")})),_t(l.shape[3]===p.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input channels (".concat(l.shape[3],") must match the inChannels dimension in filter ").concat(p.shape[2],".")})),_t(wc(a,u),(function(){return"Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ".concat(a," and dilations '").concat(u,"'.")})),_c("depthwiseConv2d",i,s),{x:function(){return Jf(l.shape,e,p,a,i,u,s)},filter:function(){return Zf(l,e,p.shape,a,i,u,s)}}}},vy={kernelName:pr,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=o(t,2),a=r[0],i=r[1],s={x:a,filter:i,dy:e},u={x:a,filter:i,dy:e};return{x:function(){return Yo.runKernel(dr,s,n)},filter:function(){return Yo.runKernel(fr,u,n)}}}},gy={kernelName:vr,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:o(t,1)[0]};return{x:function(){return Yo.runKernel(gr,n)}}}},yy={kernelName:yr,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0],r=Zu(jl(vp(zl(n))),2/Math.sqrt(Math.PI));return{x:function(){return Zu(e,r)}}}},by={kernelName:xr,outputsToSave:[!0],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(e,n)}}}},xy={kernelName:kr,inputsToSave:["input"],gradFunc:function(e,t){var n=o(t,1)[0];return{input:function(){return Nc(e,n.shape)}}}},ky={kernelName:wr,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(e,jl(n))}}}},wy={kernelName:Nr,gradFunc:function(e){return{x:function(){return bl(e)}}}},Sy={kernelName:Cr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=Qu(e,Iu(a,"float32")),n=ml(r.shape,i);return n.length>0?Nc(Bl(t,n),r.shape):t},b:function(){var t=Zu(e,Iu(r,"float32")),n=ml(a.shape,i);n.length>0&&(t=Nc(Bl(t,n),a.shape));var o=zl(a);return vp(Qu(t,Iu(o,"float32")))}}}},Iy={kernelName:Tr,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=o(t,4),i=a[0],s=a[1],u=a[2],c=a[3],l=null==c?Pl(1):c,p=ml(s.shape,i.shape),d=[];if(1===s.rank){for(var f=0;f<i.shape.length-1;++f)d.push(i.shape[f]);d.push(1)}var h=bp(i,s),m=Zu(e,l),v=Ud(Xu(u,Pl(r))),g=Zu(Zu(Zu(v,v),v),Pl(-.5));return{x:function(){return 1===s.rank?Nc(Zu(Zu(e,ql(Nc(v,[1,1,1,s.shape[0]]),d)),l),i.shape):Nc(Zu(Zu(e,v),l),i.shape)},mean:function(){var e=Zu(Zu(v,Pl(-1)),m);return 1===s.rank&&(e=Bl(e,p)),Nc(e,s.shape)},variance:function(){var e=Zu(Zu(g,h),m);return 1===s.rank&&(e=Bl(e,p)),Nc(e,s.shape)},scale:function(){var t=Zu(h,v),n=Zu(e,t);return 1===s.rank&&(n=Bl(n,p)),Nc(n,s.shape)},offset:function(){var t=e;return 1===s.rank&&(t=Bl(t,p)),Nc(t,s.shape)}}}},_y={kernelName:Er,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=o(t,2),a=r[0],i=r[1],s=n.axis,u=zt(s,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,u),o=r.length,c=t.slice(s,t.length).slice(1),l=c.length,p=Ny(0,o),d=Ny(o+1,o+1+l),f=Cy([r,[n],c]),h=Nc(e,f),m=Nc(i,[n]),v=Cy([[o],p,d]),g=Af(h,v),y=kf(g,m,a.shape[u]),b=Rl(v);return y=Af(y,b)},indices:function(){return i}}}};function Ny(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function Cy(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var Ty={kernelName:Fr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1];return{a:function(){return bl(r)},b:function(){return bl(a)}}}},Ey={kernelName:Dr,gradFunc:function(e){return{x:function(){return Iu(e,"float32")}}}},Ay={kernelName:Pr,gradFunc:function(e){return{x:function(){return bl(e)}}}},Ry={kernelName:Lr,gradFunc:function(e){return{x:function(){return bl(e)}}}},Fy={kernelName:zr,gradFunc:function(e){return{x:function(){return bl(e)}}}},Dy={kernelName:Br,inputsToSave:["x"],gradFunc:function(e,t,n){var r=o(t,1)[0],a=n.alpha,i=Ql(r,0);return{x:function(){return yl(i,e,Zu(e,a))}}}},My={kernelName:Gr,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Qu(e,Xu(n,1))}}}},Oy={kernelName:jr,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Qu(e,Iu(n,"float32"))}}}},Py={kernelName:Yr,inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=o(t,1)[0],a=n.axis;return{logits:function(){var t=jl(r);return bp(e,Zu(Bl(e,a,!0),t))}}}};var Ly=cs({localResponseNormalizationBackprop_:function(e,t,n){var r={x:e,y:t,dy:n},a={depthRadius:arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,bias:arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,alpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,beta:arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5};return Yo.runKernel(Jr,r,a)}}),zy={kernelName:Zr,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=o(t,2),a=r[0],i=r[1],s=n.depthRadius,u=n.bias,c=n.alpha,l=n.beta;return{x:function(){return Ly(a,i,e,s,u,c,l)}}}};function By(e,t,n,r){return t.rank<n.rank&&(t=Nc(t,Tl(t.shape,r))),e.rank<n.rank&&(e=Nc(e,Tl(e.shape,r))),{x:function(){return Zu(e,Iu(gl(n,t),e.dtype))}}}var Wy={kernelName:$r,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=By(e,t[1],a,zt(r,a.shape));return{x:function(){return i.x()}}}},Uy={kernelName:ea,inputsToSave:["a","b"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1];return{a:function(){return Zu(e,Iu(Zl(r,a),"float32"))},b:function(){return Zu(e,Iu(rp(r,a),"float32"))}}}};var Vy=cs({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=os(e,"dy","maxPool3dGrad"),u=os(t,"input","maxPool3dGrad"),c=os(n,"output","maxPool3dGrad"),l=s,p=u,d=c,f=!1;4===u.rank&&(f=!0,l=Nc(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),p=Nc(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),d=Nc(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),_t(5===l.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank ".concat(l.rank,".")})),_t(5===p.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank ".concat(p.rank,".")})),_t(5===d.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank ".concat(d.rank,".")})),_c("maxPool3dGrad",i,o);var h={dy:l,input:p,output:d},m={filterSize:r,strides:a,pad:i,dimRoundingMode:o},v=Yo.runKernel(aa,h,m);return f?Nc(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}}),jy={kernelName:ra,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=o(t,2),a=r[0],i=r[1],s=n.filterSize,u=n.strides,c=n.pad,l=n.dimRoundingMode;return{x:function(){return Vy(e,a,i,s,u,c,l)}}}};var Gy=cs({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=os(e,"dy","maxPoolGrad"),u=os(t,"input","maxPoolGrad"),c=os(n,"output","maxPoolGrad");_t(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy (").concat(s.rank,")")})),_t(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank ".concat(s.rank,".")})),_t(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank ".concat(u.rank,".")})),_c("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},p={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return Yo.runKernel(na,l,p)}}),Hy={kernelName:ta,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=o(t,2),a=r[0],i=r[1],s=n.filterSize,u=n.strides,c=n.pad;return{x:function(){return Gy(e,a,i,s,u,c)}}}},qy={kernelName:oa,inputsToSave:["x"],gradFunc:function(e,t,n){var r=o(t,1)[0],a=zt(n.axis,r.shape),i=Tt(Cl(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=Nc(e,t);return Qu(Zu(n,Op(r.shape,"float32")),i)}}}},Ky={kernelName:sa,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=o(t,2),i=a[0],s=By(e,a[1],i,zt(r,i.shape));return{x:function(){return s.x()}}}},Xy={kernelName:ua,inputsToSave:["a","b"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1];return{a:function(){return Zu(e,Iu(ap(r,a),"float32"))},b:function(){return Zu(e,Iu(Ql(r,a),"float32"))}}}},Yy={kernelName:ca,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Fc(e,a,r.shape)}}}},Qy={kernelName:la,inputsToSave:["a","b"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=ml(r.shape,i);return t.length>0?Nc(Bl(e,t),r.shape):e},b:function(){var t=Zu(e,vp(Xl(Qu(r,a)))),n=ml(a.shape,i);return n.length>0?Nc(Bl(t,n),a.shape):t}}}},Zy={kernelName:da,inputsToSave:["a","b"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=Zu(e,Iu(a,"float32")),n=ml(r.shape,i);return n.length>0?Nc(Bl(t,n),r.shape):t},b:function(){var t=Zu(e,Iu(r,"float32")),n=ml(a.shape,i);return n.length>0?Nc(Bl(t,n),a.shape):t}}}},Jy={kernelName:fa,gradFunc:function(e){return{x:function(){return vp(e)}}}},$y={kernelName:ba,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return Mp(n.shape,"float32")}}}},eb={kernelName:ya,gradFunc:function(e){return{x:function(){return bl(e)}}}},tb={kernelName:xa,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return wf(e,r).map((function(e){return function(){return e}}))}},nb={kernelName:ka,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Fc(e,a,r.shape)}}}},rb={kernelName:Sa,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=o(t,3),r=n[0],a=n[1],i=n[2],s=r,u=a,c=vl(s.shape,u.shape);return{a:function(){var t=Iu(u,"float32"),n=Zu(e,Zu(t,Ol(s,bp(t,Pl(1))))),r=ml(s.shape,c);return r.length>0&&(n=Bl(n,r)),Nc(n,s.shape)},b:function(){var t=Ql(s,0),n=yl(t,sp(s),bl(s)),r=Zu(e,Zu(i,n)),a=ml(u.shape,c);return a.length>0&&(r=Bl(r,a)),Nc(r,u.shape)}}}},ab={kernelName:Ia,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1],i=Ql(r,0);return{x:function(){return yl(i,e,Zu(e,a))},alpha:function(){var t=yl(i,bl(e),Zu(e,r)),n=ml(a.shape,e.shape);return n.length>0&&(t=Bl(t,n)),Nc(t,a.shape)}}}};function ib(e,t,n){var r=e.shape.length,a=r-n.length,i=Rv.getAxesPermutation(n,r),o=e;null!=i&&(o=Af(e,i));var s=o.shape.slice(),u=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(u);var c=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=Nc(t,r),i=ol(e,n,!0,!1),o=ol(e,n,!0,!0),s=Zu(i,o);return Zu(a,s)}(o.reshape(s),t,a);if(c=c.reshape(o.shape),null!=i){var l=Rv.getUndoAxesPermutation(i);c=Af(c,l)}return c}var ob={kernelName:_a,inputsToSave:["x"],gradFunc:function(e,t,n){var r=o(t,1)[0],a=n.axis,i=[];return i=null==a?r.shape.map((function(e,t){return t})):"number"==typeof a?[a]:a,{x:function(){return ib(r,e,i)}}}},sb={kernelName:hr,inputsToSave:["a","b"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=Qu(e,Iu(a,"float32")),n=ml(r.shape,i);return n.length>0?Nc(Bl(t,n),r.shape):t},b:function(){var t=Zu(e,Iu(r,"float32")),n=ml(a.shape,i);n.length>0&&(t=Nc(Bl(t,n),a.shape));var o=zl(a);return vp(Qu(t,Iu(o,"float32")))}}}},ub={kernelName:Ra,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Qu(e,vp(zl(n)))}}}},cb={kernelName:za,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0],r=Zu(ap(n,6),cf(n));return{x:function(){return Zu(e,Iu(r,"float32"))}}}},lb={kernelName:Fa,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(e,Iu(cf(n),"float32"))}}}},pb={kernelName:Da,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Nc(e,n.shape)}}}},db={kernelName:Pa,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:o(t,1)[0]};return{images:function(){return Yo.runKernel(La,r,n)}}}},fb={kernelName:Ma,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:o(t,1)[0]};return{images:function(){return Yo.runKernel(Oa,r,n)}}}},hb={kernelName:Ba,gradFunc:function(e,t,n){var r=zt(n.dims,e.shape);return{x:function(){return Od(e,r)}}}},mb={kernelName:Wa,gradFunc:function(e){return{x:function(){return bl(e)}}}},vb={kernelName:Ua,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return vp(Qu(e,Zu(Ol(n,1.5),2)))}}}},gb={kernelName:Ga,inputsToSave:["condition"],gradFunc:function(e,t){var n=o(t,1)[0];return{condition:function(){return Iu(bl(n),"float32")},t:function(){return Zu(e,Iu(n,e.dtype))},e:function(){return Zu(e,Iu(Sp(n),e.dtype))}}}},yb={kernelName:Ha,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){var t=Ql(n,Pl(0)),r=Pl(qv),a=Pl(Kv),i=Zu(e,a),o=Zu(Zu(e,r),jl(Iu(n,"float32")));return yl(t,i,o)}}}},bb={kernelName:Qa,outputsToSave:[!0],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(e,Zu(n,bp(Pl(1),n)))}}}},xb={kernelName:Ya,gradFunc:function(e){return{x:function(){return bl(e)}}}},kb={kernelName:Ka,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(al(Iu(n,"float32")),e)}}}},wb={kernelName:Xa,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(il(Iu(n,"float32")),e)}}}},Sb={kernelName:qa,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=o(t,1)[0],a=n.begin,i=n.size,s=r.shape,u=o(wv(r,a,i),2),c=u[0],l=u[1],p=[],d=0;d<e.rank;d++)p.push([c[d],s[d]-c[d]-l[d]]);return{x:function(){return Kp(e,p)}}}},Ib={kernelName:ni,outputsToSave:[!0],gradFunc:function(e,t,n){var r=o(t,1)[0],a=n.dim,i=Zu(e,r);return{logits:function(){return bp(i,Zu(Bl(i,[a],true),r))}}}},_b={kernelName:Za,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(e,Rc(n))}}}},Nb={kernelName:ei,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return Oc(e,r,a)}}}},Cb={kernelName:ti,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Ec(e,r)}}}},Tb={kernelName:Ja,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Qu(e,Zu(Ll(Iu(n,"float32")),2))}}}},Eb={kernelName:ci,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(e,Zu(Iu(n,"float32"),2))}}}},Ab={kernelName:ui,inputsToSave:["a","b"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1],i=Pl(2);return{a:function(){return Zu(e,Zu(i,bp(r,a)))},b:function(){return Zu(e,Zu(i,bp(a,r)))}}}},Rb={kernelName:Ni,gradFunc:function(e){return{x:function(){return bl(e)}}}},Fb={kernelName:hi,inputsToSave:["a","b"],gradFunc:function(e,t){var n=o(t,2),r=n[0],a=n[1],i=vl(r.shape,a.shape);return{a:function(){var t=e,n=ml(r.shape,i);return n.length>0&&(t=Bl(t,n)),Nc(t,r.shape)},b:function(){var t=e,n=ml(a.shape,i);return n.length>0&&(t=Bl(t,n)),Nc(vp(t),a.shape)}}}},Db={kernelName:$a,inputsToSave:["x"],gradFunc:function(e,t,n){var r=o(t,1)[0],a=r.shape.slice();zt(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=Nc(e,a),s=Zu(i,Op(r.shape,"float32"));return{x:function(){return s}}}},Mb={kernelName:mi,inputsToSave:["x"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Qu(e,zl(al(n)))}}}},Ob={kernelName:vi,outputsToSave:[!0],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return Zu(bp(Pl(1),zl(n)),e)}}}},Pb={kernelName:gi,inputsToSave:["x"],gradFunc:function(e,t,n){var r=o(t,1)[0],a=n.reps;return{x:function(){var t=bl(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=Xu(t,Fc(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=Xu(t,Fc(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=Xu(t,Fc(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var p=0;p<a[1];++p)for(var d=0;d<a[2];++d)for(var f=0;f<a[3];++f)t=Xu(t,Fc(e,[l*r.shape[0],p*r.shape[1],d*r.shape[2],f*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},Lb={kernelName:xi,gradFunc:function(e,t,n){var r=Rl(n.perm);return{x:function(){return Af(e,r)}}}},zb={kernelName:wi,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return uf(e,r)}}}},Bb={kernelName:Si,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=o(t,1)[0];return{x:function(){return function(e,t){for(var n=Fp(t,bl(t)),r=Yl(e,n),a=Zl(t,Pl(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=Gl(a,o+1);a=wp(a,Op(r.shape,"bool"));var s=bl(r);return yl(a,r,s)}(e,n)}}}};for(var Wb={kernelName:_i,gradFunc:function(e){return{x:function(){return bl(e)}}}},Ub=0,Vb=[zg,Bg,Wg,Ug,Vg,jg,Gg,Hg,qg,Kg,Xg,Yg,Zg,$g,ey,ty,ny,ry,ay,iy,oy,sy,cy,uy,py,dy,fy,hy,my,vy,sb,gy,yy,by,xy,ky,Sy,wy,Iy,_y,Ty,Ey,Ay,Ry,Fy,Dy,My,Oy,Py,zy,Wy,Wy,Uy,jy,Hy,qy,Ky,Xy,Yy,Qy,Zy,Jy,$y,eb,tb,nb,nb,rb,ab,ob,ub,cb,lb,pb,db,fb,hb,mb,vb,gb,yb,bb,xb,kb,wb,Sb,Ib,_b,Nb,Nb,Cb,Cb,Tb,Ab,Eb,Rb,Fb,Db,Mb,Ob,Pb,Lb,zb,Bb,Wb];Ub<Vb.length;Ub++){Wi(Vb[Ub])}Eo().prototype.abs=function(){return this.throwIfDisposed(),Ju(this)},Eo().prototype.acos=function(){return this.throwIfDisposed(),$u(this)},Eo().prototype.acosh=function(){return this.throwIfDisposed(),ec(this)},Eo().prototype.add=function(e){return this.throwIfDisposed(),Xu(this,e)},Eo().prototype.all=function(e,t){return this.throwIfDisposed(),nc(this,e,t)},Eo().prototype.any=function(e,t){return this.throwIfDisposed(),rc(this,e,t)},Eo().prototype.argMax=function(e){return this.throwIfDisposed(),ac(this,e)},Eo().prototype.argMin=function(e){return this.throwIfDisposed(),ic(this,e)},Eo().prototype.asScalar=function(){return this.throwIfDisposed(),_t(1===this.size,(function(){return"The array must have only 1 element."})),Nc(this,[])},Eo().prototype.asType=function(e){return this.throwIfDisposed(),Iu(this,e)},Eo().prototype.as1D=function(){return this.throwIfDisposed(),Nc(this,[this.size])},Eo().prototype.as2D=function(e,t){return this.throwIfDisposed(),Nc(this,[e,t])},Eo().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),Nc(this,[e,t,n])},Eo().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),Nc(this,[e,t,n,r])},Eo().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),Nc(this,[e,t,n,r,a])},Eo().prototype.asin=function(){return this.throwIfDisposed(),oc(this)},Eo().prototype.asinh=function(){return this.throwIfDisposed(),sc(this)},Eo().prototype.atan=function(){return this.throwIfDisposed(),uc(this)},Eo().prototype.atan2=function(e){return this.throwIfDisposed(),cc(this,e)},Eo().prototype.atanh=function(){return this.throwIfDisposed(),lc(this)},Eo().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),Cc(this,e,t,n,r)},Eo().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Oc(this,e,t)},Eo().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),Lc(this,e,t,n,r,a)},Eo().prototype.broadcastTo=function(e){return this.throwIfDisposed(),jc(this,e)},Eo().prototype.cast=function(e){return this.throwIfDisposed(),Iu(this,e)},Eo().prototype.ceil=function(){return this.throwIfDisposed(),Gc(this)},Eo().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),qc(this,e,t)},Eo().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof To&&(e=[e]),Ec([this].concat(Fe(e)),t)},Eo().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Jc(this,e,t,n,r,a,i)},Eo().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),el(this,e,t,n,r,a)},Eo().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),Zc(this,e,t,n,r,a,i)},Eo().prototype.cos=function(){return this.throwIfDisposed(),al(this)},Eo().prototype.cosh=function(){return this.throwIfDisposed(),il(this)},Eo().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),ol(this,e,t,n)},Eo().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),sl(this,e,t,n)},Eo().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),cl(this,e,t)},Eo().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),ll(this,e,t,n,r,a,i)},Eo().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),dl(this,e,t,n,r,a)},Eo().prototype.divNoNan=function(e){return this.throwIfDisposed(),xl(this,e)},Eo().prototype.div=function(e){return this.throwIfDisposed(),Qu(this,e)},Eo().prototype.dot=function(e){return this.throwIfDisposed(),kl(this,e)},Eo().prototype.elu=function(){return this.throwIfDisposed(),Sl(this)},Eo().prototype.equal=function(e){return this.throwIfDisposed(),gl(this,e)},Eo().prototype.erf=function(){return this.throwIfDisposed(),Il(this)},Eo().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),Vl(this,e,t)},Eo().prototype.exp=function(){return this.throwIfDisposed(),jl(this)},Eo().prototype.expandDims=function(e){return this.throwIfDisposed(),Gl(this,e)},Eo().prototype.expm1=function(){return this.throwIfDisposed(),Hl(this)},Eo().prototype.fft=function(){return this.throwIfDisposed(),ef(this)},Eo().prototype.flatten=function(){return this.throwIfDisposed(),Nc(this,[this.size])},Eo().prototype.floor=function(){return this.throwIfDisposed(),Xl(this)},Eo().prototype.floorDiv=function(e){return this.throwIfDisposed(),Yu(this,e)},Eo().prototype.gather=function(e,t){return this.throwIfDisposed(),Yl(this,e,t)},Eo().prototype.greaterEqual=function(e){return this.throwIfDisposed(),Zl(this,e)},Eo().prototype.greater=function(e){return this.throwIfDisposed(),Ql(this,e)},Eo().prototype.ifft=function(){return this.throwIfDisposed(),tf(this)},Eo().prototype.irfft=function(){return this.throwIfDisposed(),nf(this)},Eo().prototype.isFinite=function(){return this.throwIfDisposed(),$l(this)},Eo().prototype.isInf=function(){return this.throwIfDisposed(),ep(this)},Eo().prototype.isNaN=function(){return this.throwIfDisposed(),tp(this)},Eo().prototype.leakyRelu=function(e){return this.throwIfDisposed(),np(this,e)},Eo().prototype.lessEqual=function(e){return this.throwIfDisposed(),ap(this,e)},Eo().prototype.less=function(e){return this.throwIfDisposed(),rp(this,e)},Eo().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),op(this,e,t,n,r)},Eo().prototype.logSigmoid=function(){return this.throwIfDisposed(),yp(this)},Eo().prototype.logSoftmax=function(e){return this.throwIfDisposed(),xp(this,e)},Eo().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),kp(this,e,t)},Eo().prototype.log=function(){return this.throwIfDisposed(),sp(this)},Eo().prototype.log1p=function(){return this.throwIfDisposed(),up(this)},Eo().prototype.logicalAnd=function(e){return this.throwIfDisposed(),wp(this,e)},Eo().prototype.logicalNot=function(){return this.throwIfDisposed(),Sp(this)},Eo().prototype.logicalOr=function(e){return this.throwIfDisposed(),Ip(this,e)},Eo().prototype.logicalXor=function(e){return this.throwIfDisposed(),_p(this,e)},Eo().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),Ac(this,e,t,n)},Eo().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Ep(this,e,t,n,r)},Eo().prototype.max=function(e,t){return this.throwIfDisposed(),Dl(this,e,t)},Eo().prototype.maximum=function(e){return this.throwIfDisposed(),Fp(this,e)},Eo().prototype.mean=function(e,t){return this.throwIfDisposed(),Dp(this,e,t)},Eo().prototype.min=function(e,t){return this.throwIfDisposed(),Ml(this,e,t)},Eo().prototype.minimum=function(e){return this.throwIfDisposed(),Lp(this,e)},Eo().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),zp(this,e,t)},Eo().prototype.mod=function(e){return this.throwIfDisposed(),Bp(this,e)},Eo().prototype.mul=function(e){return this.throwIfDisposed(),Zu(this,e)},Eo().prototype.neg=function(){return this.throwIfDisposed(),vp(this)},Eo().prototype.norm=function(e,t,n){return this.throwIfDisposed(),Ul(this,e,t,n)},Eo().prototype.notEqual=function(e){return this.throwIfDisposed(),jp(this,e)},Eo().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),Gp(this,e,t,n)},Eo().prototype.onesLike=function(){return this.throwIfDisposed(),Hp(this)},Eo().prototype.pad=function(e,t){return this.throwIfDisposed(),Kp(this,e,t)},Eo().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),$p(this,e,t,n,r,a,i)},Eo().prototype.pow=function(e){return this.throwIfDisposed(),Ol(this,e)},Eo().prototype.prelu=function(e){return this.throwIfDisposed(),ed(this,e)},Eo().prototype.prod=function(e,t){return this.throwIfDisposed(),td(this,e,t)},Eo().prototype.reciprocal=function(){return this.throwIfDisposed(),Fd(this)},Eo().prototype.relu=function(){return this.throwIfDisposed(),Dd(this)},Eo().prototype.relu6=function(){return this.throwIfDisposed(),Md(this)},Eo().prototype.reshapeAs=function(e){return this.throwIfDisposed(),Nc(this,e.shape)},Eo().prototype.reshape=function(e){return this.throwIfDisposed(),Nc(this,e)},Eo().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Th(this,e,t,n)},Eo().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),Eh(this,e,t,n)},Eo().prototype.reverse=function(e){return this.throwIfDisposed(),Od(this,e)},Eo().prototype.rfft=function(){return this.throwIfDisposed(),af(this)},Eo().prototype.round=function(){return this.throwIfDisposed(),Wd(this)},Eo().prototype.rsqrt=function(){return this.throwIfDisposed(),Ud(this)},Eo().prototype.selu=function(){return this.throwIfDisposed(),Vd(this)},Eo().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),jd(this,e,t,n,r,a,i)},Eo().prototype.sigmoid=function(){return this.throwIfDisposed(),Rc(this)},Eo().prototype.sign=function(){return this.throwIfDisposed(),qd(this)},Eo().prototype.sin=function(){return this.throwIfDisposed(),Kd(this)},Eo().prototype.sinh=function(){return this.throwIfDisposed(),Xd(this)},Eo().prototype.slice=function(e,t){return this.throwIfDisposed(),Fc(this,e,t)},Eo().prototype.softmax=function(e){return this.throwIfDisposed(),$d(this,e)},Eo().prototype.softplus=function(){return this.throwIfDisposed(),gp(this)},Eo().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Jp(this,e,t)},Eo().prototype.split=function(e,t){return this.throwIfDisposed(),rf(this,e,t)},Eo().prototype.sqrt=function(){return this.throwIfDisposed(),Ll(this)},Eo().prototype.square=function(){return this.throwIfDisposed(),zl(this)},Eo().prototype.squaredDifference=function(e){return this.throwIfDisposed(),of(this,e)},Eo().prototype.squeeze=function(e){return this.throwIfDisposed(),sf(this,e)},Eo().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof To?[this,e]:[this].concat(Fe(e));return uf(n,t)},Eo().prototype.step=function(e){return this.throwIfDisposed(),cf(this,e)},Eo().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),lf(this,e,t,n,r,a,i,o,s)},Eo().prototype.sub=function(e){return this.throwIfDisposed(),bp(this,e)},Eo().prototype.sum=function(e,t){return this.throwIfDisposed(),Bl(this,e,t)},Eo().prototype.tan=function(){return this.throwIfDisposed(),pf(this)},Eo().prototype.tanh=function(){return this.throwIfDisposed(),Dc(this)},Eo().prototype.tile=function(e){return this.throwIfDisposed(),ql(this,e)},Eo().prototype.toBool=function(){return this.throwIfDisposed(),Iu(this,"bool")},Eo().prototype.toFloat=function(){return this.throwIfDisposed(),Iu(this,"float32")},Eo().prototype.toInt=function(){return this.throwIfDisposed(),Iu(this,"int32")},Eo().prototype.topk=function(e,t){return this.throwIfDisposed(),yf(this,e,t)},Eo().prototype.transpose=function(e){return this.throwIfDisposed(),Af(this,e)},Eo().prototype.unique=function(e){return this.throwIfDisposed(),xf(this,e)},Eo().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),kf(this,e,t)},Eo().prototype.unstack=function(e){return this.throwIfDisposed(),wf(this,e)},Eo().prototype.where=function(e,t){return this.throwIfDisposed(),yl(e,this,t)},Eo().prototype.zerosLike=function(){return this.throwIfDisposed(),bl(this)};var jb=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),r=t.call(this,e),Object.setPrototypeOf(Ie(r),n.prototype),r}return v(n)}(Te(Error)),Gb=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),r=t.call(this,e),Object.setPrototypeOf(Ie(r),n.prototype),r}return v(n)}(Te(Error)),Hb=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),r=t.call(this,e),Object.setPrototypeOf(Ie(r),n.prototype),r}return v(n)}(Te(Error)),qb=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),r=t.call(this,e),Object.setPrototypeOf(Ie(r),n.prototype),r}return v(n)}(Te(Error)),Kb=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),r=t.call(this,e),Object.setPrototypeOf(Ie(r),n.prototype),r}return v(n)}(Te(Error)),Xb=function(){function e(t){h(this,e),this.maxEntries=t||100,this.cache=new Map}return v(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}();function Yb(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function Qb(e,t){if(!e)throw new Kb(t)}function Zb(e,t){var n,r=0,a=De(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(i){a.e(i)}finally{a.f()}return r}function Jb(e){return 1===e.length?e[0]:e}function $b(e){return Array.isArray(e)?e:[e]}function ex(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function tx(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var nx={};function rx(e){if(null==e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function ax(e){if(null!=e&&"object"==typeof e)if(Array.isArray(e))e.forEach((function(e){return ax(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"==typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!=typeof a.value?ax(a):e[r]=a.value)}}function ix(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"==typeof e){var i,s=e;if(s in n)i=n[s];else if(s in nx)i=nx[s];else if(null==(i=t[s]))throw new Hb("Unknown ".concat(r,": ").concat(e,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));return i}var u,c,l,p=e;if(null==p.className||null==p.config)throw new Hb("".concat(r,": Improper config format: ").concat(JSON.stringify(p),".\n'className' and 'config' must set."));var d,f,h=p.className;if(h in n?(d=(u=o(n[h],2))[0],f=u[1]):h in nx?(d=(c=o(nx.className,2))[0],f=c[1]):h in t&&(d=(l=o(t[h],2))[0],f=l[1]),null==d)throw new Hb("Unknown ".concat(r,": ").concat(h,". This may be due to one of the following reasons:\n1. The ").concat(r," is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ").concat(r," is defined in JavaScript, but is not registered properly with tf.serialization.registerClass()."));if(null!=f){for(var m={},v=0,g=Object.keys(nx);v<g.length;v++){var y=g[v];m[y]=nx[y]}for(var b=0,x=Object.keys(n);b<x.length;b++){var k=x[b];m[k]=n[k]}p.config.customObjects=m;for(var w=Object.assign({},nx),S=0,I=Object.keys(n);S<I.length;S++){var _=I[S];nx[_]=n[_]}ax(p.config);var N=f(d,p.config,n,a);return nx=Object.assign({},w),N}for(var C=Object.assign({},nx),T=0,E=Object.keys(n);T<E.length;T++){var A=E[T];nx[A]=n[A]}var R=new d(p.config);return nx=Object.assign({},C),R}function ox(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function sx(e){if(null==e)return e;var t,n=[],r=De(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(i){r.e(i)}finally{r.f()}return n}function ux(e){if(null==e)throw new Hb("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function cx(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new Hb("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function lx(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return Qb(n>=0),Qb(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function px(e,t){Array.isArray(e)?(Hi.assert(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return px(e,"element ".concat(n+1," of ").concat(t))}))):Hi.assert(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ").concat(dx(e),".")}))}function dx(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return dx(e)})).join(",")+"]":"string"==typeof e?'"'.concat(e,'"'):"".concat(e)}function fx(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var hx=0;function mx(){return hx++}var vx={};function gx(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in vx||(vx[e]=0),vx[e]+=1,e+vx[e].toString()}var yx=["channelsFirst","channelsLast"],bx=["nearest","bilinear"],xx=["valid","same","causal"],kx=["max","avg"],wx=["sum","mul","concat","ave"],Sx=new Map;function Ix(e){cx(yx,"DataFormat",e)}function _x(e){cx(xx,"PaddingMode",e)}function Nx(e){cx(kx,"PoolMode",e)}var Cx=[],Tx="/";function Ex(e,t){Cx.push(e);try{var n=t();return Cx.pop(),n}catch(n){throw Cx.pop(),n}}function Ax(e){if(!Mx(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Cx.length?"":Cx.join(Tx)+Tx)+e}function Rx(e){if(!Mx(e))throw new Error("Not a valid tensor name: '"+e+"'");Sx.has(e)||Sx.set(e,0);var t=Sx.get(e);if(Sx.set(e,Sx.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return Sx.set(n,1),n}return e}var Fx,Dx=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Mx(e){return!!e.match(Dx)}function Ox(e){return e===parseInt(e.toString(),10)}function Px(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function Lx(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function zx(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function Bx(e,t){if(t<e)throw new Hb("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function Wx(){return null==Fx&&(Fx=qu().epsilon()),Fx}function Ux(e,t){return Iu(e,t)}function Vx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),Nc(e,n)}function jx(e,t,n){return Ou((function(){switch(e.rank){case 1:return Yd(e,t,n);case 2:return Qd(e,[t,0],[n,e.shape[1]]);case 3:return Zd(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Jd(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Fc(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Fc(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new Hb("sliceAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function Gx(e,t,n){return Ou((function(){switch(e.rank){case 1:return Yd(e,t,n);case 2:return Qd(e,[0,t],[e.shape[0],n]);case 3:return Zd(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Jd(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new Hb("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function Hx(e,t,n,r){return Ou((function(){switch(e.rank){case 1:return Yd(e,t,n);case 2:switch(r){case 1:return jx(e,t,n);case 2:return Gx(e,t,n);default:throw new Hb("The axis is not within the rank of the tensor ".concat(r))}case 3:switch(r){case 1:return jx(e,t,n);case 2:return Zd(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return Gx(e,t,n);default:throw new Hb("The axis is not within the rank of the tensor ".concat(r))}case 4:switch(r){case 1:return jx(e,t,n);case 2:return Jd(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Jd(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return Gx(e,t,n);default:throw new Hb("The axis is not within the rank of the tensor ".concat(r))}default:throw new Hb("sliceAlongLastAxis() received an unsupported tensor rank: ".concat(e.rank))}}))}function qx(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),Ec(e,n)}function Kx(e,t){switch(e.rank){case 1:return Kc([e,t]);case 2:return Xc([e,t],0);case 3:return Yc([e,t],0);case 4:return Qc([e,t],0);default:throw new Hb("concatAlongFirstAxis() received an unsupported tensor rank: ".concat(e.rank))}}function Xx(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new Hb("The length of input n (".concat(t.length,") does not match the number of dimensions in input x (").concat(e.rank,")"));return ql(e,t)}function Yx(e){return Cd(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0)}function Qx(e,t,n,r){if(e.rank<2||t.rank<2)throw new qb("dot requires both inputs to be rank >= 2 but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new qb("If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ".concat(e.shape," and  y shape = ").concat(t.shape));if(2===e.rank&&2===t.rank)return Gf.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?$x(e.rank,r,"channelsLast"):null,activation:n});var a=e.shape.slice(),i=a.pop();e=Nc(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat(Fe(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=Nc(Af(t,l),[u,-1]);var p=[].concat(Fe(a),Fe(c));return Nc(Gf.matMul({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?$x(e.rank,r,"channelsLast"):null,activation:n}),p)}function Zx(e,t,n){return Ou((function(){return t=Array.isArray(t)?df(t,"int32"):Iu(t,"int32"),Yl(e,t,n)}))}function Jx(e){return Zu(e,e)}function $x(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new Hb("Unexpected bias dimensions: ".concat(t.rank,"; expected it to be 1 or ").concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?Nc(t,[1,r[0],1,1,1]):Nc(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?Nc(t,[1,1,1,1,r[0]]):Nc(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?Nc(t,[1,r[0],1,1]):Nc(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?Nc(t,[1,1,1,r[0]]):Nc(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?Nc(t,[1,r[0],1]):Nc(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?Nc(t,[1,1,r[0]]):Nc(t,[1].concat(r))}else if(e<3)return t;throw new Hb("Unsupported input rank by biasAdd: ".concat(t.rank))}function ek(e,t,n){return Ou((function(){return null==n&&(n="channelsLast"),Ix(n),Xu(e,$x(e.rank,t,n))}))}function tk(e,t,n,r){return Ou((function(){return Bf(e,t,n,r)}))}function nk(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?e():t()}var rk=["fanIn","fanOut","fanAvg"],ak=["normal","uniform","truncatedNormal"];var ik=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(om.Serializable),ok=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e,t){return Mp(e,t)}}]),n}(ik);ok.className="Zeros",om.registerClass(ok);var sk=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e,t){return Op(e,t)}}]),n}(ik);sk.className="Ones",om.registerClass(sk);var uk=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),r=t.call(this),"object"!=typeof e)throw new Hb("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new Hb("config must have value set but got ".concat(e));return r.value=e.value,Ee(r)}return v(n,[{key:"apply",value:function(e,t){var n=this;return Ou((function(){return Zu(Pl(n.value),Op(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(ik);uk.className="Constant",om.registerClass(uk);var ck=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return v(n,[{key:"apply",value:function(e,t){return Ed(e,this.minval,this.maxval,t,this.seed)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(ik);ck.className="RandomUniform",om.registerClass(ck);var lk=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return v(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new qb("randomNormal does not support dType ".concat(t,"."));return Yx(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(ik);lk.className="RandomNormal",om.registerClass(lk);var pk=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return v(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new qb("truncatedNormal does not support dType ".concat(t,"."));return bf(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(ik);pk.className="TruncatedNormal",om.registerClass(pk);var dk=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return v(n,[{key:"apply",value:function(e,t){var n=this;return Ou((function(){if(2!==e.length||e[0]!==e[1])throw new Hb("Identity matrix initializer can only be used for 2D square matrices.");return Zu(n.gain,Kl(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(ik);dk.className="Identity",om.registerClass(dk);var fk=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),r=t.call(this),e.scale<0)throw new Hb("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,function(e){cx(rk,"FanMode",e)}(r.mode),r.distribution=null==e.distribution?"normal":e.distribution,function(e){cx(ak,"Distribution",e)}(r.distribution),r.seed=e.seed,Ee(r)}return v(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(Ix(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=Px(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=Px(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=Px(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new qb("".concat(this.getClassName()," does not support dType ").concat(t,"."));return bf(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return Ed(e,-s,s,t,this.seed)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(ik);fk.className="VarianceScaling",om.registerClass(fk);var hk=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return v(n,[{key:"getClassName",value:function(){return fk.className}}]),n}(fk);hk.className="GlorotUniform",om.registerClass(hk);var mk=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return v(n,[{key:"getClassName",value:function(){return fk.className}}]),n}(fk);mk.className="GlorotNormal",om.registerClass(mk);var vk=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return v(n,[{key:"getClassName",value:function(){return fk.className}}]),n}(fk);vk.className="HeNormal",om.registerClass(vk);var gk=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return v(n,[{key:"getClassName",value:function(){return fk.className}}]),n}(fk);gk.className="HeUniform",om.registerClass(gk);var yk=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return v(n,[{key:"getClassName",value:function(){return fk.className}}]),n}(fk);yk.className="LeCunNormal",om.registerClass(yk);var bk=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return v(n,[{key:"getClassName",value:function(){return fk.className}}]),n}(fk);bk.className="LeCunUniform",om.registerClass(bk);var xk=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new qb("Random seed is not implemented for Orthogonal Initializer yet.");return Ee(r)}return v(n,[{key:"apply",value:function(e,t){var n=this;return Ou((function(){if(e.length<2)throw new qb("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more than 2000 (".concat(e[0]*e[1],") elements: Slowness may result."));var t=Yx(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=nm.gramSchmidt(t);return e[0]>e[1]&&(r=Af(r)),Zu(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(ik);xk.className="Orthogonal",om.registerClass(xk);var kk={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function wk(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ix(e,om.SerializationMap.getMap().classNameMap,t,"initializer")}function Sk(e){return rx(e)}function Ik(e){if("string"==typeof e){var t=e in kk?kk[e]:e;if("GlorotNormal"===t)return new mk;if("GlorotUniform"===t)return new hk;if("HeNormal"===t)return new vk;if("HeUniform"===t)return new gk;if("LeCunNormal"===t)return new yk;if("LeCunUniform"===t)return new bk;var n={};return n.className=t,n.config={},wk(n)}return e instanceof ik?e:wk(e)}function _k(e){return Array.isArray(e)&&Array.isArray(e[0])}function Nk(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function Ck(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new Hb("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function Tk(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new Hb("Expected exactly 1 Shape; got ".concat(e.length))}return e}function Ek(e){var t,n=0,r=De(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch(i){r.e(i)}finally{r.f()}return n}var Ak="Variable",Rk=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ak,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;h(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=mx(),r=null==r?Ak:r,this.originalName=Ax(r),this.name=Rx(this.originalName),this.trainable_=a,this.constraint=i,this.val=If(t,this.trainable_,this.name,this.dtype)}return v(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function Fk(e){return e.map((function(e){return e.read()}))}function Dk(e){e.forEach((function(e){e[0].write(e[1])}))}var Mk=v((function e(t){h(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),Ok=v((function e(t,n,r,a,i,o,s){h(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=mx(),null!=o&&(this.originalName=Ax(o),this.name=Rx(this.originalName)),this.rank=n.length})),Pk=0,Lk=function(){function e(t,n){h(this,e),this.callArgs=n,this.id=Pk++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=De(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(o){a.e(o)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return v(e,[{key:"getConfig",value:function(){var e,t=[],n=De(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch(a){n.e(a)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),zk=0,Bk=function(e){Ae(n,e);var t=Re(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=zk++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=ex(i)+"_"+gx(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return v(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new Gb("The layer has never been called and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new Hb("Asked to get ".concat(t," at node ").concat(e,", but the layer has only ").concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return Jb(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return Jb(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new jb("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.'));if(0===this.inboundNodes.length)throw new jb("Layer ".concat(this.name," is not connected, no input to return."));return Jb(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new jb("Layer ".concat(this.name," has no inbound nodes."));if(this.inboundNodes.length>1)throw new jb("Layer ".concat(this.name,' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.'));return Jb(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=$b(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=$b(this.inputSpec);if(e.length!==t.length)throw new Hb("Layer ".concat(this.name," expects ").concat(t.length," inputs, but it received ").concat(e.length," input tensors. Input received: ").concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new Hb("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected ndim=").concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new Hb("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected max_ndim=").concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new Hb("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected min_ndim=").concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new Hb("Input ".concat(n," is incompatible with layer ").concat(this.name," : expected dtype=").concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new Hb("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected axis ").concat(u," of input shape to have value ").concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var p=0;p<a.shape.length;++p){var d=a.shape[p],f=r.shape[p];if(null!=d&&null!=f&&d!==f)throw new Hb("Input ".concat(n," is incompatible with layer ").concat(this.name,": expected shape=").concat(a.shape,", found shape=").concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=$b(e),i=!0,o=De(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof Ok)){i=!1;break}}}catch(l){o.e(l)}finally{o.f()}var s,u=!0,c=De(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof Ok){u=!1;break}}}catch(l){c.e(l)}finally{c.f()}if(i===u)throw new Hb("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ex(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=De($b(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(l){o.e(l)}finally{o.f()}n.build(Jb(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,p=n.call(e,t),d=[],f=De($b(p));try{for(f.s();!(c=f.n()).done;){var h=c.value;-1!==a.indexOf(h)&&(h=h.clone()),d.push(h)}}catch(l){f.e(l)}finally{f.f()}if(p=Jb(d),null!=n.activityRegularizer)throw new qb("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}var m,v=function(e){e=$b(e);var t,n=[],r=De(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(l){r.e(l)}finally{r.f()}return Jb(n)}(e),g=n.computeOutputShape(v),y="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?v[0]:v),m=null!=g&&g.length>0&&Array.isArray(g[0])?g.map((function(r,a){return new Ok(y,r,n,$b(e),t,n.name,a)})):new Ok(y,g,n,$b(e),t,n.name),n.addInboundNode(e,m,null,null,v,g,t),n._refCount++,null!=n.activityRegularizer)throw new qb("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return m}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: ".concat(JSON.stringify(e),") does not match that of the batchInputShape (").concat(JSON.stringify(this.batchInputShape),") of the layer ").concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor (".concat(JSON.stringify(e),") does not match the expectation of layer ").concat(this.name,": ").concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new jb("The layer ".concat(this.name," has never been called and thus has no defined output shape."));var e,t=[],n=De(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(o){n.e(o)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new jb("The layer ".concat(this.name,' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.'))}},{key:"countParams",value:function(){if(!this.built)throw new Gb("You tried to call countParams() on ".concat(this.name,", but the layer is not built yet. Build it first by calling build(batchInputShape)."));return Ek(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){return Fk(arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;Ou((function(){var n=t.weights;if(n.length!==e.length)throw new Hb('You called setWeights(weights) on layer "'.concat(t.name,'" with a weight list of length ').concat(e.length,", but the layer was expecting ").concat(n.length," weights. Provided weights: ").concat(e,"..."));if(0!==n.length){for(var r=[],a=Fk(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!Hi.arraysEqual(o.shape,u.shape))throw new Hb("Layer weight shape ".concat(o.shape," not compatible with provided weight shape ").concat(u.shape));r.push([s,u])}Dk(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new Hb("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():Ik("zeros"));var u=r.apply(t,n),c=new Rk(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=$b(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,Fe(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, but was passed an inputMask."));t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, but was passed an inputMask."))}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=$b(e);t=$b(t),n=$b(n),r=$b(r),a=Nk(a),i=Nk(i);var u,c=[],l=[],p=[],d=De(s);try{for(d.s();!(u=d.n()).done;){var f=u.value;c.push(f.sourceLayer),l.push(f.nodeIndex),p.push(f.tensorIndex)}}catch(m){d.e(m)}finally{d.f()}new Lk({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:p,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var h=0;h<t.length;h++)t[h].sourceLayer=this,t[h].nodeIndex=this.inboundNodes.length-1,t[h].tensorIndex=h}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been built yet."));if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used yet."));this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(om.Serializable);function Wk(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=De(Wk(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]));try{for(s.s();!(o=s.n()).done;){var u=o.value;-1===a.indexOf(u)&&a.push(u)}}catch(c){s.e(c)}finally{s.f()}}return a}var Uk=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:gx("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new Hb("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new Hb("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new Hb("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new Ok(r.dtype,r.batchInputShape,Ie(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new Lk({outboundLayer:Ie(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),Ee(r)}return v(n,[{key:"apply",value:function(e,t){throw new Hb("Cannot pass any input to an InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(Bk);function Vk(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new Hb("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new Uk({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}Uk.className="InputLayer",om.registerClass(Uk);var jk=function(){function e(t){if(h(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=De(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(o){a.e(o)}finally{a.f()}}}return v(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new Hb("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Iu(t,e.dtype)}catch(n){throw new Hb("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype of the key '").concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof Ok){if(null==this.id2Value[e.id])throw new Hb("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new Hb("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof Ok){if(null==this.id2Value[e.id])throw new Hb("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new Hb("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&Pu(this.id2Mask)}}]),e}(),Gk=new Xb,Hk=new Xb;function qk(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),p=De(u);try{for(p.s();!(a=p.n()).done;){var d=a.value;-1!==l.indexOf(d)?c.push(t.getValue(d)):c.push(null)}}catch(L){p.e(L)}finally{p.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var f,h=u.join(",")+"|"+t.names().sort().join(","),m=Gk.get(h);if(null==m){var v=function(e,t){Hi.assert(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=Xk(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=De(e);try{for(s.s();!(i=s.n()).done;){var u,c=Xk(i.value,t),l=c.sorted,p=c.recipientMap,d=De(l);try{for(d.s();!(u=d.n()).done;){var f=u.value;o.has(f.name)||(n.push(f),o.add(f.name))}}catch(L){d.e(L)}finally{d.f()}var h=function(e){null==r[e]&&(r[e]=new Set),p[e].forEach((function(t){return r[e].add(t)}))};for(var m in p)h(m)}}catch(L){s.e(L)}finally{s.f()}}return{sorted:n,recipientCounts:Kk(r)}}(s,t);m=v.sorted,f=v.recipientCounts,Gk.put(h,m),Hk.put(h,f)}f={},i||Object.assign(f,Hk.get(h));for(var g=new jk(t),y=0;y<m.length;++y){if(null!=r){var b=Du().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var x=m[y],k=x.sourceLayer;if(!(k instanceof Uk)){var w,S=[],I=[],_=[],N=!1,C=De(x.inputs);try{for(C.s();!(w=C.n()).done;){var T=w.value,E=g.getValue(T),A=g.getMask(T);S.push(E),I.push(A),null!=A&&(N=!0),i||(f[T.name]--,0===f[T.name]&&!t.hasKey(T)&&-1===u.indexOf(T.name)&&!E.isDisposed&&!0!==T.sourceLayer.stateful&&_.push(E))}}catch(L){C.e(L)}finally{C.f()}N&&((n=n||{}).mask=I[0]);var R=$b(k.apply(S,n)),F=null;k.supportsMasking&&(F=k.computeMask(S,I));for(var D=Yk(x),M=Array.isArray(D)?D:[D],O=0;O<M.length;++O){g.hasKey(M[O])||g.add(M[O],R[O],Array.isArray(F)?F[0]:F);var P=u.indexOf(M[O].name);-1!==P&&(c[P]=R[O])}i||Pu(_)}}return g.disposeMasks(),o?c:c[0]}function Kk(e){var t={};for(var n in e)t[n]=e[n].size;return t}function Xk(e,t){var n,r=new Set,a=[],i={},o=De(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(m){o.e(m)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var p=c[c.length-1]===u.length-1;if(0===l.inputs.length||p)u.pop(),a.push(l),r.add(l.name),p&&c.pop();else{c.push(u.length-1);var d,f=De(l.inputs);try{for(f.s();!(d=f.n()).done;){var h=d.value;null==i[h.name]&&(i[h.name]=new Set),i[h.name].add(l.name),!r.has(h.name)&&u.push(h)}}catch(m){f.e(m)}finally{f.f()}}}}return{sorted:a,recipientMap:i}}function Yk(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=De(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(o){i.e(o)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}hn().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=Gk&&Gk.setMaxEntries(e),null!=Hk&&Hk.setMaxEntries(e)}));var Qk={};function Zk(e,t){return Ou((function(){return Ll(Bl(Zu(e,e),t,!0))}))}He(Qk,{maxNorm:function(){return sw},minMaxNorm:function(){return lw},nonNeg:function(){return cw},unitNorm:function(){return uw}});var Jk=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"getConfig",value:function(){return{}}}]),n}(om.Serializable),$k=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return v(n,[{key:"apply",value:function(e){var t=this;return Ou((function(){var n=Zk(e,t.axis),r=qc(n,0,t.maxValue);return Zu(e,Qu(r,Xu(Wx(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(Jk);$k.className="MaxNorm",om.registerClass($k);var ew=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return v(n,[{key:"apply",value:function(e){var t=this;return Ou((function(){return Qu(e,Xu(Wx(),Zk(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(Jk);ew.className="UnitNorm",om.registerClass(ew);var tw=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return Dd(e)}}]),n}(Jk);tw.className="NonNeg",om.registerClass(tw);var nw=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return v(n,[{key:"apply",value:function(e){var t=this;return Ou((function(){var n=Zk(e,t.axis),r=Xu(Zu(t.rate,qc(n,t.minValue,t.maxValue)),Zu(1-t.rate,n));return Zu(e,Qu(r,Xu(Wx(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(Jk);nw.className="MinMaxNorm",om.registerClass(nw);var rw={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function aw(e){return rx(e)}function iw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ix(e,om.SerializationMap.getMap().classNameMap,t,"constraint")}function ow(e){return null==e?null:"string"==typeof e?iw({className:e in rw?rw[e]:e,config:{}}):e instanceof Jk?e:iw(e)}function sw(e){return new $k(e)}function uw(e){return new ew(e)}function cw(){return new tw}function lw(e){return new nw(e)}var pw={};function dw(){return new ok}function fw(){return new sk}function hw(e){return new uk(e)}function mw(e){return new ck(e)}function vw(e){return new lk(e)}function gw(e){return new pk(e)}function yw(e){return new dk(e)}function bw(e){return new fk(e)}function xw(e){return new hk(e)}function kw(e){return new mk(e)}function ww(e){return new vk(e)}function Sw(e){return new gk(e)}function Iw(e){return new yk(e)}function _w(e){return new bk(e)}function Nw(e){return new xk(e)}He(pw,{constant:function(){return hw},glorotNormal:function(){return kw},glorotUniform:function(){return xw},heNormal:function(){return ww},heUniform:function(){return Sw},identity:function(){return yw},leCunNormal:function(){return Iw},leCunUniform:function(){return _w},ones:function(){return fw},orthogonal:function(){return Nw},randomNormal:function(){return vw},randomUniform:function(){return mw},truncatedNormal:function(){return gw},varianceScaling:function(){return bw},zeros:function(){return dw}});var Cw,Tw={};function Ew(e){return Aw.apply(this,arguments)}function Aw(){return Aw=y(f().mark((function e(t){var n,r,a,i,o,s,u,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!=typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=10;break}return e.next=7,Promise.all(n);case 7:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];Pu(a);case 10:case"end":return e.stop()}}),e)}))),Aw.apply(this,arguments)}function Rw(e){if(null!=e)for(var t in e){var n=e[t];"number"!=typeof n&&n.dispose()}}He(Tw,{Layer:function(){return Bk},RNN:function(){return n_},RNNCell:function(){return r_},activation:function(){return FN},add:function(){return UN},alphaDropout:function(){return RC},average:function(){return VN},averagePooling1d:function(){return ZN},averagePooling2d:function(){return eC},averagePooling3d:function(){return rC},avgPool1d:function(){return JN},avgPool2d:function(){return tC},avgPool3d:function(){return aC},avgPooling1d:function(){return $N},avgPooling2d:function(){return nC},avgPooling3d:function(){return iC},batchNormalization:function(){return XN},bidirectional:function(){return SC},categoryEncoding:function(){return PC},centerCrop:function(){return MC},concatenate:function(){return jN},conv1d:function(){return SN},conv2d:function(){return IN},conv2dTranspose:function(){return _N},conv3d:function(){return NN},conv3dTranspose:function(){return CN},convLstm2d:function(){return bC},convLstm2dCell:function(){return xC},cropping2D:function(){return EN},dense:function(){return DN},depthwiseConv2d:function(){return RN},dot:function(){return KN},dropout:function(){return MN},elu:function(){return gN},embedding:function(){return WN},flatten:function(){return PN},gaussianDropout:function(){return AC},gaussianNoise:function(){return EC},globalAveragePooling1d:function(){return oC},globalAveragePooling2d:function(){return sC},globalMaxPool1d:function(){return _C},globalMaxPool2d:function(){return NC},globalMaxPooling1d:function(){return uC},globalMaxPooling2d:function(){return cC},gru:function(){return fC},gruCell:function(){return hC},input:function(){return rI},inputLayer:function(){return vN},layerNormalization:function(){return YN},leakyReLU:function(){return bN},lstm:function(){return mC},lstmCell:function(){return vC},masking:function(){return FC},maxPool1d:function(){return CC},maxPool2d:function(){return TC},maxPooling1d:function(){return lC},maxPooling2d:function(){return pC},maxPooling3d:function(){return dC},maximum:function(){return GN},minimum:function(){return HN},multiply:function(){return qN},permute:function(){return BN},prelu:function(){return xN},reLU:function(){return yN},repeatVector:function(){return LN},rescaling:function(){return DC},reshape:function(){return zN},resizing:function(){return OC},rnn:function(){return kC},separableConv2d:function(){return TN},simpleRNN:function(){return gC},simpleRNNCell:function(){return yC},softmax:function(){return kN},spatialDropout1d:function(){return ON},stackedRNNCells:function(){return wC},thresholdedReLU:function(){return wN},timeDistributed:function(){return IC},upSampling2d:function(){return AN},zeroPadding2d:function(){return QN}}),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(Cw||(Cw={}));var Fw=125,Dw=function(){function e(){h(this,e),this.validationData=null}return v(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),Mw=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;h(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return v(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=De(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=De(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(r){n.e(r)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=y(f().mark((function e(t,n){var r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=De(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=y(f().mark((function e(t,n){var r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=De(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=y(f().mark((function e(t,n){var r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=De(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=y(f().mark((function e(t,n){var r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=De(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=y(f().mark((function e(t){var n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=De(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=y(f().mark((function e(t){var n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=De(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Ow=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.call(this)}return v(n,[{key:"onEpochBegin",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=y(f().mark((function e(t,n){var r,a,i,o=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=f().mark((function e(t){var a,i,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"number"==typeof(a=n[t])?(o.totals.hasOwnProperty(t)||(o.totals[t]=0),o.totals[t]=o.totals[t]+a*r):(t in o.totals?i=o.totals[t]:o.totals[t]=0,s=Ou((function(){return Xu(o.totals[t],Zu(a,r))})),o.totals[t]=s,null!=i&&i.dispose());case 2:case"end":return e.stop()}}),e)})),e.t0=f().keys(n);case 5:if((e.t1=e.t0()).done){e.next=10;break}return i=e.t1.value,e.delegateYield(a(i),"t2",8);case 8:e.next=5;break;case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=y(f().mark((function e(t,n){var r,a,i,o=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=17;break}r=De(this.params.metrics),e.prev=2,i=f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.value,null!=o.totals[t]&&("number"==typeof o.totals[t]?n[t]=o.totals[t]/o.seen:Ou((function(){var e=Zu(Qu(1,o.seen),o.totals[t]);n[t]=e,o.totals[t].dispose(),Lu(n[t])})));case 2:case"end":return e.stop()}}),e)})),r.s();case 5:if((a=r.n()).done){e.next=9;break}return e.delegateYield(i(),"t0",7);case 7:e.next=5;break;case 9:e.next=14;break;case 11:e.prev=11,e.t1=e.catch(2),r.e(e.t1);case 14:return e.prev=14,r.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[2,11,14,17]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(Dw),Pw=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"onTrainBegin",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=y(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i,o,s,u,c;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!=typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=4,Promise.all(t);case 4:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Dw),Lw=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;if(h(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||Ev,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=Fw),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return Hi.isNumber(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():Hi.now();return function(){var i=null!=n?n():Hi.now();return i-a<t||(a=i,r=e.apply(void 0,arguments)),r}}(a.maybeWait.bind(Ie(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,Ee(a)}return v(n,[{key:"maybeWait",value:function(){var e=y(f().mark((function e(t,n,r){var a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],e.t0=null!=this.yield,!e.t0){e.next=6;break}return e.next=5,Ew(r);case 5:a.push(this.yield(t,n,r));case 6:return a.push(this.nextFrameFunc()),e.next=9,Promise.all(a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,e.t0=null!=this.epochBegin,!e.t0){e.next=7;break}return e.next=5,Ew(n);case 5:return e.next=7,this.epochBegin(t,n);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=y(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.epochEnd,!e.t0){e.next=6;break}return e.next=5,Ew(n);case 5:r.push(this.epochEnd(t,n));case 6:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.batchBegin,!e.t0){e.next=6;break}return e.next=4,Ew(n);case 4:return e.next=6,this.batchBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=y(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=null!=this.batchEnd,!e.t0){e.next=6;break}return e.next=5,Ew(n);case 5:r.push(this.batchEnd(t,n));case 6:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):Hi.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=9,Promise.all(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainBegin,!e.t0){e.next=6;break}return e.next=4,Ew(t);case 4:return e.next=6,this.trainBegin(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=this.trainEnd,!e.t0){e.next=6;break}return e.next=4,Ew(t);case 4:return e.next=6,this.trainEnd(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Dw);function zw(e,t){return null==e&&(e={}),e instanceof Dw?[e]:Array.isArray(e)&&e[0]instanceof Dw?e:$b(e).map((function(e){return new Lw(e,t)}))}var Bw=function(){function e(){h(this,e)}return v(e,null,[{key:"registerCallbackConstructor",value:function(t,n){Hi.assert(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors)e.constructors[+n].forEach((function(e){if(e===t)throw new Hb("Duplicate callback constructor.")}))}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,Fe(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function Ww(e,t,n,r,a,i,o,s,u){var c=new Pw,l=[new Ow].concat(Fe(Bw.createCallbacks(t)));null!=e&&l.push.apply(l,Fe(e)),l.push(c);var p=new Mw(l);return p.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:p,history:c}}function Uw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return ix(e,om.SerializationMap.getMap().classNameMap,t,"layer",n)}function Vw(e,t){return Ou((function(){"float32"!==e.dtype&&(e=Iu(e,"float32"));var n=Bl(Jx(e),t,!0),r=Hc(n.shape,Wx()),a=Ll(Fp(n,r));return Qu(e,a)}))}function jw(e,t){return Ou((function(){return Dp(Jx(bp(t,e)),-1)}))}function Gw(e,t){return Ou((function(){return Dp(Ju(bp(t,e)),-1)}))}function Hw(e,t){return Ou((function(){var n=bp(e,t),r=qc(Ju(e),Wx(),Number.MAX_VALUE),a=Ju(Qu(n,r));return Zu(100,Dp(a,-1))}))}function qw(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ou((function(){if(n)t=$d(t);else{var r=Bl(t,t.shape.length-1,!0);t=Qu(t,r)}return t=qc(t,Wx(),1-Wx()),vp(Bl(Zu(Iu(e,"float32"),sp(t)),t.shape.length-1))}))}function Kw(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ou((function(){var r=Iu(Xl(function(e){var t=[Px(e.shape)];return Nc(e,t)}(e)),"int32"),a=(t=qc(t,Wx(),1-Wx())).shape;return qw(Nc(Gp(r,a[a.length-1]),a),t,n)}))}function Xw(e,t){return Ou((function(){var n;return n=qc(t,Wx(),1-Wx()),n=sp(Qu(n,bp(1,n))),Dp(function(e,t){if(!Hi.arraysEqual(e.shape,t.shape))throw new Hb("logits and labels must have the same shape, but got shapes ".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return Ou((function(){var n=Dd(t),r=vp(Ju(t));return Xu(bp(n,Zu(t,e)),up(jl(r)))}))}(e,n),-1)}))}function Yw(e,t){return Ou((function(){var n=Vw(e,-1),r=Vw(t,-1),a=Zu(n,r);return vp(Bl(a,-1))}))}Bw.constructors={};var Qw={meanSquaredError:jw,meanAbsoluteError:Gw,meanAbsolutePercentageError:Hw,meanSquaredLogarithmicError:function(e,t){return Ou((function(){var n=qc(t,Wx(),Number.MAX_VALUE),r=sp(Xu(1,n)),a=qc(e,Wx(),Number.MAX_VALUE),i=sp(Xu(1,a));return Dp(Jx(bp(r,i)),-1)}))},squaredHinge:function(e,t){return Ou((function(){var n=Fp(0,bp(1,Zu(e,t)));return Dp(Jx(n),-1)}))},hinge:function(e,t){return Ou((function(){var n=Fp(0,bp(1,Zu(e,t)));return Dp(n,-1)}))},categoricalHinge:function(e,t){return Ou((function(){var n=Bl(Zu(e,t),-1),r=Dl(Zu(bp(1,e),t),-1);return Fp(0,Xu(1,bp(r,n)))}))},logcosh:function(e,t){return Ou((function(){var n=Math.log(2),r=bp(t,e),a=bp(Xu(r,gp(Zu(-2,r))),n);return Dp(a,-1)}))},categoricalCrossentropy:qw,sparseCategoricalCrossentropy:Kw,binaryCrossentropy:Xw,kullbackLeiblerDivergence:function(e,t){return Ou((function(){var n=qc(e,Wx(),1),r=qc(t,Wx(),1);return Bl(Zu(e,sp(Qu(n,r))),-1)}))},poisson:function(e,t){return Ou((function(){var n=sp(Xu(Wx(),t));return Dp(bp(t,Zu(e,n)),-1)}))},cosineProximity:Yw};function Zw(e){if("string"==typeof e){if(e in Qw)return Qw[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy')),new Hb(t)}return e}function Jw(e,t){return Ou((function(){var n=Zu(.5,Hp(t)),r=Ux(Ql(t,n),e.dtype);return Dp(gl(e,r),-1)}))}function $w(e,t){return Ou((function(){return Ux(gl(ac(e,-1),ac(t,-1)),"float32")}))}function eS(e,t){return Ou((function(){return Iu(Bl(wp(gl(e,1),gl(t,1))),"float32")}))}function tS(e,t){return Ou((function(){var n=eS(e,t),r=function(e,t){return Ou((function(){return Iu(Bl(wp(gl(e,0),gl(t,1))),"float32")}))}(e,t),a=Xu(n,r);return Iu(yl(Ql(a,0),Qu(n,a),0),"float32")}))}function nS(e,t){return Ou((function(){var n=eS(e,t),r=function(e,t){return Ou((function(){return Iu(Bl(wp(gl(e,1),gl(t,0))),"float32")}))}(e,t),a=Xu(n,r);return Iu(yl(Ql(a,0),Qu(n,a),0),"float32")}))}function rS(e,t){return Xw(e,t)}function aS(e,t){return e.rank===t.rank&&(e=sf(e,[e.rank-1])),(t=ac(t,-1)).dtype!==e.dtype&&(t=Iu(t,e.dtype)),Iu(gl(e,t),"float32")}var iS=qw,oS=Kw,sS={binaryAccuracy:Jw,categoricalAccuracy:$w,precision:tS,categoricalCrossentropy:iS,sparseCategoricalCrossentropy:oS,mse:jw,MSE:jw,mae:Gw,MAE:Gw,mape:Hw,MAPE:Hw,cosine:Yw};function uS(e){if(Qb(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"==typeof e)return e;for(var t,n=0,r=Object.keys(Qw);n<r.length;n++){var a=r[n];if(Qw[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(sS);i<o.length;i++){var s=o[i];if(sS[s]===e){t=s;break}}return void 0!==t?t:e.name}function cS(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||!lS(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>1048576&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in size (length=').concat(r.length," when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ",1048576,"."))}}function lS(e){if(null===e)return!0;if("object"==typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!=typeof r||!lS(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=De(e);try{for(i.s();!(a=i.n()).done;){if(!lS(a.value))return!1}}catch(s){i.e(s)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function pS(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=function(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,Fe(s))}if(t){var u,c=De(e.layers);try{for(c.s();!(u=c.n()).done;){var l,p=u.value,d=!1,f=De(p.inboundNodes);try{for(f.s();!(l=f.n()).done;){var h=l.value;if(-1!==r.indexOf(h)){if(d){t=!1;break}d=!0}}}catch(m){f.e(m)}finally{f.f()}if(!t)break}}catch(m){c.e(m)}finally{c.f()}}return t}(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,Fe(e.nodesByDepth[s]))}a("_".repeat(t)),dS(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?fS(c[l],n,a):hS(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var p=function(e){var t;return t=null!=e.collectedTrainableWeights?Ek(e.collectedTrainableWeights):Ek(e.trainableWeights),t}(e),d=Ek(e.nonTrainableWeights);a("Total params: ".concat(p+d)),a("Trainable params: ".concat(p)),a("Non-trainable params: ".concat(d)),a("_".repeat(t))}function dS(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function fS(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(F){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(F){r="multiple"}var i=e.name,o=e.getClassName();dS(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function hS(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(g){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(g){a="multiple"}var o,s=[],u=De(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var p=c.inboundLayers[l].name,d=c.nodeIndices[l],f=c.tensorIndices[l];s.push("".concat(p,"[").concat(d,"][").concat(f,"]"))}}}catch(y){u.e(y)}finally{u.f()}var h=e.name,m=e.getClassName(),v=0===s.length?"":s[0];dS(["".concat(h," (").concat(m,")"),i,a,e.countParams().toString(),v],t,r);for(var g=1;g<s.length;++g)dS(["","","","",s[g]],t,r)}function mS(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"==typeof n}function vS(e,t){if(null===e)return null;if("string"==typeof e)return tx(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];mS(t,a,i)?n.push(i):n.push(vS(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"==typeof l)o[c]=l;else{var p=tx(c);o[p]=vS(l,p)}}return o}function gS(e,t){if(null==e)return null;if("string"==typeof e)return ex(e);if("number"==typeof e||"boolean"==typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];mS(t,a,i)?n.push(i):n.push(gS(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],p=ex(c);o[p]="name"!==c&&"className"!==c||"string"!=typeof l?gS(l,c):l}return o}var yS="4.2.0",bS=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=gx(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],sx(r.inputs).length!==r.inputs.length)throw new Hb("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ".concat(r.inputs.map((function(e){return e.name}))));sx(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=De(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,c=s.nodeIndex,l=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(c),r.outputLayersTensorIndices.push(l)}}catch(ke){o.e(ke)}finally{o.f()}var p,d=De(r.inputs);try{for(d.s();!(p=d.n()).done;){var f=p.value,m=f.sourceLayer,v=f.nodeIndex,g=f.tensorIndex;Qb(0===v,"input layer has >1 nodes"),Qb(0===g,"input layer has >1 tensors"),r.inputLayers.push(m),r.inputLayersNodeIndices.push(v),r.inputLayersTensorIndices.push(g)}}catch(ke){d.e(ke)}finally{d.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var y=0;y<r.inputLayers.length;y++){var b=r.inputLayers[y];if(!(b instanceof Uk))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. Received inputs: ".concat(e.inputs,". Input ").concat(y," (0-based) originates from layer type ").concat(b.getClassName(),"."));r.inputNames.push(b.name),r.feedInputShapes.push(b.batchInputShape),r.feedInputNames.push(b.name)}var x,k=De(r.outputLayers);try{for(k.s();!(x=k.n()).done;){var w=x.value;r.outputNames.push(w.name)}}catch(ke){k.e(ke)}finally{k.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var S,I={},_={},N={},C={},T={},E=[],A=function e(t,a,i,o,s,u){(null==o||null==s||null==u)&&(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new Gb("The tensor ".concat(t.name,' at layer "').concat(o.name,'" is part of a cycle.'));if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in T||(T[o.id]=Object.keys(T).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,p=0;p<l;p++){e(c.inputTensors[p],a,i,c.inboundLayers[p],c.nodeIndices[p],c.tensorIndices[p])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);E.push(c)}},R=[],F=[],D=De(r.outputs);try{for(D.s();!(S=D.n()).done;){A(S.value,R,F)}}catch(ke){D.e(ke)}finally{D.f()}var M,O=De(E.slice().reverse());try{for(O.s();!(M=O.n()).done;){var P=M.value;_[P.id]=P,P.id in I||(I[P.id]=0);var L=I[P.id],z=null==N[P.outboundLayer.id]?0:N[P.outboundLayer.id];L=Math.max(L,z),N[P.outboundLayer.id]=L,C[P.outboundLayer.id]=P.outboundLayer,I[P.id]=L;for(var B=0;B<P.inboundLayers.length;B++){var W=P.inboundLayers[B],U=P.nodeIndices[B],V=W.inboundNodes[U],j=null==I[V.id]?0:I[V.id];I[V.id]=Math.max(L+1,j),_[V.id]=V}}}catch(ke){O.e(ke)}finally{O.f()}var G={};for(var H in I){var q=I[H];q in G||(G[q]=[]),G[q].push(_[H])}var K={};for(var X in N){var Y=N[X];Y in K||(K[Y]=[]),K[Y].push(C[X])}var Q=Object.keys(K).map((function(e){return parseInt(e,10)})).sort(ox);r.layers=[];var Z,J=De(Q);try{for(J.s();!(Z=J.n()).done;){var $=K[Z.value];$.sort((function(e,t){var n=T[e.id],r=T[t.id];return n<r?-1:n>r?1:0}));var ee,te=De($);try{for(te.s();!(ee=te.n()).done;){var ne=ee.value;ne instanceof n&&r.internalContainerRefs.push(ne),r.layers.push(ne)}}catch(ke){te.e(ke)}finally{te.f()}}}catch(ke){J.e(ke)}finally{J.f()}r.layersByDepth=K,Q=Object.keys(G).map((function(e){return parseInt(e,10)})).sort(ox);var re,ae=r.inputs.slice(),ie=[],oe=De(Q);try{for(oe.s();!(re=oe.n()).done;){var se,ue=De(G[re.value]);try{for(ue.s();!(se=ue.n()).done;){var ce=se.value,le=ce.outboundLayer;if(null!=le){var pe,de=De(ce.inputTensors);try{for(de.s();!(pe=de.n()).done;){var fe=pe.value;if(-1===ae.indexOf(fe))throw new Gb("Graph disconnected: cannot obtain value for tensor ".concat(fe,' at layer "').concat(le.name,'". The following previous layers were accessed without issue: ').concat(ie))}}catch(ke){de.e(ke)}finally{de.f()}var he,me=De(ce.outputTensors);try{for(me.s();!(he=me.n()).done;){var ve=he.value;ae.push(ve)}}catch(ke){me.e(ke)}finally{me.f()}ie.push(le.name)}}}catch(ke){ue.e(ke)}finally{ue.f()}}}catch(ke){oe.e(ke)}finally{oe.f()}r.nodesByDepth=G;var ge,ye=r.layers.map((function(e){return e.name})),be=De(ye);try{var xe=function(){var e=ge.value,t=ye.filter((function(t){return t===e})).length;if(1!==t)throw new Gb('The name "'.concat(e,'" is used ').concat(t," times in the model. All layer names should be unique. Layer names: ")+JSON.stringify(ye))};for(be.s();!(ge=be.n()).done;)xe()}catch(ke){be.e(ke)}finally{be.f()}return r.outboundNodes=[],r.inboundNodes=[],new Lk({outboundLayer:Ie(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,Ee(r)}return v(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=De(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(s){n.e(s)}finally{n.f()}var a,i=De(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(s){i.e(s)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new Hb("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=De(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=De(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Fe(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=De(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Fe(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=De(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=De(t.value.weights);try{for(s.s();!(o=s.n()).done;){var u=o.value;if(null!=r[u.originalName])throw new Hb("Duplicate weight name: ".concat(u.originalName));r[u.originalName]=u,a++}}catch(m){s.e(m)}finally{s.f()}}}catch(m){i.e(m)}finally{i.f()}var c=[];for(var l in e){var p=l;if(null==r[l]){var d=l.split("/");p=d.slice(0,-2).concat([d[d.length-1]]).join("/")}if(null!=r[p])c.push([r[p],e[l]]);else if(n)throw new Hb("Provided weight data has no target variable: ".concat(l));delete r[p]}if(n){var f=[];for(var h in r)f.push(h);if(f.length>0)throw new Hb("".concat(f.length," of ").concat(a," weights are not set: ").concat(f))}Dk(c)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(yS),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=gS(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return Ou((function(){e=$b(e);for(var r=new jk,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return qk(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return Ou((function(){var r;return e=$b(e),r=null==t?Yb(null,e.length):$b(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=Nk(e);if(t.length!==this.inputLayers.length)throw new Hb("Invalid inputShape argument ".concat(e,": model has ").concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(ox);if(o.length>1){var s,u=De(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,p=De(this.nodesByDepth[l]);try{for(p.s();!(c=p.n()).done;){var d=c.value,f=d.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(f.id)){for(var h=[],m=0;m<d.inboundLayers.length;m++){var v=d.inboundLayers[m],g=d.nodeIndices[m],y=d.tensorIndices[m],b=n["".concat(v.name,"_").concat(g,"_").concat(y)];h.push(b)}for(var x=Nk(f.computeOutputShape(Jb(h))),k=f.inboundNodes.indexOf(d),w=0;w<x.length;w++){n["".concat(f.name,"_").concat(k,"_").concat(w)]=x[w]}}}}catch(F){p.e(F)}finally{p.f()}}}catch(F){u.e(F)}finally{u.f()}}for(var S=[],I=[],_=0;_<this.outputLayers.length;_++){var N=this.outputLayers[_],C=this.outputLayersNodeIndices[_],T=this.outputLayersTensorIndices[_],E="".concat(N.name,"_").concat(C,"_").concat(T);I.push(E)}for(var A=0;A<I.length;A++){var R=I[A];Qb(R in n),S.push(n[R])}return Jb(S)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=Yb(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],s=t[r];n[a.id]=[i,s]}var u,c=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(ox),l=De(c);try{for(l.s();!(u=l.n()).done;){var p,d=u.value,f=De(this.nodesByDepth[d]);try{for(f.s();!(p=f.n()).done;){var h,m=p.value,v=m.outboundLayer,g=m.inputTensors,y=m.outputTensors,b=new Array,x=De(g);try{for(x.s();!(h=x.n()).done;){var k=h.value;k.id in n&&b.push(n[k.id])}}catch(j){x.e(j)}finally{x.f()}if(b.length===g.length){var w={},S=void 0,I=void 0,_=void 0,N=void 0;if(null!=m.callArgs&&(w=m.callArgs),1===b.length){var C=o(b[0],2),T=C[0],E=C[1];null==w.mask&&(w.mask=E),_=$b(v.call(T,w)),N=$b(v.computeMask(T,E)),S=[T],I=[E]}else S=b.map((function(e){return e[0]})),I=b.map((function(e){return e[1]})),null==w.mask&&(w.mask=I),_=$b(v.call(S,w)),N=$b(v.computeMask(S,I));if(v.activityRegularizer)throw new qb("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var A=0;A<y.length;++A){var R=y[A],F=_[A],D=N[A];n[R.id]=[F,D]}}}}catch(j){f.e(j)}finally{f.f()}}}catch(j){l.e(j)}finally{l.f()}var M,O=[],P=[],L=[],z=De(this.outputs);try{for(z.s();!(M=z.n()).done;){var B=M.value;Qb(B.id in n,"Could not compute output ".concat(B.name," : ").concat(B.id));var W=o(n[B.id],2),U=W[0],V=W[1];L.push(U.shape),O.push(U),P.push(V)}}catch(j){z.e(j)}finally{z.f()}return[O,P,L]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=De(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(c){i.e(c)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new Hb("Was asked to retrieve layer at index ".concat(t,", but model only has ").concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new Hb("Provide either a layer name or layer index");var n,r=De(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(i){r.e(i)}finally{r.f()}throw new Hb("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return Ou((function(){var t,r=[],a=De(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,Fe(i.calculateLosses()))}}catch(u){a.e(u)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=De(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var p=o.inboundNodes[l],d=n.nodeKey(o,l),f={};if(this.containerNodes.has(d)){if(p.callArgs)try{JSON.stringify(p.callArgs),f=p.callArgs}catch(h){console.warn("Layer ".concat(o.name," was passed non-serializable keyword arguments: ").concat(p.callArgs,". They will not be included in the serialized model (and thus will be missing at deserialization time).")),f={}}if(p.inboundLayers.length>0){for(var h=[],m=0;m<p.inboundLayers.length;m++){var v=p.inboundLayers[m],g=p.nodeIndices[m],y=p.tensorIndices[m],b=r[n.nodeKey(v,g)];null==b&&(b=0),h.push([v.name,b,y,f])}c.push(h)}}}var x={};x.name=o.name,x.className=s,x.config=u,x.inboundNodes=c,a.push(x)}}catch(O){i.e(O)}finally{i.f()}t.layers=a;for(var k=[],w=0;w<this.inputLayers.length;w++){var S=this.inputLayers[w],I=this.inputLayersNodeIndices[w],_=n.nodeKey(S,I);if(this.containerNodes.has(_)){var N=r[_];null==N&&(N=0);var C=this.inputLayersTensorIndices[w];k.push([S.name,N,C])}}t.inputLayers=k;for(var T=[],E=0;E<this.outputLayers.length;E++){var A=this.outputLayers[E],R=this.outputLayersNodeIndices[E],F=n.nodeKey(A,R);if(this.containerNodes.has(F)){var D=r[F];null==D&&(D=0);var M=this.outputLayersTensorIndices[E];T.push([A.name,D,M])}}return t.outputLayers=T,t}},{key:"stateful",get:function(){if(this._stateful)throw new Hb("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=De(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;Ou((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=De(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],p=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var d=r[c];if(d.inboundNodes.length<=l)return void i(e,t);var f=d.inboundNodes[l];o.push(f.outputTensors[p])}}catch(h){s.e(h)}finally{s.f()}o.length>0&&e.apply(Jb(o),n)}function s(e){var a=e.name,o=Uw(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new Hb("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,p=De(l);try{for(p.s();!(u=p.n()).done;){s(u.value)}}catch(O){p.e(O)}finally{p.f()}for(;!ux(a);){var d,f=De(l);try{for(f.s();!(d=f.n()).done;){var h=d.value,m=r[h.name];if(m.name in a){var v=a[m.name];delete a[m.name];var g,y=De(v);try{for(y.s();!(g=y.n()).done;){o(m,g.value)}}catch(O){y.e(O)}finally{y.f()}}}}catch(O){f.e(O)}finally{f.f()}}var b,x=[],k=[],w=De(t.inputLayers);try{for(w.s();!(b=w.n()).done;){var S=b.value,I=S[0],_=S[1],N=S[2];Qb(I in r);var C=r[I].inboundNodes[_].outputTensors;x.push(C[N])}}catch(O){w.e(O)}finally{w.f()}var T,E=De(t.outputLayers);try{for(E.s();!(T=E.n()).done;){var A=T.value,R=A[0],F=A[1],D=A[2];Qb(R in r);var M=r[R].inboundNodes[F].outputTensors;k.push(M[D])}}catch(O){E.e(O)}finally{E.f()}return new e({inputs:x,outputs:k,name:c})}}]),n}(Bk);function xS(e,t){return function(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"==typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," element(s), but the model has ").concat(r," outputs. Make sure a set of weights is provided for each model output."));return e}if("object"==typeof e&&Object.keys(e).length>0&&"object"==typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, so ").concat(n," must be either an array with ").concat(r," elements or an object with ").concat(t," keys. Provided ").concat(n," not understood: ").concat(JSON.stringify(e)))}(e,t,"classWeight")}function kS(e,t,n,r){return wS.apply(this,arguments)}function wS(){return wS=y(f().mark((function e(t,n,r,a){var i,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=14;break}return i=Ou((function(){if(1===t.shape.length)return _u(t);if(2===t.shape.length){if(t.shape[1]>1)return ac(t,1);if(1===t.shape[1])return Nc(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") during handling of class weights. The size is expected to be >= 1."))}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during handling of class weights. The rank is expected to be 1 or 2."))})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),Pu(i),s=[],e.abrupt("return",(o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. The class ".concat(e," exists in the data but not in classWeight"));s.push(r[e])})),df(s,"float32")));case 14:return e.abrupt("return",null);case 15:case"end":return e.stop()}}),e)}))),wS.apply(this,arguments)}function SS(e,t){return Zu(e,t)}var IS=32;function _S(e,t){var n,r,a=t;n=a.xs,r=a.ys,Hi.assert(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ".concat(t)}));var i=NS("input",e.inputNames,n),o=NS("output",e.outputNames,r),s=i[0].shape[0];Hi.assert(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset provides ").concat(i.length," inputs.  (Expected input keys: ").concat(JSON.stringify(e.inputNames),")")})),Hi.assert(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset provides ").concat(o.length," outputs.  (Expected output keys: ").concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){Hi.assert(i[t].shape[0]===s,(function(){return"Batch size mismatch: input ".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){Hi.assert(o[t].shape[0]===s,(function(){return"Batch size mismatch: output ".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; expected  ").concat(s," based on input ").concat(e.inputNames[0],".")}))},p=0;p<o.length;p++)l(p);return{xs:i,ys:o}}function NS(e,t,n){if(n instanceof To)return[n];if(Array.isArray(n))return Hi.assert(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=De(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new Hb("The feature data generated by the dataset lacks the required ".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch(s){i.e(s)}finally{i.f()}return a}function CS(e){if(3===e.length)throw new qb("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function TS(e,t,n){return ES.apply(this,arguments)}function ES(){return ES=y(f().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,h,m,v,g,y,b,x,k,w,S,I,_,N,C,T,E,A,R,F,D,M,O,P,L;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,Hi.assert(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),Hi.assert(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),Hi.assert(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive integer, but got ".concat(r.epochs)})),Hi.assert(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ".concat(r.batchesPerEpoch)})),Hi.assert(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,(i=null!=r.validationData)&&(RS(r.validationData)?Hi.assert(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ".concat(r.validationBatches)})):(u=CS(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),p=i?l.slice().concat(l.map((function(e){return"val_"+e}))):l.slice(),d=zw(r.callbacks,r.yieldEvery),h=null==r.verbose?1:r.verbose,m=Ww(d,h,r.epochs,null,null,AS(n,r),null,i,p),v=m.callbackList,g=m.history,v.setModel(t),t.history=g,e.next=14,v.onTrainBegin();case 14:return t.stopTraining_=!1,y=null==r.initialEpoch?0:r.initialEpoch,e.next=18,n.iterator();case 18:b=e.sent;case 19:if(!(y<r.epochs)){e.next=88;break}return x={},e.next=23,v.onEpochBegin(y);case 23:if(k=0,w=0,e.t0=a,e.t0){e.next=29;break}return e.next=28,n.iterator();case 28:b=e.sent;case 29:if(a&&!(k<r.batchesPerEpoch)){e.next=81;break}return e.next=32,b.next();case 32:if(S=e.sent,!a||!S.done){e.next=36;break}return console.warn("You provided `batchesPerEpoch` as ".concat(r.batchesPerEpoch,", but your dataset iterator ran out of data after ").concat(k," batches; interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, ").concat(r.batchesPerEpoch*r.epochs," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("break",81);case 36:if(null==S.value){e.next=63;break}return I=_S(t,S.value),_=I.xs,N=I.ys,(C={}).batch=w,C.size=_[0].shape[0],e.next=42,v.onBatchBegin(w,C);case 42:if(T=[],null==r.classWeight){e.next=55;break}E=xS(r.classWeight,t.outputNames),A=0;case 46:if(!(A<E.length)){e.next=55;break}return e.t1=T,e.next=50,kS(N[A],null,E[A]);case 50:e.t2=e.sent,e.t1.push.call(e.t1,e.t2);case 52:++A,e.next=46;break;case 55:for(R=_.concat(N).concat(T),F=c(R),Pu(R),D=0;D<l.length;++D)M=l[D],O=F[D],C[M]=O,Lu(O);return e.next=60,v.onBatchEnd(w,C);case 60:Rw(C),w++,k++;case 63:if(!(a?k>=r.batchesPerEpoch:S.done)){e.next=77;break}if(!i){e.next=76;break}if(P=void 0,!RS(r.validationData)){e.next=74;break}return e.t3=$b,e.next=70,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 70:e.t4=e.sent,P=(0,e.t3)(e.t4),e.next=75;break;case 74:P=$b(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?IS:r.validationBatchSize,verbose:0}));case 75:for(L=0;L<t.metricsNames.length;++L)x["val_".concat(t.metricsNames[L])]=P[L];case 76:return e.abrupt("break",81);case 77:if(!t.stopTraining_){e.next=79;break}return e.abrupt("break",81);case 79:e.next=29;break;case 81:return e.next=83,v.onEpochEnd(y,x);case 83:if(y++,!t.stopTraining_){e.next=86;break}return e.abrupt("break",88);case 86:e.next=19;break;case 88:return e.next=90,v.onTrainEnd();case 90:return e.next=92,t.history.syncData();case 92:return e.abrupt("return",t.history);case 93:return e.prev=93,t.isTraining=!1,e.finish(93);case 96:case"end":return e.stop()}}),e,null,[[4,,93,96]])}))),ES.apply(this,arguments)}function AS(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function RS(e){return"function"==typeof e.iterator}function FS(e){return"function"==typeof e.next}function DS(e,t,n){return MS.apply(this,arguments)}function MS(){return MS=y(f().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=4;break}throw new qb("Verbose mode is not implemented yet.");case 4:if(Hi.assert(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but received ".concat(JSON.stringify(r.batches))})),!FS(n)){e.next=9;break}e.t0=n,e.next=12;break;case 9:return e.next=11,n.iterator();case 11:e.t0=e.sent;case 12:s=e.t0,u=0,c=0,l=f().mark((function e(){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=Ou((function(){if(n.value){var e=_S(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),l=Ou((function(){return i(s)}));if(Pu(s),0===c)for(var p=0;p<l.length;++p)o.push(Pl(0));for(var d=s[0].shape[0],f=function(e){var t=l[e],n=o[e];o[e]=Ou((function(){return Xu(o[e],Zu(d,t))})),c>0&&Pu(n)},h=0;h<l.length;++h)f(h);Pu(l),u+=d,++c}return o})),!n.done){e.next=6;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` batches (in this case, ".concat(r.batches," batches). You may need to use the repeat() function when building your dataset.")),e.abrupt("return","break");case 6:case"end":return e.stop()}}),e)}));case 16:if(a&&!(c<r.batches)){e.next=23;break}return e.delegateYield(l(),"t1",18);case 18:if("break"!==e.t1){e.next=21;break}return e.abrupt("break",23);case 21:e.next=16;break;case 23:for(p=0;p<o.length;++p)d=o[p],o[p]=Qu(o[p],u),Pu(d);return e.abrupt("return",Jb(o));case 25:case"end":return e.stop()}}),e)}))),MS.apply(this,arguments)}function OS(e){Hi.assert(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function PS(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return jx(e,t,n-t)})):jx(e,t,n-t)}function LS(e,t){return Ou((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return LS(e,t)})):Zx(e,"int32"===t.dtype?t:Iu(t,"int32"))}))}function zS(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function BS(e){var t=[];e instanceof To&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(Vx(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function WS(e,t){if(null!=e){var n=[];if(t instanceof To)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof To)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function US(e){return Array.isArray(e)}function VS(e){return!function(e){return e instanceof To}(e)&&!US(e)}function jS(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(US(e)&&e.length>0)o=!0;else if(VS(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new Hb("Error when checking model ".concat(i," expected no data, but got ").concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(VS(e)){r=[];var u,c=De(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new Hb('No data provided for "'.concat(l,'". Need data for each key in: ').concat(t));r.push(e[l])}}catch(v){c.e(v)}finally{c.f()}}else if(US(e)){if(e.length!==t.length)throw new Hb("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got the following list of Tensor(s): ").concat(e));r=e}else{if(t.length>1)throw new Hb("The model ".concat(i," expects ").concat(t.length," Tensor(s), but only received one Tensor. Found: Tensor with shape ").concat(e.shape));r=[e]}if(r=BS(r),null!=n)for(var p=0;p<t.length;++p)if(null!=n[p]){var d=r[p];if(d.shape.length!==n[p].length)throw new Hb("Error when checking ".concat(i,": expected ").concat(t[p]," to have ").concat(n[p].length," dimension(s). but got array with shape ").concat(d.shape));for(var f=0;f<n[p].length;++f)if(0!==f||a){var h=d.shape[f],m=n[p][f];if(null!=m&&m>=0&&h!==m)throw new Hb("".concat(i," expected a batch of elements where each example has shape [").concat(n[p].slice(1,n[p].length),"] (i.e.,tensor shape [*,").concat(n[p].slice(1,n[p].length),"]) but the ").concat(i," received an input with ").concat(d.shape[0]," examples, each with shape [").concat(d.shape.slice(1,d.shape.length),"] (tensor shape [").concat(d.shape,"])"))}}return r}function GS(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new Hb("Error when checking model ".concat(i,": the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ").concat(t.length," Tensor(s), but instead got ").concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new Hb("The model expects ".concat(t.length," ").concat(i," Tensors, but only received one Tensor. Found: array with shape ").concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new Hb("Error when checking ".concat(i,": expected ").concat(t[o]," to have ").concat(n[o].length," dimension(s), but got array with shape ").concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new Hb("Error when checking ".concat(i,": expected ").concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but got array with shape ").concat(JSON.stringify(s.shape),"."))}}}var HS=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).isTraining=!1,r}return v(n,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new Hb("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");pS(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"==typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return Cv.adagrad(.01)},Adadelta:function(){return Cv.adadelta(1,.95,Wx())},Adam:function(){return Cv.adam(.001,.9,.999,Wx())},Adamax:function(){return Cv.adamax(.002,.9,.999,Wx(),0)},RMSProp:function(){return Cv.rmsprop(.001,.9,0,Wx())},SGD:function(){return Cv.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new Hb("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof lm))throw new Hb("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"==typeof e.loss||"function"==typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new Hb("When passing an Array as loss, it should have one entry per model output. The model has ".concat(this.outputs.length," output(s), but you passed loss=").concat(e.loss,"."));n=e.loss.map((function(e){return Zw(e)}))}else{var r=Zw(e.loss);this.outputs.forEach((function(e){n.push(r)}))}else{for(var a in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(a))throw new Hb('Unknown entry in loss dictionary: "'.concat(a,'". Only expected the following keys: ').concat(this.outputNames));var i,o=De(this.outputNames);try{for(o.s();!(i=o.n()).done;){var s=i.value;null==e.loss[s]&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ').concat(s," during training")),n.push(Zw(e.loss[s]))}}catch(f){o.e(f)}finally{o.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var u=0;u<this.outputs.length;++u){var c=this.internalOutputShapes[u],l=this.outputNames[u];this.feedOutputNames.push(l),this.feedOutputShapes.push(c),this.feedLossFns.push(this.lossFunctions[u])}var p=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ex("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===p.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var d=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"==typeof e||"function"==typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!=typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=De(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(f){i.e(f)}finally{i.f()}return a}(e.metrics,this.outputNames);Ex("metric",(function(){for(var e=function(e){if(-1!==p.indexOf(e))return"continue";!function(n){var r,a,i,o,s=De(n);try{var u=function(){var n,s=o.value;if("string"==typeof s&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(s)){var u,c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===Xw?-1!==["accuracy","acc"].indexOf(s)?a=Jw:-1!==["crossentropy","ce"].indexOf(s)&&(a=rS):t.lossFunctions[e]===Kw?-1!==["accuracy","acc"].indexOf(s)?a=aS:-1!==["crossentropy","ce"].indexOf(s)&&(a=oS):-1!==["accuracy","acc"].indexOf(s)?a=$w:-1!==["crossentropy","ce"].indexOf(s)&&(a=iS),-1!==["accuracy","acc"].indexOf(s)?u="acc":-1!==["crossentropy","ce"].indexOf(s)&&(u="ce"),i=a,r=""+u}else i=function(e){if("string"==typeof e&&e in sS)return sS[e];if("string"!=typeof e&&null!=e)return e;throw new Hb("Unknown metric ".concat(e))}(s),r=""+uS(s);Ex(r,(function(){n=i})),function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])}(e,r,n)};for(s.s();!(o=s.n()).done;)u()}catch(f){s.e(f)}finally{s.f()}}(d[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;OS(r);var a=this.standardizeUserDataXY(e,t,!0,r);try{var i=a[0].concat(a[1]);this.makeTestFunction();var o=this.testFunction;return Jb(this.testLoop(o,i,r,n.verbose,n.steps))}finally{WS(a[0],e),WS(a[1],t)}}},{key:"evaluateDataset",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.makeTestFunction(),DS(this,t,n)));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new Hb("If ".concat(a," is set, batchSize must be null or undefined.Got batchSize = ").concat(t))}else{if(null==e)throw new Hb("Either the input data should have a defined shape, or ".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new Hb("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new jk;if(e instanceof To&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new Hb("The number of inputs provided (".concat(e.length,") does not match the number of inputs of this model (").concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=De(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=e[c.name];if(null==l)throw new Hb("No value is provided for the model's input ".concat(c.name));i.add(c,l)}}catch(d){u.e(d)}finally{u.f()}}var p=qk(a,i);return n?p:p[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=Yb(null,e.length),r=e.length,a=De(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(p){a.e(p)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new Hb("Cannot find SymbolicTensors for output name(s): ".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ou((function(){var a=t.checkNumSamples(e);if(r)throw new qb("Verbose predictLoop() is not implemented yet.");for(var i=zS(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){Ou((function(){var r=i[n][0],a=i[n][1],o=PS(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new jk(s);return qk(t.outputs,c)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return Jb(o.map((function(e){return Ec(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=BS(e);GS(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return OS(r),this.predictLoop(n,r)}finally{WS(n,e)}}},{key:"predictOnBatch",value:function(e){GS(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new Gb("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a];this.feedLossFns[a]===Kw?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(function(e,t,n){var r=sx(e.map((function(e){return e.shape[0]})));r.sort();var a=sx(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new Hb("All input Tensors (x) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new Hb("All target Tensors (y) should have the same number of samples. Got array shapes: ".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!Hi.arraysEqual(r,a))throw new Hb("Input Tensors should have the same number of samples as target Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target sample(s)."))}(e=jS(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=jS(t,this.feedOutputNames,r,!1,"target")),function(e,t,n){for(var r=[jw,Xw,qw],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===qw&&1===i.shape[i.shape.length-1])throw new Hb("You are passing a target array of shape ".concat(i.shape," while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes]."));if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var p=u[l],d=c[l];if(null!=d&&p!==d)throw new Hb("A target Tensor with shape ".concat(i.shape," was passed for an output of shape ").concat(s,", while using a loss function that expects targets to have the same shape as the output."))}}}}(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new Hb("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=y(f().mark((function e(t,n,r,a){var i,s,u,c,l,p,d,h,m,v=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(v.length>4&&void 0!==v[4])||v[4],s=v.length>5?v[5]:void 0,u=this.standardizeUserDataXY(t,n,i,s),c=o(u,2),l=c[0],p=c[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(d=null,null==a){e.next=19;break}h=xS(a,this.outputNames),d=[],m=0;case 10:if(!(m<h.length)){e.next=19;break}return e.t0=d,e.next=14,kS(p[m],null,h[m]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++m,e.next=10;break;case 19:return e.abrupt("return",[l,p,d]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return Ou((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new qb("Verbose mode is not implemented yet.");if(null!=i)throw new qb("steps mode in testLoop() is not implemented yet");for(var u=zS(o,n),c=df(Bx(0,o)),l=0;l<u.length;++l){var p=u[l][0],d=u[l][1],f=jx(c,p,d-p),h=LS(t,f),m=e(h);if(0===l)for(var v=0;v<m.length;++v)s.push(Pl(0));for(var g=0;g<m.length;++g){var y=m[g];s[g]=Xu(s[g],Zu(d-p,y))}}for(var b=0;b<s.length;++b)s[b]=Qu(s[b],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(Zb(e,r)>1){var i=Zb(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new jk(t),l=qk(e.outputs,c,{training:!0}),p=0;p<e.lossFunctions.length;++p){var d=(0,e.lossFunctions[p])(a[p],l[p]);null!=i[p]&&(d=SS(d,i[p]));var f=Dp(d);n.push(f),u=0===p?d:Xu(u,d)}for(var h=0;h<e.metricsTensors.length;++h){var m=void 0;if(e.outputs.length>1&&h<e.outputs.length)m=n[h];else{var v=e.metricsTensors[h][0],g=e.metricsTensors[h][1];m=Dp(v(a[g],l[g]))}Lu(m),o.push(m)}return u=Dp(u),e.calculateLosses().forEach((function(e){u=Xu(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return Ou((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new jk(o),c=qk(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var p=e.lossFunctions[l],d=Dp(p(i[l],c[l]));n=0===l?d:Xu(n,d),r.push(n)}for(var f=0;f<e.metricsTensors.length;++f){var h=e.metricsTensors[f][0],m=e.metricsTensors[f][1],v=Dp(h(i[m],c[m]));r.push(v)}return r}))}}},{key:"fit",value:function(){var e=y(f().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,d,h,m,v,g,y,b,x,k,w,S,I,_,N,C=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=C.length>2&&void 0!==C[2]?C[2]:{},!this.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return this.isTraining=!0,e.prev=4,OS(h=null==r.batchSize?32:r.batchSize),!1,e.next=10,this.standardizeUserData(t,n,r.sampleWeight,r.classWeight,false,h);case 10:if(m=e.sent,a=m[0],i=m[1],d=m[2],v=!1,!(null!=r.validationData&&r.validationData.length>0)){e.next=26;break}if(v=!0,2!==r.validationData.length){e.next=18;break}u=r.validationData[0],c=r.validationData[1],e.next=19;break;case 18:throw 3===r.validationData.length?new qb("validationData including sample weights is not supported yet."):new Hb("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ".concat(r.validationData," is invalid."));case 19:return!0,e.next=22,this.standardizeUserData(u,c,null,null,true,h);case 22:y=e.sent,l=y[0],p=y[1],g=l.concat(p),e.next=27;break;case 26:null!=r.validationSplit&&r.validationSplit>0&&r.validationSplit<1?(v=!0,b=Math.floor(a[0].shape[0]*(1-r.validationSplit)),x=a[0].shape[0],l=PS(a,b,x),o=a,a=PS(a,0,b),p=PS(i,b,x),s=i,i=PS(i,0,b),g=l.concat(p)):null!=r.validationSteps&&(v=!0);case 27:return k=a.concat(i).concat(d),this.checkTrainableWeightsConsistency(),w=this.makeTrainFunction(),S=this.getDedupedMetricsNames(),v?(this.makeTestFunction(),I=this.testFunction,_=S.slice().concat(S.map((function(e){return"val_"+e})))):(I=null,g=[],_=S.slice()),N=zw(r.callbacks,r.yieldEvery),e.next=34,this.fitLoop(w,k,S,h,r.epochs,r.verbose,N,I,g,r.shuffle,_,r.initialEpoch,null,null);case 34:return e.abrupt("return",e.sent);case 35:return e.prev=35,this.isTraining=!1,WS(a,t),WS(i,n),WS(o,t),WS(s,n),WS(l,u),WS(p,c),null!=d&&Pu(d),e.finish(35);case 38:case"end":return e.stop()}}),e,this,[[4,,35,38]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitLoop",value:function(){var e=y(f().mark((function e(t,n,r,a,i,o,s,u,c,l,p,d,h,m){var v,g,y,b,x,k,w,S,I=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==a&&(a=32),null==i&&(i=1),null==l&&(l=!0),null==d&&(d=0),v=!1,null!=u&&null!=c&&(v=!0),null==m||(v=!0,null!=h)){e.next=4;break}throw new Hb("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 4:return null!=(g=this.checkNumSamples(n,a,h,"steps_per_epoch"))&&(y=Bx(0,g)),null==o&&(o=1),b=Ww(s,o,i,d,g,h,a,v,p),x=b.callbackList,k=b.history,x.setModel(this),this.history=k,e.next=11,x.onTrainBegin();case 11:this.stopTraining_=!1,w=f().mark((function e(){var i,o,s,p,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.onEpochBegin(S);case 2:if(i={},null==h){e.next=5;break}throw new qb("stepsPerEpoch mode is not implemented yet.");case 5:if("batch"!==l){e.next=7;break}throw new qb("batch shuffling is not implemneted yet");case 7:l&&Hi.shuffle(y),o=df(y),s=zS(g,a),p=f().mark((function e(l){var p;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p={},e.next=3,x.onBatchBegin(l,p);case 3:return Ou((function(){var e=s[l][0],d=s[l][1],f=jx(o,e,d-e);p.batch=l,p.size=d-e;for(var h=LS(n,f),m=t(h),g=0;g<r.length;++g){var y=r[g],b=m[g];p[y]=b,Lu(b)}if(l===s.length-1&&v)for(var x=I.testLoop(u,c,a),k=0;k<r.length;++k){var w=r[k],S=x[k];Lu(S),i["val_"+w]=S}})),e.next=6,x.onBatchEnd(l,p);case 6:if(Rw(p),!I.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),d=0;case 11:if(!(d<s.length)){e.next=19;break}return e.delegateYield(p(d),"t0",13);case 13:if("break"!==e.t0){e.next=16;break}return e.abrupt("break",19);case 16:++d,e.next=11;break;case 19:return o.dispose(),e.next=22,x.onEpochEnd(S,i);case 22:if(!I.stopTraining_){e.next=24;break}return e.abrupt("return","break");case 24:case"end":return e.stop()}}),e)})),S=d;case 14:if(!(S<i)){e.next=22;break}return e.delegateYield(w(),"t0",16);case 16:if("break"!==e.t0){e.next=19;break}return e.abrupt("break",22);case 19:++S,e.next=14;break;case 22:return e.next=24,x.onTrainEnd();case 24:return e.next=26,this.history.syncData();case 26:return e.abrupt("return",this.history);case 27:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i,o,s,u,c,l,p,d,f,h){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",TS(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=y(f().mark((function e(t,n){var r,a,i,o,s,u,c,l,p;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction()(a.concat(i)),s=[],u=De(o),e.prev=8,u.s();case 10:if((c=u.n()).done){e.next=18;break}return l=c.value,e.next=14,l.data();case 14:p=e.sent,s.push(p[0]);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),u.e(e.t0);case 23:return e.prev=23,u.f(),e.finish(23);case 26:return e.abrupt("return",(Pu(o),WS(r[0],t),WS(r[1],n),Jb(s)));case 27:case"end":return e.stop()}}),e,this,[[8,20,23,26]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=Se(we(n.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=Du().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Du().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"==typeof this.loss)e=ex(this.loss);else if(Array.isArray(this.loss)){var t,n=De(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!=typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(u){n.e(u)}finally{n.f()}e=this.loss.map((function(e){return ex(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!=typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=ex(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"==typeof this.metrics||"function"==typeof this.metrics)return[ex(uS(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return ex(uS(e))}));var e={};for(var t in this.metrics)e[t]=ex(uS(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=Uw(vS(e.optimizer_config));if("string"==typeof e.loss)t=tx(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return tx(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=tx(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return tx(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=tx(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var e=y(f().mark((function e(t,n){var r,a,i,o,s,u,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=bm.getSaveHandlers(t)).length){e.next=4;break}throw new Hb("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Hb("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Hb("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.next=11,bm.encodeWeights(this.getNamedWeights(n));case 11:if(a=e.sent,!1,null,i={modelTopology:this.toJSON(null,false),format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(yS),convertedBy:null},null==n||!n.includeOptimizer||null==this.optimizer){e.next=29;break}return i.trainingConfig=this.getTrainingConfig(),s="optimizer",e.t0=bm,e.next=21,this.optimizer.getWeights();case 21:return e.t1=e.sent,e.t2=s,e.next=25,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 25:u=e.sent,c=u.data,l=u.specs,(o=a.specs).push.apply(o,Fe(l)),a.data=bm.concatenateArrayBuffers([a.data,c]);case 29:return e.abrupt("return",(null!=this.userDefinedMetadata&&(cS(this.userDefinedMetadata,this.name,!0),i.userDefinedMetadata=this.userDefinedMetadata),i.weightData=a.data,i.weightSpecs=a.specs,t.save(i)));case 30:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){cS(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),n}(bS);HS.className="Model",om.registerClass(HS);var qS=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n)}(HS);function KS(e,t){return XS.apply(this,arguments)}function XS(){return XS=y(f().mark((function e(t,n){var r,a,i,o,s,u,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("modelTopology"in t||(t={modelTopology:t}),null!=(r=t.modelTopology).model_config&&(r=r.model_config),a=vS(r),i=Uw(a,n),null==t.weightsManifest){e.next=12;break}return e.next=7,bm.loadWeights(t.weightsManifest,t.pathPrefix,i.weights.map((function(e){return e.originalName})));case 7:o=e.sent,s={},u=De(i.weights);try{for(u.s();!(c=u.n()).done;)l=c.value,s[l.originalName]=o[l.originalName]}catch(p){u.e(p)}finally{u.f()}i.loadWeights(s),Pu(o);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e)}))),XS.apply(this,arguments)}function YS(e,t){return QS.apply(this,arguments)}function QS(){return QS=y(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!=typeof t){e.next=9;break}if(0!==(r=bm.getLoadHandlers(t,n)).length){e.next=6;break}r.push(bm.browserHTTPRequest(t,n)),e.next=8;break;case 6:if(!(r.length>1)){e.next=8;break}throw new Hb("Found more than one (".concat(r.length,") load handlers for URL '").concat(t,"'"));case 8:t=r[0];case 9:return e.abrupt("return",ZS(t,void 0,n));case 10:case"end":return e.stop()}}),e)}))),QS.apply(this,arguments)}function ZS(e,t,n){return JS.apply(this,arguments)}function JS(){return JS=y(f().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=2;break}throw new Hb("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 2:return e.next=4,t.load();case 4:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),o=null==r.strict||r.strict,s=null!=a.weightData&&null!=a.weightSpecs&&o,u=Uw(vS(i),n,s),null!=(c=a.trainingConfig)&&u.loadTrainingConfig(c),null!=a.userDefinedMetadata&&u.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=19;break}if(null!=a.weightSpecs){e.next=11;break}throw new Hb("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 11:if(l=$S(a.weightData,a.weightSpecs),p=l.modelWeights,d=l.optimizerWeights,u.loadWeights(p,o),e.t0=null!=u.optimizer&&d.length>0,!e.t0){e.next=17;break}return e.next=17,u.optimizer.setWeights(d);case 17:Pu(p),Pu(d.map((function(e){return e.tensor})));case 19:return e.abrupt("return",u);case 20:case"end":return e.stop()}}),e)}))),JS.apply(this,arguments)}function $S(e,t){var n=bm.decodeWeights(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}qS.className="Functional",om.registerClass(qS);var eI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:gx("sequential_"),null!=e.layers){var a,i=De(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(s){i.e(s)}finally{i.f()}}return Ee(r)}return v(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new Hb("Negative dimension size caused by adding layer ".concat(e.name," with input shape [").concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof HS;if(r){if(1!==(t=e).outputs.length)throw new Hb("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new Hb("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new Hb("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=Vk({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new Hb("A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ".concat(e.name," which has ").concat(e.inboundNodes.length," pre-existing inbound connections."));if(1!==e.inboundNodes[0].outputTensors.length)throw new Hb("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=Wk(this.outputs[0])}this.inboundNodes=[],new Lk({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Yb(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(Tk(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new HS({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),Se(we(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),Se(we(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new Gb("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new Gb("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=y(f().mark((function e(t,n){var r,a=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new Gb("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new Gb("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new Hb("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new Hb("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=De(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(i){n.e(i)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new Hb("Legacy serialization format not supported yet.");r=t}else Hi.assert(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new qb("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=De(r);try{for(u.s();!(s=u.n()).done;){var c=Uw(s.value,void 0,a);a&&c.setFastWeightInitDuringBuild(!0),o.add(c)}}catch(l){u.e(l)}finally{u.f()}return o}}]),n}(HS);function tI(e){return new HS(e)}function nI(e){return new eI(e)}function rI(e){return Vk(e)}function aI(e,t){Bw.registerCallbackConstructor(e,t)}eI.className="Sequential",om.registerClass(eI);var iI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"getConfig",value:function(){return{}}}]),n}(om.Serializable),oI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new qb("Support for alpha values other than 1 (".concat(t,") is not implemented yet."));return Sl(e)}(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}}]),n}(iI);oI.className="elu",om.registerClass(oI);var sI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return Vd(e)}}]),n}(iI);sI.className="selu",om.registerClass(sI);var uI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return Dd(e)}}]),n}(iI);uI.className="relu",om.registerClass(uI);var cI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return Ou((function(){return Lp(6,Dd(e))}))}}]),n}(iI);cI.className="relu6",om.registerClass(cI);var lI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return e}}]),n}(iI);lI.className="linear",om.registerClass(lI);var pI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return Rc(e)}}]),n}(iI);pI.className="sigmoid",om.registerClass(pI);var dI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return function(e){return Ou((function(){var t=Xu(.5,Zu(.2,e));return qc(t,0,1)}))}(e)}}]),n}(iI);dI.className="hardSigmoid",om.registerClass(dI);var fI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return gp(e)}}]),n}(iI);fI.className="softplus",om.registerClass(fI);var hI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return function(e){return Ou((function(){return Qu(e,Xu(Ju(e),1))}))}(e)}}]),n}(iI);hI.className="softsign",om.registerClass(hI);var mI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return Dc(e)}}]),n}(iI);mI.className="tanh",om.registerClass(mI);var vI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return $d(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(iI);vI.className="softmax",om.registerClass(vI);var gI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return xp(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1)}}]),n}(iI);gI.className="logSoftmax",om.registerClass(gI);var yI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Ou((function(){return Zu(Rc(Zu(e,t)),e)}))}}]),n}(iI);yI.className="swish",om.registerClass(yI);var bI=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e){return Ou((function(){return Zu(e,Dc(gp(e)))}))}}]),n}(iI);function xI(e){return e.getClassName()}function kI(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ix(e,om.SerializationMap.getMap().classNameMap,t,"activation")}function wI(e){if(null==e){var t={className:"linear",config:{}};return kI(t)}if("string"==typeof e){var n={};return n.className=e,n.config={},kI(n)}return e instanceof iI?e:kI(e)}function SI(e){if(null!=e&&"object"!=typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an object, but received: ".concat(e))}bI.className="mish",om.registerClass(bI);var II=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n)}(om.Serializable),_I=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),r=t.call(this),SI(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return v(n,[{key:"apply",value:function(e){var t=this;return Ou((function(){var n=Mp([1]);return t.hasL1&&(n=Xu(n,Bl(Zu(t.l1,Ju(e))))),t.hasL2&&(n=Xu(n,Bl(Zu(t.l2,Jx(e))))),Nc(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(II);_I.className="L1L2",om.registerClass(_I);var NI={l1l2:"L1L2"};function CI(e){return rx(e)}function TI(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ix(e,om.SerializationMap.getMap().classNameMap,t,"regularizer")}function EI(e){return null==e?null:"string"==typeof e?TI({className:e in NI?NI[e]:e,config:{}}):e instanceof II?e:TI(e)}var AI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return v(n,[{key:"call",value:function(e,t){e=Ck(e);var n=Dd(e);return null!=this.maxValue&&(n=qc(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);AI.className="ReLU",om.registerClass(AI);var RI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return v(n,[{key:"call",value:function(e,t){var n=Ck(e);return np(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);RI.className="LeakyReLU",om.registerClass(RI);var FI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=Ik(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=EI(e.alphaRegularizer),r.alphaConstraint=ow(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!=typeof e.sharedAxes)throw new Hb("Expected sharedAxes to be a number or an array of numbers, but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return Ee(r)}return v(n,[{key:"build",value:function(e){var t=(e=Tk(e)).slice(1);if(null!=this.sharedAxes){var n,r=De(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(o){r.e(o)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new Mk({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=Ck(e),ed(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:Sk(this.alphaInitializer),alphaRegularizer:CI(this.alphaRegularizer),alphaConstraint:aw(this.alphaConstraint),sharedAxes:this.sharedAxes},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);FI.className="PReLU",om.registerClass(FI);var DI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new qb("Non-default alpha value (".concat(e.alpha,") is not supported by the ELU layer yet."));return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,Ee(r)}return v(n,[{key:"call",value:function(e,t){var n=Ck(e);return Sl(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);DI.className="ELU",om.registerClass(DI);var MI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return v(n,[{key:"call",value:function(e,t){var n=Ck(e);return Zu(n,Iu(Ql(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);MI.className="ThresholdedReLU",om.registerClass(MI);var OI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new vI).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return v(n,[{key:"call",value:function(e,t){var n=Ck(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);function PI(e,t,n){if("number"==typeof e)return Yb(e,t);if(e.length!==t)throw new Hb("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if(!Ox(a))throw new Hb("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers. Received: ").concat(JSON.stringify(e)," including a non-integer number ").concat(a))}return e}function LI(e,t,n,r){var a;return null==e?e:(a="same"===n?e:e-(t+(t-1)*((arguments.length>4&&void 0!==arguments[4]?arguments[4]:1)-1))+1,Math.floor((a+r-1)/r))}function zI(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+zx([n-t,0]);else{if("same"!==r)throw new Hb("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function BI(e,t){return Ou((function(){return Ix(t),"channelsFirst"===t?Af(e,[0,2,3,1]):e}))}function WI(e,t){return Ou((function(){return Ix(t),"channelsFirst"===t?Af(e,[0,2,3,4,1]):e}))}function UI(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return Ou((function(){if(null==i&&(i="channelsLast"),Ix(i),3!==e.rank&&4!==e.rank)throw new Hb("conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new Hb("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ".concat(e.rank,"."));var u=BI(e,i);if("causal"===a)throw new qb("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=Gf.conv2d({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=Af(u,[0,3,1,2])),u}))}OI.className="Softmax",om.registerClass(OI);var VI=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;if(h(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,px(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new qb("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is not implemented yet."));if(a.kernelSize=PI(r.kernelSize,e,"kernelSize"),a.strides=PI(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,_x(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,Ix(a.dataFormat),a.activation=wI(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=Ik(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=ow(r.biasConstraint),a.biasRegularizer=EI(r.biasRegularizer),a.activityRegularizer=EI(r.activityRegularizer),a.dilationRate=PI(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new Hb("dilationRate must be a number or an array of a single number for 1D convolution, but received ".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new Hb("dilationRate must be a number or array of two numbers for 2D convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"==typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new Hb("dilationRate must be a number or array of three numbers for 3D convolution, but received ".concat(JSON.stringify(a.dilationRate)));return Ee(a)}return v(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:xI(this.activation),useBias:this.useBias,biasInitializer:Sk(this.biasInitializer),biasRegularizer:CI(this.biasRegularizer),activityRegularizer:CI(this.activityRegularizer),biasConstraint:aw(this.biasConstraint)},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(Qb("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!=typeof e.kernelSize&&!lx(e.kernelSize,"number",1,3))throw new Hb("BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(Bk),jI=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,px(a.filters,"filters"),a.kernelInitializer=Ik(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=ow(r.kernelConstraint),a.kernelRegularizer=EI(r.kernelRegularizer),a}return v(n,[{key:"build",value:function(e){e=Tk(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Hb("The channel dimension of the input should be defined. Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:c({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ou((function(){e=Ck(e);var t,r=null==n.bias?null:n.bias.read(),a=fx(n.activation.getClassName());if(null!=a&&2===n.rank)t=UI(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Ou((function(){if(null==i&&(i="channelsLast"),Ix(i),3!==e.shape.length)throw new Hb("The input of a conv1dWithBias operation should be 3, but is ".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new Hb("The kernel for a conv1dWithBias operation should be 3, but is ".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new Hb("The bias for a conv1dWithBias operation should be 1, but is ".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=Af(e,[0,2,1])),"causal"===a)throw new qb("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=Jc(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=ek(s,n)),s}))}(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=UI(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new qb("convolutions greater than 3D are not implemented yet.");t=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return Ou((function(){if(null==i&&(i="channelsLast"),Ix(i),4!==e.rank&&5!==e.rank)throw new Hb("conv3dWithBias expects input to be of rank 4 or 5, but received ".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new Hb("conv3dWithBias expects kernel to be of rank 4 or 5, but received ".concat(e.rank,"."));var s=WI(e,i);if("causal"===a)throw new qb("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=tl(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=ek(s,n)),"channelsFirst"===i&&(s=Af(s,[0,4,1,2,3])),s}))}(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=Tk(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=LI(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"==typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:Sk(this.kernelInitializer),kernelRegularizer:CI(this.kernelRegularizer),kernelConstraint:aw(this.kernelConstraint)},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!=typeof e.filters||e.filters<1)throw new Hb("Convolution layer expected config.filters to be a 'number' > 0 but got ".concat(JSON.stringify(e.filters)))}}]),n}(VI),GI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return v(n,[{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!lx(e.kernelSize,"number",1,2))throw new Hb("Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(jI);GI.className="Conv2D",om.registerClass(GI);var HI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return v(n,[{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new Hb("Conv3D expects config.kernelSize to be number or [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(jI);HI.className="Conv3D",om.registerClass(HI);var qI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),(r=t.call(this,e)).inputSpec=[new Mk({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new Hb("Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return Ee(r)}return v(n,[{key:"build",value:function(e){if(4!==(e=Tk(e)).length)throw new Hb("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Hb("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Mk({ndim:4,axes:c({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var t=Ck(e);if(4!==t.shape.length)throw new Hb("Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],l=n.kernelSize[1],p=n.strides[0],d=n.strides[1],f=[o,zI(s,p,c,n.padding),zI(u,d,l,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=Af(t,[0,2,3,1]));var h=el(t,n.kernel.read(),f,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(h=Af(h,[0,3,1,2])),null!=n.bias&&(h=ek(h,n.bias.read(),n.dataFormat)),null!=n.activation&&(h=n.activation.apply(h)),h}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=Tk(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=zI(a[n],s,i,this.padding),a[r]=zI(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(GI);qI.className="Conv2DTranspose",om.registerClass(qI);var KI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),(r=t.call(this,e)).inputSpec=[new Mk({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new Hb("Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ".concat(r.padding));return Ee(r)}return v(n,[{key:"build",value:function(e){if(5!==(e=Tk(e)).length)throw new Hb("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new Hb("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Mk({ndim:5,axes:c({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var t=Ck(e);if(5!==t.shape.length)throw new Hb("Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],c=o[r],l=o[a],p=n.kernelSize[0],d=n.kernelSize[1],f=n.kernelSize[2],h=n.strides[0],m=n.strides[1],v=n.strides[2],g=[s,zI(u,h,p,n.padding),zI(c,m,d,n.padding),zI(l,v,f,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=Af(t,[0,2,3,4,1]));var y=rl(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(y=Af(y,[0,4,1,2,3])),null!==n.bias&&(y=ek(y,n.bias.read(),n.dataFormat)),null!==n.activation&&(y=n.activation.apply(y)),y}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=Tk(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],p=this.strides[2];return i[t]=this.filters,i[n]=zI(i[n],c,o,this.padding),i[r]=zI(i[r],l,s,this.padding),i[a]=zI(i[a],p,u,this.padding),i}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(HI);KI.className="Conv3DTranspose",om.registerClass(KI);var XI=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;if(h(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new Hb("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new Hb("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new Hb("SeparableConv".concat(a.rank,"D supports only padding modes: 'same' and 'valid', but received ").concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=Ik(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=EI(r.depthwiseRegularizer),a.depthwiseConstraint=ow(r.depthwiseConstraint),a.pointwiseInitializer=Ik(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=EI(r.pointwiseRegularizer),a.pointwiseConstraint=ow(r.pointwiseConstraint),Ee(a)}return v(n,[{key:"build",value:function(e){if((e=Tk(e)).length<this.rank+2)throw new Hb("Inputs to SeparableConv".concat(this.rank,"D should have rank ").concat(this.rank+2,", but received input shape: ").concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new Hb("The channel dimension of the inputs should be defined, but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);var o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new Mk({ndim:this.rank+2,axes:c({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var t;if(e=Ck(e),1===n.rank)throw new qb("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=Af(e,[0,2,3,1])),t=jd(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=ek(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=Af(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Sk(this.depthwiseInitializer),e.pointwiseInitializer=Sk(this.pointwiseInitializer),e.depthwiseRegularizer=CI(this.depthwiseRegularizer),e.pointwiseRegularizer=CI(this.pointwiseRegularizer),e.depthwiseConstraint=aw(this.depthwiseConstraint),e.pointwiseConstraint=aw(this.pointwiseConstraint),e}}]),n}(jI);XI.className="SeparableConv";var YI=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,2,e)}return v(n)}(XI);YI.className="SeparableConv2D",om.registerClass(YI);var QI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return v(n,[{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!=typeof e.kernelSize&&!lx(e.kernelSize,"number",1,1))throw new Hb("Conv1D expects config.kernelSize to be number or number[] with length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(jI);QI.className="Conv1D",om.registerClass(QI);var ZI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),r=t.call(this,e),"number"==typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"==typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return v(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return Ou((function(){if(e=Ck(e),"channelsLast"===n.dataFormat){var t=Hx(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return Hx(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=Hx(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return Hx(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);ZI.className="Cropping2D",om.registerClass(ZI);var JI=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ix(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,function(e){cx(bx,"InterpolationFormat",e)}(r.interpolation),r}return v(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var t=Ck(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=Af(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?tm.resizeNearestNeighbor(t,[a,i]):tm.resizeBilinear(t,[a,i]);return Af(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?tm.resizeNearestNeighbor(t,[s,u]):tm.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);JI.className="UpSampling2D",om.registerClass(JI);var $I=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=Ik(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=ow(e.depthwiseConstraint),r.depthwiseRegularizer=EI(e.depthwiseRegularizer),r}return v(n,[{key:"build",value:function(e){if((e=Tk(e)).length<4)throw new Hb("Inputs to DepthwiseConv2D should have rank 4. Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new Hb("The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return Ou((function(){null==a&&(a="channelsLast"),Ix(a);var o=BI(e,a);if(4!==e.rank)throw new Hb("Input for depthwiseConv2d is required to be 4-D, but is instead ".concat(e.rank,"-D"));if(4!==t.rank)throw new Hb("depthwiseKernel is required to be 4-D, but is instead ".concat(t.rank,"-D"));return o=ll(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=Af(o,[0,3,1,2])),o}))}(e=Ck(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=ek(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=Tk(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=LI(t,this.kernelSize[0],this.padding,this.strides[0]),i=LI(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Sk(this.depthwiseInitializer),e.depthwiseRegularizer=CI(this.depthwiseRegularizer),e.depthwiseConstraint=aw(this.depthwiseRegularizer),e}}]),n}(VI);function e_(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new Hb("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function t_(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return Ou((function(){var u=t.shape.length;if(u<3)throw new Hb("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(Bx(2,u));if(t=Af(t,c),null!=i)throw new qb("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=Iu(Iu(a,"bool"),"float32")).rank===u-1&&(a=Gl(a,-1)),a=Af(a,c)),r&&(t=Od(t,0),null!=a&&(a=Od(a,0)));var l,p,d=[],f=n,h=t.shape[0],m=wf(t);null!=a&&(p=wf(a));for(var v,g=function(t){var n=m[t],r=Ou((function(){return e(n,f)}));if(null==a)l=r[0],f=r[1];else{var i=Ou((function(){var e=p[t],n=bp(Hp(e),e),a=Xu(Zu(r[0],e),Zu(f[0],n)),i=f.map((function(t,a){return Xu(Zu(r[1][a],e),Zu(t,n))}));return{output:a,newStates:i}}));l=i.output,f=i.newStates}s&&d.push(l)},y=0;y<h;++y)g(y);return s&&(v=uf(d,1)),[l,v,f]}))}$I.className="DepthwiseConv2D",om.registerClass($I);var n_=function(e){Ae(n,e);var t=Re(n);function n(e){var r,a;if(h(this,n),r=t.call(this,e),null==e.cell)throw new Hb("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new l_({cells:e.cell}):e.cell).stateSize)throw new Hb("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new Mk({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return v(n,[{key:"getStates",value:function(){return null==this.states_?Bx(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){_k(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=De(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(u){o.e(u)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return Ou((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new qb("Constants support is not implemented in RNN yet.");_k(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new Mk({shape:[t,null].concat(Fe(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!Hi.arraysEqual(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new Hb("An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; However cell.stateSize is ").concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new Mk({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Ou((function(){if(!t.stateful)throw new jb("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new Hb("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Mp([r,e])})):t.states_=[Mp([r,t.cell.stateSize])];else if(null==e)Pu(t.states_),null!=t.keptStates&&(Pu(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return Mp([r,e])})):t.states_[0]=Mp([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new Hb("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));!0===n?t.keptStates.push(t.states_.slice()):Pu(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!Hi.arraysEqual(i.shape,s))throw new Hb("State ".concat(a," is incompatible with layer ").concat(t.name,": expected shape=").concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return Lu(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=e_(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=De(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new Mk({shape:l.shape}))}}catch(m){c.e(m)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof Ok){var p=[e].concat(o),d=this.inputSpec.concat(s),f=this.inputSpec;this.inputSpec=d;var h=Se(we(n.prototype),"apply",this).call(this,p,t);return this.inputSpec=f,h}return Se(we(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=Ck(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new Hb("RNN Layer has ".concat(o," state(s) but was passed ").concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=t_((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],p=u[2];n.stateful&&n.resetStates(p,a);var d=n.returnSequences?l:c;return n.returnState?[d].concat(p):d}))}},{key:"getInitialState",value:function(e){var t=this;return Ou((function(){var n=Mp(e.shape);return n=Vx(n=Bl(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?Xx(n,[1,e]):n})):t.cell.stateSize>1?[Xx(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){Se(we(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign(Object.assign(Object.assign({},r),e),t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Uw(t.cell,n);return new e(Object.assign(t,{cell:r}))}}]),n}(Bk);n_.className="RNN",om.registerClass(n_);var r_=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n)}(Bk),a_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,px(r.units,"units"),r.activation=wI(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Ik(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Ik(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Ik(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=EI(e.kernelRegularizer),r.recurrentRegularizer=EI(e.recurrentRegularizer),r.biasRegularizer=EI(e.biasRegularizer),r.kernelConstraint=ow(e.kernelConstraint),r.recurrentConstraint=ow(e.recurrentConstraint),r.biasConstraint=ow(e.biasConstraint),r.dropout=Lx([1,zx([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Lx([1,zx([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return v(n,[{key:"build",value:function(e){e=Tk(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ou((function(){if(2!==e.length)throw new Hb("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=p_({ones:function(){return Hp(e)},rate:n.dropout,training:a,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=p_({ones:function(){return Hp(r)},rate:n.recurrentDropout,training:a,dropoutFunc:n.dropoutFunc}));var i,o=n.dropoutMask,s=n.recurrentDropoutMask;i=Qx(null!=o?Zu(e,o):e,n.kernel.read()),null!=n.bias&&(i=ek(i,n.bias.read())),null!=s&&(r=Zu(r,s));var u=Xu(i,Qx(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:xI(this.activation),useBias:this.useBias,kernelInitializer:Sk(this.kernelInitializer),recurrentInitializer:Sk(this.recurrentInitializer),biasInitializer:Sk(this.biasInitializer),kernelRegularizer:CI(this.kernelRegularizer),recurrentRegularizer:CI(this.recurrentRegularizer),biasRegularizer:CI(this.biasRegularizer),activityRegularizer:CI(this.activityRegularizer),kernelConstraint:aw(this.kernelConstraint),recurrentConstraint:aw(this.recurrentConstraint),biasConstraint:aw(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}]),n}(r_);a_.className="SimpleRNNCell",om.registerClass(a_);var i_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),e.cell=new a_(e),t.call(this,e)}return v(n,[{key:"call",value:function(e,t){var r=this;return Ou((function(){null!=r.cell.dropoutMask&&(Pu(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Pu(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Se(we(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(n_);i_.className="SimpleRNN",om.registerClass(i_);var o_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new Hb("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,px(r.units,"units"),r.activation=wI(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=wI(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Ik(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Ik(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Ik(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=EI(e.kernelRegularizer),r.recurrentRegularizer=EI(e.recurrentRegularizer),r.biasRegularizer=EI(e.biasRegularizer),r.kernelConstraint=ow(e.kernelConstraint),r.recurrentConstraint=ow(e.recurrentConstraint),r.biasConstraint=ow(e.biasConstraint),r.dropout=Lx([1,zx([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Lx([1,zx([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,Ee(r)}return v(n,[{key:"build",value:function(e){var t=(e=Tk(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ou((function(){if(2!==e.length)throw new Hb("GRUCell expects 2 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=p_({ones:function(){return Hp(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=p_({ones:function(){return Hp(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var i,s,u,c=n.dropoutMask,l=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Zu(e,c[0]));var p=Qx(e,n.kernel.read());n.useBias&&(p=ek(p,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Zu(a,l[0]));var d=n.recurrentKernel.read(),f=o(rf(d,[2*n.units,n.units],d.rank-1),2),h=f[0],m=f[1],v=Qx(a,h),g=o(rf(p,3,p.rank-1),3),y=g[0],b=g[1],x=g[2],k=o(rf(v,2,v.rank-1),2),w=k[0],S=k[1];i=n.recurrentActivation.apply(Xu(y,w)),s=n.recurrentActivation.apply(Xu(b,S));var I=Qx(Zu(s,a),m);u=n.activation.apply(Xu(x,I));var _=Xu(Zu(i,a),Zu(Xu(1,vp(i)),u));return[_,_]}))}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:xI(this.activation),recurrentActivation:xI(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Sk(this.kernelInitializer),recurrentInitializer:Sk(this.recurrentInitializer),biasInitializer:Sk(this.biasInitializer),kernelRegularizer:CI(this.kernelRegularizer),recurrentRegularizer:CI(this.recurrentRegularizer),biasRegularizer:CI(this.biasRegularizer),activityRegularizer:CI(this.activityRegularizer),kernelConstraint:aw(this.kernelConstraint),recurrentConstraint:aw(this.recurrentConstraint),biasConstraint:aw(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}]),n}(r_);o_.className="GRUCell",om.registerClass(o_);var s_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new o_(e),t.call(this,e)}return v(n,[{key:"call",value:function(e,t){var r=this;return Ou((function(){null!=r.cell.dropoutMask&&(Pu(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Pu(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Se(we(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(n_);s_.className="GRU",om.registerClass(s_);var u_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,px(r.units,"units"),r.activation=wI(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=wI(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=Ik(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=Ik(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=Ik(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=EI(e.kernelRegularizer),r.recurrentRegularizer=EI(e.recurrentRegularizer),r.biasRegularizer=EI(e.biasRegularizer),r.kernelConstraint=ow(e.kernelConstraint),r.recurrentConstraint=ow(e.recurrentConstraint),r.biasConstraint=ow(e.biasConstraint),r.dropout=Lx([1,zx([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=Lx([1,zx([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return v(n,[{key:"build",value:function(e){var t,n,r=(e=Tk(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new sk).apply([i]),o=a.apply([2*i]);return Kx(Kx(n,r),o)}}]),n}(ik),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new Hb("LSTMCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=p_({ones:function(){return Hp(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=p_({ones:function(){return Hp(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s,u,c,l,p=n.dropoutMask,d=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Zu(e,p[0]));var f=Qx(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Zu(a,d[0])),f=Xu(f,Qx(a,n.recurrentKernel.read())),n.useBias&&(f=ek(f,n.bias.read()));var h=o(rf(f,4,f.rank-1),4),m=h[0],v=h[1],g=h[2],y=h[3];s=n.recurrentActivation.apply(m),u=n.recurrentActivation.apply(v),c=Xu(Zu(u,i),Zu(s,n.activation.apply(g))),l=n.recurrentActivation.apply(y);var b=Zu(l,n.activation.apply(c));return[b,b,c]}))}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:xI(this.activation),recurrentActivation:xI(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Sk(this.kernelInitializer),recurrentInitializer:Sk(this.recurrentInitializer),biasInitializer:Sk(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:CI(this.kernelRegularizer),recurrentRegularizer:CI(this.recurrentRegularizer),biasRegularizer:CI(this.biasRegularizer),activityRegularizer:CI(this.activityRegularizer),kernelConstraint:aw(this.kernelConstraint),recurrentConstraint:aw(this.recurrentConstraint),biasConstraint:aw(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}]),n}(r_);u_.className="LSTMCell",om.registerClass(u_);var c_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new u_(e),t.call(this,e)}return v(n,[{key:"call",value:function(e,t){var r=this;return Ou((function(){null!=r.cell.dropoutMask&&(Pu(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Pu(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Se(we(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(n_);c_.className="LSTM",om.registerClass(c_);var l_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).cells=e.cells,r}return v(n,[{key:"stateSize",get:function(){var e,t=[],n=De(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,Fe(r.stateSize)):t.push(r.stateSize)}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var r,a=e.slice(1),i=[],o=De(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(v){o.e(v)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var p=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=p.call(u,t),c.push(u.slice(1))}a=[];var d,f=De(c.slice().reverse());try{for(f.s();!(d=f.n()).done;){var h,m=d.value;(h=a).push.apply(h,Fe(m))}}catch(v){f.e(v)}finally{f.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;_k(e)&&(e=e[0]),this.cells.forEach((function(n,r){Ex("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign(Object.assign({},e),t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=De(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Fe(r.trainableWeights))}}catch(a){n.e(a)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=De(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Fe(r.nonTrainableWeights))}}catch(u){n.e(u)}finally{n.f()}if(!this.trainable){var a,i=[],o=De(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Fe(s.trainableWeights))}}catch(u){o.e(u)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=De(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Fe(r.weights))}}catch(a){n.e(a)}finally{n.f()}return Fk(t)}},{key:"setWeights",value:function(e){var t,n=[],r=De(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch(u){r.e(u)}finally{r.f()}Dk(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=De(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(Uw(o,r))}}catch(s){i.e(s)}finally{i.f()}return new e({cells:a})}}]),n}(r_);function p_(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):tk(t(),n)},c=function(){return nk(u,t,a)};return!o||o<=1?Lu(c().clone()):Array(o).fill(void 0).map(c).map((function(e){return Lu(e.clone())}))}l_.className="StackedRNNCells",om.registerClass(l_);var d_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),e.unroll)throw new qb("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new qb("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new Mk({ndim:5})],r}return v(n,[{key:"call",value:function(e,t){var r=this;return Ou((function(){if(null!=r.cell.dropoutMask&&(Pu(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(Pu(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new Hb("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return Se(we(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(Fe(t.slice(2)))),this.returnState&&(t=[t].concat(Fe(Array(2).fill([e[0]].concat(Fe(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return Ou((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=Mp([a[0]].concat(Fe(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Ou((function(){if(!t.stateful)throw new jb("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat(Fe(a.slice(2)));if(null==r[0])throw new Hb("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Mp(i)})):t.states_=[Mp(i)];else if(null==e)Pu(t.states_),null!=t.keptStates&&(Pu(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return Mp(i)})):t.states_[0]=Mp(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new Hb("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), but it received ").concat(e.length," state value(s). Input received: ").concat(e));n?t.keptStates.push(t.states_.slice()):Pu(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!Hi.arraysEqual(s.shape,u))throw new Hb("State ".concat(o," is incompatible with layer ").concat(t.name,": expected shape=").concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return Lu(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],p=LI(c,a[0],i,o[0],s[0]),d=LI(l,a[1],i,o[1],s[1]);return[].concat(Fe(e.slice(0,2)),Fe(u?[r,p,d]:[p,d,r]))}}]),n}(n_);d_.className="ConvRNN2D";var f_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;h(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign(Object.assign({},e),{units:a}))).filters=a,px(r.filters,"filters"),r.kernelSize=PI(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return px(e,"kernelSize")})),r.strides=PI(o||1,2,"strides"),r.strides.forEach((function(e){return px(e,"strides")})),r.padding=s||"valid",_x(r.padding),r.dataFormat=u||"channelsLast",Ix(r.dataFormat),r.dilationRate=PI(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return px(e,"dilationRate")})),r}return v(n,[{key:"build",value:function(e){var t;e=Tk(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new Hb("The channel dimension of the input should be defined. Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"apply",value:function(e,t){return qx([s.apply([u]),Op([u]),s.apply([2*u])])}}]),n}(ik),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ou((function(){if(3!==e.length)throw new Hb("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],s=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=p_({ones:function(){return Hp(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var u=n.dropoutMask,c=function(e,t,n){return t&&t[n]?Zu(t[n],e):e},l=c(a,u,0),p=c(a,u,1),d=c(a,u,2),f=c(a,u,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=p_({ones:function(){return Hp(i)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var h=n.recurrentDropoutMask,m=c(i,h,0),v=c(i,h,1),g=c(i,h,2),y=c(i,h,3),b=o(rf(n.kernel.read(),4,3),4),x=b[0],k=b[1],w=b[2],S=b[3],I=o(n.useBias?rf(n.bias.read(),4):[null,null,null,null],4),_=I[0],N=I[1],C=I[2],T=I[3];l=n.inputConv(l,x,_,n.padding),p=n.inputConv(p,k,N,n.padding),d=n.inputConv(d,w,C,n.padding),f=n.inputConv(f,S,T,n.padding);var E=o(rf(n.recurrentKernel.read(),4,3),4),A=E[0],R=E[1],F=E[2],D=E[3];m=n.recurrentConv(m,A),v=n.recurrentConv(v,R),g=n.recurrentConv(g,F),y=n.recurrentConv(y,D);var M=n.recurrentActivation.apply(Xu(l,m)),O=n.recurrentActivation.apply(Xu(p,v)),P=Xu(Zu(O,s),Zu(M,n.activation.apply(Xu(d,g)))),L=Zu(n.recurrentActivation.apply(Xu(f,y)),n.activation.apply(P));return[L,L,P]}))}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this),t=(e.units,function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},t),r)}},{key:"inputConv",value:function(e,t,n,r){var a=Zc(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?ek(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return Zc(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(u_);f_.className="ConvLSTM2DCell",om.registerClass(f_);var h_=function(e){Ae(n,e);var t=Re(n);function n(e){h(this,n);var r=new f_(e);return t.call(this,Object.assign(Object.assign({},e),{cell:r}))}return v(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(d_);h_.className="ConvLSTM2D",om.registerClass(h_);var m_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return v(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return Ou((function(){n.invokeCallHook(e,t);var r=Ck(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return nk((function(){return tk(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return Se(we(n.prototype),"dispose",this).call(this)}}]),n}(Bk);m_.className="Dropout",om.registerClass(m_);var v_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return v(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(m_);v_.className="SpatialDropout1D",om.registerClass(v_);var g_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,px(r.units,"units"),r.activation=wI(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=Ik(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=Ik(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=ow(e.kernelConstraint),r.biasConstraint=ow(e.biasConstraint),r.kernelRegularizer=EI(e.kernelRegularizer),r.biasRegularizer=EI(e.biasRegularizer),r.activityRegularizer=EI(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],Ee(r)}return v(n,[{key:"build",value:function(e){var t=(e=Tk(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:c({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=Tk(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return Ou((function(){n.invokeCallHook(e,t);var r,a=Ck(e),i=fx(n.activation.getClassName());return null!=i?r=Qx(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=Qx(a,n.kernel.read()),null!=n.bias&&(r=ek(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:xI(this.activation),useBias:this.useBias,kernelInitializer:Sk(this.kernelInitializer),biasInitializer:Sk(this.biasInitializer),kernelRegularizer:CI(this.kernelRegularizer),biasRegularizer:CI(this.biasRegularizer),activityRegularizer:CI(this.activityRegularizer),kernelConstraint:aw(this.kernelConstraint),biasConstraint:aw(this.biasConstraint)},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);g_.className="Dense",om.registerClass(g_);var y_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return v(n,[{key:"computeOutputShape",value:function(e){var t,n=De((e=Tk(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new Hb('The shape of the input to "Flatten" is not fully defined (got '.concat(e.slice(1),'). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.'))}}catch(r){n.e(r)}finally{n.f()}return[e[0],Px(e,1)]}},{key:"call",value:function(e,t){var n=this;return Ou((function(){n.invokeCallHook(e,t);var r=Ck(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=Af(r,a)}return function(e){if(e.rank<=1)throw new Hb("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],Px(e.shape,1)];return Nc(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);y_.className="Flatten",om.registerClass(y_);var b_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=wI(e.activation),r}return v(n,[{key:"call",value:function(e,t){var n=this;return Ou((function(){n.invokeCallHook(e,t);var r=Ck(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:xI(this.activation)},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);b_.className="Activation",om.registerClass(b_);var x_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return v(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return Ou((function(){return function(e,t){return Ou((function(){if(2!==e.shape.length)throw new Hb("repeat() expects a rank-2 tensor, but received a rank-".concat(e.shape.length," tensor."));return Xx(Vx(e,1),[1,t,1])}))}(e=Ck(e),n.n)}))}},{key:"getConfig",value:function(){var e={n:this.n},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);x_.className="RepeatVector",om.registerClass(x_);var k_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;h(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return v(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new Hb("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=Px(e);if(null!==i){if(0===a||u%a!==0)throw new Hb(n);r[i]=u/a}else if(u!==a)throw new Hb(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return Ou((function(){n.invokeCallHook(e,t);var r=Ck(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return Nc(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);k_.className="Reshape",om.registerClass(k_);var w_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received ".concat(e.dims," instead."));var a=Bx(1,e.dims.length+1);if(!Hi.arraysEqual(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new Mk({ndim:r.dims.length+1})],Ee(r)}return v(n,[{key:"computeOutputShape",value:function(e){var t=(e=Tk(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return Af(Ck(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);w_.className="Permute",om.registerClass(w_);var S_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return v(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=Ck(e);return rc(jp(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return Ou((function(){n.invokeCallHook(e,t);var r=Ck(e),a=rc(jp(r,n.maskValue),-1,!0);return Zu(r,Iu(a,r.dtype))}))}}]),n}(Bk);S_.className="Masking",om.registerClass(S_);var I_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat($b(e.inputLength))}return r.inputDim=e.inputDim,px(r.inputDim,"inputDim"),r.outputDim=e.outputDim,px(r.outputDim,"outputDim"),r.embeddingsInitializer=Ik(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=EI(e.embeddingsRegularizer),r.activityRegularizer=EI(e.activityRegularizer),r.embeddingsConstraint=ow(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,Ee(r)}return v(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return Ou((function(){return n.maskZero?(e=Ck(e),jp(e,bl(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=Tk(e),null==this.inputLength)return[].concat(Fe(e),[this.outputDim]);var t=$b(this.inputLength);if(t.length!==e.length-1)throw new Hb('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new Hb('"inputLength" is '.concat(this.inputLength,", but received input shape has shape ").concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat(Fe(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return Ou((function(){n.invokeCallHook(e,t);var r=Ck(e);"int32"!==r.dtype&&(r=Ux(r,"int32"));var a=Zx(n.embeddings.read(),Nc(r,[r.size]));return Nc(a,Tk(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Sk(this.embeddingsInitializer),embeddingsRegularizer:CI(this.embeddingsRegularizer),activityRegularizer:CI(this.activityRegularizer),embeddingsConstraint:aw(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);I_.className="Embedding",om.registerClass(I_);var __=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return v(n,[{key:"mergeFunction",value:function(e){throw new qb}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new Hb("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Tk(e)]),e.length<2)throw new Hb("A merge layer should be called on an Array of at least 2 inputs. Got ".concat(e.length," input(s)."));var t,n=[],r=De(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(c){r.e(c)}finally{r.f()}if((n=sx(n)).length>1)throw new Hb("Can not merge tensors with different batch sizes. Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===sx(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return Ou((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=zx(r),o=De(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=Vx(s,1);t.push(s)}}catch(N){o.e(N)}finally{o.f()}return n.mergeFunction(t)}var l,p=!1,d=De(e);try{for(d.s();!(l=d.n()).done;){var f=l.value,h=f.rank;if(null==h){var m=f.shape,v=m[0],g=m.slice(1).concat([v]),y=Nc(f,[v].concat(Px(m.slice(1))));y=Af(y,[1,0]),y=Nc(y,g),t.push(y),p=!0}else if(h>1){var b=Bx(1,h).concat([0]);t.push(Af(f,b)),p=!0}else t.push(f)}}catch(N){d.e(N)}finally{d.f()}var x=n.mergeFunction(t),k=x.rank;if(p)if(null==k){var w=x.shape,S=w[w.length-1],I=[S].concat(w.slice(0,w.length-1));x=Nc(Af(Nc(x,[-1,S]),[1,0]),I)}else if(k>1){var _=[k-1].concat(Bx(0,k-1));x=Af(x,_)}return x}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=De(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(u){o.e(u)}finally{o.f()}return t=1===(i=sx(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return Ou((function(){if(null==t)return null;if(!Array.isArray(t))throw new Hb("`mask` should be an Array");if(!Array.isArray(e))throw new Hb("`inputs` should be an Array");if(t.length!==e.length)throw new Hb("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;t=t.map((function(e){return null==e?e:Gl(e,0)}));for(var n=t[0],r=1;r<t.length-1;++r)n=wp(n,t[r]);return n}))}}]),n}(Bk),N_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e)}return v(n,[{key:"mergeFunction",value:function(e){return Ou((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Xu(t,e[n]);return t}))}}]),n}(__);N_.className="Add",om.registerClass(N_);var C_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e)}return v(n,[{key:"mergeFunction",value:function(e){return Ou((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Zu(t,e[n]);return t}))}}]),n}(__);C_.className="Multiply",om.registerClass(C_);var T_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e)}return v(n,[{key:"mergeFunction",value:function(e){return Ou((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Xu(t,e[n]);return Zu(1/e.length,t)}))}}]),n}(__);T_.className="Average",om.registerClass(T_);var E_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e)}return v(n,[{key:"mergeFunction",value:function(e){return Ou((function(){for(var t=e[0],n=1;n<e.length;++n)t=Fp(t,e[n]);return t}))}}]),n}(__);E_.className="Maximum",om.registerClass(E_);var A_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e)}return v(n,[{key:"mergeFunction",value:function(e){return Ou((function(){for(var t=e[0],n=1;n<e.length;++n)t=Lp(t,e[n]);return t}))}}]),n}(__);A_.className="Minimum",om.registerClass(A_);var R_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return v(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new Hb("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=De(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(p){r.e(p)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=De(a);try{for(c.s();!(s=c.n()).done;){var l=s.value;if(Hi.arraysEqual(l,o)){u=!0;break}}}catch(p){c.e(p)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new Hb("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return Ou((function(){return qx(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new Hb("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=De(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new Hb("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new Hb("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new Hb("Mismatch in the length of mask (".concat(t.length,") and the legnth of inputs (").concat(e.length,")"));return Ou((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(Iu(Hp(e[i]),"bool")):t[i].rank<e[i].rank?a.push(Gl(t[i],-1)):a.push(t[i]);var o=Ec(a,n.axis);return nc(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(__);function F_(e,t){for(;e<0;)e+=t;return e}R_.className="Concatenate",om.registerClass(R_);var D_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return v(n,[{key:"build",value:function(e){Hi.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new qb("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new Hb("Dimension incompatibility: ".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new Hb("A `Dot` layer must be called on exactly 2 inputs, but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return F_(t,e[n].shape.length)})):[F_(this.axes,n.shape.length),F_(this.axes,r.shape.length)],this.normalize&&(n=Vw(n,t[0]),r=Vw(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new qb("batchDot is not implemented for tensors of 4D or higher rank yet");if(Hi.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, but got ".concat(e.shape.length)})),Hi.assert(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, but got ".concat(t.shape.length)})),"number"==typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new qb("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return Ou((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=Nc(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=Nc(e,e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?Bl(Zu(e,t),i[0]):Bl(Zu(Af(e,[1,0]),t),i[1]);else{var p=i[0]!==e.shape.length-1,d=i[1]===t.shape.length-1;o=Ac(e,t,p,d)}if(n>0){for(var f,h=[],m=f=r>a?r+a-3:r-1;m<f+n;++m)h.push(m);o=sf(o,h)}return 1===o.shape.length&&(o=Gl(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[F_(this.axes,e.length),F_(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){Hi.assert(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new qb("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(__);D_.className="Dot",om.registerClass(D_);var M_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return v(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Ou((function(){n.invokeCallHook(e,t);var r=Ck(e);return nk((function(){return Xu(Yx(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(Bk);M_.className="GaussianNoise",om.registerClass(M_);var O_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return v(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Ou((function(){n.invokeCallHook(e,t);var r=Ck(e);return n.rate>0&&n.rate<1?nk((function(){var e=Math.sqrt(n.rate/(1-n.rate));return Zu(r,Yx(r.shape,1,e))}),(function(){return r}),t.training||!1):r}))}}]),n}(Bk);O_.className="GaussianDropout",om.registerClass(O_);var P_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return v(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||Ck(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=Se(we(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return Ou((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return nk((function(){var t=Ck(e),a=-1.7580993408473766,i=Zl(Ed(r),n.rate);i=Ux(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=Xu(Zu(t,i),Zu(Xu(i,-1),a));return Xu(Zu(u,o),s)}),(function(){return Ck(e)}),t.training||!1)}return e}))}}]),n}(Bk);function L_(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=zc(e,t,n,r,a,o);else if(3===e.rank)i=Bc(e,t,n,r,a,o);else{if(4!==e.rank)throw new qb("batchNormalization is not implemented for array of rank ".concat(e.rank," yet"));i=Wc(e,t,n,r,a,o)}return i}function z_(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Hi.arraysEqual(r.slice().sort(),Bx(0,e.rank-1))?function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Ou((function(){var i=Wp(e,r),o=i.mean,s=i.variance;return[L_(e,o,s,n,t,a),o,s]}))}(e,t,n,r,a):function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Ou((function(){var i,o=Wp(e,r),s=o.mean,u=o.variance,c=[],l=De(Bx(0,e.rank));try{for(l.s();!(i=l.n()).done;){var p=i.value;-1!==r.indexOf(p)?c.push(1):c.push(e.shape[p])}}catch(v){l.e(v)}finally{l.f()}var d=Nc(s,c),f=Nc(u,c),h=null==t?null:Nc(t,c),m=null==n?null:Nc(n,c);return[L_(e,d,f,m,h,a),s,u]}))}(e,t,n,r,a)}P_.className="AlphaDropout",om.registerClass(P_);var B_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Ik(e.betaInitializer||"zeros"),r.gammaInitializer=Ik(e.gammaInitializer||"ones"),r.movingMeanInitializer=Ik(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=Ik(e.movingVarianceInitializer||"ones"),r.betaConstraint=ow(e.betaConstraint),r.gammaConstraint=ow(e.gammaConstraint),r.betaRegularizer=EI(e.betaRegularizer),r.gammaRegularizer=EI(e.gammaRegularizer),r}return v(n,[{key:"build",value:function(e){e=Tk(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new Hb("Axis ".concat(t," of input tensor should have a defined dimension but the layer received an input with shape ").concat(JSON.stringify(e),"."));this.inputSpec=[new Mk({ndim:e.length,axes:c({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var r=null!=t.training&&t.training,a=Ck(e),i=a.shape,s=i.length,u=Bx(0,s),c=n.axis>=0?n.axis:n.axis+s;u.splice(c,1);var l=Yb(1,s);l[c]=i[c];var p=u.slice();p.sort();var d=!Hi.arraysEqual(p,Bx(0,s).slice(0,s-1));if(!r)return function(){if(d){var e=Nc(n.movingMean.read(),l),t=Nc(n.movingVariance.read(),l),r=n.center?Nc(n.beta.read(),l):null,i=n.scale?Nc(n.gamma.read(),l):null;return L_(a,e,t,r,i,n.epsilon)}return L_(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var f=o(z_(a,n.gamma.read(),n.beta.read(),u,n.epsilon),3),h=f[0],m=f[1],v=f[2],g=function(e,t,n){Ou((function(){var r=1-n,a=e.read(),i=Zu(bp(a,t),r);e.write(bp(a,i))}))};return g(n.movingMean,m,n.momentum),g(n.movingVariance,v,n.momentum),h}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Sk(this.betaInitializer),gammaInitializer:Sk(this.gammaInitializer),movingMeanInitializer:Sk(this.movingMeanInitializer),movingVarianceInitializer:Sk(this.movingVarianceInitializer),betaRegularizer:CI(this.betaRegularizer),gammaRegularizer:CI(this.gammaRegularizer),betaConstraint:aw(this.betaConstraint),gammaConstraint:aw(this.gammaConstraint)},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);B_.className="BatchNormalization",om.registerClass(B_);var W_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"==typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, but received ".concat(JSON.stringify(r.axis)));var a,i=De(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, but received ".concat(JSON.stringify(r.axis)))}}catch(s){i.e(s)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=Ik(e.betaInitializer||"zeros"),r.gammaInitializer=Ik(e.gammaInitializer||"ones"),r.betaRegularizer=EI(e.betaRegularizer),r.gammaRegularizer=EI(e.gammaRegularizer),r.supportsMasking=!0,Ee(r)}return v(n,[{key:"build",value:function(e){var t=(e=Tk(e)).length;"number"==typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=De(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(s){a.e(s)}finally{a.f()}if(this.axis.length!==sx(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=Ck(e),a=r.shape,i=a.length;return Ou((function(){var e,t=Wp(r,n.axis,!0),o=t.mean,s=t.variance,u=Yb(1,i),c=De(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch(g){c.e(g)}finally{c.f()}for(var p=function(e){return null!=e&&e.shape.length!==i?Nc(e,u):e},d=n.scale?p(n.gamma.read()):null,f=n.center?p(n.beta.read()):null,h=[],m=[],v=0;v<i;++v)-1!==n.axis.indexOf(v)?(h.push(a[v]),m.push(1)):(h.push(1),m.push(a[v]));return o=ql(o,h),s=ql(s,h),null!=d&&(d=ql(d,m)),null!=f&&(f=ql(f,m)),L_(r,o,s,f,d,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Sk(this.betaInitializer),gammaInitializer:Sk(this.gammaInitializer),betaRegularizer:CI(this.betaRegularizer),gammaRegularizer:CI(this.gammaRegularizer)},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);W_.className="LayerNormalization",om.registerClass(W_);var U_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"==typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new Hb("ZeroPadding2D expects padding to be a length-2 array, but received a length-".concat(e.padding.length," array."));var a,i;if("number"==typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new Hb("ZeroPadding2D expects height padding to be a length-2 array, but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new Hb("ZeroPadding2D expects width padding to be a length-2 array, but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new Mk({ndim:4})],Ee(r)}return v(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=Tk(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return Ou((function(){return function(e,t,n){return Ou((function(){if(4!==e.rank)throw new Hb("temporalPadding expects input tensor to be 4-D, but received a ".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new Hb("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new Hb("Unknown data format: ".concat(n,". Supported data formats are 'channelsLast' and 'channelsFirst."));var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],Kp(e,r)}))}(Ck(e),n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk);function V_(e,t,n,r,a,i){return Ou((function(){Ix(a),Nx(i),_x(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=BI(e,a);var o,s="same"===r?"same":"valid";return o="max"===i?Ep(e,t,n,s):Cc(e,t,n,s),"channelsFirst"===a&&(o=Af(o,[0,3,1,2])),o}))}function j_(e,t,n,r,a,i){return Ou((function(){Ix(a),Nx(i),_x(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=WI(e,a);var o,s="same"===r?"same":"valid";return o="max"===i?Ap(e,t,n,s):Tc(e,t,n,s),"channelsFirst"===a&&(o=Af(o,[0,4,1,2,3])),o}))}U_.className="ZeroPadding2D",om.registerClass(U_);var G_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"==typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!=typeof e.poolSize[0])throw new Hb("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(px(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"==typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!=typeof e.strides[0])throw new Hb("strides for 1D convolutional layer must be a number or an Array of a single number, but received ".concat(JSON.stringify(e.strides)));r.strides=e.strides}return px(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,_x(r.padding),r.inputSpec=[new Mk({ndim:3})],Ee(r)}return v(n,[{key:"computeOutputShape",value:function(e){var t=LI((e=Tk(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return Ou((function(){n.invokeCallHook(e,t),e=Vx(Ck(e),2);var r=n.poolingFunction(Ck(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return sf(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk),H_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e)}return v(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ix(a),_x(r),V_(e,t,n,r,a,"max")}}]),n}(G_);H_.className="MaxPooling1D",om.registerClass(H_);var q_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e)}return v(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ix(a),_x(r),V_(e,t,n,r,a,"avg")}}]),n}(G_);q_.className="AveragePooling1D",om.registerClass(q_);var K_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new Hb("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return px(r.poolSize,"poolSize"),px(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ix(r.dataFormat),_x(r.padding),r.inputSpec=[new Mk({ndim:4})],Ee(r)}return v(n,[{key:"computeOutputShape",value:function(e){e=Tk(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=LI(t,this.poolSize[0],this.padding,this.strides[0]),n=LI(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return Ou((function(){return n.invokeCallHook(e,t),n.poolingFunction(Ck(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk),X_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e)}return v(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ix(a),_x(r),V_(e,t,n,r,a,"max")}}]),n}(K_);X_.className="MaxPooling2D",om.registerClass(X_);var Y_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e)}return v(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ix(a),_x(r),V_(e,t,n,r,a,"avg")}}]),n}(K_);Y_.className="AveragePooling2D",om.registerClass(Y_);var Q_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new Hb("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return px(r.poolSize,"poolSize"),px(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ix(r.dataFormat),_x(r.padding),r.inputSpec=[new Mk({ndim:5})],Ee(r)}return v(n,[{key:"computeOutputShape",value:function(e){e=Tk(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=LI(t,this.poolSize[0],this.padding,this.strides[0]),n=LI(n,this.poolSize[1],this.padding,this.strides[1]),r=LI(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return Ou((function(){return n.invokeCallHook(e,t),n.poolingFunction(Ck(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk),Z_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e)}return v(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ix(a),_x(r),j_(e,t,n,r,a,"max")}}]),n}(Q_);Z_.className="MaxPooling3D",om.registerClass(Z_);var J_=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e)}return v(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return Ix(a),_x(r),j_(e,t,n,r,a,"avg")}}]),n}(Q_);J_.className="AveragePooling3D",om.registerClass(J_);var $_=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).inputSpec=[new Mk({ndim:3})],r}return v(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new qb}}]),n}(Bk),eN=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e||{})}return v(n,[{key:"call",value:function(e,t){return Ou((function(){var t=Ck(e);return Dp(t,1)}))}}]),n}($_);eN.className="GlobalAveragePooling1D",om.registerClass(eN);var tN=function(e){Ae(n,e);var t=Re(n);function n(e){return h(this,n),t.call(this,e||{})}return v(n,[{key:"call",value:function(e,t){return Ou((function(){var t=Ck(e);return Dl(t,1)}))}}]),n}($_);tN.className="GlobalMaxPooling1D",om.registerClass(tN);var nN=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,Ix(r.dataFormat),r.inputSpec=[new Mk({ndim:4})],r}return v(n,[{key:"computeOutputShape",value:function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new qb}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(Bk),rN=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"call",value:function(e,t){var n=this;return Ou((function(){var t=Ck(e);return"channelsLast"===n.dataFormat?Dp(t,[1,2]):Dp(t,[2,3])}))}}]),n}(nN);rN.className="GlobalAveragePooling2D",om.registerClass(rN);var aN=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"call",value:function(e,t){var n=this;return Ou((function(){var t=Ck(e);return"channelsLast"===n.dataFormat?Dl(t,[1,2]):Dl(t,[2,3])}))}}]),n}(nN);aN.className="GlobalMaxPooling2D",om.registerClass(aN);var iN=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).layer=e.layer,r}return v(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){Se(we(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Uw(t.layer,n);delete t.layer;var a={layer:r};return Object.assign(a,t),new e(a)}}]),n}(Bk),oN=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return v(n,[{key:"build",value:function(e){if((e=Tk(e)).length<3)throw new Hb("TimeDistributed layer expects an input shape >= 3D, but received input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),Se(we(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=Tk(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return Ou((function(){return t_((function(e,r){return[Ck(n.layer.call(e,t)),[]]}),e=Ck(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(iN);oN.className="TimeDistributed",om.registerClass(oN);var sN="concat",uN=function(e){Ae(n,e);var t=Re(n);function n(e){var r;h(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=Uw(i),a.goBackwards=!0!==a.goBackwards;var o={};if(o.className=e.layer.getClassName(),o.config=a,r.backwardLayer=Uw(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?sN:e.mergeMode,function(e){cx(wx,"BidirectionalMergeMode",e)}(r.mergeMode),e.weights)throw new qb("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return v(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState&&(r=a.slice(1)),t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):Jb(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=e_(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return Se(we(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new Hb("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,Fe(r));var c=r.map((function(e){return new Mk({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,Fe(c))}if(null!=a)throw new qb("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof Ok,p=0,d=o;p<d.length;p++){if(d[p]instanceof Ok!==l)throw new Hb("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var f=[e].concat(o),h=this.inputSpec.concat(s),m=this.inputSpec;this.inputSpec=h;var v=Se(we(n.prototype),"apply",this).call(this,f,t);return this.inputSpec=m,v}return Se(we(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=Od(a,1)),"concat"===n.mergeMode?o=qx([r,a]):"sum"===n.mergeMode?o=Xu(r,a):"ave"===n.mergeMode?o=Zu(.5,Xu(r,a)):"mul"===n.mergeMode?o=Zu(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;Ex(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),Ex(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){Se(we(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=Uw(t.layer);if(delete t.layer,null!=t.numConstants)throw new qb("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(iN);uN.className="Bidirectional",om.registerClass(uN);var cN=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).scale=e.scale,e.offset?r.offset=e.offset:r.offset=0,r}return v(n,[{key:"getConfig",value:function(){var e={scale:this.scale,offset:this.offset},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return Ou((function(){return"float32"!==(e=Ck(e)).dtype&&(e=Ux(e,"float32")),Xu(Zu(e,n.scale),n.offset)}))}}]),n}(Bk);cN.className="Rescaling",om.registerClass(cN);var lN=tm.resizeBilinear,pN=tm.cropAndResize,dN=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,r}return v(n,[{key:"centerCrop",value:function(e,t,n,r,a,i,o,s){return Ou((function(){var u,c=!1,l=[t/i,n/o,(r+t)/i,(a+n)/o],p=[];3===e.rank?(c=!0,u=uf([e])):u=e;for(var d=0;d<u.shape[0];d++)p.push(l);var f=ds(p,[p.length,4]),h=Ad(0,p.length,1,"int32"),m=pN(u,f,h,[r,a],"nearest");return Ux(c?Ck(wf(m)):m,s)}))}},{key:"upsize",value:function(e,t,n,r){return Ou((function(){return Ux(lN(e,[t,n]),r)}))}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var t=Ck(e),r=t.dtype,a=t.shape,i=a[a.length-3],o=a[a.length-2],s=0;i!==n.height&&(s=Math.floor((i-n.height)/2));var u=0;return o!==n.width&&(0===(u=Math.floor((o-n.width)/2))&&(u=1)),s>=0&&u>=0?n.centerCrop(t,s,u,n.height,n.width,i,o,r):n.upsize(e,n.height,n.width,r)}))}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){var t=(e=Tk(e)).length-3,n=e.length-2;return e[t]=this.height,e[n]=this.width,e}}]),n}(Bk);dN.className="CenterCrop",om.registerClass(dN);var fN=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,e)).numTokens=e.numTokens,e.outputMode?r.outputMode=e.outputMode:r.outputMode="multiHot",r}return v(n,[{key:"getConfig",value:function(){var e={numTokens:this.numTokens,outputMode:this.outputMode},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"computeOutputShape",value:function(e){return null==(e=Tk(e))?[this.numTokens]:"oneHot"===this.outputMode&&1!==e[e.length-1]?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var r;if("int32"!==(e=Ck(e)).dtype&&(e=Ux(e,"int32")),"undefined"!=typeof t.countWeights){if("count"!==n.outputMode)throw new Hb("countWeights is not used when outputMode !== count.\n              Received countWeights=".concat(t.countWeights));r=Ck(t.countWeights)}var a=Dl(e),i=Ml(e),o=Ql(n.numTokens,a).bufferSync().get(0),s=Zl(i,0).bufferSync().get(0);if(!o||!s)throw new Hb("Input values must be between 0 < values <= numTokens with numTokens=".concat(n.numTokens));return function(e,t,n,r){var a=Ck(e);if("int32"!==a.dtype&&(a=Ux(a,"int32")),"int"===t)return a;var i=a.shape;if(0===a.rank&&(a=Gl(a,-1)),"oneHot"===t&&1!==a.shape[a.shape.length-1]&&(a=Gl(a,-1)),a.rank>2)throw new Hb("When outputMode is not int, maximum output rank is 2 Received outputMode ".concat(t," and input shape ").concat(i," which would result in output rank ").concat(a.rank,"."));var o,s=["multiHot","oneHot"].includes(t),u=a;if(o=ul(u,"undefined"!=typeof r&&"count"===t?r:[],n,s),"tfIdf"!==t)return o;if(r)return Zu(o,r);throw new Hb("When outputMode is 'tfIdf', weights must be provided.")}(e,n.outputMode,n.numTokens,r)}))}}]),n}(Bk);fN.className="CategoryEncoding",om.registerClass(fN);var hN=new Set(["bilinear","nearest"]),mN=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),(r=t.call(this,e)).height=e.height,r.width=e.width,e.interpolation){if(!hN.has(e.interpolation))throw new Hb("Invalid interpolation parameter: ".concat(e.interpolation," is not implemented"));r.interpolation=e.interpolation}else r.interpolation="bilinear";return r.cropToAspectRatio=Boolean(e.cropToAspectRatio),Ee(r)}return v(n,[{key:"computeOutputShape",value:function(e){var t=(e=Tk(e))[2];return[this.height,this.width,t]}},{key:"getConfig",value:function(){var e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=Se(we(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"call",value:function(e,t){var n=this;return Ou((function(){var t=[n.height,n.width];if("bilinear"===n.interpolation)return tm.resizeBilinear(e,t,!n.cropToAspectRatio);if("nearest"===n.interpolation)return tm.resizeNearestNeighbor(e,t,!n.cropToAspectRatio);throw new Error("Interpolation is ".concat(n.interpolation," but only ").concat(Fe(hN)," are supported"))}))}}]),n}(Bk);function vN(e){return new Uk(e)}function gN(e){return new DI(e)}function yN(e){return new AI(e)}function bN(e){return new RI(e)}function xN(e){return new FI(e)}function kN(e){return new OI(e)}function wN(e){return new MI(e)}function SN(e){return new QI(e)}function IN(e){return new GI(e)}function _N(e){return new qI(e)}function NN(e){return new HI(e)}function CN(e){return new KI(e)}function TN(e){return new YI(e)}function EN(e){return new ZI(e)}function AN(e){return new JI(e)}function RN(e){return new $I(e)}function FN(e){return new b_(e)}function DN(e){return new g_(e)}function MN(e){return new m_(e)}function ON(e){return new v_(e)}function PN(e){return new y_(e)}function LN(e){return new x_(e)}function zN(e){return new k_(e)}function BN(e){return new w_(e)}function WN(e){return new I_(e)}function UN(e){return new N_(e)}function VN(e){return new T_(e)}function jN(e){return new R_(e)}function GN(e){return new E_(e)}function HN(e){return new A_(e)}function qN(e){return new C_(e)}function KN(e){return new D_(e)}function XN(e){return new B_(e)}function YN(e){return new W_(e)}function QN(e){return new U_(e)}function ZN(e){return new q_(e)}function JN(e){return ZN(e)}function $N(e){return ZN(e)}function eC(e){return new Y_(e)}function tC(e){return eC(e)}function nC(e){return eC(e)}function rC(e){return new J_(e)}function aC(e){return rC(e)}function iC(e){return rC(e)}function oC(e){return new eN(e)}function sC(e){return new rN(e)}function uC(e){return new tN(e)}function cC(e){return new aN(e)}function lC(e){return new H_(e)}function pC(e){return new X_(e)}function dC(e){return new Z_(e)}function fC(e){return new s_(e)}function hC(e){return new o_(e)}function mC(e){return new c_(e)}function vC(e){return new u_(e)}function gC(e){return new i_(e)}function yC(e){return new a_(e)}function bC(e){return new h_(e)}function xC(e){return new f_(e)}function kC(e){return new n_(e)}function wC(e){return new l_(e)}function SC(e){return new uN(e)}function IC(e){return new oN(e)}mN.className="Resizing",om.registerClass(mN);var _C=uC,NC=cC,CC=lC,TC=pC;function EC(e){return new M_(e)}function AC(e){return new O_(e)}function RC(e){return new P_(e)}function FC(e){return new S_(e)}function DC(e){return new cN(e)}function MC(e){return new dN(e)}function OC(e){return new mN(e)}function PC(e){return new fN(e)}var LC={};function zC(e,t){return Jw(e,t)}function BC(e,t){return rS(e,t)}function WC(e,t){return aS(e,t)}function UC(e,t){return $w(e,t)}function VC(e,t){return iS(e,t)}function jC(e,t){return tS(e,t)}function GC(e,t){return nS(e,t)}function HC(e,t){return Yw(e,t)}function qC(e,t){return Gw(e,t)}function KC(e,t){return Hw(e,t)}function XC(e,t){return Hw(e,t)}function YC(e,t){return Hw(e,t)}function QC(e,t){return jw(e,t)}function ZC(e,t){return jw(e,t)}function JC(e,t){return jw(e,t)}He(LC,{MAPE:function(){return XC},MSE:function(){return ZC},binaryAccuracy:function(){return zC},binaryCrossentropy:function(){return BC},categoricalAccuracy:function(){return UC},categoricalCrossentropy:function(){return VC},cosineProximity:function(){return HC},mape:function(){return YC},meanAbsoluteError:function(){return qC},meanAbsolutePercentageError:function(){return KC},meanSquaredError:function(){return QC},mse:function(){return JC},precision:function(){return jC},recall:function(){return GC},sparseCategoricalAccuracy:function(){return WC}});var $C={};He($C,{modelFromJSON:function(){return KS}});var eT={};function tT(e){return new _I(e)}function nT(e){return function(e){return SI(e),new _I({l1:null!=e?e.l1:null,l2:0})}(e)}function rT(e){return function(e){return SI(e),new _I({l2:null!=e?e.l2:null,l1:0})}(e)}He(eT,{l1:function(){return nT},l1l2:function(){return tT},l2:function(){return rT}});var aT=function(e){Ae(n,e);var t=Re(n);function n(){var e;return h(this,n),(e=t.apply(this,arguments)).model=null,e}return v(n,[{key:"setModel",value:function(e){if(!(e instanceof HS))throw new Error("model must be a LayersModel, not some other Container");this.model=e}}]),n}(Dw);function iT(e,t){return e<t}function oT(e,t){return e>t}var sT=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),r=t.call(this),null==e&&(e={}),e.restoreBestWeights)throw new qb("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=e.monitor||"val_loss",r.minDelta=Math.abs(e.minDelta||0),r.patience=e.patience||0,r.verbose=e.verbose||0,r.mode=e.mode||"auto",r.baseline=e.baseline,-1===["auto","min","max"].indexOf(r.mode)&&(console.warn("EarlyStopping mode '".concat(r.mode,"' is invalid. Falling back to mode 'auto'.")),r.mode="auto"),"min"===r.mode?r.monitorFunc=iT:"max"===r.mode||-1!==r.monitor.indexOf("acc")?r.monitorFunc=oT:r.monitorFunc=iT,r.monitorFunc===iT&&(r.minDelta*=-1),Ee(r)}return v(n,[{key:"onTrainBegin",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.wait=0,this.stoppedEpoch=0,null!=this.baseline?this.best=this.baseline:this.best=this.monitorFunc===iT?1/0:-1/0;case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=y(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ew(n);case 2:null!=(r=this.getMonitorValue(n))&&(this.monitorFunc(r-this.minDelta,this.best)?(this.best=r,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping."));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMonitorValue",value:function(e){null==e&&(e={});var t=e[this.monitor];return null==t&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. Available metrics are: ").concat(Object.keys(e))),t}}]),n}(aT);var uT,cT,lT={earlyStopping:function(e){return new sT(e)}};hn().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(uT||(uT={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(cT||(cT={}));var pT={};function dT(e,t){var n={tfOpName:e,category:"custom",inputs:[],attrs:[],customExecutor:t};pT[e]=n}function fT(e){return pT[e]}function hT(e){delete pT[e]}function mT(e,t,n,r,a){var i=t.inputParams[e];if(i&&void 0!==i.inputIndexStart){var o=i.inputIndexStart,s=0===i.inputIndexEnd?void 0:void 0===i.inputIndexEnd?o+1:i.inputIndexEnd;if("tensor"===i.type)return vT(t.inputNames[i.inputIndexStart],n,r,a);if("tensors"===i.type)return t.inputNames.slice(o,s).map((function(e){return vT(e,n,r,a)}));var u=vT(t.inputNames.slice(o)[0],n,r,a),c=u.dataSync();return"number"===i.type?c[0]:Hi.toNestedArray(u.shape,c)}var l=t.attrParams[e];return l&&l.value}function vT(e,t,n,r){var a=o(bT(e),2),i=a[0],s=a[1];if(null!=r){var u=r.getHashTableHandleByName(i);if(null!=u)return u}var c=n.currentContextIds.find((function(e){return!!t[yT(i,e)]}));return void 0!==c?t[yT(i,c)][s]:void 0}function gT(e,t){var n=o(bT(e),3),r=n[0],a=n[1],i=n[2];return[yT(r,t&&t.currentContextId),a,i]}function yT(e,t){return t?"".concat(e,"-").concat(t):e}function bT(e){var t=e.split(":");if(1===t.length)return[e,0,void 0];var n=t[0],r=3===t.length?t[1]:void 0;return[n,Number(t[t.length-1]),r]}function xT(e,t,n){var r=mT("pad",e,t,n);if("explicit"===r){r=mT("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[2*i],a[i][1]=r[2*i+1];return a}return r}function kT(e){return e.kept?e:_u(e)}var wT={};He(wT,{json:function(){return ST}});var ST=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],IT={};He(IT,{json:function(){return _T}});var _T=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],NT={};He(NT,{json:function(){return CT}});var CT=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],TT={};He(TT,{json:function(){return ET}});var ET=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],AT={};He(AT,{json:function(){return RT}});var RT=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],FT={};He(FT,{json:function(){return DT}});var DT=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],MT={};He(MT,{json:function(){return OT}});var OT=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],PT={};He(PT,{json:function(){return LT}});var LT=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],zT={};He(zT,{json:function(){return BT}});var BT=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],WT={};He(WT,{json:function(){return UT}});var UT=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],VT={};He(VT,{json:function(){return jT}});var jT=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],GT={};He(GT,{json:function(){return HT}});var HT=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],qT={};He(qT,{json:function(){return KT}});var KT=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],XT={};He(XT,{json:function(){return YT}});var YT=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],QT={};He(QT,{json:function(){return ZT}});var ZT=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],JT={};He(JT,{json:function(){return $T}});var $T=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],eE={};He(eE,{json:function(){return tE}});var tE=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],nE={};He(nE,{json:function(){return rE}});var rE=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],aE={};He(aE,{json:function(){return iE}});var iE=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],oE=function(){function e(){var t;h(this,e);var n=[wT,IT,NT,TT,AT,FT,MT,PT,zT,WT,VT,GT,qT,XT,QT,JT,eE,nE,aE],r=(t=[]).concat.apply(t,Fe(n.map((function(e){return e.json}))));this.opMappers=r.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}return v(e,[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.node,a=[],i=[],s=[],u=r.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?i.push(e[n.name]):(null==n.input||0===n.input.length)&&s.push(e[n.name]),e}),{}),c=[],l=[],p={},d={};null!=n&&(p=this.mapSignatureEntries(n.inputs),d=this.mapSignatureEntries(n.outputs));var f=Object.keys(u);f.forEach((function(e){var t=u[e];t.inputNames.forEach((function(e,n){var r=o(gT(e),3),a=r[0],i=r[2],s=u[a];if(null!=s.outputs){var c=s.outputs.indexOf(i);if(-1!==c){var l="".concat(a,":").concat(c);t.inputNames[n]=l}}t.inputs.push(s),s.children.push(t)}))})),0===Object.keys(d).length?f.forEach((function(e){var t=u[e];0===t.children.length&&l.push(t)})):Object.keys(d).forEach((function(e){var t=o(gT(e),1)[0],n=u[t];null!=n&&(n.signatureKey=d[e],l.push(n))})),Object.keys(p).length>0?Object.keys(p).forEach((function(e){var t=o(gT(e),1)[0],n=u[t];n&&(n.signatureKey=p[e],c.push(n))})):c=a;var h={};null!=e.library&&null!=e.library.function&&(h=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var m={nodes:u,inputs:c,outputs:l,weights:i,placeholders:a,signature:n,functions:h};return s.length>0&&(m.initNodes=s),m}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=fT(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.slice(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r,a=n.type;switch(n.type){case"string":void 0===(r=uE(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=uE(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(r=yE(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=yE(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(r=lE(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(r=lE(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(r=gE(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=gE(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(r=cE(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=cE(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(r=xE(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=xE(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(r=vE(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=vE(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(r=bE(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=bE(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(r=fE(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=fE(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(r=hE(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=hE(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(r=dE(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=dE(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:r,type:a},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var i=[],s=[];e.signature.inputArg.forEach((function(e){var t=o(gT(e.name),1)[0],n={name:t,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:pE(e.type),type:"dtype"}},children:[]};n.signatureKey=e.name,i.push(n),a[t]=n})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e,n){var r=o(gT(e),3),i=r[0],s=r[2],u=a[i];if(null!=u.outputs){var c=u.outputs.indexOf(s);if(-1!==c){var l="".concat(i,":").concat(c);t.inputNames[n]=l}}t.inputs.push(u),u.children.push(t)}))}));var u=e.ret;e.signature.outputArg.forEach((function(e){var t=o(gT(u[e.name]),2),n=t[0],r=t[1],i=a[n];null!=i&&(i.defaultOutput=r,s.push(i))}));var c=this.mapArgsToSignature(e);return{nodes:a,inputs:i,outputs:s,weights:r,placeholders:[],signature:c}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}]),e}();function sE(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=hn().global;if("undefined"!=typeof t.atob)return t.atob(e);if("undefined"!=typeof Buffer)return new Buffer(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function uE(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?sE(a.s,r):n}function cE(e,t,n){var r=e[t];return r?r.b:n}function lE(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function pE(e){switch("string"==typeof e&&(e=uT[e]),e){case uT.DT_FLOAT:case uT.DT_HALF:return"float32";case uT.DT_INT32:case uT.DT_INT64:case uT.DT_INT8:case uT.DT_UINT8:return"int32";case uT.DT_BOOL:return"bool";case uT.DT_DOUBLE:return"float32";case uT.DT_STRING:return"string";default:return null}}function dE(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function fE(e,t,n){var r=e[t];return r&&r.type?pE(r.type):n}function hE(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return pE(e)})):n}function mE(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function vE(e,t,n){var r=e[t];return r&&r.shape?mE(r.shape):n}function gE(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function yE(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return sE(e,r)})):n}function bE(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return mE(e)})):n}function xE(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var kE=function(){function e(t,n,r){var a=this;h(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}return v(e,[{key:"getInput",value:function(e){return vT(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return vT(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return lE(this.node.rawAttrs,e,t);if(null!=n.s)return uE(this.node.rawAttrs,e,t);if(null!=n.b)return cE(this.node.rawAttrs,e,t);if(null!=n.shape)return vE(this.node.rawAttrs,e,t);if(null!=n.type)return fE(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return gE(this.node.rawAttrs,e,t);if(null!=n.list.s)return yE(this.node.rawAttrs,e,t);if(null!=n.list.shape)return bE(this.node.rawAttrs,e,t);if(null!=n.list.b)return xE(this.node.rawAttrs,e,t);if(null!=n.list.type)return hE(this.node.rawAttrs,e,t)}return t}}]),e}(),wE={};He(wE,{OP_SCOPE_SUFFIX:function(){return us},abs:function(){return Ju},acos:function(){return $u},acosh:function(){return ec},add:function(){return Xu},addN:function(){return tc},all:function(){return nc},any:function(){return rc},argMax:function(){return ac},argMin:function(){return ic},asin:function(){return oc},asinh:function(){return sc},atan:function(){return uc},atan2:function(){return cc},atanh:function(){return lc},avgPool:function(){return Cc},avgPool3d:function(){return Tc},basicLSTMCell:function(){return Mc},batchNorm:function(){return Lc},batchNorm2d:function(){return zc},batchNorm3d:function(){return Bc},batchNorm4d:function(){return Wc},batchToSpaceND:function(){return Oc},bincount:function(){return Uc},booleanMaskAsync:function(){return Ef},broadcastArgs:function(){return Vc},broadcastTo:function(){return jc},buffer:function(){return Su},cast:function(){return Iu},ceil:function(){return Gc},clipByValue:function(){return qc},clone:function(){return _u},complex:function(){return ls},concat:function(){return Ec},concat1d:function(){return Kc},concat2d:function(){return Xc},concat3d:function(){return Yc},concat4d:function(){return Qc},conv1d:function(){return Jc},conv2d:function(){return Zc},conv2dTranspose:function(){return el},conv3d:function(){return tl},conv3dTranspose:function(){return rl},cos:function(){return al},cosh:function(){return il},cosineWindow:function(){return Uf},cumprod:function(){return ol},cumsum:function(){return sl},denseBincount:function(){return ul},depthToSpace:function(){return cl},depthwiseConv2d:function(){return ll},diag:function(){return pl},dilation2d:function(){return dl},div:function(){return Qu},divNoNan:function(){return xl},dot:function(){return kl},dropout:function(){return Bf},einsum:function(){return wl},elu:function(){return Sl},enclosingPowerOfTwo:function(){return Wf},equal:function(){return gl},erf:function(){return Il},euclideanNorm:function(){return Vl},exp:function(){return jl},expandDims:function(){return Gl},expm1:function(){return Hl},eye:function(){return Kl},fft:function(){return ef},fill:function(){return Hc},floor:function(){return Xl},floorDiv:function(){return Yu},fused:function(){return Gf},gather:function(){return Yl},gatherND:function(){return zf},greater:function(){return Ql},greaterEqual:function(){return Zl},ifft:function(){return tf},imag:function(){return Jl},image:function(){return tm},inTopKAsync:function(){return jf},irfft:function(){return nf},isFinite:function(){return $l},isInf:function(){return ep},isNaN:function(){return tp},leakyRelu:function(){return np},less:function(){return rp},lessEqual:function(){return ap},linalg:function(){return nm},linspace:function(){return ip},localResponseNormalization:function(){return op},log:function(){return sp},log1p:function(){return up},logSigmoid:function(){return yp},logSoftmax:function(){return xp},logSumExp:function(){return kp},logicalAnd:function(){return wp},logicalNot:function(){return Sp},logicalOr:function(){return Ip},logicalXor:function(){return _p},losses:function(){return rm},lowerBound:function(){return Tp},matMul:function(){return Ac},max:function(){return Dl},maxPool:function(){return Ep},maxPool3d:function(){return Ap},maxPoolWithArgmax:function(){return Rp},maximum:function(){return Fp},mean:function(){return Dp},meshgrid:function(){return Pp},min:function(){return Ml},minimum:function(){return Lp},mirrorPad:function(){return zp},mod:function(){return Bp},moments:function(){return Wp},movingAverage:function(){return Rf},mul:function(){return Zu},multiRNNCell:function(){return Up},multinomial:function(){return Vp},neg:function(){return vp},norm:function(){return Ul},notEqual:function(){return jp},oneHot:function(){return Gp},ones:function(){return Op},onesLike:function(){return Hp},op:function(){return cs},outerProduct:function(){return qp},pad:function(){return Kp},pad1d:function(){return Xp},pad2d:function(){return Yp},pad3d:function(){return Qp},pad4d:function(){return Zp},pool:function(){return $p},pow:function(){return Ol},prelu:function(){return ed},print:function(){return Nu},prod:function(){return td},raggedGather:function(){return nd},raggedRange:function(){return rd},raggedTensorToTensor:function(){return ad},rand:function(){return id},randomGamma:function(){return Nd},randomNormal:function(){return Cd},randomStandardNormal:function(){return Td},randomUniform:function(){return Ed},range:function(){return Ad},real:function(){return Rd},reciprocal:function(){return Fd},relu:function(){return Dd},relu6:function(){return Md},reshape:function(){return Nc},reverse:function(){return Od},reverse1d:function(){return Pd},reverse2d:function(){return Ld},reverse3d:function(){return zd},reverse4d:function(){return Bd},rfft:function(){return af},round:function(){return Wd},rsqrt:function(){return Ud},scalar:function(){return Pl},scatterND:function(){return Pf},searchSorted:function(){return Cp},selu:function(){return Vd},separableConv2d:function(){return jd},setdiff1dAsync:function(){return Hd},sigmoid:function(){return Rc},sign:function(){return qd},signal:function(){return em},sin:function(){return Kd},sinh:function(){return Xd},slice:function(){return Fc},slice1d:function(){return Yd},slice2d:function(){return Qd},slice3d:function(){return Zd},slice4d:function(){return Jd},softmax:function(){return $d},softplus:function(){return gp},spaceToBatchND:function(){return Jp},sparse:function(){return am},sparseToDense:function(){return Lf},spectral:function(){return $h},split:function(){return rf},sqrt:function(){return Ll},square:function(){return zl},squaredDifference:function(){return of},squeeze:function(){return sf},stack:function(){return uf},step:function(){return cf},stridedSlice:function(){return lf},string:function(){return im},sub:function(){return bp},sum:function(){return Bl},tan:function(){return pf},tanh:function(){return Dc},tensor:function(){return ds},tensor1d:function(){return df},tensor2d:function(){return ff},tensor3d:function(){return hf},tensor4d:function(){return mf},tensor5d:function(){return vf},tensor6d:function(){return gf},tile:function(){return ql},topk:function(){return yf},transpose:function(){return Af},truncatedNormal:function(){return bf},unique:function(){return xf},unsortedSegmentSum:function(){return kf},unstack:function(){return wf},upperBound:function(){return Sf},variable:function(){return If},where:function(){return yl},whereAsync:function(){return Cf},zeros:function(){return Mp},zerosLike:function(){return bl}});var SE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(mT("a",e,t,n),mT("b",e,t,n))];case"AddN":return[r.addN(mT("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(mT("a",e,t,n),mT("b",e,t,n))];case"Mul":return[r.mul(mT("a",e,t,n),mT("b",e,t,n))];case"RealDiv":case"Div":return[r.div(mT("a",e,t,n),mT("b",e,t,n))];case"DivNoNan":return[r.divNoNan(mT("a",e,t,n),mT("b",e,t,n))];case"FloorDiv":return[r.floorDiv(mT("a",e,t,n),mT("b",e,t,n))];case"Sub":return[r.sub(mT("a",e,t,n),mT("b",e,t,n))];case"Minimum":return[r.minimum(mT("a",e,t,n),mT("b",e,t,n))];case"Maximum":return[r.maximum(mT("a",e,t,n),mT("b",e,t,n))];case"Pow":return[r.pow(mT("a",e,t,n),mT("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(mT("a",e,t,n),mT("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},IE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(mT("x",e,t,n))];case"Acos":return[r.acos(mT("x",e,t,n))];case"Acosh":return[r.acosh(mT("x",e,t,n))];case"Asin":return[r.asin(mT("x",e,t,n))];case"Asinh":return[r.asinh(mT("x",e,t,n))];case"Atan":return[r.atan(mT("x",e,t,n))];case"Atan2":return[r.atan2(mT("x",e,t,n),mT("y",e,t,n))];case"Atanh":return[r.atanh(mT("x",e,t,n))];case"Ceil":return[r.ceil(mT("x",e,t,n))];case"Complex":return[r.complex(mT("real",e,t,n),mT("imag",e,t,n))];case"Cos":return[r.cos(mT("x",e,t,n))];case"Cosh":return[r.cosh(mT("x",e,t,n))];case"Elu":return[r.elu(mT("x",e,t,n))];case"Erf":return[r.erf(mT("x",e,t,n))];case"Exp":return[r.exp(mT("x",e,t,n))];case"Expm1":return[r.expm1(mT("x",e,t,n))];case"Floor":return[r.floor(mT("x",e,t,n))];case"Log":return[r.log(mT("x",e,t,n))];case"Log1p":return[r.log1p(mT("x",e,t,n))];case"Imag":return[r.imag(mT("x",e,t,n))];case"Neg":return[r.neg(mT("x",e,t,n))];case"Reciprocal":return[r.reciprocal(mT("x",e,t,n))];case"Real":return[r.real(mT("x",e,t,n))];case"Relu":return[r.relu(mT("x",e,t,n))];case"Round":return[r.round(mT("x",e,t,n))];case"Selu":return[r.selu(mT("x",e,t,n))];case"Sigmoid":return[r.sigmoid(mT("x",e,t,n))];case"Sin":return[r.sin(mT("x",e,t,n))];case"Sign":return[r.sign(mT("x",e,t,n))];case"Sinh":return[r.sinh(mT("x",e,t,n))];case"Softplus":return[r.softplus(mT("x",e,t,n))];case"Sqrt":return[r.sqrt(mT("x",e,t,n))];case"Square":return[r.square(mT("x",e,t,n))];case"Tanh":return[r.tanh(mT("x",e,t,n))];case"Tan":return[r.tan(mT("x",e,t,n))];case"ClipByValue":return[r.clipByValue(mT("x",e,t,n),mT("clipValueMin",e,t,n),mT("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(mT("x",e,t,n))];case"Rsqrt":return[r.rsqrt(vT(e.inputNames[0],t,n))];case"Prod":return[r.prod(mT("x",e,t,n),mT("axes",e,t,n))];case"LeakyRelu":return[r.leakyRelu(mT("x",e,t,n),mT("alpha",e,t,n))];case"Prelu":return[r.prelu(mT("x",e,t,n),mT("alpha",e,t,n))];case"IsNan":return[r.isNaN(vT(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function _E(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!=typeof e&&"number"!=typeof t){Hi.assert(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var r=0;r<e.length;r++){var a=e[r],i=t[r];Hi.assert(a<0||i<0||a===i,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function NE(e){return!("number"==typeof e||e.some((function(e){return e<0})))}function CE(e,t,n){var r=TE(e,n),a=!NE(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=TE(e.shape,r)})),!NE(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function TE(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],i=t[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:i}return n}var EE=function(){function e(t,n,r,a,i,o,s){h(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Pl(0),Lu(this.idTensor)}return v(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.tensor.id))&&t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0===this.size()&&(null==this.elementShape||0===this.elementShape.length)&&(this.elementShape=t.shape),_E(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Lu(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return ds([],[0].concat(this.elementShape));var r=this.readMany(e);return _E(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),uf(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return ds([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return _E(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),Ec(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,Fe(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,wf(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));var i=0===r?0:t.size/r,o=[];Ou((function(){t=Nc(t,[1,r,i]);for(var s=0;s<e.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,e[s],i];o[s]=Nc(Fc(t,u,c),n.elementShape)}return o}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,o)}}]),e}(),AE=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;h(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));_E(n,e.shape,"TensorList shape mismatch: "),Lu(e)})),this.idTensor=Pl(0),this.maxNumElements=a,Lu(this.idTensor)}return v(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"copy",value:function(){return new e(Fe(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){(null==e||!e.has(t.id))&&t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));_E(e,this.elementShape,"TensorList shape mismatch: ");var a=CE(this.elementShape,this.tensors,e);return Ou((function(){var e=n.tensors.map((function(e){return Nc(e,a)}));return uf(e,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=CE(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,_E(r.shape,e,"TensorList shape mismatch: "),Nc(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(_E(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Lu(e),this.tensors.push(e)}},{key:"resize",value:function(t){if(t<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(t));if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error("TensorListResize input size ".concat(t," is greater maxNumElement ").concat(this.maxNumElements,"."));var n=new e([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(var r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));_E(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=CE(this.elementShape,this.tensors,t);return Nc(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));_E(this.elementShape,t.shape,"TensorList shape mismatch: "),Lu(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));_E(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var a=CE(this.elementShape,this.tensors,n);return 0===e.length?ds([],[0].concat(a)):Ou((function(){var t=e.map((function(e){return Nc(r.tensors[e],a)}));return uf(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));_E(this.elementShape,t,"TensorList shape mismatch: ");var r=CE(this.elementShape,this.tensors,t);return 0===this.size()?ds([],[0].concat(r)):Ou((function(){var e=n.tensors.map((function(e){return Nc(e,r)}));return Ec(e,0)}))}}]),e}();function RE(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));_E(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=wf(e);return new AE(a,t,r)}function FE(e,t,n,r){return new AE([],e,t,r)}function DE(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,Fe(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new AE([],n,e.dtype,r),o=wf(e,0);return t.forEach((function(e,t){i.setItem(e,o[t])})),i}function ME(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var i=TE(e.shape.slice(1),n),o=0===r?0:e.size/r,s=Ou((function(){var n=[];e=Nc(e,[1,r,o]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,t[s],o];n[s]=Nc(Fc(e,u,c),i)}return e.dispose(),n})),u=new AE([],n,e.dtype,t.length),c=0;c<s.length;c++)u.setItem(c,s[c]);return u}var OE=function(){var e=y(f().mark((function e(t,n,r){var a,i,o,s,u,c,l,p,d,h,m,v,g,y,b,x,k,w,S,I,_,N,C,T,E,A,R,F,D,M,O,P,L,z,B,W,U,V,j,G,H,q,K,X,Y,Q,Z,J,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,pe,de,fe,he,me,ve,ge,ye,be,xe,ke,we,Se,Ie,_e,Ne,Ce,Te,Ee,Ae,Re,Fe,De,Me,Oe,Pe,Le,ze,Be,We,Ue,Ve,je,Ge,He,qe,Ke,Xe,Ye,Qe,Ze,Je,$e;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?12:"LoopCond"===e.t0?30:"Switch"===e.t0?32:"Merge"===e.t0?42:"Enter"===e.t0?47:"Exit"===e.t0?49:"NextIteration"===e.t0?51:"TensorArrayV3"===e.t0?53:"TensorArrayWriteV3"===e.t0?55:"TensorArrayReadV3"===e.t0?57:"TensorArrayGatherV3"===e.t0?59:"TensorArrayScatterV3"===e.t0?61:"TensorArrayConcatV3"===e.t0?63:"TensorArraySplitV3"===e.t0?65:"TensorArraySizeV3"===e.t0?67:"TensorArrayCloseV3"===e.t0?69:"TensorListSetItem"===e.t0?71:"TensorListGetItem"===e.t0?73:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?75:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?77:"TensorListGather"===e.t0?81:"TensorListStack"===e.t0?83:"TensorListFromTensor"===e.t0?85:"TensorListConcat"===e.t0||"TensorListConcatV2"===e.t0?87:"TensorListPushBack"===e.t0?89:"TensorListPopBack"===e.t0?91:"TensorListSplit"===e.t0?93:"TensorListLength"===e.t0?95:"TensorListResize"===e.t0?97:99;break;case 3:return a=mT("thenBranch",t,n,r),i=mT("elseBranch",t,n,r),o=mT("cond",t,n,r),s=mT("args",t,n,r),e.next=6,o.data();case 6:if(!e.sent[0]){e.next=10;break}e.t1=r.functionMap[a].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap),e.next=11;break;case 10:e.t1=r.functionMap[i].executeFunctionAsync(s,r.tensorArrayMap,r.tensorListMap);case 11:return e.abrupt("return",e.t1);case 12:return u=mT("body",t,n,r),c=mT("cond",t,n,r),l=mT("args",t,n,r),e.next=17,r.functionMap[c].executeFunctionAsync(l,r.tensorArrayMap,r.tensorListMap);case 17:return p=e.sent,d=l.map((function(e){return e.id})),e.next=21,p[0].data();case 21:h=e.sent,p.forEach((function(e){!e.kept&&-1===d.indexOf(e.id)&&e.dispose()})),m=l,v=f().mark((function e(){var t,n,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=m,e.next=3,r.functionMap[u].executeFunctionAsync(m,r.tensorArrayMap,r.tensorListMap);case 3:return m=e.sent,n=m.map((function(e){return e.id})),t.forEach((function(e){!e.kept&&-1===d.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()})),e.next=8,r.functionMap[c].executeFunctionAsync(m,r.tensorArrayMap,r.tensorListMap);case 8:return a=e.sent,e.next=11,a[0].data();case 11:h=e.sent,a.forEach((function(e){!e.kept&&-1===d.indexOf(e.id)&&-1===n.indexOf(e.id)&&e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 25:if(!h[0]){e.next=29;break}return e.delegateYield(v(),"t2",27);case 27:e.next=25;break;case 29:return e.abrupt("return",m);case 30:return g=mT("pred",t,n,r),e.abrupt("return",[kT(g)]);case 32:return y=mT("pred",t,n,r),(b=mT("data",t,n,r)).kept||(b=kT(b)),e.next=36,y.data();case 36:if(!e.sent[0]){e.next=40;break}e.t3=[void 0,b],e.next=41;break;case 40:e.t3=[b,void 0];case 41:return e.abrupt("return",e.t3);case 42:if(x=t.inputNames.find((function(e){return void 0!==vT(e,n,r)})),!x){e.next=46;break}return k=vT(x,n,r),e.abrupt("return",[kT(k)]);case 46:return e.abrupt("return");case 47:return w=mT("frameName",t,n,r),S=mT("tensor",t,n,r),e.abrupt("return",(r.enterFrame(w),[kT(S)]));case 49:return I=mT("tensor",t,n,r),e.abrupt("return",(r.exitFrame(),[kT(I)]));case 51:return _=mT("tensor",t,n,r),e.abrupt("return",(r.nextIteration(),[kT(_)]));case 53:return N=mT("size",t,n,r),C=mT("dtype",t,n,r),T=mT("elementShape",t,n,r),E=mT("dynamicSize",t,n,r),A=mT("clearAfterRead",t,n,r),R=mT("identicalElementShapes",t,n,r),F=mT("name",t,n,r),D=new EE(F,C,N,T,R,E,A),e.abrupt("return",(r.addTensorArray(D),[D.idTensor,Pl(1)]));case 55:return M=mT("tensorArrayId",t,n,r),O=mT("index",t,n,r),P=mT("tensor",t,n,r),L=r.getTensorArray(M.id),e.abrupt("return",(L.write(O,P),[L.idTensor]));case 57:return z=mT("tensorArrayId",t,n,r),B=mT("index",t,n,r),e.abrupt("return",[r.getTensorArray(z.id).read(B)]);case 59:return W=mT("tensorArrayId",t,n,r),U=mT("indices",t,n,r),V=mT("dtype",t,n,r),e.abrupt("return",[r.getTensorArray(W.id).gather(U,V)]);case 61:return j=mT("tensorArrayId",t,n,r),G=mT("indices",t,n,r),H=mT("tensor",t,n,r),q=r.getTensorArray(j.id),e.abrupt("return",(q.scatter(G,H),[q.idTensor]));case 63:return K=mT("tensorArrayId",t,n,r),X=r.getTensorArray(K.id),Y=mT("dtype",t,n,r),e.abrupt("return",[X.concat(Y)]);case 65:return Q=mT("tensorArrayId",t,n,r),Z=mT("tensor",t,n,r),J=mT("lengths",t,n,r),$=r.getTensorArray(Q.id),e.abrupt("return",($.split(J,Z),[$.idTensor]));case 67:return ee=mT("tensorArrayId",t,n,r),te=r.getTensorArray(ee.id),e.abrupt("return",[Pl(te.size(),"int32")]);case 69:return ne=mT("tensorArrayId",t,n,r),re=r.getTensorArray(ne.id),e.abrupt("return",(re.clearAndClose(),[re.idTensor]));case 71:return ae=mT("tensorListId",t,n,r),ie=mT("index",t,n,r),oe=mT("tensor",t,n,r),se=r.getTensorList(ae.id),e.abrupt("return",(se.setItem(ie,oe),[se.idTensor]));case 73:return ue=mT("tensorListId",t,n,r),ce=mT("index",t,n,r),le=mT("elementShape",t,n,r),pe=mT("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(ue.id).getItem(ce,le,pe)]);case 75:return de=mT("indices",t,n,r),fe=mT("tensor",t,n,r),he=mT("elementShape",t,n,r),me=mT("numElements",t,n,r),ve=DE(fe,de,he,me),e.abrupt("return",(r.addTensorList(ve),[ve.idTensor]));case 77:return ge=mT("elementShape",t,n,r),ye=mT("elementDType",t,n,r),be="TensorListReserve"===t.op?"numElements":"maxNumElements",xe=mT(be,t,n,r),ke="TensorListReserve"===t.op?-1:xe,we=FE(ge,ye,0,ke),e.abrupt("return",(r.addTensorList(we),[we.idTensor]));case 81:return Se=mT("tensorListId",t,n,r),Ie=mT("indices",t,n,r),_e=mT("elementShape",t,n,r),Ne=mT("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Se.id).gather(Ie,Ne,_e)]);case 83:return Ce=mT("tensorListId",t,n,r),Te=mT("elementShape",t,n,r),Ee=mT("elementDType",t,n,r),Ae=mT("numElements",t,n,r),e.abrupt("return",[r.getTensorList(Ce.id).stack(Te,Ee,Ae)]);case 85:return Re=mT("tensor",t,n,r),Fe=mT("elementShape",t,n,r),De=mT("elementDType",t,n,r),Me=RE(Re,Fe,De),e.abrupt("return",(r.addTensorList(Me),[Me.idTensor]));case 87:return Oe=mT("tensorListId",t,n,r),Pe=r.getTensorList(Oe.id),Le=mT("dtype",t,n,r),ze=mT("elementShape",t,n,r),e.abrupt("return",[Pe.concat(Le,ze)]);case 89:return Be=mT("tensorListId",t,n,r),We=mT("tensor",t,n,r),Ue=r.getTensorList(Be.id),e.abrupt("return",(Ue.pushBack(We),[Ue.idTensor]));case 91:return Ve=mT("tensorListId",t,n,r),je=mT("elementShape",t,n,r),Ge=mT("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Ve.id).popBack(je,Ge)]);case 93:return He=mT("tensor",t,n,r),qe=mT("elementShape",t,n,r),Ke=mT("lengths",t,n,r),Xe=ME(He,Ke,qe),e.abrupt("return",(r.addTensorList(Xe),[Xe.idTensor]));case 95:return Ye=mT("tensorListId",t,n,r),Qe=r.getTensorList(Ye.id),e.abrupt("return",[Pl(Qe.size(),"int32")]);case 97:return Ze=mT("tensorListId",t,n,r),Je=mT("size",t,n,r),$e=r.getTensorList(Ze.id).resize(Je),e.abrupt("return",(r.addTensorList($e),[$e.idTensor]));case 99:throw TypeError("Node type ".concat(t.op," is not implemented"));case 100:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function PE(e,t,n){var r=o(mT("fusedOps",e,t,n),2),a=r[0],i=r[1],s="biasadd"===a,u=!s,c="prelu"===i,l="fusedbatchnorm"===a,p=mT("numArgs",e,t,n);if(s){if(c&&2!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&s&&1!==p)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var d=mT("strides",e,t,n),f=xT(e,t,n),h=mT("dataFormat",e,t,n).toUpperCase(),m=mT("dilations",e,t,n),v=o(mT("args",e,t,n),2),g=v[0],y=v[1];return u&&(y=g,g=void 0),{stride:d,pad:f,dataFormat:h,dilations:m,biasArg:g,preluArg:y,activationFunc:i,leakyreluAlpha:mT("leakyreluAlpha",e,t,n)}}var LE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"Conv1D":var a=mT("stride",e,t,n),i=mT("pad",e,t,n),o=mT("dataFormat",e,t,n).toUpperCase(),s=mT("dilation",e,t,n);return[r.conv1d(mT("x",e,t,n),mT("filter",e,t,n),a,i,o,s)];case"Conv2D":var u=mT("strides",e,t,n),c=xT(e,t,n),l=mT("dataFormat",e,t,n).toUpperCase(),p=mT("dilations",e,t,n);return[r.conv2d(mT("x",e,t,n),mT("filter",e,t,n),[u[1],u[2]],c,l,[p[1],p[2]])];case"_FusedConv2D":var d=PE(e,t,n),f=d.stride,h=d.pad,m=d.dataFormat,v=d.dilations,g=d.biasArg,y=d.preluArg,b=d.activationFunc,x=d.leakyreluAlpha;return[r.fused.conv2d({x:mT("x",e,t,n),filter:mT("filter",e,t,n),strides:[f[1],f[2]],pad:h,dataFormat:m,dilations:[v[1],v[2]],bias:g,activation:b,preluActivationWeights:y,leakyreluAlpha:x})];case"FusedDepthwiseConv2dNative":var k=PE(e,t,n),w=k.stride,S=k.pad,I=k.dataFormat,_=k.dilations,N=k.biasArg,C=k.preluArg,T=k.activationFunc,E=k.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:mT("x",e,t,n),filter:mT("filter",e,t,n),strides:[w[1],w[2]],pad:S,dataFormat:I,dilations:[_[1],_[2]],bias:N,activation:T,preluActivationWeights:C,leakyreluAlpha:E})];case"Conv2DBackpropInput":case"Conv2dTranspose":var A=mT("outputShape",e,t,n),R=mT("strides",e,t,n),F=xT(e,t,n);return[r.conv2dTranspose(mT("x",e,t,n),mT("filter",e,t,n),A,[R[1],R[2]],F)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var D=mT("strides",e,t,n),M=xT(e,t,n),O=mT("dilations",e,t,n),P=mT("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(mT("input",e,t,n),mT("filter",e,t,n),[D[1],D[2]],M,P,[O[1],O[2]])];case"Conv3D":var L=mT("strides",e,t,n),z=mT("pad",e,t,n),B=mT("dataFormat",e,t,n).toUpperCase(),W=mT("dilations",e,t,n);return[r.conv3d(mT("x",e,t,n),mT("filter",e,t,n),[L[1],L[2],L[3]],z,B,[W[1],W[2],W[3]])];case"AvgPool":var U=mT("strides",e,t,n),V=mT("pad",e,t,n),j=mT("kernelSize",e,t,n);return[r.avgPool(mT("x",e,t,n),[j[1],j[2]],[U[1],U[2]],V)];case"MaxPool":var G=mT("strides",e,t,n),H=mT("pad",e,t,n),q=mT("kernelSize",e,t,n);return[r.maxPool(mT("x",e,t,n),[q[1],q[2]],[G[1],G[2]],H)];case"MaxPoolWithArgmax":var K=mT("strides",e,t,n),X=mT("pad",e,t,n),Y=mT("kernelSize",e,t,n),Q=mT("includeBatchInIndex",e,t,n),Z=r.maxPoolWithArgmax(mT("x",e,t,n),[Y[1],Y[2]],[K[1],K[2]],X,Q);return[Z.result,Z.indexes];case"AvgPool3D":var J=mT("strides",e,t,n),$=mT("pad",e,t,n),ee=mT("kernelSize",e,t,n);return[r.avgPool3d(mT("x",e,t,n),[ee[1],ee[2],ee[3]],[J[1],J[2],J[3]],$)];case"MaxPool3D":var te=mT("strides",e,t,n),ne=mT("pad",e,t,n),re=mT("kernelSize",e,t,n);return[r.maxPool3d(mT("x",e,t,n),[re[1],re[2],re[3]],[te[1],te[2],te[3]],ne)];case"Dilation2D":var ae=mT("strides",e,t,n),ie=mT("pad",e,t,n),oe=mT("dilations",e,t,n),se=ae[1],ue=ae[2],ce=oe[1],le=oe[2];return[r.dilation2d(mT("x",e,t,n),mT("filter",e,t,n),[se,ue],ie,[ce,le],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},zE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"Fill":var a=mT("shape",e,t,n),i=mT("dtype",e,t,n),o=mT("value",e,t,n);return[r.fill(a,o,i)];case"LinSpace":var s=mT("start",e,t,n),u=mT("stop",e,t,n),c=mT("num",e,t,n);return[r.linspace(s,u,c)];case"Multinomial":var l=mT("logits",e,t,n),p=mT("numSamples",e,t,n),d=mT("seed",e,t,n);return[r.multinomial(l,p,d)];case"OneHot":var f=mT("indices",e,t,n),h=mT("depth",e,t,n),m=mT("onValue",e,t,n),v=mT("offValue",e,t,n),g=mT("dtype",e,t,n);return[r.oneHot(f,h,m,v,g)];case"Ones":return[r.ones(mT("shape",e,t,n),mT("dtype",e,t,n))];case"OnesLike":return[r.onesLike(mT("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(mT("shape",e,t,n),mT("dtype",e,t,n),mT("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(mT("shape",e,t,n),mT("minval",e,t,n),mT("maxval",e,t,n),mT("dtype",e,t,n))];case"Range":var y=mT("start",e,t,n),b=mT("stop",e,t,n),x=mT("step",e,t,n);return[r.range(y,b,x,mT("dtype",e,t,n))];case"TruncatedNormal":var k=mT("shape",e,t,n),w=mT("mean",e,t,n),S=mT("stdDev",e,t,n),I=mT("seed",e,t,n);return[r.truncatedNormal(k,w,S,mT("dtype",e,t,n),I)];case"Zeros":return[r.zeros(mT("shape",e,t,n),mT("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(mT("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function BE(e,t,n){return{boxes:mT("boxes",e,t,n),scores:mT("scores",e,t,n),maxOutputSize:mT("maxOutputSize",e,t,n),iouThreshold:mT("iouThreshold",e,t,n),scoreThreshold:mT("scoreThreshold",e,t,n),softNmsSigma:mT("softNmsSigma",e,t,n)}}var WE=function(){var e=y(f().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,d,h,m,v,g,y,b,x,k,w,S,I,_,N,C,T,E,A,R=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=R.length>4&&void 0!==R[4]?R[4]:wE,e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?4:"NonMaxSuppressionV4"===e.t0?15:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?26:"Where"===e.t0?31:"ListDiff"===e.t0?37:38;break;case 4:return o=BE(t,n,r),s=o.boxes,u=o.scores,c=o.maxOutputSize,l=o.iouThreshold,p=o.scoreThreshold,d=o.softNmsSigma,e.next=13,i.image.nonMaxSuppressionWithScoreAsync(s,u,c,l,p,d);case 13:return h=e.sent,e.abrupt("return",[h.selectedIndices,h.selectedScores]);case 15:return m=BE(t,n,r),v=m.boxes,g=m.scores,y=m.maxOutputSize,b=m.iouThreshold,x=m.scoreThreshold,k=mT("padToMaxOutputSize",t,n,r),e.next=24,i.image.nonMaxSuppressionPaddedAsync(v,g,y,b,x,k);case 24:return w=e.sent,e.abrupt("return",[w.selectedIndices,w.validOutputs]);case 26:return S=BE(t,n,r),I=S.boxes,_=S.scores,N=S.maxOutputSize,C=S.iouThreshold,T=S.scoreThreshold,e.next=29,i.image.nonMaxSuppressionAsync(I,_,N,C,T);case 29:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 31:return E=i.cast(mT("condition",t,n,r),"bool"),e.next=34,i.whereAsync(E);case 34:return e.t2=e.sent,A=[e.t2],e.abrupt("return",(E.dispose(),A));case 37:return e.abrupt("return",i.setdiff1dAsync(mT("x",t,n,r),mT("y",t,n,r)));case 38:throw TypeError("Node type ".concat(t.op," is not implemented"));case 39:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),UE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"LowerBound":var a=mT("sortedSequence",e,t,n),i=mT("values",e,t,n);return[r.lowerBound(a,i)];case"TopKV2":var o=mT("x",e,t,n),s=mT("k",e,t,n),u=mT("sorted",e,t,n),c=r.topk(o,s,u);return[c.values,c.indices];case"UpperBound":var l=mT("sortedSequence",e,t,n),p=mT("values",e,t,n);return[r.upperBound(l,p)];case"Unique":var d=mT("x",e,t,n),f=r.unique(d);return[f.values,f.indices];case"UniqueV2":var h=mT("x",e,t,n),m=mT("axis",e,t,n),v=r.unique(h,m);return[v.values,v.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},VE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var a=mT("default",e,t,n);return[vT(e.name,t,n)||a];case"Placeholder":return[vT(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[kT(mT("x",e,t,n))];case"IdentityN":return mT("x",e,t,n).map((function(e){return kT(e)}));case"Snapshot":return[kT(mT("x",e,t,n))];case"Shape":return[r.tensor1d(mT("x",e,t,n).shape,"int32")];case"ShapeN":return mT("x",e,t,n).map((function(e){return r.tensor1d(e.shape)}));case"Size":return[r.scalar(mT("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(mT("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var i=mT("x",e,t,n),o=mT("data",e,t,n),s=mT("message",e,t,n),u=mT("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(s);for(var c=0;c<o.length;c++)console.log(Array.prototype.slice.call(o[c].dataSync()).slice(0,u));return[i];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},jE=function(){function e(t,n){h(this,e),this.keyDType=t,this.valueDType=n,this.handle=Pl(0),this.tensorMap=new Map,Lu(this.handle)}return v(e,[{key:"id",get:function(){return this.handle.id}},{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return Pl(this.size(),"int32")}},{key:"import",value:function(){var e=y(f().mark((function e(t,n){var r,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",(this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),Ou((function(){var e=wf(n),t=r.length,i=e.length;Hi.assert(t===i,(function(){return"The number of elements doesn't match, keys has ".concat(t," elements, the values has ").concat(i," elements.")}));for(var o=0;o<t;o++){var s=r[o],u=e[o];Lu(u),a.tensorMap.set(s,u)}return a.handle}))));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"find",value:function(){var e=y(f().mark((function e(t,n){var r,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",Ou((function(){for(var e=[],t=0;t<r.length;t++){var i=r[t],o=a.findWithDefault(i,n);e.push(o)}return uf(e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ").concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ").concat(t.dtype))}}]),e}(),GE=function(){var e=y(f().mark((function e(t,n,r,a){var i,o,s,u,c,l,p,d,h,m,v;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"InitializeTable"===e.t0||"InitializeTableV2"===e.t0||"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?8:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?13:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?18:20;break;case 3:if(null==(i=a.getHashTableHandleByName(t.name))){e.next=6;break}return e.abrupt("return",[i]);case 6:return o=mT("keyDType",t,n,r),s=mT("valueDType",t,n,r),u=new jE(o,s),e.abrupt("return",(a.addHashTable(t.name,u),[u.handle]));case 8:return c=mT("tableHandle",t,n,r,a),l=mT("keys",t,n,r),p=mT("values",t,n,r),e.next=11,a.getHashTableById(c.id).import(l,p);case 11:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 13:return d=mT("tableHandle",t,n,r,a),h=mT("keys",t,n,r),m=mT("defaultValue",t,n,r),e.next=16,a.getHashTableById(d.id).find(h,m);case 16:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 18:return v=mT("tableHandle",t,n,r,a),e.abrupt("return",[a.getHashTableById(v.id).tensorSize()]);case 20:throw TypeError("Node type ".concat(t.op," is not implemented"));case 21:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),HE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"ResizeBilinear":var a=mT("images",e,t,n),i=mT("size",e,t,n),o=mT("alignCorners",e,t,n),s=mT("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[i[0],i[1]],o,s)];case"ResizeNearestNeighbor":var u=mT("images",e,t,n),c=mT("size",e,t,n),l=mT("alignCorners",e,t,n),p=mT("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(u,[c[0],c[1]],l,p)];case"CropAndResize":var d=mT("image",e,t,n),f=mT("boxes",e,t,n),h=mT("boxInd",e,t,n),m=mT("cropSize",e,t,n),v=mT("method",e,t,n),g=mT("extrapolationValue",e,t,n);return[r.image.cropAndResize(d,f,h,m,v,g)];case"ImageProjectiveTransformV3":var y=mT("images",e,t,n),b=mT("transforms",e,t,n),x=mT("outputShape",e,t,n),k=mT("fillValue",e,t,n),w=mT("interpolation",e,t,n),S=mT("fillMode",e,t,n);return[r.image.transform(y,b,w.toLowerCase(),S.toLowerCase(),k,x)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},qE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"Equal":return[r.equal(mT("a",e,t,n),mT("b",e,t,n))];case"NotEqual":return[r.notEqual(mT("a",e,t,n),mT("b",e,t,n))];case"Greater":return[r.greater(mT("a",e,t,n),mT("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(mT("a",e,t,n),mT("b",e,t,n))];case"Less":return[r.less(mT("a",e,t,n),mT("b",e,t,n))];case"LessEqual":return[r.lessEqual(mT("a",e,t,n),mT("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(mT("a",e,t,n),mT("b",e,t,n))];case"LogicalNot":return[r.logicalNot(mT("a",e,t,n))];case"LogicalOr":return[r.logicalOr(mT("a",e,t,n),mT("b",e,t,n))];case"Select":case"SelectV2":return[r.where(mT("condition",e,t,n),mT("a",e,t,n),mT("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},KE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(mT("a",e,t,n),mT("b",e,t,n),mT("transposeA",e,t,n),mT("transposeB",e,t,n))];case"Einsum":return[r.einsum.apply(r,[mT("equation",e,t,n)].concat(Fe(mT("tensors",e,t,n))))];case"Transpose":return[r.transpose(mT("x",e,t,n),mT("perm",e,t,n))];case"_FusedMatMul":var a=o(mT("fusedOps",e,t,n),2),i=a[0],s=a[1],u="biasadd"===i,c="prelu"===s,l=mT("numArgs",e,t,n),p=mT("leakyreluAlpha",e,t,n);if(u){if(c&&2!==l)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!c&&1!==l)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var d=o(mT("args",e,t,n),2),f=d[0],h=d[1];return[r.fused.matMul({a:mT("a",e,t,n),b:mT("b",e,t,n),transposeA:mT("transposeA",e,t,n),transposeB:mT("transposeB",e,t,n),bias:f,activation:s,preluActivationWeights:h,leakyreluAlpha:p})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},XE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(mT("x",e,t,n),mT("axis",e,t,n),mT("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(mT("x",e,t,n),mT("mean",e,t,n),mT("variance",e,t,n),mT("offset",e,t,n),mT("scale",e,t,n),mT("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(mT("x",e,t,n),mT("radius",e,t,n),mT("bias",e,t,n),mT("alpha",e,t,n),mT("beta",e,t,n))];case"Softmax":return[r.softmax(mT("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(mT("x",e,t,n))];case"SparseToDense":return[r.sparseToDense(mT("sparseIndices",e,t,n),mT("outputShape",e,t,n),mT("sparseValues",e,t,n),mT("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},YE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"RaggedGather":var a=r.raggedGather(mT("paramsNestedSplits",e,t,n),mT("paramsDenseValues",e,t,n),mT("indices",e,t,n),mT("outputRaggedRank",e,t,n)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o);case"RaggedRange":var s=r.raggedRange(mT("starts",e,t,n),mT("limits",e,t,n),mT("splits",e,t,n));return[s.rtNestedSplits,s.rtDenseValues];case"RaggedTensorToTensor":return[r.raggedTensorToTensor(mT("shape",e,t,n),mT("values",e,t,n),mT("defaultValue",e,t,n),mT("rowPartitionTensors",e,t,n),mT("rowPartitionTypes",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},QE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"Max":var a=mT("axis",e,t,n),i=mT("keepDims",e,t,n);return[r.max(mT("x",e,t,n),a,i)];case"Mean":var o=mT("axis",e,t,n),s=mT("keepDims",e,t,n);return[r.mean(mT("x",e,t,n),o,s)];case"Min":var u=mT("axis",e,t,n),c=mT("keepDims",e,t,n);return[r.min(mT("x",e,t,n),u,c)];case"Sum":var l=mT("axis",e,t,n),p=mT("keepDims",e,t,n);return[r.sum(mT("x",e,t,n),l,p)];case"All":var d=mT("axis",e,t,n),f=mT("keepDims",e,t,n);return[r.all(mT("x",e,t,n),d,f)];case"Any":var h=mT("axis",e,t,n),m=mT("keepDims",e,t,n);return[r.any(mT("x",e,t,n),h,m)];case"ArgMax":var v=mT("axis",e,t,n);return[r.argMax(mT("x",e,t,n),v)];case"ArgMin":var g=mT("axis",e,t,n);return[r.argMin(mT("x",e,t,n),g)];case"Prod":var y=mT("axis",e,t,n),b=mT("keepDims",e,t,n);return[r.prod(mT("x",e,t,n),y,b)];case"Cumprod":var x=mT("axis",e,t,n),k=mT("exclusive",e,t,n),w=mT("reverse",e,t,n);return[r.cumprod(mT("x",e,t,n),x,k,w)];case"Cumsum":var S=mT("axis",e,t,n),I=mT("exclusive",e,t,n),_=mT("reverse",e,t,n);return[r.cumsum(mT("x",e,t,n),S,I,_)];case"Bincount":var N=mT("x",e,t,n),C=mT("weights",e,t,n),T=mT("size",e,t,n);return[r.bincount(N,C,T)];case"DenseBincount":var E=mT("x",e,t,n),A=mT("weights",e,t,n),R=mT("size",e,t,n),F=mT("binaryOutput",e,t,n);return[r.denseBincount(E,A,R,F)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},ZE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"ConcatV2":case"Concat":var a=mT("n",e,t,n),i=mT("axis",e,t,n),o=mT("tensors",e,t,n);return o=o.slice(0,a),[r.concat(o,i)];case"Gather":var s=mT("x",e,t,n),u=mT("indices",e,t,n);return[r.gather(s,r.cast(u,"int32"),0)];case"GatherV2":var c=mT("axis",e,t,n),l=mT("batchDims",e,t,n),p=mT("x",e,t,n),d=mT("indices",e,t,n);return[r.gather(p,r.cast(d,"int32"),c,l)];case"Reverse":for(var f=mT("dims",e,t,n),h=[],m=0;m<f.length;m++)f[m]&&h.push(m);var v=mT("x",e,t,n);return[r.reverse(v,h)];case"ReverseV2":var g=mT("axis",e,t,n),y=mT("x",e,t,n);return[r.reverse(y,g)];case"Slice":var b=mT("begin",e,t,n),x=mT("size",e,t,n);return[r.slice(mT("x",e,t,n),b,x)];case"StridedSlice":var k=mT("begin",e,t,n),w=mT("end",e,t,n),S=mT("strides",e,t,n),I=mT("beginMask",e,t,n),_=mT("endMask",e,t,n),N=mT("ellipsisMask",e,t,n),C=mT("newAxisMask",e,t,n),T=mT("shrinkAxisMask",e,t,n),E=mT("x",e,t,n);return[r.stridedSlice(E,k,w,S,I,_,N,C,T)];case"Pack":return Ou((function(){var a=mT("axis",e,t,n),i=mT("tensors",e,t,n),o=i[0].shape,s=r.squeeze(i[0]).shape,u=i.map((function(e){var t=Hi.arraysEqual(e.shape,o);if(!t&&!Hi.arraysEqual(r.squeeze(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,o)}));return[r.stack(u,a)]}));case"Unpack":var A=mT("axis",e,t,n),R=mT("tensor",e,t,n);return r.unstack(R,A);case"Tile":var F=mT("reps",e,t,n);return[r.tile(mT("x",e,t,n),F)];case"Split":case"SplitV":var D=mT("axis",e,t,n),M=mT("numOrSizeSplits",e,t,n),O=mT("x",e,t,n);return r.split(O,M,D);case"ScatterNd":var P=mT("indices",e,t,n),L=mT("values",e,t,n),z=mT("shape",e,t,n);return[r.scatterND(P,L,z)];case"GatherNd":var B=mT("x",e,t,n),W=mT("indices",e,t,n);return[r.gatherND(B,W)];case"SparseToDense":var U=mT("sparseIndices",e,t,n),V=mT("outputShape",e,t,n),j=mT("sparseValues",e,t,n),G=mT("defaultValue",e,t,n);return[r.sparseToDense(U,j,V,j.dtype===G.dtype?G:r.cast(G,j.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},JE=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"SparseFillEmptyRows":var a=r.sparse.sparseFillEmptyRows(mT("indices",e,t,n),mT("values",e,t,n),mT("denseShape",e,t,n),mT("defaultValue",e,t,n));return[a.outputIndices,a.outputValues,a.emptyRowIndicator,a.reverseIndexMap];case"SparseReshape":var i=r.sparse.sparseReshape(mT("inputIndices",e,t,n),mT("inputShape",e,t,n),mT("newShape",e,t,n));return[i.outputIndices,i.outputShape];case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(mT("data",e,t,n),mT("indices",e,t,n),mT("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(mT("data",e,t,n),mT("indices",e,t,n),mT("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},$E=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"FFT":return[r.fft(mT("x",e,t,n))];case"IFFT":return[r.ifft(mT("x",e,t,n))];case"RFFT":return[r.rfft(mT("x",e,t,n))];case"IRFFT":return[r.irfft(mT("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},eA=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"StringNGrams":var a=r.string.stringNGrams(mT("data",e,t,n),mT("dataSplits",e,t,n),mT("separator",e,t,n),mT("nGramWidths",e,t,n),mT("leftPad",e,t,n),mT("rightPad",e,t,n),mT("padWidth",e,t,n),mT("preserveShortSequences",e,t,n));return[a.nGrams,a.nGramsSplits];case"StringSplit":var i=r.string.stringSplit(mT("input",e,t,n),mT("delimiter",e,t,n),mT("skipEmpty",e,t,n));return[i.indices,i.values,i.shape];case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(mT("input",e,t,n),mT("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}},tA=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:wE;switch(e.op){case"Cast":return[r.cast(mT("x",e,t,n),mT("dtype",e,t,n))];case"ExpandDims":var a=mT("axis",e,t,n);return[r.expandDims(mT("x",e,t,n),a)];case"Squeeze":var i=mT("axis",e,t,n);return[r.squeeze(mT("x",e,t,n),i)];case"Reshape":return[r.reshape(mT("x",e,t,n),mT("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(mT("x",e,t,n),mT("padding",e,t,n),mT("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(mT("x",e,t,n),mT("padding",e,t,n),mT("constantValue",e,t,n))];case"SpaceToBatchND":var o=mT("blockShape",e,t,n),s=mT("paddings",e,t,n);return[r.spaceToBatchND(mT("x",e,t,n),o,s)];case"BatchToSpaceND":var u=mT("blockShape",e,t,n),c=mT("crops",e,t,n);return[r.batchToSpaceND(mT("x",e,t,n),u,c)];case"DepthToSpace":var l=mT("blockSize",e,t,n),p=mT("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(mT("x",e,t,n),l,p)];case"BroadcastTo":return[r.broadcastTo(mT("x",e,t,n),mT("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(mT("s0",e,t,n),mT("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}};function nA(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ou,i=function(e,t,n){switch(e.category){case"arithmetic":return a((function(){return SE(e,t,n)}));case"basic_math":return a((function(){return IE(e,t,n)}));case"control":return OE(e,t,n);case"convolution":return a((function(){return LE(e,t,n)}));case"creation":return a((function(){return zE(e,t,n)}));case"dynamic":return WE(e,t,n);case"evaluation":return a((function(){return UE(e,t,n)}));case"image":return a((function(){return HE(e,t,n)}));case"graph":return a((function(){return VE(e,t,n)}));case"logical":return a((function(){return qE(e,t,n)}));case"matrices":return a((function(){return KE(e,t,n)}));case"normalization":return a((function(){return XE(e,t,n)}));case"ragged":return a((function(){return YE(e,t,n)}));case"reduction":return a((function(){return QE(e,t,n)}));case"slice_join":return a((function(){return ZE(e,t,n)}));case"sparse":return a((function(){return JE(e,t,n)}));case"spectral":return a((function(){return $E(e,t,n)}));case"string":return a((function(){return eA(e,t,n)}));case"transformation":return a((function(){return tA(e,t,n)}));case"hash_table":return GE(e,t,n,r);case"custom":var i=fT(e.op);if(i&&i.customExecutor)return i.customExecutor(new kE(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}}(e,t,n);return Hi.isPromise(i)?i.then((function(e){return[].concat(e)})):[].concat(i)}var rA=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};h(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return v(e,[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"currentContext",get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}]),e}();function aA(e,t,n,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(e).map((function(e){return bT(e)[0]})),l=[];null!=r&&(l=r.map((function(e){return bT(e.name)[0]})));for(var p=Fe(t);p.length>0;){var d=p.pop();if((uA(d)||cA(d)||lA(d))&&null==o&&(s=(o=d).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(d.name),null==n[d.name]&&-1===c.indexOf(d.name)&&-1===l.indexOf(d.name)){if(0===d.inputs.length){i.push(d.name);continue}d.inputs.forEach((function(e){u.has(e.name)||(u.add(e.name),p.push(e))}))}}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}var iA=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],oA=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],sA=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function uA(e){return iA.indexOf(e.op)>=0}function cA(e){return oA.indexOf(e.op)>=0}function lA(e){return sA.indexOf(e.op)>=0}var pA=function(){function e(t,n){var r=this;h(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}return v(e,[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,Fe(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}},{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=aA(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,i=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has the dynamic op '").concat(a.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(i,"]"));if(r.length>0){var o=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(o,"] from the provided inputs [").concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,i=[],o=Object.keys(a).map((function(e){return bT(e)[0]})).map((function(t){return e.nodes[t]})),s=e.initNodes;o.forEach((function(e){r.has(e.name)&&i.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&i.push(e)})),null!=s&&s.forEach((function(e){r.has(e.name)&&i.push(e)}));for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&i.push(e)}))}return c}(this.graph,this.weightMap,n)}},{key:"cloneAndKeepTensor",value:function(e){if(null==e)return null;var t=e.clone();return Lu(t),t}},{key:"cloneTensorList",value:function(e){var t=this;return e?e.map((function(e){return t.cloneAndKeepTensor(e)})):null}},{key:"cloneTensorMap",value:function(e){var t=this;return Object.fromEntries(Object.entries(e).map((function(e){var n=o(e,2),r=n[0],a=n[1];return[r,t.cloneTensorList(a)]})))}},{key:"execute",value:function(e,t){var n=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var a=r.map((function(e){return n.graph.nodes[bT(e)[0]]})),i=t.map((function(e){return bT(e)[0]})),s=i.map((function(e){return n.graph.nodes[e]}));0===s.length&&(s=this._outputs);var u=this.getCompilationKey(a,s),c=this.compiledMap.get(u);null==c&&(c=this.compile(e,s),this.compiledMap.set(u,c));try{this.keepIntermediateTensors=hn().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(R){this.keepIntermediateTensors=!1,console.warn(R.message)}var l={},p={};return Ou((function(){var r=new rA(n.weightMap,l,p,n.functionExecutorMap),a=Object.assign({},n.weightMap);n.keepIntermediateTensors&&(n.clonedTensorsMap=n.cloneTensorMap(n.weightMap)),Object.keys(e).forEach((function(t){var r=o(bT(t),2),i=r[0],s=[];s[r[1]]=e[t],a[i]=s,n.keepIntermediateTensors&&(n.clonedTensorsMap[i]=n.cloneTensorList(s))}));for(var s=n.getFrozenTensorIds(a),u={},d=0;d<c.length;d++){var f=c[d];if(!a[f.name]){var h=nA(f,a,r,n._resourceManager);if(Hi.isPromise(h))throw new Error("The execution of the op '".concat(f.op,"' returned a promise. Please use model.executeAsync() instead."));a[f.name]=h,n.keepIntermediateTensors&&(n.clonedTensorsMap[f.name]=n.cloneTensorList(h)),n.checkTensorForDisposal(f.name,f,a,r,s,i,u)}}return null==n.parent&&r.dispose(s),t.map((function(e){return vT(e,a,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,i,o){"control"===t.category||-1!==i.indexOf(e)||(n[e].forEach((function(e){null!=e&&(o[e.id]=(o[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var t=function(e,t,n){return t[yT(e,n.currentContextId)]}(e.name,n,r);null!=t&&t.forEach((function(e){if(e&&!e.kept&&!a.has(e.id)){var t=o[e.id];1===t?(e.dispose(),delete o[e.id]):null!=t&&o[e.id]--}}))}})))}},{key:"executeAsync",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"disposeIntermediateTensors",value:function(){this.clonedTensorsMap&&(Object.values(this.clonedTensorsMap).forEach((function(e){var t,n=De(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;r&&!r.isDisposed&&r.dispose()}}catch(a){n.e(a)}finally{n.f()}})),this.clonedTensorsMap=null)}},{key:"getIntermediateTensors",value:function(){return this.clonedTensorsMap}},{key:"_executeAsync",value:function(){var e=y(f().mark((function e(t,n){var r,a,i,o,s,u,c,l,p,d=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=d.length>2&&void 0!==d[2]&&d[2],a=d.length>3&&void 0!==d[3]?d[3]:{},i=d.length>4&&void 0!==d[4]?d[4]:{},this.disposeIntermediateTensors(),r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepIntermediateTensors=hn().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(D){this.keepIntermediateTensors=!1,console.warn(D.message)}return o=new rA(this.weightMap,a,i,this.functionExecutorMap),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),e.next=9,this.executeWithControlFlow(t,o,n,r);case 9:return s=e.sent,u=n.map((function(e){return vT(e,s,o)})),c=u.map((function(e){return e.id})),l=Object.keys(t).map((function(e){return t[e].id})),p=new Set([].concat(Fe(c),Fe(l),Fe(this.weightIds))),e.abrupt("return",(Object.values(s).forEach((function(e){e.forEach((function(e){e&&!e.isDisposed&&!p.has(e.id)&&e.dispose()}))})),null==this.parent&&o.dispose(p),u));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"executeFunctionAsync",value:function(){var e=y(f().mark((function e(t,n,r){var a,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[i.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"executeWithControlFlow",value:function(){var e=y(f().mark((function e(t,n,r,a){var i,s,u,c,l,p,d,h,m,v,g,y,b,x,k,w,S,I=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),s=i.map((function(e){return I.graph.nodes[bT(e)[0]]})),u=r.map((function(e){return bT(e)[0]})),c=u.map((function(e){return I.graph.nodes[e]})),0===c.length&&(c=this._outputs),l=aA(t,c,this.weightMap,this._initNodes),p=l.usedNodes,d=l.missingInputs,h=l.dynamicNode,m=l.syncInputs,v=[].concat(Fe(s),Fe(this.graph.weights),Fe(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),g=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=o(bT(e),2),r=n[0],a=[];a[n[1]]=t[e],g[r]=a})),y={},b=this.getFrozenTensorIds(g),x={};case 5:if(!(v.length>0)){e.next=11;break}return k=this.processStack(s,v,n,g,x,b,u,y,p),e.next=9,Promise.all(k);case 9:e.next=5;break;case 11:if(null==h&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),w=c.filter((function(e){return!uA(e)&&!vT(e.name,g,n)})).map((function(e){return e.name})),!(w.length>0)){e.next=16;break}throw S="",null!=h&&(S="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(m,"]")),new Error("Cannot compute the outputs [".concat(w,"] from the provided inputs [").concat(i,"]. Consider providing the following inputs: [").concat(d,"]. ").concat(S));case 16:return e.abrupt("return",g);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"processStack",value:function(e,t,n,r,a,i,s,u,c){for(var l=this,p=[],d=function(){var e,d=t.pop();n.currentContext=d.contexts;var f="";if("Enter"===d.node.op&&mT("isConstant",d.node,r,n)&&(e=o(gT(d.node.name,n),1),f=e[0]),null==r[d.node.name]){var h,m=nA(d.node,r,n,l._resourceManager);f||(h=o(gT(d.node.name,n),1),f=h[0]);var v=n.currentContext;Hi.isPromise(m)?p.push(m.then((function(e){return r[f]=e,l.keepIntermediateTensors&&(l.clonedTensorsMap[f]=l.cloneTensorList(e)),n.currentContext=v,l.checkTensorForDisposal(f,d.node,r,n,i,s,u),l.processChildNodes(d.node,t,n,r,a,c),e}))):(r[f]=m,l.keepIntermediateTensors&&(l.clonedTensorsMap[f]=l.cloneTensorList(m)),l.checkTensorForDisposal(f,d.node,r,n,i,s,u),l.processChildNodes(d.node,t,n,r,a,c))}else l.processChildNodes(d.node,t,n,r,a,c)};t.length>0;)d();return p}},{key:"processChildNodes",value:function(e,t,n,r,a,i){e.children.forEach((function(e){var s=o(gT(e.name,n),1)[0];a[s]||!i.has(e.name)||("Merge"===e.op?e.inputNames.some((function(e){return!!vT(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!vT(e,r,n)}))&&(a[s]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],a=o(bT(n),1)[0],i=t.graph.nodes[a];if(i.attrParams.shape&&i.attrParams.shape.value){var s=i.attrParams.shape.value,u=s.length===r.shape.length&&r.shape.every((function(e,t){return-1===s[t]||s[t]===e}));Hi.assert(u,(function(){return"The shape of dict['".concat(i.name,"'] provided in model.execute(dict) must be [").concat(s,"], but was [").concat(r.shape,"]")}))}i.attrParams.dtype&&i.attrParams.dtype.value&&Hi.assert(r.dtype===i.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(i.name,"'] provided in model.execute(dict) must be ").concat(i.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t,n,r={};for(var a in e){var i=null===(n=null===(t=this._signature)||void 0===t?void 0:t.inputs)||void 0===n?void 0:n[a];null!=i?r[i.name]=e[a]:r[a]=e[a]}return r}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=o(bT(e),1)[0];return null==t.graph.nodes[n]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){var n,r,a=null===(r=null===(n=t._signature)||void 0===n?void 0:n.outputs)||void 0===r?void 0:r[e];return null!=a?a.name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=o(bT(e),1)[0];if(!t.graph.nodes[n])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}]),e}(),dA=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}return v(e,[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}]),e}(),fA="?tfjs-format=file",hA="model.json",mA=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bm;h(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",this.io=r,null==n&&(this.loadOptions={}),this.resourceManager=new dA}return v(e,[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"modelStructuredOutputKeys",get:function(){return this.structuredOutputKeys}},{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for URL '").concat([e],"'"));this.handler=t[0]}}},{key:"load",value:function(){var e=this;if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Hi.isPromise(t)?t.then((function(t){return e.loadSync(t)})):this.loadSync(t)}},{key:"loadSync",value:function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){var r=this.artifacts.userDefinedMetadata;null!=r.signature&&(n=r.signature),null!=r.structuredOutputKeys&&(this.structuredOutputKeys=r.structuredOutputKeys)}this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var a=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new pA(oE.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(a),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var i=oE.Instance.transformGraph(e.modelInitializer);this.initializer=new pA(i),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0}},{key:"save",value:function(){var e=y(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=this.io.getSaveHandlers(t)).length){e.next=4;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Error("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.abrupt("return",t.save(this.artifacts));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addStructuredOutputNames",value:function(e){var t=this;if(this.structuredOutputKeys){var n={};return(e instanceof To?[e]:e).forEach((function(e,r){return n[t.structuredOutputKeys[r]]=e})),n}return e}},{key:"predict",value:function(e,t){var n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)}},{key:"predictAsync",value:function(){var e=y(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.executeAsync(t,this.outputNodes);case 2:return r=e.sent,e.abrupt("return",this.addStructuredOutputNames(r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"normalizeInputs",value:function(e){var t,n=this;if(!(e instanceof To)&&!Array.isArray(e)){var r=null===(t=this.signature)||void 0===t?void 0:t.inputs;if(null!=r)for(var a in r){var i=r[a];null!=i.resourceId&&(e[a]=this.resourceIdToCapturedInput[i.resourceId])}return e}e=Array.isArray(e)?e:[e];var o=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+o!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-o," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var s=0;return this.inputNodes.reduce((function(t,r){var a,i,o,u=null===(o=null===(i=null===(a=n.signature)||void 0===a?void 0:a.inputs)||void 0===i?void 0:i[r])||void 0===o?void 0:o.resourceId;return t[r]=null!=u?n.resourceIdToCapturedInput[u]:e[s++],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"executeInitializerGraph",value:function(){return null==this.initializer?[]:null==this.initializerSignature?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))}},{key:"executeInitializerGraphAsync",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null==this.initializer?[]:null==this.initializerSignature?this.initializer.executeAsync({},[]):this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs)));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setResourceIdToCapturedInput",value:function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,n=Object.keys(t),r=0;r<n.length;r++){var a=t[n[r]];this.resourceIdToCapturedInput[a.resourceId]=e[r]}}},{key:"execute",value:function(e,t){null==this.resourceIdToCapturedInput&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:function(){var e=y(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null==this.resourceIdToCapturedInput,!e.t0){e.next=7;break}return e.t1=this,e.next=5,this.executeInitializerGraphAsync();case 5:e.t2=e.sent,e.t1.setResourceIdToCapturedInput.call(e.t1,e.t2);case 7:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=11,this.executor.executeAsync(t,n);case 11:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getIntermediateTensors",value:function(){return this.executor.getIntermediateTensors()}},{key:"disposeIntermediateTensors",value:function(){this.executor.disposeIntermediateTensors()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Pu(this.resourceIdToCapturedInput)),this.resourceManager.dispose()}}]),e}();function vA(e){return gA.apply(this,arguments)}function gA(){return gA=y(f().mark((function e(t){var n,r,a,i=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:{},r=i.length>2&&void 0!==i[2]?i[2]:bm,null!=t){e.next=4;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 4:return null==n&&(n={}),n.fromTFHub&&"string"==typeof t&&(t=bA(t)),a=new mA(t,n,r),e.next=8,a.load();case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)}))),gA.apply(this,arguments)}function yA(e){if(null==e)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var t;if(e instanceof Array){var n=o(e,2),r=n[0],a=n[1];if(!r)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");var i=bm.getWeightSpecs(r.weightsManifest),s=bm.getModelArtifactsForJSONSync(r,i,a);t=bm.fromMemorySync(s)}else if("load"in e)t=e;else{if(!("modelTopology"in e&&"weightSpecs"in e&&"weightData"in e))throw new Error("Unknown model format");t=bm.fromMemorySync(e)}var u=new mA(t);return u.load(),u}function bA(e){return e.endsWith("/")||(e+="/"),"".concat(e).concat(hA).concat(fA)}var xA="4.2.0",kA={};He(kA,{CSVDataset:function(){return vR},Dataset:function(){return rR},FileDataSource:function(){return RR},TextLineDataset:function(){return cR},URLDataSource:function(){return FR},array:function(){return iR},csv:function(){return DR},func:function(){return MR},generator:function(){return OR},microphone:function(){return zR},version_data:function(){return WR},webcam:function(){return PR},zip:function(){return oR}});var wA=qe(at()),SA=qe(at());function IA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"==typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(AA(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=IA(e[o],t,n,r);i[o]=s}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function _A(e){return NA(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:CA)}function NA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(AA(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=e.map((function(e){return e[r]})),o=NA(a,t,n);i[r]=o};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function CA(e){return null===e?null:AA(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function TA(e,t){return EA.apply(this,arguments)}function EA(){return EA=y(f().mark((function e(t,n){var r,a,i,o,s,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Map,IA(t,n,r),a=0,i=Array.from(r.keys());case 3:if(!(a<i.length)){e.next=14;break}if(o=i[a],s=r.get(o),!Hi.isPromise(s)){e.next=11;break}return e.next=9,s;case 9:u=e.sent,r.set(o,u);case 11:a++,e.next=3;break;case 14:return e.abrupt("return",IA(t,n,r));case 15:case"end":return e.stop()}}),e)}))),EA.apply(this,arguments)}function AA(e){var t=!1;hn().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof it().StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"==typeof e&&!(e instanceof To)&&!(e instanceof Promise)&&!t)}function RA(e){return function(e,t){return IA(e,t)}(e,FA)}function FA(e){return e instanceof To?{value:e.clone(),recurse:!1}:AA(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var DA=function(){function e(t){if(h(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return v(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=De(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),MA=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.call(this,n.INITIAL_CAPACITY)}return v(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){Se(we(n.prototype),"isFull",this).call(this)&&this.expand(),Se(we(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){Se(we(n.prototype),"isFull",this).call(this)&&this.expand(),Se(we(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(DA);function OA(e){return new UA(e)}function PA(e){return new VA(e)}function LA(e,t){return new $A(e,t)}function zA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BA.FAIL;return new eR(e,t)}MA.INITIAL_CAPACITY=32;var BA,WA=function(){function e(){h(this,e)}return v(e,[{key:"toArray",value:function(){var e=y(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent;case 9:e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=y(f().mark((function e(){var t,n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent;case 10:e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent;case 7:e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=y(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value);case 9:e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new YA(this,e)}},{key:"filter",value:function(e){return new KA(this,e)}},{key:"map",value:function(e){return new XA(this,e)}},{key:"mapAsync",value:function(e){return new QA(this,e)}},{key:"serialMapAsync",value:function(e){return new QA(this,e).serial()}},{key:"flatmap",value:function(e){return new JA(this,e)}},{key:"forEachAsync",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){return new qA(this,e,!(arguments.length>1&&void 0!==arguments[1])||arguments[1])}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:CA;return this.rowMajorBatch(e,t).map((function(e){return _A(e,n)}))}},{key:"concatenate",value:function(e,t){return new $A(OA([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new HA(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new GA(this,e)}},{key:"prefetch",value:function(e){return new tR(this,e)}},{key:"shuffle",value:function(e,t){return new nR(this,e,t)}},{key:"serial",value:function(){return new jA(this)}}]),e}(),UA=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).items=e,r.trav=0,r}return v(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],e.abrupt("return",(this.trav++,{value:RA(t),done:!1}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),VA=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).nextFn=e,r}return v(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 7:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),jA=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),GA=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:Pu(t.value);case 7:e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),HA=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),qA=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return h(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=y(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=10;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=7;break}return e.abrupt("return",this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0});case 7:t.push(n.value);case 8:e.next=1;break;case 10:return e.abrupt("return",{value:t,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),KA=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=5;break}return e.abrupt("return",t);case 5:Pu(t.value);case 6:e.next=0;break;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),XA=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=Po.getTensorsInContainer(t.value),r=this.transform(t.value),a=Po.getTensorsInContainer(r),i=De(n);try{for(i.s();!(o=i.n()).done;)s=o.value,Po.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),YA=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.upstream.next();case 3:return e.abrupt("return",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),this.handler(e.t0)){e.next=10;break}return e.abrupt("return",{value:null,done:!0});case 10:e.next=0;break;case 12:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),QA=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=Po.getTensorsInContainer(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=Po.getTensorsInContainer(r),i=De(n);try{for(i.s();!(o=i.n()).done;)s=o.value,Po.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),ZA=function(e){Ae(n,e);var t=Re(n);function n(){var e;return h(this,n),(e=t.call(this)).outputQueue=new MA,e.lastRead=Promise.resolve({value:null,done:!1}),e}return v(n,[{key:"next",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),JA=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=Po.getTensorsInContainer(t.value),r=this.transform(t.value),a=Po.getTensorsInContainer(r),this.outputQueue.pushAll(r),i=De(n);try{for(i.s();!(o=i.n()).done;)s=o.value,Po.isTensorInList(s,a)||s.dispose()}catch(u){i.e(u)}finally{i.f()}return e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ZA),$A=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return v(n,[{key:"summary",value:function(){return"TODO: fill in upstream of chained summaries -> Chained"}},{key:"next",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.readFromChain(this.lastRead),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=y(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=9;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 9:return e.next=11,this.iterator.next();case 11:return r=e.sent,e.abrupt("return",r.done?(this.iterator=null,this.readFromChain(t)):r);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(WA);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(BA||(BA={}));var eR=function(e){Ae(n,e);var t=Re(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BA.FAIL;return h(this,n),(r=t.call(this)).iterators=e,r.mismatchMode=a,r.count=0,r.currentPromise=null,r}return v(n,[{key:"summary",value:function(){return"{TODO: fill in upstream of zip summaries} -> Zip"}},{key:"nextState",value:function(){var e=y(f().mark((function e(t){var n,r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){return e instanceof WA?{value:e.next().then((function(e){return n++,e.done&&r++,e.value})),recurse:!1}:{value:null,recurse:!0}},e.next=3,t;case 3:return n=0,r=0,e.next=6,TA(this.iterators,a);case 6:if(i=e.sent,n!==r){e.next=9;break}return e.abrupt("return",{value:null,done:!0});case 9:if(!(r>0)){e.next=15;break}e.t0=this.mismatchMode,e.next=e.t0===BA.FAIL?13:e.t0===BA.SHORTEST?14:(e.t0,BA.LONGEST,15);break;case 13:throw new Error("Zipped streams should have the same length. Mismatched at element ".concat(this.count,"."));case 14:return e.abrupt("return",{value:null,done:!0});case 15:return e.abrupt("return",(this.count++,{value:i,done:!1}));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.currentPromise=this.nextState(this.currentPromise),this.currentPromise));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),tR=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new DA(r),a}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(WA),nR=function(e){Ae(n,e);var t=Re(n);function n(e,r,a){var i;return h(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=SA.alea(a||Hi.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return v(n,[{key:"next",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.lastRead=this.lastRead.then((function(){return t.serialNext()})),this.lastRead));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=y(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=13;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=11;break;case 10:return e.abrupt("return",(this.refill(),n));case 11:e.next=1;break;case 13:return e.abrupt("return",{value:null,done:!0});case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(tR),rR=function(){function e(){h(this,e),this.size=null}return v(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return Hi.assert(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),aR(y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,sR));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,aR(y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,aR(y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return Ou((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return aR(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return Ou((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return aR(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return aR(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,aR(y(f().mark((function t(){var r;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=PA(y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.t1=!1,e.abrupt("return",{value:e.t0,done:e.t1});case 5:case"end":return e.stop()}}),e)})))),t.abrupt("return",LA(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,aR(y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=wA.alea(t||Hi.now().toString());return aR(y(f().mark((function t(){var i;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,aR(y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function aR(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){Ae(a,n);var r=Re(a);function a(){var e;return h(this,a),(e=r.apply(this,arguments)).size=t,e}return v(a,[{key:"iterator",value:function(){var t=y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(rR))}function iR(e){return aR(y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",OA(e));case 1:case"end":return t.stop()}}),t)}))),e.length)}function oR(e){if(!AA(e))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(e))for(var n=0;n<e.length;n++)t=null==t?e[n].size:Math.min(t,e[n].size);else if(e instanceof Object)for(var r in e)t=null==t?e[r].size:Math.min(t,e[r].size);return aR(y(f().mark((function t(){var n;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,TA(e,(function(e){if(e instanceof rR)return{value:e.iterator(),recurse:!1};if(AA(e))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")}));case 2:return n=t.sent,t.abrupt("return",zA(n,BA.SHORTEST));case 4:case"end":return t.stop()}}),t)}))),t)}function sR(e){return null===e?null:function(e){return null==e||function(e){return null===e||"object"!=typeof e&&"function"!=typeof e}(e)||Array.isArray(e)||"object"==typeof e&&e instanceof To||Hi.isTypedArray(e)}(e[0])?{value:uR(e),recurse:!1}:{value:null,recurse:!0}}function uR(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof To?uf(e):ds(e)}rR.MAX_BUFFER_SIZE=1e4;var cR=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).input=e,r}return v(n,[{key:"iterator",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.input.iterator();case 2:return e.abrupt("return",e.sent.decodeUTF8().split("\n").map((function(e){return e.endsWith("\r")&&(e=e.slice(0,-1)),e})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(rR),lR='"',pR=Symbol("out"),dR=Symbol("field"),fR=Symbol("quote"),hR=Symbol("quoteafterquote"),mR=Symbol("quoteinquote"),vR=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).input=e,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new cR(e),r||(r={}),a.hasHeader=!1!==r.hasHeader,a.fullColumnNames=r.columnNames,a.columnConfigs=r.columnConfigs,a.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(Hi.assert(null==r.delimiter,(function(){return"Delimiter should not be provided when delimWhitespace is true."})),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=r.delimiter?r.delimiter:",",a}return v(n,[{key:"columnNames",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.abrupt("return",this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setColumnNames",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i,o,s=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.maybeReadHeaderLine();case 2:if(t=e.sent,this.fullColumnNames||t){e.next=5;break}throw new Error("Column names must be provided if there is no header line.");case 5:if(this.fullColumnNames&&t&&Hi.assert(t.length===this.fullColumnNames.length,(function(){return"The length of provided columnNames ("+s.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."})),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce((function(e,t){return e[t]=e[t]+1||1,e}),{}),r=Object.keys(n).filter((function(e){return n[e]>1})),Hi.assert(0===r.length,(function(){return"Duplicate column names found: "+r.toString()})),!this.columnConfigs){e.next=16;break}a=0,i=Object.keys(this.columnConfigs);case 9:if(!(a<i.length)){e.next=16;break}if(o=i[a],-1!==this.fullColumnNames.indexOf(o)){e.next=13;break}throw new Error('The key "'+o+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").");case 13:a++,e.next=9;break;case 16:this.columnNamesValidated=!0;case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"maybeReadHeaderLine",value:function(){var e=y(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasHeader){e.next=12;break}return e.next=3,this.base.iterator();case 3:return e.next=5,e.sent.next();case 5:if(!(t=e.sent).done){e.next=8;break}throw new Error("No data was found for CSV parsing.");case 8:return n=t.value,e.abrupt("return",this.parseRow(n,!1));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"iterator",value:function(){var e=y(f().mark((function e(){var t,n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.columnNamesValidated,e.t0){e.next=4;break}return e.next=4,this.setColumnNames();case 4:return e.next=6,this.base.iterator();case 6:return t=e.sent,e.abrupt("return",(this.hasHeader&&(t=t.skip(1)),t.map((function(e){return n.makeDataElement(e)}))));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"makeDataElement",value:function(e){for(var t=this.parseRow(e),n={},r={},a=0;a<this.fullColumnNames.length;a++){var i=this.fullColumnNames[a],o=this.columnConfigs?this.columnConfigs[i]:null;if(!this.configuredColumnsOnly||o){var s=t[a],u=null;if(""===s)if(o&&void 0!==o.default)u=o.default;else{if(o&&(o.required||o.isLabel))throw new Error("Required column ".concat(i," is empty in this line: ").concat(e));u=void 0}else{var c=Number(s);if(isNaN(c))u=o&&"bool"===o.dtype?this.getBoolean(s):s;else if(o&&o.dtype)switch(o.dtype){case"float32":default:u=c;break;case"int32":u=Math.floor(c);break;case"bool":u=this.getBoolean(s)}else u=c}o&&o.isLabel?r[i]=u:n[i]=u}}return 0===Object.keys(r).length?n:{xs:n,ys:r}}},{key:"getBoolean",value:function(e){return"1"===e||"true"===e.toLowerCase()?1:0}},{key:"parseRow",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],r=0,a=e.length,i=pR,o=0;o<a;o++)switch(i){case pR:switch(e.charAt(o)){case lR:r=o+1,i=fR;break;case this.delimiter:if(r=o+1," "===this.delimiter&&this.delimWhitespace)break;n.push(""),i=pR;break;default:i=dR,r=o}break;case dR:if(e.charAt(o)===this.delimiter)n.push(e.substring(r,o)),i=pR,r=o+1;break;case fR:if(e.charAt(o)===lR)i=hR;break;case hR:switch(e.charAt(o)){case this.delimiter:n.push(e.substring(r,o-1)),i=pR,r=o+1;break;case lR:i=fR;break;default:i=mR}break;case mR:if(e.charAt(o)===lR)i=fR}if(i===hR?n.push(e.substring(r,a-1)):n.push(e.substring(r)),t&&n.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(n));return n}}]),n}(rR),gR=function(e){Ae(n,e);var t=Re(n);function n(e){var r;h(this,n),(r=t.call(this)).microphoneConfig=e,r.isClosed=!1,r.fftSize=e.fftSize||1024;var a=Math.log2(r.fftSize);if(r.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between 2 to 4 and 2 to 14, but got ".concat(r.fftSize));if(r.numFrames=e.numFramesPerSpectrogram||43,r.sampleRateHz=e.sampleRateHz,r.columnTruncateLength=e.columnTruncateLength||r.fftSize,r.audioTrackConstraints=e.audioTrackConstraints,r.smoothingTimeConstant=e.smoothingTimeConstant||0,r.includeSpectrogram=!1!==e.includeSpectrogram,r.includeWaveform=!0===e.includeWaveform,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}return v(n,[{key:"summary",value:function(){return"microphone"}},{key:"start",value:function(){var e=y(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:null==this.audioTrackConstraints||this.audioTrackConstraints,video:!1});case 3:this.stream=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new Error("Error thrown while initializing video stream: ".concat(e.t0.message));case 9:if(this.stream){e.next=11;break}throw new Error("Could not obtain audio from microphone.");case 11:if(t=window.AudioContext||window.webkitAudioContext,this.audioContext=new t,this.sampleRateHz){e.next=16;break}this.sampleRateHz=this.audioContext.sampleRate,e.next=18;break;case 16:if(this.audioContext.sampleRate===this.sampleRateHz){e.next=18;break}throw new Error("Mismatch in sampling rate: Expected: ".concat(this.sampleRateHz,"; Actual: ").concat(this.audioContext.sampleRate));case 18:n=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2*this.fftSize,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,n.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize);case 20:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.next=4,this.getAudioData();case 4:return r=e.sent,this.includeSpectrogram&&(a=this.flattenQueue(r.freqDataQueue),t=this.getTensorFromAudioDataArray(a,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(i=this.flattenQueue(r.timeDataQueue),n=this.getTensorFromAudioDataArray(i,[this.numFrames*this.fftSize,1])),e.abrupt("return",{value:{spectrogram:t,waveform:n},done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"capture",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAudioData",value:function(){var e=y(f().mark((function e(){var t,n,r,a=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],n=[],r=0,e.abrupt("return",new Promise((function(e){var i=setInterval((function(){a.includeSpectrogram&&(a.analyser.getFloatFrequencyData(a.freqData),a.freqData[0]===-1/0&&e({freqDataQueue:t,timeDataQueue:n}),t.push(a.freqData.slice(0,a.columnTruncateLength))),a.includeWaveform&&(a.analyser.getFloatTimeDomainData(a.timeData),n.push(a.timeData.slice())),++r===a.numFrames&&(clearInterval(i),e({freqDataQueue:t,timeDataQueue:n}))}),a.fftSize/a.sampleRateHz*1e3)})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),null!=this.stream&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())}},{key:"toArray",value:function(){throw new Error("Can not convert infinite audio stream to array.")}},{key:"getSampleRate",value:function(){return this.sampleRateHz}},{key:"flattenQueue",value:function(e){var t=e[0].length,n=new Float32Array(e.length*t);return e.forEach((function(e,r){return n.set(e,r*t)})),n}},{key:"getTensorFromAudioDataArray",value:function(e,t){var n=new Float32Array(Hi.sizeFromShape(t));return n.set(e,n.length-e.length),ds(n,t)}}],[{key:"create",value:function(){var e=y(f().mark((function e(){var t,r,a=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},hn().get("IS_BROWSER")){e.next=3;break}throw new Error("microphone API is only supported in browser environment.");case 3:return r=new n(t),e.next=6,r.start();case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),n}(WA),yR=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;if(h(this,n),(a=t.call(this)).webcamVideoElement=e,a.webcamConfig=r,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=df([0],"int32"),a.webcamConfig.centerCrop){var i=1*a.webcamConfig.resizeWidth/a.webcamVideoElement.width,o=1*a.webcamConfig.resizeHeight/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=ff([u,s,l,c],[1,4])}else a.cropBox=ff([0,0,1,1],[1,4]);return Ee(a)}return v(n,[{key:"summary",value:function(){return"webcam"}},{key:"start",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.webcamConfig.facingMode&&Hi.assert("user"===this.webcamConfig.facingMode||"environment"===this.webcamConfig.facingMode,(function(){return"Invalid webcam facing mode: ".concat(t.webcamConfig.facingMode,". Please provide 'user' or 'environment'")})),e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}});case 4:this.stream=e.sent,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(1),e.t0.message="Error thrown while initializing video stream: ".concat(e.t0.message),e.t0;case 10:if(this.stream){e.next=12;break}throw new Error("Could not obtain video from webcam.");case 12:try{this.webcamVideoElement.srcObject=this.stream}catch(C4){console.log(C4),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return e.abrupt("return",(this.webcamVideoElement.play(),this.isClosed=!1,new Promise((function(e){t.webcamVideoElement.onloadedmetadata=function(){e()}}))));case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"next",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isClosed){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:e.prev=2,t=Ym.fromPixels(this.webcamVideoElement),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(e.t0)));case 9:if(!this.resize){e.next=22;break}return e.prev=10,e.abrupt("return",{value:this.cropAndResizeFrame(t),done:!1});case 14:throw e.prev=14,e.t1=e.catch(10),new Error("Error thrown cropping the video: ".concat(e.t1.message));case 17:return e.prev=17,t.dispose(),e.finish(17);case 20:e.next=23;break;case 22:return e.abrupt("return",{value:t,done:!1});case 23:case"end":return e.stop()}}),e,this,[[2,6],[10,14,17,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"needToResize",value:function(){return!(!this.webcamConfig.resizeWidth||!this.webcamConfig.resizeHeight||this.webcamVideoElement.width===this.webcamConfig.resizeWidth&&this.webcamVideoElement.height===this.webcamConfig.resizeHeight)}},{key:"cropAndResizeFrame",value:function(e){var t=this;return Ou((function(){var n,r=Gl(Iu(e,"float32"),0),a=(n=tm.cropAndResize(r,t.cropBox,t.cropBoxInd,t.cropSize,"bilinear")).shape;return Nc(n,a.slice(1))}))}},{key:"capture",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:return e.abrupt("return",e.sent.value);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.stream.getTracks().forEach((function(e){return e.stop()}));try{this.webcamVideoElement.srcObject=null}catch(C4){console.log(C4),this.webcamVideoElement.src=null}this.isClosed=!0}},{key:"toArray",value:function(){throw new Error("Can not convert infinite video stream to array.")}}],[{key:"create",value:function(){var e=y(f().mark((function e(t){var r,a,i=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},hn().get("IS_BROWSER")){e.next=3;break}throw new Error("tf.data.webcam is only supported in browser environment.");case 3:if(t){e.next=7;break}if(t=document.createElement("video"),r.resizeWidth&&r.resizeHeight){e.next=6;break}throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");case 6:t.width=r.resizeWidth,t.height=r.resizeHeight;case 7:return a=new n(t,r),e.next=10,a.start();case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(WA),bR=v((function e(){h(this,e)})),xR=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"split",value:function(e){return new kR(this,e)}}]),n}(WA),kR=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).upstream=e,a.impl=new wR(e,r),a}return v(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(xR),wR=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).upstream=e,a.separator=r,a.carryover="",a}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")}},{key:"pump",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",""!==this.carryover&&(this.outputQueue.push(this.carryover),this.carryover="",!0));case 5:(n=t.value.split(this.separator))[0]=this.carryover+n[0],r=De(n.slice(0,-1));try{for(r.s();!(a=r.n()).done;)i=a.value,this.outputQueue.push(i)}catch(o){r.e(o)}finally{r.f()}return e.abrupt("return",(this.carryover=n[n.length-1],!0));case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ZA),SR=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"decodeUTF8",value:function(){return new IR(this)}}]),n}(WA),IR=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).upstream=e,r.impl=new _R(e),r}return v(n,[{key:"summary",value:function(){return this.impl.summary()}},{key:"next",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.impl.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(xR),_R=function(e){Ae(n,e);var t=Re(n);function n(e){var r;if(h(this,n),(r=t.call(this)).upstream=e,hn().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var a=it().StringDecoder;r.decoder=new a("utf8")}return Ee(r)}return v(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Utf8")}},{key:"pump",value:function(){var e=y(f().mark((function e(){var t,n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:return n=t.value,e.abrupt("return",(r=hn().get("IS_BROWSER")?this.decoder.decode(n,{stream:!0}):this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(r),!0));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(ZA),NR=function(e){Ae(n,e);var t=Re(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,n),(r=t.call(this)).file=e,r.options=a,Hi.assert(e instanceof Uint8Array||!!hn().get("IS_BROWSER")&&(e instanceof File||e instanceof Blob),(function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."})),r.offset=a.offset||0,r.chunkSize=a.chunkSize||1048576,r}return v(n,[{key:"summary",value:function(){return"FileChunks ".concat(this.file)}},{key:"next",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size))){e.next=4;break}e.t0={value:null,done:!0},e.next=9;break;case 4:return e.next=6,new Promise((function(e,n){var r=t.offset+t.chunkSize;if(t.file instanceof Uint8Array)e(new Uint8Array(t.file.slice(t.offset,r)));else{var a=new FileReader;a.onload=function(t){var r=a.result;if(r instanceof ArrayBuffer&&(r=new Uint8Array(r)),!(r instanceof Uint8Array))return n(new TypeError("FileReader returned unknown type."));e(r)},a.onabort=function(e){return n(new Error("Aborted"))},a.onerror=function(e){return n(new Error(e.type))};var i=t.file.slice(t.offset,r);a.readAsArrayBuffer(i)}t.offset=r}));case 6:e.t1=e.sent,e.t2=!1,e.t0={value:e.t1,done:e.t2};case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(SR);function CR(e){return TR.apply(this,arguments)}function TR(){return TR=y(f().mark((function e(t){var n,r,a,i,o,s,u=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:{},r=u.length>2?u[2]:void 0,"string"==typeof t?a=t:(a=t.url,i=ER(t)),e.next=5,(r||Hi.fetch)(a,i);case 5:if(!(o=e.sent).ok){e.next=15;break}return e.t0=Uint8Array,e.next=10,o.arrayBuffer();case 10:return e.t1=e.sent,s=new e.t0(e.t1),e.abrupt("return",new NR(s,n));case 15:throw new Error(o.statusText);case 16:case"end":return e.stop()}}),e)}))),TR.apply(this,arguments)}var ER=function(e){return{method:e.method,headers:e.headers,body:e.body,mode:e.mode,credentials:e.credentials,cache:e.cache,redirect:e.redirect,referrer:e.referrer,integrity:e.integrity}};function AR(e){return"string"==typeof e&&"file://"===e.slice(0,7)}var RR=function(e){Ae(n,e);var t=Re(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,n),(r=t.call(this)).input=e,r.options=a,r}return v(n,[{key:"iterator",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return AR(this.input)&&hn().get("IS_NODE")&&(t=ot(),this.input=t.readFileSync(this.input.slice(7))),e.abrupt("return",new NR(this.input,this.options));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(bR),FR=function(e){Ae(n,e);var t=Re(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h(this,n),(r=t.call(this)).url=e,r.fileOptions=a,r}return v(n,[{key:"iterator",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",AR(this.url)?new RR(this.url,this.fileOptions).iterator():CR(this.url,this.fileOptions));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(bR);function DR(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new vR(new FR(e),t)}function MR(e){var t=PA(e);return aR(y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)}))))}function OR(e){return aR(y(f().mark((function t(){var n;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return n=t.sent,t.abrupt("return",PA((function(){return n.next()})));case 4:case"end":return t.stop()}}),t)}))))}function PR(e,t){return LR.apply(this,arguments)}function LR(){return LR=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",yR.create(t,n));case 1:case"end":return e.stop()}}),e)}))),LR.apply(this,arguments)}function zR(e){return BR.apply(this,arguments)}function BR(){return BR=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gR.create(t));case 1:case"end":return e.stop()}}),e)}))),BR.apply(this,arguments)}var WR="4.2.0";function UR(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Hi.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var VR=Lg.whereImpl,jR=function(e){Ae(n,e);var t=Re(n);function n(){var e;return h(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new ht(Ie(e),Fu()),e}return v(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,hn().get("IS_NODE")&&Rv.warn("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Hi.isString(n[0])){var a=n.map((function(e){return Hi.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;if("complex64"===n){var a=this.readSync(r.real.dataId),i=this.readSync(r.imag.dataId);return Rv.mergeRealAndImagArrays(a,i)}return Hi.convertBackendValuesAndArrayBuffer(this.data.get(e).values,n)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Hi.decodeString(e)}));return Su(e.shape,e.dtype,n)}catch(x){throw new Error("Failed to decode encoded string bytes into utf-8")}return Su(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return Fu().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e).complexTensorInfos;null!=n&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=y(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Hi.now(),e.abrupt("return",(t(),{kernelMs:Hi.now()-n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){UR([e],"where");var t=this.readSync(e.dataId);return VR(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return Se(we(n.prototype),"epsilon",this).call(this)}}]),n}(mt);jR.nextDataId=0;var GR={};function HR(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}He(GR,{addImpl:function(){return oF},bincountImpl:function(){return lF},bincountReduceImpl:function(){return pF},castImpl:function(){return tF},ceilImpl:function(){return mF},concatImpl:function(){return yF},equalImpl:function(){return bF},expImpl:function(){return wF},expm1Impl:function(){return _F},floorImpl:function(){return TF},gatherNdImpl:function(){return RF},gatherV2Impl:function(){return FF},greaterEqualImpl:function(){return PF},greaterImpl:function(){return DF},lessEqualImpl:function(){return VF},lessImpl:function(){return BF},linSpaceImpl:function(){return HF},logImpl:function(){return qF},maxImpl:function(){return YF},maximumImpl:function(){return QF},minimumImpl:function(){return $F},multiplyImpl:function(){return nD},negImpl:function(){return oD},notEqualImpl:function(){return uD},prodImpl:function(){return hD},raggedGatherImpl:function(){return bD},raggedRangeImpl:function(){return kD},raggedTensorToTensorImpl:function(){return ND},rangeImpl:function(){return CD},rsqrtImpl:function(){return TD},scatterImpl:function(){return RD},sigmoidImpl:function(){return FD},simpleAbsImpl:function(){return HR},sliceImpl:function(){return OD},sparseFillEmptyRowsImpl:function(){return zD},sparseReshapeImpl:function(){return BD},sparseSegmentReductionImpl:function(){return WD},sqrtImpl:function(){return UD},squaredDifferenceImpl:function(){return GD},stridedSliceImpl:function(){return KD},stringNGramsImpl:function(){return YD},stringSplitImpl:function(){return ZD},stringToHashBucketFastImpl:function(){return JD},subImpl:function(){return $D},tileImpl:function(){return rM},topKImpl:function(){return oM},transposeImpl:function(){return pD},uniqueImpl:function(){return sM}});var qR={kernelName:bn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;UR(t,"abs");var r=new Float32Array(Hi.sizeFromShape(t.shape));return r=HR(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}};function KR(e){return function(t,n,r,a,i){var o=Rv.assertAndGetBroadcastShape(t,n),s=o.length,u=Hi.computeStrides(o),c=Hi.sizeFromShape(o),l=Hi.getTypedArrayFromDType(i,c),p=t.length,d=n.length,f=Hi.computeStrides(t),h=Hi.computeStrides(n),m=Rv.getBroadcastDims(t,o),v=Rv.getBroadcastDims(n,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=e(r[g%r.length],a[g%a.length]);else for(var y=function(){var t=Hi.indexToLoc(b,s,u),n=t.slice(-p);m.forEach((function(e){return n[e]=0}));var i=Hi.locToIndex(n,p,f),o=t.slice(-d);v.forEach((function(e){return o[e]=0}));var c=Hi.locToIndex(o,d,h);l[b]=e(r[i],a[c])},b=0;b<l.length;++b)y();return[l,o]}}function XR(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var YR={kernelName:Hn,backendName:"cpu",kernelFunc:XR};function QR(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n)return XR({inputs:{real:QR(e,t,"float32"),imag:QR(e,t,"float32")},backend:e});var r=Hi.makeZerosTypedArray(Hi.sizeFromShape(t),n);return e.makeTensorInfo(t,n,r)}function ZR(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var JR={kernelName:Dr,backendName:"cpu",kernelFunc:ZR};function $R(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var eF={kernelName:Aa,backendName:"cpu",kernelFunc:$R};function tF(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=Hi.toTypedArray([0],n),i=KR((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),s=o(i,2),u=s[0];return[s[1],"bool",u]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function nF(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return ZR({inputs:{x:a},backend:n});var s=QR(n,a.shape,a.dtype),u=nF({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),c=XR({inputs:{real:u,imag:s},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}if("complex64"===a.dtype){var l=$R({inputs:{input:a},backend:n}),p=nF({inputs:{x:l},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(l),p}if(!Hi.hasEncodingLoss(a.dtype,i)){var d=ZR({inputs:{x:a},backend:n});return{dataId:d.dataId,shape:d.shape,dtype:i}}var f=o(tF(n.data.get(a.dataId).values,a.shape,a.dtype,i),3),h=f[0],m=f[1],v=f[2];return n.makeTensorInfo(h,m,v)}var rF={kernelName:Vn,backendName:"cpu",kernelFunc:nF};function aF(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,s=a.a,u=a.b,c=i;UR([s,u],e);var l=c.data.get(s.dataId).values,p=c.data.get(u.dataId).values,d="string"===s.dtype?Rv.fromUint8ToStringArray(l):l,f="string"===s.dtype?Rv.fromUint8ToStringArray(p):p,h=r||s.dtype,m=o(t(s.shape,u.shape,d,f,h),2),v=m[0],g=m[1];return c.makeTensorInfo(g,h,v)}:function(e){var a=e.inputs,i=e.backend,s=a.a,u=a.b,c=i;if("complex64"===s.dtype||"complex64"===u.dtype){var l=nF({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),p=c.data.get(l.dataId),d=p.complexTensorInfos.real,f=p.complexTensorInfos.imag,h=c.data.get(d.dataId).values,m=c.data.get(f.dataId).values,v=nF({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),g=c.data.get(v.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,x=c.data.get(y.dataId).values,k=c.data.get(b.dataId).values,w=o(n(s.shape,u.shape,h,m,x,k),3),S=w[0],I=w[1],_=w[2],N=c.makeTensorInfo(_,"float32",S),C=c.makeTensorInfo(_,"float32",I),T=XR({inputs:{real:N,imag:C},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(N),c.disposeIntermediateTensorInfo(C),T}var E=c.data.get(s.dataId).values,A=c.data.get(u.dataId).values,R=r||s.dtype,F=o(t(s.shape,u.shape,E,A,R),2),D=F[0],M=F[1];return c.makeTensorInfo(M,R,D)}}function iF(e){return function(t,n,r,a,i,o){var s=Rv.assertAndGetBroadcastShape(t,n),u=Hi.sizeFromShape(s),c=s.length,l=Hi.computeStrides(s),p=Hi.getTypedArrayFromDType("float32",u),d=Hi.getTypedArrayFromDType("float32",u),f=Rv.getBroadcastDims(t,s),h=Rv.getBroadcastDims(n,s),m=Rv.mergeRealAndImagArrays(r,a),v=Rv.mergeRealAndImagArrays(i,o),g=t.length,y=Hi.computeStrides(t),b=n.length,x=Hi.computeStrides(n);if(f.length+h.length===0)for(var k=0;k<p.length;k++){var w=k%m.length,S=k%v.length,I=e(m[2*w],m[2*w+1],v[2*S],v[2*S+1]);p[k]=I.real,d[k]=I.imag}else for(var _=function(){var t=Hi.indexToLoc(N,c,l),n=t.slice(-g);f.forEach((function(e){return n[e]=0}));var r=Hi.locToIndex(n,g,y),a=t.slice(-b);h.forEach((function(e){return a[e]=0}));var i=Hi.locToIndex(a,b,x),o=e(m[2*r],m[2*r+1],v[2*i],v[2*i+1]);p[N]=o.real,d[N]=o.imag},N=0;N<p.length;N++)_();return[p,d,s]}}var oF=KR((function(e,t){return e+t})),sF=iF((function(e,t,n,r){return{real:e+n,imag:t+r}})),uF=aF(wn,oF,sF),cF={kernelName:wn,backendName:"cpu",kernelFunc:uF};function lF(e,t,n,r,a){for(var i=Hi.sizeFromShape(r),o=Hi.makeZerosTypedArray(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function pF(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=Su([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}function dF(e){return function(t,n,r){for(var a=Hi.getTypedArrayFromDType(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}function fF(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(UR(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,l=Hi.sizeFromShape(s.shape),p=n||s.dtype,d=Hi.getArrayFromDType(p,l),f=0;f<l;++f)d[f]=t(c[f],i);return u.makeTensorInfo(s.shape,p,d)}}function hF(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(UR(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,p=t(c,l,i);return u.makeTensorInfo(s.shape,l,p)}}var mF=dF((function(e){return Math.ceil(e)})),vF=hF(jn,mF),gF={kernelName:jn,backendName:"cpu",kernelFunc:vF};function yF(e,t,n,r){var a=Hi.getArrayFromDType(n,Hi.sizeFromShape(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=Hi.sizeFromShape(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?Rv.fromUint8ToStringArray(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}var bF=KR((function(e,t){return e===t?1:0})),xF=aF(br,bF,null,"bool"),kF={kernelName:br,backendName:"cpu",kernelFunc:xF},wF=dF((function(e){return Math.exp(e)})),SF=hF(xr,wF,"float32"),IF={kernelName:xr,backendName:"cpu",kernelFunc:SF},_F=dF((function(e){return Math.expm1(e)})),NF=hF(wr,_F),CF={kernelName:wr,backendName:"cpu",kernelFunc:NF},TF=dF((function(e){return Math.floor(e)})),EF=hF(Nr,TF),AF={kernelName:Nr,backendName:"cpu",kernelFunc:EF};function RF(e,t,n,r,a,i,o,s,u){for(var c=Su([r,i],n),l=0;l<r;l++){for(var p=[],d=0,f=0;f<a;f++){var h=e[l*a+f];d+=h*o[f],p.push(h)}if(d<0||d>=u/i)throw new Error("Invalid indices: ".concat(p," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=t.get.apply(t,Fe(t.indexToLoc(d*i+m)))}return c}function FF(e,t,n){for(var r=Su(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}var DF=KR((function(e,t){return e>t?1:0})),MF=aF(Rr,DF,null,"bool"),OF={kernelName:Rr,backendName:"cpu",kernelFunc:MF},PF=KR((function(e,t){return e>=t?1:0})),LF=aF(Fr,PF,null,"bool"),zF={kernelName:Fr,backendName:"cpu",kernelFunc:LF},BF=KR((function(e,t){return e<t?1:0})),WF=aF(Wr,BF,null,"bool"),UF={kernelName:Wr,backendName:"cpu",kernelFunc:WF},VF=KR((function(e,t){return e<=t?1:0})),jF=aF(Ur,VF,null,"bool"),GF={kernelName:Ur,backendName:"cpu",kernelFunc:jF};function HF(e,t,n){var r=(t-e)/(n-1),a=Hi.makeZerosTypedArray(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var qF=dF((function(e){return Math.log(e)})),KF=hF(jr,qF),XF={kernelName:jr,backendName:"cpu",kernelFunc:KF};function YF(e,t,n,r){for(var a=Hi.getTypedArrayFromDType(r,Hi.sizeFromShape(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var QF=KR((function(e,t){return Math.max(e,t)})),ZF=aF(ea,QF),JF={kernelName:ea,backendName:"cpu",kernelFunc:ZF},$F=KR((function(e,t){return Math.min(e,t)})),eD=aF(ua,$F),tD={kernelName:ua,backendName:"cpu",kernelFunc:eD},nD=KR((function(e,t){return e*t})),rD=iF((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),aD=aF(da,nD,rD),iD={kernelName:da,backendName:"cpu",kernelFunc:aD};function oD(e,t,n){var r=Hi.createScalarValue(-1,n);return nD([],t,r,e,n)}var sD={kernelName:fa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;UR(r,"neg");var a=o(oD(n.data.get(r.dataId).values,r.shape,r.dtype),2),i=a[0],s=a[1];return n.makeTensorInfo(s,r.dtype,i)}},uD=KR((function(e,t){return e!==t?1:0})),cD=aF(ha,uD,null,"bool"),lD={kernelName:ha,backendName:"cpu",kernelFunc:cD};function pD(e,t,n,r,a){for(var i=t.length,o=Hi.sizeFromShape(t),s=Hi.computeStrides(t),u=Hi.computeStrides(a),c=Hi.getTypedArrayFromDType(n,Hi.sizeFromShape(a)),l=0;l<o;++l){for(var p=Hi.indexToLoc(l,i,s),d=new Array(p.length),f=0;f<d.length;f++)d[f]=p[r[f]];c[Hi.locToIndex(d,i,u)]=e[l]}return c}function dD(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;UR(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=pD(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var fD={kernelName:xi,backendName:"cpu",kernelFunc:dD};function hD(e,t,n,r){for(var a=o(Rv.computeOutAndReduceShapes(e,r),2),i=a[0],s=a[1],u=zo(t,"int32"),c=Hi.makeZerosTypedArray(Hi.sizeFromShape(i),u),l=Hi.sizeFromShape(s),p=0;p<c.length;++p){for(var d=p*l,f=1,h=0;h<l;++h)f*=n[d+h];c[p]=f}return{outVals:c,outShape:i,outDtype:u}}var mD={kernelName:_a,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;UR(a,"prod");var s=a.shape.length,u=Hi.parseAxisParam(i,a.shape),c=Rv.getAxesPermutation(u,s),l=u,p=a,d=[];null!=c&&(p=dD({inputs:{x:a},backend:n,attrs:{perm:c}}),d.push(p),l=Rv.getInnerMostAxes(l.length,s));var f=n.data.get(p.dataId).values,h=hD(p.shape,p.dtype,f,l),m=h.outVals,v=h.outShape,g=h.outDtype,y=v;return o&&(y=Rv.expandShapeToKeepDim(v,u)),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(y,g,m)}};function vD(e,t,n,r){var a=[],i=0,o=t.length-1+n.length,s=new Array(o).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,c=0;c<t.length-1;++c){u*=t[c];for(var l=t[c+1],p=1;p<u+1;++p)s[c].push(p*l)}for(var d=0;d<e.length;++d){for(var f=e[d],h=e[d]+1,m=0;m<n.length;++m){var v=n[m],g=m+t.length-1;if(g>=0)for(var y=s[g],b=y[y.length-1]-v[f],x=f;x<h;++x)s[g].push(v[x+1]+b);f=v[f],h=v[h]}h!==f&&(a.push([f,h]),i+=h-f)}return{outSplits:s,valueSlices:a,numValues:i}}function gD(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}function yD(e,t,n,r,a){var i=t.slice();i[0]=a;var o=Hi.getArrayFromDType(n,Hi.sizeFromShape(i)),s=e.length;return function(e,t,n,r,a,i){var o,s=gD(t,2)[1],u=gD(i,2)[1],c=0,l=De(n);try{for(l.s();!(o=l.n()).done;)for(var p=o.value,d=p[0];d<p[1];++d){for(var f=0;f<r;++f)a[c*u+f]=e[d*s+f];++c}}catch(h){l.e(h)}finally{l.f()}}(e,t,r,0===s?0:s/t[0],o,i),[o,i]}function bD(e,t,n,r,a,i,o,s){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var a=Hi.indexToLoc(r,t.length,Hi.computeStrides(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(i,o,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var u=vD(i,o,e,r[0]),c=u.outSplits,l=u.valueSlices,p=u.numValues,d=function(e){for(var t=[],n=function(){var n=e[r].length,a=Hi.getArrayFromDType("int32",n);t.push(a),e[r].forEach((function(e,t){return a[t]=e}))},r=0;r<e.length;++r)n();return t}(c),f=yD(n,r,a,l,p);return[d,f[0],f[1]]}var xD=2147483647;function kD(e,t,n,r,a,i,o){if(t.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=0===t.length,u=0===a.length,c=0===o.length,l=[];s||l.push(t[0]),u||l.push(a[0]),c||l.push(o[0]);for(var p=1;p<l.length;++p)if(l[p]!==l[p-1])throw new Error("starts, limits, and deltas must have the same shape");var d=0===l.length?1:l[0],f=Hi.getArrayFromDType("int32",d+1);f[0]=0;for(var h=0;h<d;++h){var m=s?e[0]:e[h],v=u?r[0]:r[h],g=c?i[0]:i[h];if(0===g)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if((y=Math.ceil(Math.abs((v-m)/g)))>xD)throw new Error("Requires ((limit - start) / delta) <= ".concat(xD));f[h+1]=f[h]+y}for(var b=f[d],x=Hi.getArrayFromDType(n,b),k=0,w=0;w<d;++w)for(var S=f[w+1]-f[w],I=s?e[0]:e[w],_=c?i[0]:i[w],N=0;N<S;++N)x[k++]=I,I+=_;return[f,x]}var wD=Rv.RowPartitionType,SD=function(){function e(t,n,r,a,i,o,s,u,c,l){h(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=Rv.getRowPartitionTypesHelper(l),this.raggedRank=Rv.getRaggedRank(this.rowPartitionTypes)}return v(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===wD.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===wD.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case wD.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case wD.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(wD[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return _D(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape,n=this.defaultValueShape;Rv.validateDefaultValueShape(n,t);var r=this.tensorShapeFromTensor(this.shape,this.shapeShape),a=Rv.combineRaggedTensorToTensorShapes(this.raggedRank,r,t);a[0]<0&&(a[0]=e);for(var i=1;i<=this.raggedRank;++i)a[i]<0&&(a[i]=this.getMaxWidth(i));return a}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],i=0,o=0;o<r;++o,i+=t)a.push(i);for(var s=r;s<e;++s)a.push(-1);return Hi.assert(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),c=t[o];-1===c&&(u=0);for(var l=0;l<u;++l)i.push(c),c+=n;for(var p=0;p<s-u;++p)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case wD.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case wD.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(wD[i]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case wD.FIRST_DIM_SIZE:return e[0];case wD.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case wD.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(wD[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=_D(t,!1),i=Hi.getArrayFromDType(this.valuesDType,Hi.sizeFromShape(a));if(n[0]*t[0]>0){for(var o=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s)o=this.calculateOutputIndex(s-1,o,n[s],t[s]);this.setOutput(this.raggedRank,o,i,a)}return[a,i]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,i=n,o=r.slice();o=o.slice(e+1);var s=Hi.sizeFromShape(o),u=t.length,c=this.defaultValue;if(c.length!==s&&1!==c.length){var l=this.defaultValueShape;Ou((function(){var e=Nc(c,l);c=jc(e,o).dataSync()}))}for(var p=0,d=0,f=0,h=0;h<=u;++h){var m=h<u?t[h]:-1;if(m!==f){if(d<f){var v=a.subarray(p*s);ID(i.subarray(d*s),v,(f-d)*s)}if(h>=u){var g=n.length;m=Math.floor(g/s)}if(m>f)if(1===this.defaultValue.length)i.subarray(f*s,m*s).fill(this.defaultValue[0]),f=m;else for(;m>f;){ID(i.slice(f*s),c,s),++f}m<0?(p=h+1,d=f):(p=h,f=(d=f)+1)}else++f}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function ID(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function _D(e,t){var n,r=[],a=De(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch(o){a.e(o)}finally{a.f()}return r}function ND(e,t,n,r,a,i,o,s,u,c){return new SD(e,t,n,r,a,i,o,s,u,c).compute()}function CD(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return Hi.makeZerosTypedArray(0,r);var a=Math.abs(Math.ceil((t-e)/n)),i=Hi.makeZerosTypedArray(a,r);t<e&&1===n&&(n=-1),i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return i}var TD=dF((function(e){return 1/Math.sqrt(e)})),ED=hF(Ua,TD),AD={kernelName:Ua,backendName:"cpu",kernelFunc:ED};function RD(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],p=e.values,d=t.values;if(0===r)return Su(n,t.dtype);var f=Su(l,t.dtype);"string"==typeof u||"number"==typeof u?f.values.fill(u):"boolean"==typeof u&&f.values.fill(+u);for(var h=0;h<i;h++){for(var m=[],v=0,g=0;g<o;g++){var y=p[h*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?f.values[v*a+b]+=d[h*a+b]:f.values[v*a+b]=0===t.rank?d[0]:d[h*a+b]}return f}var FD=dF((function(e){return 1/(1+Math.exp(-e))})),DD=fF(Qa,(function(e){return 1/(1+Math.exp(-e))})),MD={kernelName:Qa,backendName:"cpu",kernelFunc:DD};function OD(e,t,n,r,a){var i=iv.isSliceContinous(r,t,n),o=Hi.sizeFromShape(n),s=Hi.computeStrides(r);if(i){var u=iv.computeFlatOffset(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=Su(r,a,"string"===a?Rv.fromUint8ToStringArray(e):e),l=Su(n,a),p=0;p<l.size;++p){var d=l.indexToLoc(p),f=d.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,Fe(f))].concat(Fe(d)))}return"string"===a?Rv.fromStringArrayToUint8(l.values):l.values}function PD(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,s=r.size;UR(a,"slice");var u=o(iv.parseSliceParams(a,i,s),2),c=u[0],l=u[1];iv.assertParamsValid(a,c,l);var p=OD(n.data.get(a.dataId).values,c,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,p)}var LD={kernelName:qa,backendName:"cpu",kernelFunc:PD};function zD(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),p=t[1];if(0===u){if(0!==s)throw new Error(Rv.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));return[Hi.getArrayFromDType(n,0),[0,p],Hi.getArrayFromDType(a,0),c,l]}for(var d=!0,f=0,h=new Array(u).fill(0),m=0;m<s;++m){var v=e[m*p];if(v<0)throw new Error(Rv.getSparseFillEmptyRowsNegativeIndexErrorMessage(m,v));if(v>=u)throw new Error(Rv.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(m,v,u));++h[v],d=d&&v>=f,f=v}for(var g=!0,y=0;y<u;++y){var b=0===h[y];c[y]=b,g=g&&!b,h[y]=Math.max(h[y],1),y>0&&(h[y]+=h[y-1])}if(g&&d){for(var x=e,k=r,w=0;w<s;++w)l[w]=w;return[x,[s,p],k,c,l]}for(var S=h[u-1],I=Hi.getArrayFromDType(n,S*p),_=Hi.getArrayFromDType(a,S),N=new Array(u).fill(0),C=0;C<s;++C){var T=e[C*p],E=N[T],A=(0===T?0:h[T-1])+E;N[T]++;for(var R=0;R<p;++R)I[A*p+R]=e[C*p+R];_[A]=r[C],l[C]=A}for(var F=0;F<u;++F)if(0===N[F]){var D=0===F?0:h[F-1];I[D*p+0]=F;for(var M=1;M<p;++M)I[D*p+M]=0;_[D]=o}return[I,[S,p],_,c,l]}function BD(e,t,n,r,a){for(var i=Hi.sizeFromShape(r),o=t[0],s=a.length,u=[],c=1,l=-1,p=0;p<s;++p){var d=a[p];if(-1===d){if(-1!==l)throw new Error(Rv.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,p));l=p,u.push(1)}else{if(d<0)throw new Error(Rv.getSparseReshapeNegativeOutputDimErrorMessage(p,d));c*=d,u.push(d)}}if(-1!==l){if(c<=0)throw new Error(Rv.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var f=Math.trunc(i/c);if(c*f!==i)throw new Error(Rv.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[l]=f}if(Hi.sizeFromShape(u)!==i)throw new Error(Rv.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var h=r.length,m=[];if(h>0){m[h-1]=1;for(var v=h-2;v>=0;--v)m[v]=m[v+1]*r[v+1]}var g=[];if(s>0){g[s-1]=1;for(var y=s-2;y>=0;--y)g[y]=g[y+1]*u[y+1]}for(var b=Hi.getArrayFromDType(n,o*s),x=0;x<o;++x){for(var k=0,w=0;w<h;++w)k+=e[x*h+w]*m[w];for(var S=0;S<s;++S)b[x*s+S]=Math.trunc(k/g[S]),k%=g[S]}return[b,[o,s],u]}function WD(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error(Rv.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var p=t.slice();p[0]=l;var d=p.reduce((function(e,t){return e*t}),1),f=Hi.getArrayFromDType(n,d);if(0===s)return l>0&&f.fill(o),[f,p];if(l<=0)throw new Error(Rv.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var h=0,m=1,v=0,g=a[h];;){var y=0;if(m<s){if(g===(y=a[m])){++m;continue}if(g>=y)throw new Error(Rv.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(g<0||g>=l)throw new Error(Rv.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(g,l));g>v&&f.fill(o,v*c,g*c);for(var b=h;b<m;++b){var x=r[b];if(x<0||x>=u[0])throw new Error(Rv.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,r[b],u[0]));for(var k=0;k<c;k++)f[g*c+k]+=e[x*c+k]}if(i)for(var w=0;w<c;w++)f[g*c+w]/=m-h;if(h=m,v=g+1,g=y,++m>s)break}return v<l&&f.fill(o,v*c,l*c),[f,p]}var UD=dF((function(e){return Math.sqrt(e)})),VD=fF(Ja,(function(e){return Math.sqrt(e)})),jD={kernelName:Ja,backendName:"cpu",kernelFunc:VD},GD=KR((function(e,t){var n=e-t;return n*n})),HD=aF(ui,GD),qD={kernelName:ui,backendName:"cpu",kernelFunc:HD};function KD(e,t,n,r){for(var a=Su(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat(Fe(o)))}return a}var XD=function(){function e(t,n,r,a,i,o){h(this,e),this.separator=Hi.encodeString(t),this.nGramWidths=n,this.leftPad=Hi.encodeString(r),this.rightPad=Hi.encodeString(a),this.padWidth=i,this.preserveShort=o}return v(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(){var s=o.getPadWidth(i),c=Math.max(0,s-u),l=Math.max(0,s-(a-(u+1))),p=i-(c+l),d=t+(c>0?0:u-s),f=0;f+=c*o.leftPad.length;for(var h=0;h<p;++h)f+=e[d+h].length;f+=l*o.rightPad.length,f+=(c+l+p-1)*o.separator.length,n[r+u]=new Uint8Array(f);for(var m=n[r+u],v=0,g=function(e){return e.forEach((function(e){return m[v++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<p-1;++b)g(e[d+b]),g(o.separator);if(p>0){g(e[d+p-1]);for(var x=0;x<l;++x)g(o.separator),g(o.rightPad)}else{for(var k=0;k<l-1;++k)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s()}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=Hi.getArrayFromDType("int32",a);if(0===r||0===a){for(var l=new Array(r),p=0;p<=u;++p)c[p]=0;return[l,c]}c[0]=0;for(var d=function(){var e=t[f]-t[f-1],r=0;n.nGramWidths.forEach((function(t){r+=n.getNumNGrams(e,t)})),n.preserveShort&&e>0&&0===r&&(r=1),c[f]=c[f-1]+r},f=1;f<=u;++f)d();for(var h=new Array(c[u]),m=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,h,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,h,i,1,s)}},v=0;v<u;++v)m(v);return[h,c]}}]),e}();function YD(e,t,n,r,a,i,o,s){return new XD(n,r,a,i,o,s).compute(e,t)}function QD(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);(!n||0!==o.length)&&r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);(!n||0!==c.length)&&r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}(!n||0!==e.length)&&r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function ZD(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;QD(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var p=Hi.getArrayFromDType("int32",2*i),d=new Array(i),f=[r,o],h=0,m=0;m<r;++m)for(var v=0;v<s[m];++v)p[2*h]=m,p[2*h+1]=v,d[h]=a[h],++h;return[p,d,f]}function JD(e,t){for(var n=Hi.getArrayFromDType("int32",e.length),r=0;r<e.length;++r)n[r]=Hi.fingerPrint64(e[r]).modulo(t).getLowBitsUnsigned();return n}var $D=KR((function(e,t){return e-t})),eM=iF((function(e,t,n,r){return{real:e-n,imag:t-r}})),tM=aF(hi,$D,eM),nM={kernelName:hi,backendName:"cpu",kernelFunc:tM};function rM(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=Su(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}var aM=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function iM(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2);iM(e,t,Math.max(n,Math.floor(t-i*s/a+u)),Math.min(r,Math.floor(t+(a-i)*s/a+u)))}var c=e[t],l=n,p=r;for(Hi.swap(e,n,t),aM(e[r],c)>0&&Hi.swap(e,n,r);l<p;){for(Hi.swap(e,l,p),l++,p--;aM(e[l],c)<0;)l+=1;for(;aM(e[p],c)>0;)p-=1}0===aM(e[n],c)?Hi.swap(e,n,p):(p+=1,Hi.swap(e,p,r)),p<=t&&(n=p+1),t<=p&&(r=p-1)}}function oM(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=Hi.getTypedArrayFromDType(n,o*r),c=Hi.getTypedArrayFromDType("int32",o*r),l=function(){var t=p*s,n=e.subarray(t,t+s),i=new Array(n.length);n.forEach((function(e,t){return i[t]={value:e,index:t}})),r<i.length&&(iM(i,r),i=i.slice(0,r)),a&&i.sort(aM);for(var o=p*r,l=u.subarray(o,o+r),d=c.subarray(o,o+r),f=0;f<r;f++)l[f]=i[f].value,d[f]=i[f].index},p=0;p<o;p++)l();var d=t.slice();return d[d.length-1]=r,[Su(d,n,u),Su(d,"int32",c)]}function sM(e,t,n,r){for(var a=Hi.parseAxisParam(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u={},c=new Int32Array(n[a]),l=new _o(i,r,e),p=[],d=1===i[0]&&1===i[2],f=0;f<n[a];f++){var h=void 0;if(d)h=e[f].toString();else{for(var m=[],v=0;v<i[0];v++)for(var g=0;g<i[2];g++)m.push(l.get(v,f,g));h=m.join(",")}if(void 0!==u[h])c[f]=u[h];else{var y=Object.keys(u).length;u[h]=y,c[f]=y,p.push(f)}}var b=i.slice();b[1]=Object.keys(u).length;var x=new _o(b,r);p.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)x.set(l.get(n,e,r),n,t,r)}));var k=n.slice();return k[a]=b[1],{outputValues:x.values,outputShape:k,indices:c}}Hu("cpu",(function(){return new jR}),1);var uM=fF(vr,(function(e){return e>=0?e:Math.exp(e)-1})),cM={kernelName:vr,backendName:"cpu",kernelFunc:uM};function lM(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;UR([a],"leakyRelu");for(var o=Hi.sizeFromShape(a.shape),s=n.data.get(a.dataId).values,u=Hi.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var pM={kernelName:Br,backendName:"cpu",kernelFunc:lM},dM=KR((function(e,t){return e<0?t*e:e}));function fM(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;UR([r,a],"prelu");var i=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=o(dM(r.shape,a.shape,i,s,"float32"),2),c=u[0],l=u[1];return n.makeTensorInfo(l,"float32",c)}var hM={kernelName:Ia,backendName:"cpu",kernelFunc:fM},mM=fF(Fa,(function(e){return Math.max(0,e)})),vM={kernelName:Fa,backendName:"cpu",kernelFunc:mM},gM=fF(za,(function(e){return Math.min(Math.max(0,e),6)})),yM={kernelName:za,backendName:"cpu",kernelFunc:gM};function bM(e,t,n,r,a){if("linear"===n)return ZR({inputs:{x:t},backend:e});if("relu"===n)return mM({inputs:{x:t},backend:e});if("elu"===n)return uM({inputs:{x:t},backend:e});if("relu6"===n)return gM({inputs:{x:t},backend:e});if("prelu"===n)return fM({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return lM({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return DD({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function xM(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=Hi.sizeFromShape(a.shape),s=Hi.inferFromImplicitShape(i,o),u=Hi.sizeFromShape(s);Hi.assert(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old shape (").concat(a.shape,") has ").concat(o," elements. The new shape and old shape must have the same number of elements.")})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.real,p=c.complexTensorInfos.imag;l.shape=s,p.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var kM={kernelName:Da,backendName:"cpu",kernelFunc:xM};function wM(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,s=r.transposeA,u=r.transposeB;UR([a,i],"matMul");var c=a.shape.length,l=i.shape.length,p=s?a.shape[c-2]:a.shape[c-1],d=u?i.shape[l-1]:i.shape[l-2],f=s?a.shape[c-1]:a.shape[c-2],h=u?i.shape[l-2]:i.shape[l-1],m=a.shape.slice(0,-2),v=i.shape.slice(0,-2),g=Hi.sizeFromShape(m),y=Hi.sizeFromShape(v),b=fl.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([f,h]);Hi.assert(p===d,(function(){return"Error in matMul: inner shapes (".concat(p,") and (").concat(d,") of Tensors with shapes ").concat(a.shape," and ").concat(i.shape," and transposeA=").concat(s," and transposeB=").concat(u," must match.")}));for(var x=u?[y,h,d]:[y,d,h],k=xM({inputs:{x:a},backend:n,attrs:{shape:s?[g,p,f]:[g,f,p]}}),w=xM({inputs:{x:i},backend:n,attrs:{shape:x}}),S=s?k.shape[1]:k.shape[2],I=s?k.shape[2]:k.shape[1],_=u?w.shape[1]:w.shape[2],N=Math.max(g,y),C=n.data.get(k.dataId).values,T=n.data.get(w.dataId).values,E=Hi.computeStrides(k.shape),A=Hi.computeStrides(w.shape),R=o(s?[E[0],1,E[1]]:[E[0],E[1],1],3),F=R[0],D=R[1],M=R[2],O=o(u?[1,A[1],A[0]]:[A[1],1,A[0]],3),P=O[0],L=O[1],z=O[2],B=I*_,W=Su([N,I,_],k.dtype),U=W.values,V=n.blockSize,j=0;j<N;j++)for(var G=j%g,H=j%y,q=0;q<I;q+=V)for(var K=Math.min(q+V,I),X=0;X<_;X+=V)for(var Y=Math.min(X+V,_),Q=0;Q<S;Q+=V)for(var Z=Math.min(Q+V,S),J=q;J<K;J++)for(var $=X;$<Y;$++){for(var ee=0,te=Q;te<Z;te++){ee+=C[G*F+J*D+te*M]*T[te*P+$*L+H*z]}U[j*B+(J*_+$)]+=ee}return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(b,W.dtype,W.values)}var SM={kernelName:Ln,backendName:"cpu",kernelFunc:wM};var IM={kernelName:Ei,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,p=o.transposeA,d=o.transposeB,f=o.activation,h=o.leakyreluAlpha,m=[];t=wM({inputs:{a:s,b:u},attrs:{transposeA:p,transposeB:d},backend:i}),c&&(n=uF({inputs:{a:t,b:c},backend:i}),m.push(t),t=n),f&&(r=bM(i,t,f,l,h),m.push(t),t=r);for(var v=0,g=m;v<g.length;v++){var y=g[v];i.disposeIntermediateTensorInfo(y)}return t}},_M=fF(xn,(function(e){return Math.acos(e)})),NM={kernelName:xn,backendName:"cpu",kernelFunc:_M},CM=fF(kn,(function(e){return Math.acosh(e)})),TM={kernelName:kn,backendName:"cpu",kernelFunc:CM};var EM={kernelName:Sn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;UR(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=Su(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};var AM={kernelName:In,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,s=r.keepDims;UR(a,"all");var u=Hi.parseAxisParam(i,a.shape),c=u,l=Rv.getAxesPermutation(c,a.shape.length),p=a;null!=l&&(p=dD({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Rv.getInnerMostAxes(c.length,a.shape.length)),Rv.assertAxesAreInnerMostDims("all",c,p.shape.length);for(var d=o(Rv.computeOutAndReduceShapes(p.shape,c),2),f=d[0],h=d[1],m=Hi.sizeFromShape(h),v=Hi.makeZerosTypedArray(Hi.sizeFromShape(f),p.dtype),g=n.data.get(p.dataId).values,y=0;y<v.length;++y){for(var b=y*m,x=g[b],k=0;k<m;++k){var w=g[b+k];x=x&&w}v[y]=x}null!=l&&n.disposeIntermediateTensorInfo(p);var S=n.makeTensorInfo(f,p.dtype,v);if(s){var I=xM({inputs:{x:S},backend:n,attrs:{shape:Rv.expandShapeToKeepDim(f,u)}});return n.disposeIntermediateTensorInfo(S),I}return S}};var RM={kernelName:_n,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,s=r.keepDims;UR(a,"any");var u=Hi.parseAxisParam(i,a.shape),c=u,l=Rv.getAxesPermutation(c,a.shape.length),p=a;null!=l&&(p=dD({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Rv.getInnerMostAxes(c.length,a.shape.length)),Rv.assertAxesAreInnerMostDims("any",c,p.shape.length);for(var d=o(Rv.computeOutAndReduceShapes(p.shape,c),2),f=d[0],h=d[1],m=Hi.sizeFromShape(h),v=Hi.makeZerosTypedArray(Hi.sizeFromShape(f),p.dtype),g=n.data.get(p.dataId).values,y=0;y<v.length;++y){for(var b=y*m,x=g[b],k=0;k<m;++k){var w=g[b+k];x=x||w}v[y]=x}null!=l&&n.disposeIntermediateTensorInfo(p);var S=n.makeTensorInfo(f,p.dtype,v);if(s){var I=xM({inputs:{x:S},backend:n,attrs:{shape:Rv.expandShapeToKeepDim(f,u)}});return n.disposeIntermediateTensorInfo(S),I}return S}};var FM={kernelName:Nn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;UR(a,"argMax");var s=Hi.parseAxisParam(i,a.shape),u=Rv.getAxesPermutation(s,a.shape.length),c=a,l=[];null!=u&&(c=dD({inputs:{x:a},backend:n,attrs:{perm:u}}),l.push(c),s=Rv.getInnerMostAxes(s.length,c.shape.length)),s=[s[0]],Rv.assertAxesAreInnerMostDims("argMax",s,c.shape.length);for(var p=o(Rv.computeOutAndReduceShapes(c.shape,s),2),d=p[0],f=p[1],h=Hi.sizeFromShape(d),m=Hi.makeZerosTypedArray(h,"int32"),v=Hi.sizeFromShape(f),g=n.data.get(c.dataId).values,y=0;y<m.length;++y){for(var b=y*v,x=g[b],k=0,w=0;w<v;++w){var S=g[b+w];S>x&&(x=S,k=w)}m[y]=k}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d,"int32",m)}};var DM={kernelName:Cn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;UR(a,"argMin");var s=Hi.parseAxisParam(i,a.shape),u=Rv.getAxesPermutation(s,a.shape.length),c=a,l=[];null!=u&&(c=dD({inputs:{x:a},backend:n,attrs:{perm:u}}),l.push(c),s=Rv.getInnerMostAxes(s.length,c.shape.length)),s=[s[0]],Rv.assertAxesAreInnerMostDims("argMin",s,c.shape.length);for(var p=o(Rv.computeOutAndReduceShapes(c.shape,s),2),d=p[0],f=p[1],h=Hi.sizeFromShape(d),m=Hi.makeZerosTypedArray(h,"int32"),v=Hi.sizeFromShape(f),g=n.data.get(c.dataId).values,y=0;y<m.length;++y){for(var b=y*v,x=g[b],k=0,w=0;w<v;++w){var S=g[b+w];S<x&&(x=S,k=w)}m[y]=k}return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d,"int32",m)}},MM=fF(Tn,(function(e){return Math.asin(e)})),OM={kernelName:Tn,backendName:"cpu",kernelFunc:MM},PM=fF(En,(function(e){return Math.asinh(e)})),LM={kernelName:En,backendName:"cpu",kernelFunc:PM},zM=fF(An,(function(e){return Math.atan(e)})),BM={kernelName:An,backendName:"cpu",kernelFunc:zM},WM=KR((function(e,t){return Math.atan2(e,t)})),UM=aF(Fn,WM),VM={kernelName:Fn,backendName:"cpu",kernelFunc:UM},jM=fF(Rn,(function(e){return Math.atanh(e)})),GM={kernelName:Rn,backendName:"cpu",kernelFunc:jM};function HM(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,p=a.effectiveFilterWidth,d=a.padInfo.top,f=a.padInfo.left,h="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=Su(a.outShape,n),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],x=0;x<a.batchSize;++x)for(var k=x*g,w=x*r[0],S=0;S<a.inChannels;++S)for(var I=0;I<a.outHeight;++I)for(var _=I*o-d,N=Math.max(0,_),C=Math.min(a.inHeight,l+_),T=k+I*y,E=0;E<a.outWidth;++E){for(var A=E*s-f,R=Math.max(0,A),F=Math.min(a.inWidth,p+A),D=h,M=0,O=0,P=N;P<C;P+=u){for(var L=w+P*r[1],z=R;z<F;z+=c){var B=e[L+z*r[2]+S];"max"===i&&B>D?D=B:"avg"===i&&(M+=B,O++)}if(isNaN(D))break}v[T+E*b+S]="avg"===i?M/O:D}return m}function qM(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Su(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,p=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.top,h=r.padInfo.left,m=Su(t,n,e),v=0;v<r.batchSize;++v)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-f,x=b;x<0;)x+=c;for(var k=Math.min(r.inHeight,p+b),w=0;w<r.outWidth;++w){for(var S=w*u-h,I=S;I<0;)I+=l;for(var _=Math.min(r.inWidth,d+S),N=Number.NEGATIVE_INFINITY,C=-1,T=x;T<k;T+=c)for(var E=T-b,A=I;A<_;A+=l){var R=A-S,F=m.get(v,T,A,g);F>N&&(N=F,C=a?i?((v*r.inHeight+T)*r.inWidth+A)*r.inChannels+g:(T*r.inWidth+A)*r.inChannels+g:E*d+R)}o.set(C,v,y,w,g)}}return o}function KM(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,p=a.dilationWidth,d=a.effectiveFilterDepth,f=a.effectiveFilterHeight,h=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=Su(a.outShape,n),x=b.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[3]*a.outShape[4],I=a.outShape[4],_=0;_<a.batchSize;++_)for(var N=_*k,C=_*r[0],T=0;T<a.inChannels;++T)for(var E=0;E<a.outDepth;++E){for(var A=E*o-m,R=A;R<0;)R+=c;for(var F=Math.min(a.inDepth,d+A),D=N+E*w,M=0;M<a.outHeight;++M){for(var O=M*s-v,P=O;P<0;)P+=l;for(var L=Math.min(a.inHeight,f+O),z=D+M*S,B=0;B<a.outWidth;++B){for(var W=B*u-g,U=W;U<0;)U+=p;for(var V=Math.min(a.inWidth,h+W),j=z+B*I,G=y,H=0,q=0,K=R;K<F;K+=c){for(var X=C+K*r[1],Y=P;Y<L;Y+=l){for(var Q=X+Y*r[2],Z=U;Z<V;Z+=p){var J=e[Q+Z*r[3]+T];if("max"===i&&J>G?G=J:"avg"===i&&(H+=J,q++),isNaN(G))break}if(isNaN(G))break}if(isNaN(G))break}x[j+T]="avg"===i?H/Math.max(q,1):G}}}return b}var XM={kernelName:Dn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;UR(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Hi.assert(Rv.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Rv.computePool2DInfo(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Hi.arraysEqual(l.inShape,l.outShape))c=ZR({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,d=Hi.computeStrides(a.shape),f=HM(p,a.shape,a.dtype,d,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,f.values)}return c}};var YM={kernelName:On,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;UR(a,"avgPool3d");var l=Rv.computePool3DInfo(a.shape,i,o,1,s,u,c),p=KM(n.data.get(a.dataId).values,a.shape,a.dtype,Hi.computeStrides(a.shape),l,"avg");return n.makeTensorInfo(p.shape,"float32",p.values)}};var QM={kernelName:Pn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;UR([a,i],"avgPool3DGrad");for(var l=Rv.computePool3DInfo(i.shape,o,s,1,u,c),p=l.strideDepth,d=l.strideHeight,f=l.strideWidth,h=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,x=l.effectiveFilterDepth,k=l.effectiveFilterHeight,w=l.effectiveFilterWidth,S=x-1-l.padInfo.front,I=w-1-l.padInfo.left,_=k-1-l.padInfo.top,N=Su(i.shape,"float32"),C=1/(h*m*v),T=n.bufferSync(a),E=0;E<l.batchSize;++E)for(var A=0;A<l.inChannels;++A)for(var R=0;R<l.inDepth;++R)for(var F=0;F<l.inHeight;++F)for(var D=0;D<l.inWidth;++D){for(var M=R-S,O=F-_,P=D-I,L=0,z=0;z<x;z+=g){var B=(M+z)/p;if(!(B<0||B>=l.outDepth||Math.floor(B)!==B))for(var W=0;W<k;W+=y){var U=(O+W)/d;if(!(U<0||U>=l.outHeight||Math.floor(U)!==U))for(var V=0;V<w;V+=b){var j=(P+V)/f;if(!(j<0||j>=l.outWidth||Math.floor(j)!==j))L+=T.get(E,B,U,j,A)}}}N.set(L*C,E,R,F,D,A)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}};var ZM={kernelName:Mn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;UR([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=Rv.computePool2DInfo(o.shape,s,u,1,c),p=l.strideHeight,d=l.strideWidth,f=l.filterHeight,h=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,x=g-1-l.padInfo.top,k=Su(o.shape,"float32"),w=1/(f*h),S=n.data.get(a.dataId).values,I=Su(a.shape,"float32",S),_=0;_<l.batchSize;++_)for(var N=0;N<l.inChannels;++N)for(var C=0;C<l.inHeight;++C)for(var T=0;T<l.inWidth;++T){for(var E=C-x,A=T-b,R=0,F=0;F<g;F+=m){var D=(E+F)/p;if(!(D<0||D>=l.outHeight||Math.floor(D)!==D))for(var M=0;M<y;M+=v){var O=(A+M)/d;if(!(O<0||O>=l.outWidth||Math.floor(O)!==O))R+=I.get(_,D,O,N)}}k.set(R*w,_,C,T,N)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var JM={kernelName:Tr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;Hi.assert(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Hi.assert(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Hi.assert(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),UR([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,p=n.data.get(s.dataId).values,d=n.data.get(u.dataId).values,f=i?n.data.get(i.dataId).values:new Float32Array([1]),h=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=h.length,g=f.length,y=d.length,b=p.length,x=0,k=0,w=0,S=0,I=0;I<l.length;++I)m[I]=h[x++]+(l[I]-p[k++])*f[w++]/Math.sqrt(d[S++]+c),x>=v&&(x=0),k>=b&&(k=0),w>=g&&(w=0),S>=y&&(S=0);return n.makeTensorInfo(a.shape,a.dtype,m)}};var $M={kernelName:zn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;UR([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=Rv.getReshaped(a.shape,i,s),c=Rv.getPermuted(u.length,i.length),l=Rv.getReshapedPermuted(a.shape,i,s),p=Rv.getSliceBeginCoords(o,i.length),d=Rv.getSliceSize(l,o,i.length),f=xM({inputs:{x:a},backend:n,attrs:{shape:u}}),h=dD({inputs:{x:f},backend:n,attrs:{perm:c}}),m=xM({inputs:{x:h},backend:n,attrs:{shape:l}}),v=PD({inputs:{x:m},backend:n,attrs:{begin:p,size:d}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),v}};var eO={kernelName:Bn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=lF(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};var tO={kernelName:Un,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=Rv.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},nO=fF(Gn,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),rO={kernelName:Gn,backendName:"cpu",kernelFunc:nO},aO={kernelName:qn,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(Hi.sizeFromShape(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],p=u[c];r[c]=Math.hypot(l,p)}return n.makeOutput(r,t.shape,"float32")}};function iO(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var oO={kernelName:Or,backendName:"cpu",kernelFunc:iO};function sO(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=Hi.parseAxisParam(r,t[0].shape)[0],i=t.map((function(e){return e.shape}));Rv.assertParamsConsistent(i,a);var o=Rv.computeOutShape(t.map((function(e){return e.shape})),a);if(0===Hi.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return Hi.sizeFromShape(e.shape)>0}));if(1===s.length)return ZR({inputs:{x:s[0]},backend:n});if("complex64"===s[0].dtype){var u=s.map((function(e){return $R({inputs:{input:e},backend:n})})),c=s.map((function(e){return iO({inputs:{input:e},backend:n})})),l=sO({inputs:u,backend:n,attrs:{axis:a}}),p=sO({inputs:c,backend:n,attrs:{axis:a}}),d=XR({inputs:{real:l,imag:p},backend:n});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),d}var f=s.map((function(e){var t=[-1,Hi.sizeFromShape(e.shape.slice(a))];return xM({inputs:{x:e},backend:n,attrs:{shape:t}})})),h=f.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));o=Rv.computeOutShape(f.map((function(e){return e.shape})),1);var m=1===f[0].shape[0],v=yF(h,o,t[0].dtype,m),g=Rv.computeOutShape(s.map((function(e){return e.shape})),a),y=n.makeTensorInfo(g,t[0].dtype,v);return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}var uO={kernelName:Kn,backendName:"cpu",kernelFunc:sO};function cO(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;UR([a,i],"conv2d");for(var p=Rv.convertConv2DDataFormat(u),d=Rv.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,p),f=d.filterHeight,h=d.filterWidth,m=d.dilationHeight,v=d.dilationWidth,g=d.padInfo.left,y=d.padInfo.top,b="channelsLast"===d.dataFormat,x=new _o(d.outShape,a.dtype),k=Hi.computeStrides(a.shape),w=Hi.computeStrides(i.shape),S=k[0],I=b?k[1]:k[2],_=b?k[2]:1,N=b?1:k[1],C=x.strides[0],T=b?x.strides[1]:x.strides[2],E=b?x.strides[2]:1,A=b?1:x.strides[1],R=n.data.get(a.dataId).values,F=n.data.get(i.dataId).values,D=x.values,M=0;M<d.batchSize;++M)for(var O=M*S,P=M*C,L=0;L<d.outHeight;++L)for(var z=P+L*T,B=L*d.strideHeight-y,W=0;W<f;++W){var U=B+W*m;if(!(U<0||U>=d.inHeight))for(var V=W*w[0],j=O+U*I,G=0;G<d.outWidth;++G)for(var H=z+G*E,q=G*d.strideWidth-g,K=0;K<h;++K){var X=q+K*v;if(!(X<0||X>=d.inWidth))for(var Y=j+X*_,Q=V+K*w[1],Z=0;Z<d.inChannels;++Z){for(var J=R[Y+Z*N],$=0;$<d.outChannels;++$)D[H+$*A]+=J*F[Q+$];Q+=d.outChannels}}}return n.makeTensorInfo(x.shape,x.dtype,D)}var lO={kernelName:Xn,backendName:"cpu",kernelFunc:cO};var pO={kernelName:Yn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;UR([a,i],"conv2dBackpropFilter");for(var p=Rv.convertConv2DDataFormat(u),d=Rv.computeConv2DInfo(a.shape,l,o,1,s,c,!1,p),f=d.strideHeight,h=d.strideWidth,m=d.filterHeight,v=d.filterWidth,g="channelsLast"===d.dataFormat,y=new _o(d.filterShape,"float32"),b=d.padInfo.left,x=d.padInfo.top,k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,S=new _o(a.shape,a.dtype,k),I=new _o(i.shape,i.dtype,w),_=0;_<m;++_)for(var N=Math.max(0,Math.ceil((x-_)/f)),C=Math.min(d.outHeight,(d.inHeight+x-_)/f),T=0;T<v;++T)for(var E=Math.max(0,Math.ceil((b-T)/h)),A=Math.min(d.outWidth,(d.inWidth+b-T)/h),R=0;R<d.inChannels;++R)for(var F=0;F<d.outChannels;++F){for(var D=0,M=0;M<d.batchSize;++M)for(var O=N;O<C;++O)for(var P=_+O*f-x,L=E;L<A;++L){var z=T+L*h-b;D+=g?S.get(M,P,z,R)*I.get(M,O,L,F):S.get(M,R,P,z)*I.get(M,F,O,L)}y.set(D,_,T,R,F)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var dO={kernelName:Qn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,s=r.inputShape,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dimRoundingMode;UR([a,i],"conv2dBackpropInput");var d=Hi.computeStrides(i.shape),f=Hi.computeStrides(a.shape),h=Rv.convertConv2DDataFormat(l),m=Rv.computeConv2DInfo(s,i.shape,u,1,c,p,!1,h),v=new _o(m.inShape,"float32"),g=v.values,y=n.data.get(a.dataId).values,b=n.data.get(i.dataId).values,x=o(d,3),k=x[0],w=x[1],S=x[2],I=m.batchSize,_=m.filterHeight,N=m.filterWidth,C=m.inChannels,T=m.inHeight,E=m.inWidth,A=m.outChannels,R=m.outHeight,F=m.outWidth,D=m.strideHeight,M=m.strideWidth;h=m.dataFormat;for(var O=_-1-m.padInfo.top,P=N-1-m.padInfo.left,L="channelsLast"===h,z=v.strides[0],B=L?v.strides[1]:v.strides[2],W=L?v.strides[2]:1,U=L?1:v.strides[1],V=f[0],j=L?f[1]:f[2],G=L?f[2]:1,H=L?1:f[1],q=0;q<I;++q)for(var K=0;K<C;++K)for(var X=0;X<T;++X)for(var Y=X-O,Q=Math.max(0,Math.ceil(Y/D)),Z=Math.min(R,(_+Y)/D),J=0;J<E;++J){for(var $=J-P,ee=Math.max(0,Math.ceil($/M)),te=Math.min(F,(N+$)/M),ne=0,re=Q;re<Z;++re)for(var ae=re*D-Y,ie=ee;ie<te;++ie)for(var oe=V*q+j*re+G*ie,se=k*(_-1-ae)+w*(N-1-(ie*M-$))+S*K,ue=0;ue<A;++ue){ne+=y[oe+H*ue]*b[se+ue]}g[z*q+B*X+W*J+U*K]=ne}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var fO={kernelName:Zn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;UR([a,i],"conv3d");for(var c=Rv.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,p=c.filterHeight,d=c.filterWidth,f=c.dilationDepth,h=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,b=v.top,x=new _o(c.outShape,a.dtype),k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,S=x.values,I=Hi.computeStrides(a.shape),_=Hi.computeStrides(i.shape),N=0;N<c.batchSize;++N)for(var C=N*I[0],T=N*x.strides[0],E=0;E<c.outDepth;++E)for(var A=T+E*x.strides[1],R=E*c.strideDepth-g,F=0;F<l;++F){var D=R+F*f;if(!(D<0||D>=c.inDepth))for(var M=F*_[0],O=C+D*I[1],P=0;P<c.outHeight;++P)for(var L=A+P*x.strides[2],z=P*c.strideHeight-b,B=0;B<p;++B){var W=z+B*h;if(!(W<0||W>=c.inHeight))for(var U=M+B*_[1],V=O+W*I[2],j=0;j<c.outWidth;++j)for(var G=L+j*c.outChannels,H=j*c.strideWidth-y,q=0;q<d;++q){var K=H+q*m;if(!(K<0||K>=c.inWidth))for(var X=U+q*_[2],Y=V+K*c.inChannels,Q=X,Z=0;Z<c.inChannels;++Z){for(var J=k[Y+Z],$=0;$<c.outChannels;++$)S[G+$]+=J*w[Q+$];Q+=c.outChannels}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var hO={kernelName:Jn,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,s=r.strides,u=r.pad,c=r.filterShape;UR([a,i],"conv3dBackpropFilterV2");for(var l=Hi.computeStrides(a.shape),p=Hi.computeStrides(i.shape),d=Rv.computeConv3DInfo(a.shape,c,s,1,u),f=d.strideDepth,h=d.strideHeight,m=d.strideWidth,v=d.filterDepth,g=d.filterHeight,y=d.filterWidth,b=new _o(d.filterShape,"float32"),x=b.values,k=o(b.strides,4),w=k[0],S=k[1],I=k[2],_=k[3],N=n.data.get(i.dataId).values,C=o(p,4),T=C[0],E=C[1],A=C[2],R=C[3],F=n.data.get(a.dataId).values,D=o(l,4),M=D[0],O=D[1],P=D[2],L=D[3],z=d.padInfo.front,B=d.padInfo.left,W=d.padInfo.top,U=0;U<v;++U)for(var V=Math.max(0,Math.ceil((z-U)/f)),j=Math.min(d.outDepth,(d.inDepth+z-U)/f),G=U*w,H=0;H<g;++H)for(var q=Math.max(0,Math.ceil((W-H)/h)),K=Math.min(d.outHeight,(d.inHeight+W-H)/h),X=H*S+G,Y=0;Y<y;++Y)for(var Q=Math.max(0,Math.ceil((B-Y)/m)),Z=Math.min(d.outWidth,(d.inWidth+B-Y)/m),J=Y*I+X,$=0;$<d.inChannels;++$)for(var ee=$*_+J,te=0;te<d.outChannels;++te){for(var ne=0,re=0;re<d.batchSize;++re)for(var ae=re*M,ie=re*T,oe=V;oe<j;++oe)for(var se=(U+oe*f-z)*O+ae,ue=oe*E+ie,ce=q;ce<K;++ce)for(var le=(H+ce*h-W)*P+se,pe=ce*A+ue,de=Q;de<Z;++de){var fe=de*R+pe;ne+=F[(Y+de*m-B)*L+le+$]*N[fe+te]}x[ee+te]=ne}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var mO={kernelName:$n,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,s=r.pad,u=r.strides,c=r.inputShape;UR([a],"conv3dBackpropInputV2");for(var l=Hi.computeStrides(a.shape),p=Hi.computeStrides(i.shape),d=Rv.computeConv3DInfo(c,i.shape,u,1,s),f=new _o(d.inShape,"float32"),h=f.values,m=o(f.strides,4),v=m[0],g=m[1],y=m[2],b=m[3],x=n.data.get(a.dataId).values,k=o(l,4),w=k[0],S=k[1],I=k[2],_=k[3],N=n.data.get(i.dataId).values,C=o(p,4),T=C[0],E=C[1],A=C[2],R=C[3],F=d.batchSize,D=d.filterDepth,M=d.filterHeight,O=d.filterWidth,P=d.inChannels,L=d.inDepth,z=d.inHeight,B=d.inWidth,W=d.outChannels,U=d.outDepth,V=d.outHeight,j=d.outWidth,G=d.strideDepth,H=d.strideHeight,q=d.strideWidth,K=D-1-d.padInfo.front,X=M-1-d.padInfo.top,Y=O-1-d.padInfo.left,Q=0;Q<F;++Q)for(var Z=0;Z<P;++Z)for(var J=0;J<L;++J)for(var $=J-K,ee=Math.max(0,Math.ceil($/G)),te=Math.min(U,(D+$)/G),ne=0;ne<z;++ne)for(var re=ne-X,ae=Math.max(0,Math.ceil(re/H)),ie=Math.min(V,(M+re)/H),oe=0;oe<B;++oe){for(var se=oe-Y,ue=Math.max(0,Math.ceil(se/q)),ce=Math.min(j,(O+se)/q),le=0,pe=ee;pe<te;++pe)for(var de=pe*G-$,fe=ae;fe<ie;++fe)for(var he=fe*H-re,me=ue;me<ce;++me)for(var ve=w*Q+S*pe+I*fe+_*me,ge=T*(D-1-de)+E*(M-1-he)+A*(O-1-(me*q-se))+R*Z,ye=0;ye<W;++ye){le+=x[ve+ye]*N[ge+ye]}h[v*Q+g*J+y*ne+b*oe+Z]=le}return n.makeTensorInfo(f.shape,f.dtype,f.values)}},vO=fF(er,(function(e){return Math.cos(e)})),gO={kernelName:er,backendName:"cpu",kernelFunc:vO},yO=fF(tr,(function(e){return Math.cosh(e)})),bO={kernelName:tr,backendName:"cpu",kernelFunc:yO};var xO={kernelName:ar,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,s=t.boxInd,u=r.cropSize,c=r.method,l=r.extrapolationValue,p=o(a.shape,4),d=p[0],f=p[1],h=p[2],m=p[3],v=i.shape[0],g=o(u,2),y=g[0],b=g[1],x=Su([v,y,b,m],"float32"),k=n.data.get(i.dataId).values,w=n.data.get(s.dataId).values,S=n.data.get(a.dataId).values,I=Hi.computeStrides(a.shape),_=Hi.computeStrides(x.shape),N=0;N<v;N++){var C=4*N,T=k[C],E=k[C+1],A=k[C+2],R=k[C+3],F=w[N];if(!(F>=d))for(var D=y>1?(A-T)*(f-1)/(y-1):0,M=b>1?(R-E)*(h-1)/(b-1):0,O=0;O<y;O++){var P=y>1?T*(f-1)+O*D:.5*(T+A)*(f-1);if(P<0||P>f-1)for(var L=0;L<b;L++)for(var z=0;z<m;z++){var B=z+L*_[2]+O*_[1]+N*_[0];x.values[B]=l}else if("bilinear"===c)for(var W=Math.floor(P),U=Math.ceil(P),V=P-W,j=0;j<b;j++){var G=b>1?E*(h-1)+j*M:.5*(E+R)*(h-1);if(G<0||G>h-1)for(var H=0;H<m;H++){var q=H+j*_[2]+O*_[1]+N*_[0];x.values[q]=l}else for(var K=Math.floor(G),X=Math.ceil(G),Y=G-K,Q=0;Q<m;Q++){var Z=Q+K*I[2]+W*I[1]+F*I[0],J=S[Z],$=S[Z=Q+X*I[2]+W*I[1]+F*I[0]],ee=S[Z=Q+K*I[2]+U*I[1]+F*I[0]],te=J+($-J)*Y,ne=ee+(S[Z=Q+X*I[2]+U*I[1]+F*I[0]]-ee)*Y;Z=Q+j*_[2]+O*_[1]+N*_[0],x.values[Z]=te+(ne-te)*V}}else for(var re=0;re<b;++re){var ae=b>1?E*(h-1)+re*M:.5*(E+R)*(h-1);if(ae<0||ae>h-1)for(var ie=0;ie<m;ie++){var oe=ie+re*_[2]+O*_[1]+N*_[0];x.values[oe]=l}else for(var se=Math.round(ae),ue=Math.round(P),ce=0;ce<m;ce++){var le=ce+se*I[2]+ue*I[1]+F*I[0],pe=ce+re*_[2]+O*_[1]+N*_[0];x.values[pe]=S[le]}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var kO={kernelName:nr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;UR(a,"cumprod");var u=Rv.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=dD({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=Rv.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=zo(c.dtype,"int32"),d=Hi.makeOnesTypedArray(Hi.sizeFromShape(c.shape),p),f=n.data.get(c.dataId).values,h=c.shape[c.shape.length-1],m=s?function(e,t){return e+h-t-1}:function(e,t){return e+t},v=0;v<f.length;v+=h)for(var g=0;g<h;g++){var y=m(v,g);if(0===g)d[y]=o?1:f[y];else{var b=m(v,g-1);d[y]=o?f[b]*d[b]:f[y]*d[b]}}var x=n.makeTensorInfo(c.shape,p,d);if(null!=u){var k=dD({inputs:{x:x},backend:n,attrs:{perm:Rv.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var wO={kernelName:rr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;UR(a,"cumsum");var u=Rv.getAxesPermutation([i],a.shape.length),c=a;null!=u&&(c=dD({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=Rv.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var p=zo(c.dtype,"int32"),d=Hi.makeZerosTypedArray(Hi.sizeFromShape(c.shape),p),f=n.data.get(c.dataId).values,h=c.shape[c.shape.length-1],m=s?function(e,t){return e+h-t-1}:function(e,t){return e+t},v=0;v<f.length;v+=h)for(var g=0;g<h;g++){var y=m(v,g);if(0===g)d[y]=o?0:f[y];else{var b=m(v,g-1);d[y]=o?f[b]+d[b]:f[y]+d[b]}}var x=n.makeTensorInfo(c.shape,p,d);if(null!=u){var k=dD({inputs:{x:x},backend:n,attrs:{perm:Rv.getUndoAxesPermutation(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var SO={kernelName:ir,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=lF(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=pF(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}};var IO={kernelName:or,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;Hi.assert("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],p=u*i,d=c*i,f=l/(i*i),h=n.data.get(a.dataId).values,m=new Float32Array(s*p*d*f),v=0,g=0;g<s;++g)for(var y=0;y<p;++y)for(var b=Math.floor(y/i),x=y%i,k=0;k<d;++k)for(var w=Math.floor(k/i),S=(x*i+k%i)*f,I=0;I<f;++I){var _=I+S+l*(w+c*(b+u*g));m[v++]=h[_]}return n.makeTensorInfo([s,p,d,f],a.dtype,m)}};function _O(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;UR([a,i],"depthwiseConv2DNative");var l=Hi.computeStrides(a.shape),p=Hi.computeStrides(i.shape),d=u;null==d&&(d=[1,1]),Hi.assert(Rv.eitherStridesOrDilationsAreOne(o,d),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(d,"'")}));for(var f=Rv.computeConv2DInfo(a.shape,i.shape,o,d,s,c,!0),h=f.filterHeight,m=f.filterWidth,v=f.dilationHeight,g=f.dilationWidth,y=f.padInfo,b=y.left,x=y.top,k=f.outChannels/f.inChannels,w=new _o(f.outShape,a.dtype),S=n.data.get(a.dataId).values,I=n.data.get(i.dataId).values,_=w.values,N=0;N<f.batchSize;++N)for(var C=N*l[0],T=N*w.strides[0],E=0;E<f.outHeight;++E)for(var A=T+E*w.strides[1],R=E*f.strideHeight-x,F=0;F<h;++F){var D=R+F*v;if(!(D<0||D>=f.inHeight))for(var M=F*p[0],O=C+D*l[1],P=0;P<f.outWidth;++P)for(var L=A+P*w.strides[2],z=P*f.strideWidth-b,B=0;B<m;++B){var W=z+B*g;if(!(W<0||W>=f.inWidth))for(var U=M+B*p[1],V=O+W*f.inChannels,j=L,G=U,H=0;H<f.inChannels;++H){for(var q=S[V+H],K=0;K<k;++K)_[j+K]+=q*I[G+K];j+=k,G+=k}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var NO={kernelName:sr,backendName:"cpu",kernelFunc:_O};var CO={kernelName:ur,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;UR([a,i],"depthwiseConv2dNativeBackpropFilter");for(var p=Rv.computeConv2DInfo(a.shape,l,o,s,u,c,!0),d=p.strideHeight,f=p.strideWidth,h=p.filterHeight,m=p.filterWidth,v=new _o(p.filterShape,"float32"),g=p.padInfo.left,y=p.padInfo.top,b=p.outChannels/p.inChannels,x=n.data.get(a.dataId).values,k=new _o(a.shape,a.dtype,x),w=n.data.get(i.dataId).values,S=new _o(i.shape,i.dtype,w),I=0;I<h;++I)for(var _=Math.max(0,Math.ceil((y-I)/d)),N=Math.min(p.outHeight,(p.inHeight+y-I)/d),C=0;C<m;++C)for(var T=Math.max(0,Math.ceil((g-C)/f)),E=Math.min(p.outWidth,(p.inWidth+g-C)/f),A=0;A<p.outChannels;++A){for(var R=Math.trunc(A/b),F=A%b,D=0,M=0;M<p.batchSize;++M)for(var O=_;O<N;++O)for(var P=I+O*d-y,L=T;L<E;++L){var z=C+L*f-g;D+=k.get(M,P,z,R)*S.get(M,O,L,A)}v.set(D,I,C,R,F)}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var TO={kernelName:cr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,s=r.strides,u=r.dilations,c=r.pad,l=r.dimRoundingMode,p=r.inputShape;UR([a,i],"depthwiseConv2DNativeBackpropInput");for(var d=Hi.computeStrides(a.shape),f=Hi.computeStrides(i.shape),h=Rv.computeConv2DInfo(p,i.shape,s,u,c,l,!0),m=new _o(h.inShape,"float32"),v=m.values,g=o(m.strides,3),y=g[0],b=g[1],x=g[2],k=n.data.get(a.dataId).values,w=o(d,3),S=w[0],I=w[1],_=w[2],N=n.data.get(i.dataId).values,C=o(f,3),T=C[0],E=C[1],A=C[2],R=h.batchSize,F=h.filterHeight,D=h.filterWidth,M=h.inChannels,O=h.inHeight,P=h.inWidth,L=h.outChannels,z=h.outHeight,B=h.outWidth,W=h.strideHeight,U=h.strideWidth,V=F-1-h.padInfo.top,j=D-1-h.padInfo.left,G=L/M,H=0;H<R;++H)for(var q=0;q<M;++q)for(var K=0;K<O;++K)for(var X=K-V,Y=Math.max(0,Math.ceil(X/W)),Q=Math.min(z,(F+X)/W),Z=0;Z<P;++Z){for(var J=Z-j,$=Math.max(0,Math.ceil(J/U)),ee=Math.min(B,(D+J)/U),te=0,ne=Y;ne<Q;++ne)for(var re=ne*W-X,ae=$;ae<ee;++ae)for(var ie=S*H+I*ne+_*ae,oe=T*(F-1-re)+E*(D-1-(ae*U-J))+A*q,se=0;se<G;++se){te+=k[ie+(q*G+se)]*N[oe+se]}v[y*H+b*K+x*Z+q]=te}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var EO={kernelName:lr,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=Hi.sizeFromShape(r.shape),i=n.data.get(r.dataId).values,o=Su([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat(Fe(r.shape),Fe(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},AO={kernelName:pr,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,p=a.shape.length,d=c.data.get(i.dataId).values,f=i.shape.length,h=Rv.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),m=h.batchSize,v=h.inHeight,g=h.inWidth,y=h.inChannels,b=h.outHeight,x=h.outWidth,k=h.padInfo,w=h.strideHeight,S=h.strideWidth,I=h.filterHeight,_=h.filterWidth,N=h.dilationHeight,C=h.dilationWidth,T=h.outShape,E=Hi.sizeFromShape(T),A=T.length,R=Hi.getArrayFromDType(a.dtype,E),F=0;F<m;++F)for(var D=0;D<b;++D)for(var M=D*w-k.top,O=0;O<x;++O)for(var P=O*S-k.left,L=0;L<y;++L){for(var z=Number.MIN_SAFE_INTEGER,B=0;B<I;++B){var W=M+B*N;if(W>=0&&W<v)for(var U=0;U<_;++U){var V=P+U*C;if(V>=0&&V<g){var j=Hi.locToIndex([F,W,V,L],p,Hi.computeStrides(a.shape)),G=Hi.locToIndex([B,U,L],f,Hi.computeStrides(i.shape)),H=l[j]+d[G];H>z&&(z=H)}}}R[Hi.locToIndex([F,D,O,L],A,Hi.computeStrides(T))]=z}return{dataId:c.write(Hi.toTypedArray(R,a.dtype),T,a.dtype),shape:T,dtype:a.dtype}}},RO={kernelName:fr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=Hi.toNestedArray(a.shape,l.data.get(a.dataId).values),d=Hi.toNestedArray(i.shape,l.data.get(i.dataId).values),f=Rv.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),h=f.batchSize,m=f.inHeight,v=f.inWidth,g=f.inChannels,y=f.outHeight,b=f.outWidth,x=f.padInfo,k=f.strideHeight,w=f.strideWidth,S=f.filterHeight,I=f.filterWidth,_=f.dilationHeight,N=f.dilationWidth,C=f.outShape;Hi.assert(o.rank===C.length,(function(){return"Error in ".concat(fr,", dy must have the same rank as output ").concat(C.length,", but got ").concat(o.rank)}));for(var T=Hi.toNestedArray(C,l.data.get(o.dataId).values),E=Hi.makeZerosNestedTypedArray(i.shape,i.dtype),A=0;A<h;++A)for(var R=0;R<y;++R)for(var F=R*k-x.top,D=0;D<b;++D)for(var M=D*w-x.left,O=0;O<g;++O){for(var P=Number.MIN_SAFE_INTEGER,L=0,z=0,B=0;B<S;++B){var W=F+B*_;if(W>=0&&W<m)for(var U=0;U<I;++U){var V=M+U*N;if(V>=0&&V<v){var j=p[A][W][V][O]+d[B][U][O];j>P&&(P=j,L=B,z=U)}}}E[L][z][O]+=T[A][R][D][O]}return{dataId:l.write(Hi.toTypedArray(E,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},FO={kernelName:dr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,p=Hi.toNestedArray(a.shape,l.data.get(a.dataId).values),d=Hi.toNestedArray(i.shape,l.data.get(i.dataId).values),f=Rv.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),h=f.batchSize,m=f.inHeight,v=f.inWidth,g=f.inChannels,y=f.outHeight,b=f.outWidth,x=f.padInfo,k=f.strideHeight,w=f.strideWidth,S=f.filterHeight,I=f.filterWidth,_=f.dilationHeight,N=f.dilationWidth,C=f.outShape;Hi.assert(o.rank===C.length,(function(){return"Error in ".concat(dr,", dy must have the same rank as output ").concat(C.length,", but got ").concat(o.rank)}));for(var T=Hi.toNestedArray(C,l.data.get(o.dataId).values),E=Hi.makeZerosNestedTypedArray(a.shape,a.dtype),A=0;A<h;++A)for(var R=0;R<y;++R)for(var F=R*k-x.top,D=0;D<b;++D)for(var M=D*w-x.left,O=0;O<g;++O){for(var P=Number.MIN_SAFE_INTEGER,L=F<0?0:F,z=M<0?0:M,B=0;B<S;++B){var W=F+B*_;if(W>=0&&W<m)for(var U=0;U<I;++U){var V=M+U*N;if(V>=0&&V<v){var j=p[A][W][V][O]+d[B][U][O];j>P&&(P=j,L=W,z=V)}}}E[A][L][z][O]+=T[A][R][D][O]}return{dataId:l.write(Hi.toTypedArray(E,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};function DO(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,s=a.axis,u=a.keepDims;UR(i,"sum");var c=(t="bool"===i.dtype?nF({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):ZR({inputs:{x:i},backend:r})).shape.length,l=Hi.parseAxisParam(s,t.shape),p=Rv.getAxesPermutation(l,c),d=l,f=t;null!=p&&(f=dD({inputs:{x:t},backend:r,attrs:{perm:p}}),d=Rv.getInnerMostAxes(d.length,c)),Rv.assertAxesAreInnerMostDims("sum",d,f.shape.length);for(var h=o(Rv.computeOutAndReduceShapes(f.shape,d),2),m=h[0],v=h[1],g=QR(r,m,Rv.upcastType(f.dtype,"int32")),y=Hi.sizeFromShape(v),b=r.data.get(g.dataId).values,x=r.data.get(f.dataId).values,k=0;k<b.length;++k){for(var w=k*y,S=0,I=0;I<y;++I)S+=x[w+I];b[k]=S}if(u){var _=g;g=xM({inputs:{x:g},backend:r,attrs:{shape:Rv.expandShapeToKeepDim(g.shape,l)}}),r.disposeIntermediateTensorInfo(_)}return r.disposeIntermediateTensorInfo(t),null!=p&&r.disposeIntermediateTensorInfo(f),g}var MO={kernelName:$a,backendName:"cpu",kernelFunc:DO};var OO={kernelName:mr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=Rv.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;Rv.checkEinsumDimSizes(o.length,u,a);for(var c=Rv.getEinsumComputePath(s,u),l=c.path,p=c.steps,d=p.length,f=null,h=o.length,m=[],v=0;v<d;++v){var g,y=De(p[v]);try{for(y.s();!(g=y.n()).done;){var b=g.value,x=Rv.getEinsumPermutation(h,u[b]),k=x.permutationIndices,w=x.expandDims,S=void 0;Rv.isIdentityPermutation(k)?S=a[b]:(S=dD({inputs:{x:a[b]},backend:n,attrs:{perm:k}}),m.push(S));for(var I=S.shape.slice(),_=0;_<w.length;++_)I.splice(w[_],0,1);Hi.arraysEqual(S.shape,I)||(S=xM({inputs:{x:S},backend:n,attrs:{shape:I}}),m.push(S)),null===f?f=S:(f=aD({inputs:{a:S,b:f},backend:n}),m.push(f))}}catch(E){y.e(E)}finally{y.f()}v<d-1&&(l[v]>=0&&(f=DO({inputs:{x:f},backend:n,attrs:{axis:l[v]-(o.length-h),keepDims:!1}}),m.push(f)),h--)}for(var N=0,C=m;N<C.length;N++){var T=C[N];T!==f&&n.disposeIntermediateTensorInfo(T)}return f}};var PO={kernelName:gr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;UR([r,a],"eluGrad");for(var i=new Float32Array(Hi.sizeFromShape(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=1?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},LO=Rv.ERF_P,zO=Rv.ERF_A1,BO=Rv.ERF_A2,WO=Rv.ERF_A3,UO=Rv.ERF_A4,VO=Rv.ERF_A5,jO=fF(yr,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+LO*n);return t*(1-((((VO*r+UO)*r+WO)*r+BO)*r+zO)*r*Math.exp(-n*n))})),GO={kernelName:yr,backendName:"cpu",kernelFunc:jO};function HO(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Hi.assert(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),xM({inputs:{x:a},backend:n,attrs:{shape:s}})}var qO={kernelName:kr,backendName:"cpu",kernelFunc:HO},KO=KR((function(e,t){return e/t})),XO=aF(hr,KO),YO={kernelName:hr,backendName:"cpu",kernelFunc:XO};function QO(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=Hi.sizeFromShape(c),p=Hi.getTypedArrayFromDType("float32",l),d=Hi.getTypedArrayFromDType("float32",l),f=0;f<a;f++){for(var h=PD({inputs:{x:s},backend:n,attrs:{begin:[f,0],size:[1,i]}}),m=PD({inputs:{x:u},backend:n,attrs:{begin:[f,0],size:[1,i]}}),v=XR({inputs:{real:h,imag:m},backend:n}),g=ZO(v,t,n),y=g.real,b=g.imag,x=Rv.mergeRealAndImagArrays(y,b),k=0;k<i;k++){var w=Rv.getComplexWithIndex(x,k);p[f*i+k]=w.real,d[f*i+k]=w.imag}n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(v)}var S=n.makeTensorInfo(c,"float32",p),I=n.makeTensorInfo(c,"float32",d),_=XR({inputs:{real:S,imag:I},backend:n});return n.disposeIntermediateTensorInfo(S),n.disposeIntermediateTensorInfo(I),_}function ZO(e,t,n){var r=Hi.sizeFromShape(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(function(e){return 0===(e&e-1)}(r)){var s=JO(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),p=n.makeTensorInfo([],"float32",Hi.createScalarValue(r,"float32")),d=ZR({inputs:{x:p},backend:n}),f=YO.kernelFunc({inputs:{a:c,b:p},backend:n}),h=YO.kernelFunc({inputs:{a:l,b:d},backend:n}),m=n.data.get(f.dataId).values,v=n.data.get(h.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),{real:m,imag:v}}return s}var g=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=Rv.exponent(a*s,t,n),c=Rv.getComplexWithIndex(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),Rv.assignToTypedArray(r,i,o,a)}return r}(Rv.mergeRealAndImagArrays(i,o),r,t);return Rv.splitRealAndImagArrays(g)}function JO(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=Rv.mergeRealAndImagArrays(e,t),o=n/2,s=Rv.complexWithEvenIndex(i),u=s.real,c=s.imag,l=[u.length],p=a.makeTensorInfo(l,"float32",u),d=a.makeTensorInfo(l,"float32",c),f=XR({inputs:{real:p,imag:d},backend:a}),h=Rv.complexWithOddIndex(i),m=h.real,v=h.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),b=a.makeTensorInfo(g,"float32",v),x=XR({inputs:{real:y,imag:b},backend:a}),k=JO(u,c,o,r,a),w=k.real,S=k.imag,I=[w.length],_=a.makeTensorInfo(I,"float32",w),N=a.makeTensorInfo(I,"float32",S),C=XR({inputs:{real:_,imag:N},backend:a}),T=JO(m,v,o,r,a),E=T.real,A=T.imag,R=[E.length],F=a.makeTensorInfo(R,"float32",E),D=a.makeTensorInfo(R,"float32",A),M=XR({inputs:{real:F,imag:D},backend:a}),O=Rv.exponents(n,r),P=[O.real.length],L=a.makeTensorInfo(P,"float32",O.real),z=a.makeTensorInfo(P,"float32",O.imag),B=XR({inputs:{real:L,imag:z},backend:a}),W=aD({inputs:{a:B,b:M},backend:a}),U=uF({inputs:{a:C,b:W},backend:a}),V=tM({inputs:{a:C,b:W},backend:a}),j=$R({inputs:{input:U},backend:a}),G=$R({inputs:{input:V},backend:a}),H=iO({inputs:{input:U},backend:a}),q=iO({inputs:{input:V},backend:a}),K=sO({inputs:[j,G],backend:a,attrs:{axis:0}}),X=sO({inputs:[H,q],backend:a,attrs:{axis:0}}),Y=a.data.get(K.dataId).values,Q=a.data.get(X.dataId).values;return a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(N),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),a.disposeIntermediateTensorInfo(X),{real:Y,imag:Q}}var $O={kernelName:Sr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Hi.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=xM({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=QO(o,!1,n),u=xM({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function eP(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||Hi.inferDtype(a),o=Hi.getArrayFromDType(i,Hi.sizeFromShape(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var tP={kernelName:Ir,backendName:"cpu",kernelFunc:eP};var nP={kernelName:_r,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=Hi.getTypedArrayFromDType(r.dtype,Hi.sizeFromShape(r.shape)),s=o(r.shape,4),u=s[0],c=s[1],l=s[2],p=s[3],d=a.data.get(r.dataId).values,f=0;f<u;f++)for(var h=f*l*c*p,m=0;m<c;m++)for(var v=m*(l*p),g=0;g<l;g++)for(var y=g*p,b=0;b<p;b++){var x=Math.round(l-g-1),k=h+v+y+b,w=d[k];if(x>=0&&x<l)w=d[h+v+x*p+b];i[k]=w}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},rP=KR((function(e,t){return Math.floor(e/t)})),aP=aF(Cr,rP,null,"int32"),iP={kernelName:Cr,backendName:"cpu",kernelFunc:aP};var oP={kernelName:Ai,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,d=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=cO({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:d}});if(o){var v=m;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){var g=xM({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});m=uF({inputs:{a:m,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else m=uF({inputs:{a:m,b:o},backend:n});n.disposeIntermediateTensorInfo(v)}if(f){var y=m;if("NCHW"===l&&"prelu"===f&&1===s.shape.length&&1!==s.shape[0]){var b=xM({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});m=bM(n,m,f,b,h),n.disposeIntermediateTensorInfo(b)}else m=bM(n,m,f,s,h);n.disposeIntermediateTensorInfo(y)}return m}};var sP={kernelName:Ri,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,p=r.dilations,d=r.dimRoundingMode,f=r.activation,h=r.leakyreluAlpha,m=_O({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:p,dimRoundingMode:d}});if(o){var v=m;m=uF({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(v)}if(f){var g=m;m=bM(n,m,f,s,h),n.disposeIntermediateTensorInfo(g)}return m}};var uP={kernelName:Ar,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=Hi.sizeFromShape(r.shape),s=a.shape,u=s[s.length-1],c=o(Rv.prepareAndValidate(r,a),4),l=c[0],p=c[1],d=c[2],f=c[3];if(0===p)return n.makeTensorInfo(l,r.dtype,[]);var h=RF(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,p,u,d,f,r.shape,i);return n.makeTensorInfo(l,r.dtype,h.values)}};var cP={kernelName:Er,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;UR([a,i],"gatherV2");for(var u=Hi.parseAxisParam(o,a.shape)[0],c=n.data.get(i.dataId).values,l=a.shape[u],p=function(){var e=c[d];Hi.assert(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},d=0;d<c.length;++d)p();var f=s;null==s&&(f=0);var h=Hi.sizeFromShape(i.shape),m=Rv.segment_util.collectGatherOpShapeInfo(a,i,u,f),v=xM({inputs:{x:a},backend:n,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=xM({inputs:{x:i},backend:n,attrs:{shape:[m.batchSize,h/m.batchSize]}}),y=[m.batchSize,m.outerSize,h/m.batchSize,m.sliceSize],b=n.bufferSync(g),x=FF(n.bufferSync(v),b,y);return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(m.outputShape,x.dtype,x.values)}};var lP={kernelName:Mr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Hi.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=xM({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=QO(o,!0,n),u=xM({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},pP=fF(Pr,(function(e){return Number.isFinite(e)?1:0}),"bool"),dP={kernelName:Pr,backendName:"cpu",kernelFunc:pP},fP=fF(Lr,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),hP={kernelName:Lr,backendName:"cpu",kernelFunc:fP},mP=fF(zr,(function(e){return Number.isNaN(e)?1:0}),"bool"),vP={kernelName:zr,backendName:"cpu",kernelFunc:mP};var gP={kernelName:Vr,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=HF(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},yP=fF(Gr,(function(e){return Math.log1p(e)})),bP={kernelName:Gr,backendName:"cpu",kernelFunc:yP},xP=KR((function(e,t){return e&&t})),kP=aF(Hr,xP,null,"bool"),wP={kernelName:Hr,backendName:"cpu",kernelFunc:kP},SP=fF(qr,(function(e){return e?0:1}),"bool"),IP={kernelName:qr,backendName:"cpu",kernelFunc:SP},_P=KR((function(e,t){return e||t})),NP=aF(Kr,_P,null,"bool"),CP={kernelName:Kr,backendName:"cpu",kernelFunc:NP};var TP={kernelName:Zr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;UR(a,"LRN");var c=a.shape[3],l=c-1,p=n.data.get(a.dataId).values,d=Hi.sizeFromShape(a.shape),f=new Float32Array(d);function h(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=p[n];a+=o*o}return a}for(var m=0;m<d;m++){var v=h(m),g=p[m]*Math.pow(o+s*v,-u);f[m]=g}return n.makeTensorInfo(a.shape,a.dtype,f)}};var EP={kernelName:Jr,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;UR(o,"LRNGrad");for(var p=Hi.sizeFromShape(o.shape),d=o.shape[3],f=n.data.get(o.dataId).values,h=n.data.get(a.dataId).values,m=n.data.get(i.dataId).values,v=new Float32Array(p),g=p,y=0;y<g;y++){for(var b=y%d,x=y-b+Math.max(0,b-s),k=y-b+Math.min(d,b+s+1),w=0,S=x;S<k;S++)w+=Math.pow(h[S],2);w=c*w+u;for(var I=x;I<k;I++){var _=-2*c*l*h[I]*m[y]/w;y===I&&(_+=Math.pow(w,-l)),_*=f[y],v[I]+=_}}return n.makeTensorInfo(o.shape,a.dtype,v)}};function AP(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,s=r.keepDims,u=n,c=a.shape,l=c.length,p=Hi.parseAxisParam(i,c),d=p,f=Rv.getAxesPermutation(d,l),h=u.data.get(a.dataId).values;if(null!=f){for(var m=new Array(l),v=0;v<m.length;v++)m[v]=c[f[v]];h=pD(h,c,a.dtype,f,m),d=Rv.getInnerMostAxes(d.length,l),c=m}UR(a,"max"),Rv.assertAxesAreInnerMostDims("max",d,l);var g=o(Rv.computeOutAndReduceShapes(c,d),2),y=g[0],b=g[1],x=YF(h,Hi.sizeFromShape(b),y,a.dtype),k=u.write(x,y,a.dtype),w=y;return s&&(w=Rv.expandShapeToKeepDim(y,p)),{dataId:k,shape:w,dtype:a.dtype}}var RP={kernelName:$r,backendName:"cpu",kernelFunc:AP};var FP={kernelName:ta,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;UR(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Hi.assert(Rv.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=Rv.computePool2DInfo(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Hi.arraysEqual(l.inShape,l.outShape))c=ZR({inputs:{x:a},backend:n});else{var p=n.data.get(a.dataId).values,d=Hi.computeStrides(a.shape),f=HM(p,a.shape,a.dtype,d,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,f.values)}return c}};var DP={kernelName:ra,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;UR(a,"maxPool3d");var l=Rv.computePool3DInfo(a.shape,i,o,1,s,u,c),p=KM(n.data.get(a.dataId).values,a.shape,a.dtype,Hi.computeStrides(a.shape),l,"max");return n.makeTensorInfo(p.shape,"float32",p.values)}};var MP={kernelName:aa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;UR([a,i],"maxPool3DGrad");for(var l=Rv.computePool3DInfo(i.shape,o,s,1,u,c),p=function(e,t){for(var n=Su(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,p=t.effectiveFilterWidth,d=t.padInfo.front,f=t.padInfo.top,h=t.padInfo.left,m=0;m<t.batchSize;++m)for(var v=0;v<t.inChannels;++v)for(var g=0;g<t.outDepth;++g){for(var y=g*r-d,b=y;b<0;)b+=o;for(var x=Math.min(t.inDepth,c+y),k=0;k<t.outHeight;++k){for(var w=k*a-f,S=w;S<0;)S+=s;for(var I=Math.min(t.inHeight,l+w),_=0;_<t.outWidth;++_){for(var N=_*i-h,C=N;C<0;)C+=u;for(var T=Math.min(t.inWidth,p+N),E=Number.NEGATIVE_INFINITY,A=-1,R=b;R<x;R+=o)for(var F=R-y,D=S;D<I;D+=s)for(var M=D-w,O=C;O<T;O+=u){var P=O-N,L=e.get(m,R,D,O,v);L>=E&&(E=L,A=F*l*p+M*l+P)}n.set(A,m,g,k,_,v)}}}return n}(n.bufferSync(i),l),d=l.strideDepth,f=l.strideHeight,h=l.strideWidth,m=l.dilationDepth,v=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,k=y-1-l.padInfo.front,w=x-1-l.padInfo.left,S=b-1-l.padInfo.top,I=Su(i.shape,"float32"),_=n.bufferSync(a),N=0;N<l.batchSize;++N)for(var C=0;C<l.inChannels;++C)for(var T=0;T<l.inDepth;++T)for(var E=0;E<l.inHeight;++E)for(var A=0;A<l.inWidth;++A){for(var R=T-k,F=E-S,D=A-w,M=0,O=0;O<y;O+=m){var P=(R+O)/d;if(!(P<0||P>=l.outDepth||Math.floor(P)!==P))for(var L=0;L<b;L+=v){var z=(F+L)/f;if(!(z<0||z>=l.outHeight||Math.floor(z)!==z))for(var B=0;B<x;B+=g){var W=(D+B)/h;if(!(W<0||W>=l.outWidth||Math.floor(W)!==W)){var U=y*b*x-1-p.get(N,P,z,W,C)===O*b*x+L*x+B?1:0;if(0!==U)M+=_.get(N,P,z,W,C)*U}}}}I.set(M,N,T,E,A,C)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}};var OP={kernelName:na,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;UR([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=Rv.computePool2DInfo(o.shape,s,u,1,c,l),d=n.data.get(o.dataId).values,f=Su(p.outShape,o.dtype,qM(d,o.shape,o.dtype,p).values),h=p.strideHeight,m=p.strideWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.effectiveFilterHeight,b=p.effectiveFilterWidth,x=b-1-p.padInfo.left,k=y-1-p.padInfo.top,w=Su(o.shape,"float32"),S=n.data.get(a.dataId).values,I=Su(a.shape,"float32",S),_=0;_<p.batchSize;++_)for(var N=0;N<p.inChannels;++N)for(var C=0;C<p.inHeight;++C)for(var T=0;T<p.inWidth;++T){for(var E=C-k,A=T-x,R=0,F=0;F<y;F+=v){var D=(E+F)/h;if(!(D<0||D>=p.outHeight||Math.floor(D)!==D))for(var M=0;M<b;M+=g){var O=(A+M)/m;if(!(O<0||O>=p.outWidth||Math.floor(O)!==O)){var P=y*b-1-f.get(_,D,O,N)===F*b+M?1:0;if(0!==P)R+=I.get(_,D,O,N)*P}}}w.set(R,_,C,T,N)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var PP={kernelName:ia,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,s=n.strides,u=n.pad,c=n.includeBatchInIndex,l=r;UR(a,"MaxPoolWithArgmax");var p=l.data.get(a.dataId).values,d=Rv.computePool2DInfo(a.shape,i,s,[1,1],u),f=function(e,t,n,r,a){var i=HM(e,0,n,Hi.computeStrides(t),a,"max"),o=qM(e,t,n,a,!0,r);return[i.values,o.values]}(p,a.shape,a.dtype,c,d),h=o(f,2),m=h[0],v=h[1],g=l.write(m,d.outShape,a.dtype),y=l.write(v,d.outShape,a.dtype);return[{dataId:g,shape:d.outShape,dtype:a.dtype},{dataId:y,shape:d.outShape,dtype:"int32"}]}};var LP={kernelName:oa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=Hi.parseAxisParam(i,a.shape),u=Rv.computeOutAndReduceShapes(a.shape,s)[1],c=Hi.sizeFromShape(u),l=[],p=n.makeTensorInfo([],"float32",new Float32Array([c]));l.push(p);var d=nF({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});l.push(d);var f=XO({inputs:{a:d,b:p},backend:n});l.push(f);var h=DO({inputs:{x:f},backend:n,attrs:{axis:i,keepDims:o}});return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),h}};var zP={kernelName:sa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,s=r.keepDims;UR(a,"min");var u=Hi.parseAxisParam(i,a.shape),c=u,l=Rv.getAxesPermutation(c,a.shape.length),p=a;null!=l&&(p=dD({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Rv.getInnerMostAxes(c.length,a.shape.length)),Rv.assertAxesAreInnerMostDims("min",c,p.shape.length);for(var d=o(Rv.computeOutAndReduceShapes(p.shape,c),2),f=d[0],h=d[1],m=Hi.sizeFromShape(h),v=Hi.makeZerosTypedArray(Hi.sizeFromShape(f),p.dtype),g=n.data.get(p.dataId).values,y=0;y<v.length;++y){for(var b=y*m,x=g[b],k=0;k<m;++k){var w=g[b+k];(Number.isNaN(w)||w<x)&&(x=w)}v[y]=x}null!=l&&n.disposeIntermediateTensorInfo(p);var S=n.makeTensorInfo(f,p.dtype,v);if(s){var I=xM({inputs:{x:S},backend:n,attrs:{shape:Rv.expandShapeToKeepDim(f,u)}});return n.disposeIntermediateTensorInfo(S),I}return S}};var BP={kernelName:ca,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;UR(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),l="reflect"===o?0:1,p=n.data.get(a.dataId).values,d=a.shape.length,f=Hi.computeStrides(a.shape),h=Hi.sizeFromShape(s),m=s.length,v=Hi.computeStrides(s),g=Hi.getTypedArrayFromDType(a.dtype,h),y=0;y<h;y++){for(var b=Hi.indexToLoc(y,m,v),x=0;x<m;x++)b[x]<u[x]?b[x]=2*u[x]-b[x]-l:b[x]>=c[x]&&(b[x]=2*(c[x]-1)-b[x]+l);b=b.map((function(e,t){return e-u[t]}));var k=Hi.locToIndex(b,d,f);g[y]=p[k]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},WP=KR((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),UP=aF(la,WP),VP={kernelName:la,backendName:"cpu",kernelFunc:UP},jP=qe(at());function GP(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank ".concat(o," and dim was ").concat(s));var u=Hi.parseAxisParam([s],a.shape),c=AP({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=Rv.expandShapeToKeepDim(c.shape,u),p=xM({inputs:{x:c},backend:n,attrs:{shape:l}}),d=tM({inputs:{a:a,b:p},backend:n}),f=SF({inputs:{x:d},backend:n}),h=DO({inputs:{x:f},backend:n,attrs:{axis:u,keepDims:!1}}),m=xM({inputs:{x:h},backend:n,attrs:{shape:l}}),v=XO({inputs:{a:f,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),v}var HP={kernelName:ni,backendName:"cpu",kernelFunc:GP};var qP={kernelName:pa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;UR(a,"multinomial");for(var u=s?a:GP({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],p=n.data.get(u.dataId).values,d=[c,i],f=Hi.makeZerosTypedArray(Hi.sizeFromShape(d),"int32"),h=0;h<c;++h){var m=h*l,v=new Float32Array(l-1);v[0]=p[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+p[m+g];for(var y=jP.alea(o.toString()),b=h*i,x=0;x<i;++x){var k=y();f[b+x]=v.length;for(var w=0;w<v.length;w++)if(k<v[w]){f[b+x]=w;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(d,"int32",f)}},KP=Lg.nonMaxSuppressionV3Impl;var XP={kernelName:ma,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;UR(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,p=KP(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},YP=Lg.nonMaxSuppressionV4Impl;var QP={kernelName:va,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;UR(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,d=YP(l,p,o,s,u,c),f=d.selectedIndices,h=d.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},ZP=Lg.nonMaxSuppressionV5Impl;var JP={kernelName:ga,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;UR(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,d=ZP(l,p,o,s,u,c),f=d.selectedIndices,h=d.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([h.length],"float32",new Float32Array(h))]}};var $P={kernelName:ba,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;UR(a,"oneHot");var c=Hi.sizeFromShape(a.shape),l=new Float32Array(c*o);l.fill(u);for(var p=n.data.get(a.dataId).values,d=0;d<c;++d)p[d]>=0&&p[d]<o&&(l[d*o+p[d]]=s);return n.makeTensorInfo([].concat(Fe(a.shape),[o]),i,l)}};function eL(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=$R({inputs:{input:r},backend:n}),i=eL({inputs:{x:a},backend:n}),o=iO({inputs:{input:r},backend:n}),s=eL({inputs:{x:o},backend:n}),u=XR({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return eP({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var tL={kernelName:_i,backendName:"cpu",kernelFunc:eL};var nL={kernelName:ya,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=$R({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=iO({inputs:{input:a},backend:r}),u=eL({inputs:{x:s},backend:r}),c=XR({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return eP({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function rL(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return HO({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Hi.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Hi.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=t.map((function(e){var t=HO({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),u=sO({inputs:s,backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}var aL={kernelName:xa,backendName:"cpu",kernelFunc:rL};var iL={kernelName:ka,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;UR(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,l=Hi.sizeFromShape(a.shape),p=a.shape.length,d=Hi.computeStrides(a.shape),f=Hi.sizeFromShape(s),h=s.length,m=Hi.computeStrides(s),v=Hi.getTypedArrayFromDType(a.dtype,f);0!==o&&v.fill(o);for(var g=0;g<l;g++){var y=Hi.indexToLoc(g,p,d).map((function(e,t){return e+u[t]}));v[Hi.locToIndex(y,h,m)]=c[g]}return{dataId:n.write(v,s,a.dtype),shape:s,dtype:a.dtype}}},oL=KR((function(e,t){return Math.pow(e,t)})),sL=aF(Sa,oL),uL={kernelName:Sa,backendName:"cpu",kernelFunc:sL};var cL={kernelName:Na,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,s=t.indices,u=(r.outputRaggedRank,a.map((function(e){return n.data.get(e.dataId).values}))),c=a.map((function(e){return e.shape})),l=n.data.get(i.dataId).values,p=n.data.get(s.dataId).values,d=o(bD(u,c,l,i.shape,i.dtype,p,s.shape),3),f=d[0],h=d[1],m=d[2],v=f.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),g=n.makeTensorInfo(m,i.dtype,h);return v.concat([g])}};var lL={kernelName:Ca,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=o(kD(s,r.shape,r.dtype,u,a.shape,c,i.shape),2),p=l[0],d=l[1];return[n.makeTensorInfo([p.length],"int32",p),n.makeTensorInfo([d.length],r.dtype,d)]}};var pL={kernelName:Ta,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,s=t.defaultValue,u=t.rowPartitionTensors,c=r.rowPartitionTypes,l=n.data.get(a.dataId).values,p=n.data.get(i.dataId).values,d=n.data.get(s.dataId).values,f=u.map((function(e){return n.data.get(e.dataId).values})),h=u.map((function(e){return e.shape})),m=o(ND(l,a.shape,p,i.shape,i.dtype,d,s.shape,f,h,c),2),v=m[0],g=m[1];return n.makeTensorInfo(v,i.dtype,g)}};var dL={kernelName:Ea,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=CD(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},fL=fF(Ra,(function(e){return 1/e})),hL={kernelName:Ra,backendName:"cpu",kernelFunc:fL};var mL={kernelName:Pa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,s=r.halfPixelCenters,u=r.size;UR(a,"resizeBilinear");for(var c=Hi.computeStrides(a.shape),l=o(u,2),p=l[0],d=l[1],f=o(a.shape,4),h=f[0],m=f[1],v=f[2],g=f[3],y=n.data.get(a.dataId).values,b=new Float32Array(Hi.sizeFromShape([h,p,d,g])),x=[i&&p>1?m-1:m,i&&d>1?v-1:v],k=[i&&p>1?p-1:p,i&&d>1?d-1:d],w=0,S=x[0]/k[0],I=x[1]/k[1],_=0;_<h;_++)for(var N=0;N<p;N++){var C=void 0;C=s?S*(N+.5)-.5:S*N;for(var T=Math.max(0,Math.floor(C)),E=C-T,A=Math.min(m-1,Math.ceil(C)),R=_*c[0]+T*c[1],F=_*c[0]+A*c[1],D=0;D<d;D++){var M=void 0;M=s?I*(D+.5)-.5:I*D;for(var O=Math.max(0,Math.floor(M)),P=M-O,L=Math.min(v-1,Math.ceil(M)),z=R+O*c[2],B=F+O*c[2],W=R+L*c[2],U=F+L*c[2],V=0;V<g;V++){var j=y[z+V],G=y[B+V],H=j+(y[W+V]-j)*P,q=H+(G+(y[U+V]-G)*P-H)*E;b[w++]=q}}}return n.makeTensorInfo([h,p,d,g],"float32",b)}};var vL={kernelName:La,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,s=r.alignCorners;UR([i,a],"resizeBilinearGrad");for(var u=Hi.computeStrides(a.shape),c=o(a.shape,4),l=c[0],p=c[1],d=c[2],f=c[3],h=o(i.shape,3),m=h[1],v=h[2],g=new Float32Array(l*p*d*f),y=[s&&m>1?p-1:p,s&&v>1?d-1:d],b=[s&&m>1?m-1:m,s&&v>1?v-1:v],x=y[0]/b[0],k=y[1]/b[1],w=n.data.get(i.dataId).values,S=0,I=0;I<l;I++)for(var _=I*u[0],N=0;N<m;N++)for(var C=N*x,T=Math.floor(C),E=Math.min(Math.ceil(C),p-1),A=_+T*u[1],R=_+E*u[1],F=C-T,D=1-F,M=0;M<v;M++)for(var O=M*k,P=Math.floor(O),L=Math.min(Math.ceil(O),d-1),z=O-P,B=1-z,W=A+P*u[2],U=A+L*u[2],V=R+P*u[2],j=R+L*u[2],G=D*B,H=D*z,q=F*B,K=F*z,X=0;X<f;X++){var Y=w[S++];g[W+X]+=Y*G,g[U+X]+=Y*H,g[V+X]+=Y*q,g[j+X]+=Y*K}return n.makeTensorInfo([l,d,p,f],"float32",g)}};var gL={kernelName:Ma,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,s=r.halfPixelCenters,u=r.size;UR(a,"resizeNearestNeighbor");for(var c=Hi.computeStrides(a.shape),l=o(u,2),p=l[0],d=l[1],f=o(a.shape,4),h=f[0],m=f[1],v=f[2],g=f[3],y=n.data.get(a.dataId).values,b=new Float32Array(h*p*d*g),x=[i&&p>1?m-1:m,i&&d>1?v-1:v],k=[i&&p>1?p-1:p,i&&d>1?d-1:d],w=x[0]/k[0],S=x[1]/k[1],I=0,_=0;_<h;_++)for(var N=_*c[0],C=0;C<p;C++){var T=s?w*(C+.5):w*C,E=Math.min(m-1,i?Math.round(T):Math.floor(T));s&&(E=Math.max(0,E));for(var A=N+E*c[1],R=0;R<d;R++){var F=s?S*(R+.5):S*R,D=Math.min(v-1,i?Math.round(F):Math.floor(F));s&&(D=Math.max(0,D));for(var M=A+D*c[2],O=0;O<g;O++){var P=y[M+O];b[I++]=P}}}return n.makeTensorInfo([h,p,d,g],a.dtype,b)}};var yL={kernelName:Oa,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,s=r.alignCorners;UR([i,a],"resizeNearestNeighborGrad");for(var u=Hi.computeStrides(a.shape),c=Hi.computeStrides(i.shape),l=o(a.shape,4),p=l[0],d=l[1],f=l[2],h=l[3],m=o(i.shape,3),v=m[1],g=m[2],y=new Float32Array(p*d*f*h),b=n.data.get(i.dataId).values,x=[s&&v>1?d-1:d,s&&g>1?f-1:f],k=[s&&v>1?v-1:v,s&&g>1?g-1:g],w=x[0]/k[0],S=x[1]/k[1],I=1/w,_=1/S,N=2*Math.ceil(I)+2,C=2*Math.ceil(_)+2,T=0;T<p;T++)for(var E=T*u[0],A=0;A<d;A++)for(var R=E+A*u[1],F=Math.floor(A*I),D=Math.floor(F-N/2),M=0;M<f;M++)for(var O=R+M*u[2],P=Math.floor(M*_),L=Math.floor(P-C/2),z=0;z<h;z++){for(var B=0,W=0;W<N;W++){var U=W+D;if(!(U<0||U>=v)){var V=E+U*c[1],j=U*w;if(A===Math.min(d-1,s?Math.round(j):Math.floor(j)))for(var G=0;G<C;G++){var H=G+L;if(!(H<0||H>=g)){var q=V+H*c[2],K=H*S;M===Math.min(f-1,s?Math.round(K):Math.floor(K))&&(B+=b[q+z])}}}}y[O+z]=B}return n.makeTensorInfo(a.shape,a.dtype,y)}};var bL={kernelName:Ba,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;UR(a,"reverse");var o=a.shape.length,s=Hi.parseAxisParam(i,a.shape);if(0===o)return ZR({inputs:{x:a},backend:n});for(var u=new _o(a.shape,a.dtype),c=n.bufferSync(a),l=function(){var e=u.indexToLoc(p),t=e.slice();s.forEach((function(e){return t[e]=a.shape[e]-1-t[e]})),u.set.apply(u,[c.get.apply(c,Fe(t))].concat(Fe(e)))},p=0;p<u.size;p++)l();return n.makeTensorInfo(u.shape,u.dtype,u.values)}},xL={kernelName:Ti,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,s=n.fillValue,u=n.center,c=r,l=Hi.getTypedArrayFromDType(a.dtype,Hi.sizeFromShape(a.shape)),p=o(a.shape,4),d=p[0],f=p[1],h=p[2],m=p[3],v=o(Rv.getImageCenter(u,f,h),2),g=v[0],y=v[1],b=Math.sin(i),x=Math.cos(i),k=c.data.get(a.dataId).values,w=0;w<d;w++)for(var S=w*h*f*m,I=0;I<f;I++)for(var _=I*(h*m),N=0;N<h;N++)for(var C=N*m,T=0;T<m;T++){var E=[d,I,N,T],A=E[2],R=E[1],F=(A-g)*x-(R-y)*b,D=(A-g)*b+(R-y)*x;F=Math.round(F+g),D=Math.round(D+y);var M=s;if("number"!=typeof s&&(M=3===T?255:s[T]),F>=0&&F<h&&D>=0&&D<f)M=k[S+D*(h*m)+F*m+T];l[S+_+C+T]=M}return{dataId:c.write(l,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},kL=fF(Wa,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),wL={kernelName:Wa,backendName:"cpu",kernelFunc:kL};var SL={kernelName:Va,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=Rv.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,d=s.outputSize,f=RD(n.bufferSync(a),n.bufferSync(i),o,d,l,c,u,p,0,!0);return n.makeTensorInfo(o,f.dtype,f.values)}};function IL(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function _L(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var NL={kernelName:ja,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=function(e,t,n,r,a,i){for(var o=Hi.getArrayFromDType("int32",n*a),s=0;s<n;++s)for(var u=e.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]="left"===i?IL(u,t[l+c]):_L(u,t[l+c]);return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};var CL={kernelName:Ga,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;UR([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=zo(a.dtype,i.dtype),p=Hi.makeZerosTypedArray(Hi.sizeFromShape(a.shape),l),d=0,f=0===o||o>1||1===a.shape.length?1:Hi.sizeFromShape(a.shape.slice(1)),h=0;h<s.length;h++)for(var m=0;m<f;m++)1===s[h]?p[d++]=u[h]:p[d++]=c[h];return n.makeTensorInfo(a.shape,l,p)}},TL=Rv.SELU_SCALEALPHA,EL=Rv.SELU_SCALE,AL=fF(Ha,(function(e){return e>=0?EL*e:TL*(Math.exp(e)-1)})),RL={kernelName:Ha,backendName:"cpu",kernelFunc:AL},FL=fF(Ya,(function(e){return e<0?-1:e>0?1:0})),DL={kernelName:Ya,backendName:"cpu",kernelFunc:FL},ML=fF(Ka,(function(e){return Math.sin(e)})),OL={kernelName:Ka,backendName:"cpu",kernelFunc:ML},PL=fF(Xa,(function(e){return Math.sinh(e)})),LL={kernelName:Xa,backendName:"cpu",kernelFunc:PL},zL=Math.log(1.1920928955078125e-7)+2,BL=fF(Za,(function(e){var t=e>-zL,n=e<zL,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),WL={kernelName:Za,backendName:"cpu",kernelFunc:BL};var UL={kernelName:ei,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;UR([a],"spaceToBatchND");var s=Hi.sizeFromShape(i),u=[[0,0]];u.push.apply(u,Fe(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=iL.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=Rv.getReshaped(l.shape,i,s,!1),d=Rv.getPermuted(p.length,i.length,!1),f=Rv.getReshapedPermuted(l.shape,i,s,!1),h=xM({inputs:{x:l},backend:n,attrs:{shape:p}}),m=dD({inputs:{x:h},backend:n,attrs:{perm:d}}),v=xM({inputs:{x:m},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),v}};var VL={kernelName:ri,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,s=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==s.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(s.shape));var u=n.data.get(r.dataId).values,c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,p=n.data.get(s.dataId).values[0],d=o(zD(u,r.shape,r.dtype,c,a.dtype,l,p),5),f=d[0],h=d[1],m=d[2],v=d[3],g=d[4];return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],a.dtype,m),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};var jL={kernelName:ai,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var s=Array.from(n.data.get(a.dataId).values),u=n.data.get(r.dataId).values,c=Array.from(n.data.get(i.dataId).values),l=o(BD(u,r.shape,r.dtype,s,c),3),p=l[0],d=l[1],f=l[2];return[n.makeTensorInfo(d,r.dtype,p),n.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}};var GL={kernelName:ii,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=o(WD(s,r.shape,r.dtype,u,c,!0),2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var HL={kernelName:oi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=o(WD(s,r.shape,r.dtype,u,c),2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var qL={kernelName:si,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.sparseIndices,o=n.sparseValues,s=n.defaultValue,u=a.outputShape,c=Rv.calculateShapes(o,i,u),l=c.sliceRank,p=c.numUpdates,d=c.sliceSize,f=c.strides,h=c.outputSize,m=!1,v=r.bufferSync(i);switch(o.dtype){case"bool":t=RD(v,r.bufferSync(o),u,h,d,p,l,f,Boolean(r.data.get(s.dataId).values[0]),m);break;case"float32":t=RD(v,r.bufferSync(o),u,h,d,p,l,f,r.data.get(s.dataId).values[0],m);break;case"int32":t=RD(v,r.bufferSync(o),u,h,d,p,l,f,r.data.get(s.dataId).values[0],m);break;case"string":t=RD(v,r.bufferSync(o),u,h,d,p,l,f,Hi.decodeString(r.data.get(s.dataId).values[0]),m);break;default:throw new Error("Unsupported type ".concat(o.dtype))}return r.makeTensorInfo(u,t.dtype,t.values)}};var KL={kernelName:ti,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=Hi.parseAxisParam(o,a.shape)[0],u=Rv.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map((function(e){var t=Fe(l);t[s]=e;var r=PD({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[s]+=e,r}))}},XL={kernelName:ci,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;UR(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},YL=fF(Ni,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),QL={kernelName:Ni,backendName:"cpu",kernelFunc:YL};var ZL={kernelName:li,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,p=r.newAxisMask,d=r.shrinkAxisMask;UR(a,"stridedSlice");var f,h=iv.sliceInfo(a.shape,i,o,s,u,c,l,p,d),m=h.finalShapeSparse,v=h.finalShape,g=h.isIdentity,y=h.sliceDim0,b=h.isSimpleSlice,x=h.begin,k=h.end,w=h.strides;if(g)f=xM({inputs:{x:a},backend:n,attrs:{shape:v}});else if(y||b){Hi.assert(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var S=iv.computeOutShape(x,k,w),I=PD({inputs:{x:a},backend:n,attrs:{begin:x,size:S}});f=xM({inputs:{x:I},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(I)}else{var _=KD(m,n.bufferSync(a),w,x);f=n.makeTensorInfo(v,_.dtype,_.values)}return f}};var JL={kernelName:pi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,s=r.leftPad,u=r.rightPad,c=r.padWidth,l=r.preserveShortSequences,p=t.data,d=t.dataSplits,f=o(YD(n.data.get(p.dataId).values,n.data.get(d.dataId).values,a,i,s,u,c,l),2),h=f[0],m=f[1];return[n.makeTensorInfo([h.length],"string",h),n.makeTensorInfo(d.shape,"int32",m)]}};var $L={kernelName:di,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var s=o(ZD(n.data.get(a.dataId).values,n.data.get(i.dataId).values[0],r),3),u=s[0],c=s[1],l=s[2],p=c.length;return[n.makeTensorInfo([p,2],"int32",u),n.makeTensorInfo([p],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(l))]}};var ez={kernelName:fi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=JD(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},tz=fF(mi,(function(e){return Math.tan(e)})),nz={kernelName:mi,backendName:"cpu",kernelFunc:tz},rz=fF(vi,(function(e){return Math.tanh(e)}));var az={kernelName:gi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;UR(a,"tile");var o=rM(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}};var iz={kernelName:yi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,s=r.sorted;UR(a,"topk");var u=o(oM(n.data.get(a.dataId).values,a.shape,a.dtype,i,s),2),c=u[0],l=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};var oz={kernelName:bi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=t.transforms,s=n.interpolation,u=n.fillMode,c=n.fillValue,l=n.outputShape,p=o(a.shape,4),d=p[0],f=p[1],h=p[2],m=p[3],v=o(null!=l?l:[f,h],2),g=v[0],y=v[1],b=[d,g,y,m],x=Hi.computeStrides(a.shape),k=x[0],w=x[1],S=x[2],I=Hi.computeStrides(b),_=I[0],N=I[1],C=I[2],T=Hi.getTypedArrayFromDType(a.dtype,Hi.sizeFromShape(b));T.fill(c);for(var E=r.data.get(a.dataId).values,A=r.data.get(i.dataId).values,R=0;R<d;++R){for(var F=1===i.shape[0]?A:A.subarray(8*R,8*R+8),D=0;D<g;++D)for(var M=0;M<y;++M)for(var O=0;O<m;++O){var P=void 0,L=F[6]*M+F[7]*D+1;if(0!==L){var z=(F[0]*M+F[1]*D+F[2])/L,B=(F[3]*M+F[4]*D+F[5])/L,W=sz(z,h,u),U=sz(B,f,u);switch(s){case"nearest":P=cz(E,f,h,k,w,S,R,U,W,O,c);break;case"bilinear":P=lz(E,f,h,k,w,S,R,U,W,O,c);break;default:throw new Error("Error in Transform: Expect 'nearest' or 'bilinear', but got ".concat(s))}T[R*_+D*N+M*C+O]=P}}return r.makeTensorInfo(b,a.dtype,T)}return{dataId:r.write(T,b,a.dtype),shape:a.shape,dtype:a.dtype}}};function sz(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return Hi.clamp(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return Hi.clamp(0,n,t-1)}(e,t);case"nearest":return function(e,t){return Hi.clamp(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function uz(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function cz(e,t,n,r,a,i,o,s,u,c,l){return uz(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function lz(e,t,n,r,a,i,o,s,u,c,l){var p=Math.floor(s),d=Math.floor(u),f=p+1,h=d+1;return(f-s)*((h-u)*uz(e,t,n,r,a,i,o,p,d,c,l)+(u-d)*uz(e,t,n,r,a,i,o,p,h,c,l))+(s-p)*((h-u)*uz(e,t,n,r,a,i,o,f,d,c,l)+(u-d)*uz(e,t,n,r,a,i,o,f,h,c,l))}var pz={kernelName:ki,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;UR(i,"unique");var o=sM(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var dz={kernelName:wi,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var p=new Array(o).fill(0),d=a.shape.slice();d[i]=1;for(var f=new Array(s),h=0;h<f.length;h++){p[i]=h;var m=PD({inputs:{x:a},backend:n,attrs:{begin:p,size:d}});f[h]=xM({inputs:{x:m},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(m)}return f}};for(var fz={kernelName:Si,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;UR(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,p=0;p<c;++p){var d=HO({inputs:{input:l},backend:n,attrs:{dim:p+1}});l=d,u.push(d)}for(var f=0;f<o;++f){var h=Hi.createScalarValue(f,"int32"),m=n.makeTensorInfo([],"int32",h),v=xF({inputs:{a:m,b:l},backend:n}),g=nF({inputs:{x:v},backend:n,attrs:{dtype:"float32"}}),y=aD({inputs:{a:g,b:a},backend:n}),b=DO({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(m),u.push(v),u.push(g),u.push(y),u.push(b)}var x=rL({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},hz=0,mz=[IM,qR,NM,TM,cF,EM,AM,RM,FM,DM,OM,LM,BM,VM,GM,XM,YM,QM,ZM,SM,JM,$M,eO,tO,rF,gF,rO,YR,aO,uO,lO,pO,dO,fO,hO,mO,gO,bO,xO,kO,wO,SO,IO,NO,CO,TO,EO,AO,RO,FO,OO,cM,PO,kF,GO,IF,qO,CF,$O,tP,nP,AF,iP,oP,sP,uP,cP,OF,zF,JR,lP,oO,dP,hP,vP,pM,UF,GF,gP,XF,bP,wP,IP,CP,TP,EP,RP,JF,FP,DP,MP,OP,PP,LP,zP,tD,BP,VP,qP,iD,sD,XP,QP,JP,lD,$P,nL,aL,iL,uL,hM,mD,cL,lL,pL,dL,eF,YO,hL,vM,yM,kM,mL,vL,gL,yL,bL,xL,wL,AD,SL,NL,CL,RL,MD,DL,OL,LL,LD,HP,WL,UL,VL,jL,GL,HL,qL,KL,jD,XL,qD,QL,ZL,JL,$L,ez,nM,MO,nz,{kernelName:vi,backendName:"cpu",kernelFunc:rz},az,iz,oz,fD,pz,dz,fz,tL];hz<mz.length;hz++){Bi(mz[hz])}var vz={};He(vz,{assertNotComplex:function(){return _B},bindCanvasToFramebuffer:function(){return tB},bindColorTextureToFramebuffer:function(){return nB},bindTextureToProgramUniformSampler:function(){return eB},bindTextureUnit:function(){return Qz},bindVertexBufferToProgramAttribute:function(){return Yz},callAndCheck:function(){return Tz},canBeRepresented:function(){return Rz},createFragmentShader:function(){return Oz},createFramebuffer:function(){return Xz},createProgram:function(){return Wz},createStaticIndexBuffer:function(){return Gz},createStaticVertexBuffer:function(){return jz},createTexture:function(){return qz},createVertexShader:function(){return Mz},getBatchDim:function(){return uB},getExtensionOrThrow:function(){return Dz},getFramebufferErrorMessage:function(){return iB},getMaxTexturesInShader:function(){return gB},getNumChannels:function(){return Hz},getProgramUniformLocation:function(){return $z},getProgramUniformLocationOrThrow:function(){return Jz},getRowsCols:function(){return cB},getShapeAs3D:function(){return lB},getTextureShapeFromLogicalShape:function(){return pB},getWebGLDisjointQueryTimerVersion:function(){return yB},getWebGLErrorMessage:function(){return Fz},getWebGLMaxTextureSize:function(){return hB},hasExtension:function(){return bB},isCapableOfRenderingToFloatTexture:function(){return kB},isDownloadFloatTextureEnabled:function(){return wB},isReshapeFree:function(){return fB},isWebGLFenceEnabled:function(){return IB},isWebGLVersionEnabled:function(){return xB},linkProgram:function(){return Uz},logShaderSourceAndInfoLog:function(){return Bz},resetMaxTextureSize:function(){return mB},resetMaxTexturesInShader:function(){return vB},unbindColorTextureFromFramebuffer:function(){return rB},unbindTextureUnit:function(){return Zz},validateFramebuffer:function(){return aB},validateProgram:function(){return Vz},validateTextureSize:function(){return Kz}});var gz,yz,bz,xz={},kz={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function wz(e,t){xz[e]=t}function Sz(e,t){if(!(e in xz)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;return n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete xz[e]}),!1),hn().getBool("SOFTWARE_WEBGL_ENABLED")&&(kz.failIfMajorPerformanceCaveat=!1),1===e?n.getContext("webgl",kz)||n.getContext("experimental-webgl",kz):n.getContext("webgl2",kz)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;xz[e]=n}var r=xz[e];return null==r||r.isContextLost()?(delete xz[e],Sz(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),xz[e])}function Iz(e,t){return[t,e]}function _z(e){var t=Hi.sizeFromShape(e),n=Math.ceil(t/4);return Hi.sizeToSquarishShape(n)}function Nz(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Cz(e,t){var n,r,a,i,o,s,u,c,l,p,d=e;return 2===hn().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,a=d.RGBA16F,i=d.RGBA32F,o=d.RED,u=4,c=1,l=d.HALF_FLOAT,p=d.FLOAT,s=d.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=d.RGBA,o=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:p}}function Tz(e,t){var n=t();return hn().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+Fz(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(gz||(gz={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(yz||(yz={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(bz||(bz={}));var Ez=5.96e-8,Az=65504;function Rz(e){return!!(hn().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||Ez<Math.abs(e)&&Math.abs(e)<Az)}function Fz(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}function Dz(e,t){return oB(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function Mz(e,t){var n=oB(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Tz(e,(function(){return e.shaderSource(n,t)})),Tz(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function Oz(e,t){var n=oB(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Tz(e,(function(){return e.shaderSource(n,t)})),Tz(e,(function(){return e.compileShader(n)})),hn().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw Bz(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var Pz,Lz,zz=/ERROR: [0-9]+:([0-9]+):/g;function Bz(e,t){var n=zz.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return Hi.rightPad((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),p=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(Hi.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}function Wz(e){return oB(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function Uz(e,t){if(Tz(e,(function(){return e.linkProgram(t)})),!hn().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Vz(e,t){if(Tz(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function jz(e,t){var n=oB(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Tz(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),Tz(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}function Gz(e,t){var n=oB(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Tz(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),Tz(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}function Hz(){return 2===hn().getNumber("WEBGL_VERSION")?1:4}function qz(e){return oB(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function Kz(e,t){var n=hn().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}function Xz(e){return oB(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function Yz(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(Tz(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Tz(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),Tz(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function Qz(e,t,n){sB(e,n),Tz(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),Tz(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}function Zz(e,t){sB(e,t),Tz(e,(function(){return e.activeTexture(e.TEXTURE0+t)})),Tz(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function Jz(e,t,n){return oB(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function $z(e,t,n){return e.getUniformLocation(t,n)}function eB(e,t,n,r){Tz(e,(function(){return Qz(e,t,r)})),Tz(e,(function(){return e.uniform1i(n,r)}))}function tB(e){Tz(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),Tz(e,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),Tz(e,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))}function nB(e,t,n){Tz(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),Tz(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function rB(e,t){Tz(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),Tz(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function aB(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+iB(e,t))}function iB(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}function oB(e,t,n){var r=Tz(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function sB(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function uB(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Hi.sizeFromShape(e.slice(0,e.length-t))}function cB(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function lB(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[uB(e)].concat(Fe(cB(e)))),t}function pB(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=hn().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=hn().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");r===1/0&&hn().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,e=e.map((function(t,n){return n>=e.length-2?Hi.nearestLargerEven(e[n]):e[n]})),1===e.length&&(e=[2,e[0]])),2!==e.length&&(e=Hi.squeezeShape(e).newShape);var a=Hi.sizeFromShape(e),i=null;e.length<=1&&a<=n?i=[1,a]:2===e.length&&e[0]<=n&&e[1]<=n?i=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?i=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?i=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?i=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(i=[e[0],e[1]*e[2]*e[3]]);var s=null!=i&&Math.max.apply(Math,Fe(i))>r&&Math.min.apply(Math,Fe(i))<=(t?2:1)&&Math.min.apply(Math,Fe(i))>0;if(null==i||s)if(t){var u,c=uB(e),l=2,p=2;e.length&&(l=(u=o(cB(e),2))[0],p=u[1]),a=c*(l/2)*(p/2),i=Hi.sizeToSquarishShape(a).map((function(e){return 2*e}))}else i=Hi.sizeToSquarishShape(a);return i}function dB(e){return e%2===0}function fB(e,t){if(e=e.slice(-2),t=t.slice(-2),Hi.arraysEqual(e,t)||!e.length||!t.length||0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r||dB(n)&&dB(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&dB(e[0])&&dB(t[0])}function hB(e){if(null==Pz){var t=Sz(e);Pz=t.getParameter(t.MAX_TEXTURE_SIZE)}return Pz}function mB(){Pz=null}function vB(){Lz=null}function gB(e){if(null==Lz){var t=Sz(e);Lz=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Lz)}function yB(e){if(0===e)return 0;var t=Sz(e);return bB(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:bB(t,"EXT_disjoint_timer_query")?1:0}function bB(e,t){return null!=e.getExtension(t)}function xB(e){try{if(null!=Sz(e))return!0}catch(w){return console.log("Error when getting WebGL context: ",w),!1}return!1}function kB(e){if(0===e)return!1;var t=Sz(e);if(1===e){if(!bB(t,"OES_texture_float"))return!1}else if(!bB(t,"EXT_color_buffer_float"))return!1;return SB(t)}function wB(e){if(0===e)return!1;var t=Sz(e);if(1!==e){if(bB(t,"EXT_color_buffer_float"))return SB(t);var n="EXT_color_buffer_half_float";if(bB(t,n)){var r=t.getExtension(n);return function(e,t){var n=Cz(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!(!bB(t,"OES_texture_float")||!bB(t,"WEBGL_color_buffer_float"))&&SB(t)}function SB(e){var t=Cz(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function IB(e){return 2===e&&null!=Sz(e).fenceSync}function _B(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Hi.assert("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the WebGL backend.")}))}))}var NB=hn();function CB(){var e,t,n,r,a,i,o,s,u,c;return 2===hn().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=hn().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function TB(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Hi.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function EB(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Hi.computeStrides(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function AB(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=e.map((function(e,t){return t})),a=function(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}(r,t);return a.map((function(t,r){var i="int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),o=r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(i,"; ").concat(o,";")})).join("")}function RB(e){var t=Hi.computeStrides(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}NB.registerFlag("HAS_WEBGL",(function(){return NB.getNumber("WEBGL_VERSION")>0})),NB.registerFlag("WEBGL_VERSION",(function(){return xB(2)?2:xB(1)?1:0})),NB.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),NB.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===NB.get("WEBGL_VERSION")})),NB.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),NB.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),NB.registerFlag("WEBGL_PACK",(function(){return NB.getBool("HAS_WEBGL")})),NB.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_CLIP",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_PACK_REDUCE",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_CONV_IM2COL",(function(){return NB.getBool("WEBGL_PACK")})),NB.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return hB(NB.getNumber("WEBGL_VERSION"))})),NB.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return gB(NB.getNumber("WEBGL_VERSION"))})),NB.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=NB.getNumber("WEBGL_VERSION");return 0===e?0:yB(e)})),NB.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return NB.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Jo.isMobile()})),NB.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return kB(NB.getNumber("WEBGL_VERSION"))})),NB.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!NB.getBool("WEBGL_FORCE_F16_TEXTURES")&&NB.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),NB.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return wB(NB.getNumber("WEBGL_VERSION"))})),NB.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return IB(NB.getNumber("WEBGL_VERSION"))})),NB.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return NB.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),NB.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))})),NB.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return Jo.isMobile()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ".concat(e,"."))})),NB.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),NB.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),NB.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),NB.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),NB.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),NB.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return NB.getBool("IS_TEST")})),NB.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(function(){return 1/0})),NB.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(function(){return!1})),NB.registerFlag("WEBGL2_ISNAN_CUSTOM",(function(){return!1})),NB.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var FB="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",DB=Rv.getBroadcastDims;function MB(e,t,n){var r=[];if(e.forEach((function(e){var t=Hi.sizeFromShape(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(GB(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?PB(e,r):OB(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;return i.length<=o.length&&(a+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=DB(e.shapeInfo.logicalShape,t.logicalShape),c=jB(s),l=s-o,p=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(p[e+l]," = 0;")})).join("\n");var d="";d=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(p[t+l])})).join(", ");var f="return outputValue;",h=1===Hi.sizeFromShape(e.shapeInfo.logicalShape),m=1===Hi.sizeFromShape(t.logicalShape);if(1!==o||h||m){if(h&&!m)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var v=o-2,g=o-1;u.indexOf(v)>-1&&u.indexOf(g)>-1?f="return vec4(outputValue.x);":u.indexOf(v)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(d,");\n      ").concat(f,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Hi.arraysEqual(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=jB(u),p=DB(e.shapeInfo.logicalShape,t.logicalShape),d=u-s,f=["x","y","z","w","u","v"];c=0===s?"":u<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords.".concat(f[e+d]," = 0;")})).join("\n");var h="";return h=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(f[t+d])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(h,");\n    }\n  ")}(e,t)),a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=CB(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),p=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(LB,"\n    ").concat(zB,"\n    ").concat(BB,"\n  ")}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    "):1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Hi.arraysEqual(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){return Hi.arraysEqual(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(EB(["r","c","d"],e),"\n    return ivec3(r, c, d);\n  }\n");var r=TB(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(EB(["r","c","d","d2"],e),"\n      return ivec4(r, c, d, d2);\n    }\n  ");var r=TB(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=TB(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=TB(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(p+=WB),[p,l,i,o,a,s,n.userCode].join("\n")}function OB(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=o(e.shapeInfo.texShape,2),i=a[0],s=a[1];if(1===i&&1===s)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var u=UB(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(u,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var c=o(e.shapeInfo.texShape,2),l=c[0],p=c[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(l,", ").concat(p,", ").concat(u,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(VB(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=UB(n);return 1===o?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===i?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&Hi.arraysEqual(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=Hi.squeezeShape(n),c=u.newShape,l=u.keptDims,p=c;if(p.length<n.length){var d=HB(e,p),f=["row","col"];return"\n      ".concat(OB(d,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(qB(f,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(VB(e),"\n      }\n    ");var h=i[0],m=i[1],v=UB(r);return 1===m?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===h?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(m,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):t?"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(v,";\n    vec2 uv = uvFromFlat(").concat(h,", ").concat(m,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=Hi.squeezeShape(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var p=HB(e,l),d=["row","col","depth"];return"\n        ".concat(OB(p,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(qB(d,c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(VB(e),"\n      }\n    ");var f=e.shapeInfo.texShape,h=f[0],m=f[1],v=e.shapeInfo.flatOffset;if(m===i&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(m,".0, ").concat(h,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(m===o&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(m,".0, ").concat(h,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var g=UB(r);return t?"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    "):"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(g,";\n        vec2 uv = uvFromFlat(").concat(h,", ").concat(m,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=Hi.squeezeShape(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var p=HB(e,c),d=["row","col","depth","depth2"];return"\n      ".concat(OB(p,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(qB(d,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(VB(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,m=h[0],v=h[1],g="int stride2 = ".concat(r,"Shape[3];"),y="int stride1 = ".concat(r,"Shape[2] * stride2;"),b="int stride0 = ".concat(r,"Shape[1] * stride1;");if(v===s&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(g,"\n        ").concat(y,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(v===i&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var x=UB(r);return t?"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(g,"\n      ").concat(y,"\n      ").concat(b,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index + ").concat(x,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=Hi.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var p=HB(e,c),d=["row","col","depth","depth2","depth3"];return"\n      ".concat(OB(p),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(qB(d,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(VB(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,m=h[0],v=h[1];if(v===s&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===a&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=UB(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Hi.squeezeShape(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=HB(e,i),u=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(OB(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(qB(u,o),");\n      }\n    ")}var c=t[5],l=t[4]*c,p=t[3]*l,d=t[2]*p,f=t[1]*d;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(f,", ").concat(d,", ").concat(p,", ").concat(l,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(c,", 1)));\n        ").concat(VB(e),"\n      }\n    ");var h=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,v=m[0],g=m[1];if(g===f&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(d,", ").concat(p,", ").concat(l,", ").concat(c,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(g===c&&null==h)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var y=UB(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(f," + col * ").concat(d," + depth * ").concat(p," +\n          depth2 * ").concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(g,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling is not yet supported"))}}function PB(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=CB();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=CB();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=CB();if(null!=i&&Hi.arraysEqual(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=[1,2],u=HB(e,n.slice(1)),c=["b","row","col"];return"\n        ".concat(PB(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(qB(c,s),");\n        }\n      ")}var l=CB();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");var p=o[0],d=o[1],f=Math.ceil(n[2]/2),h=f*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(p,", ").concat(d,", ").concat(h,", ").concat(f,", b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=CB();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],p=Math.ceil(i[o-1]/2),d=p*Math.ceil(i[o-2]/2),f="int b, int row, int col",h="b * ".concat(d," + (row / 2) * ").concat(p," + (col / 2)"),m=2;m<o-1;m++)f="int b".concat(m,", ")+f,d*=i[o-m-1],h="b".concat(m," * ").concat(d," + ")+h;return"\n    vec4 ".concat(r,"(").concat(f,") {\n      int index = ").concat(h,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var LB="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",zB="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",BB="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",WB="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function UB(e){return"offset".concat(e)}function VB(e){var t=e.name,n=Hi.sizeFromShape(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function jB(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function GB(e,t,n){var r=Hi.squeezeShape(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,c=!e&&o>1&&!Hi.arraysEqual(t,n)&&a.length<o||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:i}}function HB(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function qB(e,t){return t.map((function(t){return e[t]})).join(", ")}function KB(e,t,n){var r,a,i,o,s={},u={},c={},l=[],p=null;o=e.getUniformLocation(n,"NAN",!1),1===hn().getNumber("WEBGL_VERSION")&&(p=e.getUniformLocation(n,"INFINITY",!1));for(var d=!1,f=0;f<t.variableNames.length;f++){var h=t.variableNames[f];s[h]=e.getUniformLocation(n,h,d),s["offset".concat(h)]=e.getUniformLocation(n,"offset".concat(h),d),t.enableShapeUniforms&&(u["".concat(h,"Shape")]=e.getUniformLocation(n,"".concat(h,"Shape"),d),c["".concat(h,"TexShape")]=e.getUniformLocation(n,"".concat(h,"TexShape"),d))}return t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",d),i=e.getUniformLocation(n,"outShapeStrides",d),a=e.getUniformLocation(n,"outTexShape",d)),t.customUniforms&&t.customUniforms.forEach((function(t,r){l[r]=e.getUniformLocation(n,t.name,d)})),{uniformLocations:s,customUniformLocations:l,infLoc:p,nanLoc:o,inShapesLocations:u,inTexShapesLocations:c,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function XB(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!Hi.arraysEqual(r,i))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!Hi.arraysEqual(o,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function YB(e){return hn().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var QB=v((function e(t){h(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=gz.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=CB();this.outputShape=t,this.enableShapeUniforms=YB(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?EB(["r","c","d"],t):TB(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),ZB=v((function e(t){h(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=gz.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=CB();this.outputShape=t,this.enableShapeUniforms=YB(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?EB(["r","c","d"],t):TB(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),JB=v((function e(t){h(this,e),this.variableNames=["A"],this.outTexUsage=yz.DOWNLOAD;var n=CB();this.outputShape=t,this.userCode="\n      ".concat(FB,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),$B=v((function e(t){h(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=yz.DOWNLOAD;var n=CB();this.outputShape=t,this.userCode="\n      ".concat(FB,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),eW={R:0,G:1,B:2,A:3},tW=v((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RGBA";h(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=CB();this.outputShape=t,this.enableShapeUniforms=YB(this.outputShape.length);var i="result";n&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<r.length;s++){var u=r[s];o+="\n          if(offset == ".concat(s,") {\n            result = values[").concat(eW[u],"];\n          }")}this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":RB(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int flatIndex = getFlatIndex(coords);\n        float result = 0.;\n        int offset = imod(flatIndex, ").concat(r.length,");\n\n        flatIndex = idiv(flatIndex, ").concat(r.length,", 1.);\n\n        int r = flatIndex / texShape[1];\n        if (r < texShape[0]) {\n          int c = imod(flatIndex, texShape[1]);\n          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n          vec4 values = ").concat(a.texture2D,"(A, uv);\n          ").concat(o,"\n        }\n        ").concat(a.output," = vec4(").concat(i,", 0., 0., 0.);\n      }\n    ")})),nW=v((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];h(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=CB();this.outputShape=t,this.enableShapeUniforms=YB(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":RB(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")})),rW={};function aW(e){var t=CB();return Mz(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function iW(e){return jz(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function oW(e){return Gz(e,new Uint16Array([0,1,2,2,1,3]))}function sW(e,t,n,r,a,i){Kz(t,n);var o=qz(e),s=e.TEXTURE_2D;return Tz(e,(function(){return e.bindTexture(s,o)})),Tz(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),Tz(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),Tz(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),Tz(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===hn().getNumber("WEBGL_VERSION")?Tz(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):Tz(e,(function(){return e.texStorage2D(s,1,r,t,n)})),Tz(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function uW(e){return e.internalFormatFloat}function cW(e,t,n,r){var a=o(Iz(t,n),2);return sW(e,a[0],a[1],uW(r),r.textureFormatFloat,e.FLOAT)}function lW(e){return e.internalFormatHalfFloat}function pW(e,t,n,r){var a=o(Iz(t,n),2);return sW(e,a[0],a[1],lW(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function dW(e){return e.downloadTextureFormat}function fW(e,t,n,r){var a=o(Iz(t,n),2);return sW(e,a[0],a[1],dW(r),e.RGBA,e.UNSIGNED_BYTE)}function hW(e){return e.internalFormatPackedFloat}function mW(e,t,n,r){var a=o(Nz(t,n),2);return sW(e,a[0],a[1],hW(r),e.RGBA,e.FLOAT)}function vW(e){return e.internalFormatPackedHalfFloat}function gW(e,t,n,r){var a=o(Nz(t,n),2);return sW(e,a[0],a[1],vW(r),e.RGBA,r.textureTypeHalfFloat)}function yW(e,t,n){return Tz(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),Yz(e,t,"clipSpacePos",n,3,20,0)&&Yz(e,t,"uv",n,2,20,12)}function bW(e,t,n,r,a,i){var o,s,u;Tz(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===hn().getNumber("WEBGL_VERSION")?Tz(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):Tz(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),Tz(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function xW(e,t,n){Tz(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===hn().getNumber("WEBGL_VERSION")?Tz(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):Tz(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===hn().getNumber("WEBGL_VERSION")?Tz(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):Tz(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),Tz(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function kW(e,t,n,r){var a=e.createBuffer();Tz(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return Tz(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),Tz(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),Tz(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}function wW(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function SW(e,t,n,r){var a=o(Iz(t,n),2),i=a[0],s=a[1],u=new Uint8Array(function(e,t){return e*t}(t*n,4));return Tz(e,(function(){return e.readPixels(0,0,i,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function IW(e,t,n,r,a,i,s,u){var c=e,l=new Float32Array(function(e,t){var n=o(Nz(e,t),2);return n[0]*n[1]*4}(i,s));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}function _W(e,t,n){var r=new Float32Array(t*n*4);return Tz(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}He(rW,{bindVertexProgramAttributeStreams:function(){return yW},createBufferFromOutputTexture:function(){return kW},createFloat16MatrixTexture:function(){return pW},createFloat16PackedMatrixTexture:function(){return gW},createFloat32MatrixTexture:function(){return cW},createIndexBuffer:function(){return oW},createPackedMatrixTexture:function(){return mW},createUnsignedBytesMatrixTexture:function(){return fW},createVertexBuffer:function(){return iW},createVertexShader:function(){return aW},downloadByteEncodedFloatMatrixFromOutputTexture:function(){return SW},downloadFloat32MatrixFromBuffer:function(){return wW},downloadMatrixFromPackedOutputTexture:function(){return _W},downloadPackedMatrixFromBuffer:function(){return IW},getInternalFormatForFloat16MatrixTexture:function(){return lW},getInternalFormatForFloat16PackedMatrixTexture:function(){return vW},getInternalFormatForFloat32MatrixTexture:function(){return uW},getInternalFormatForPackedMatrixTexture:function(){return hW},getInternalFormatForUnsignedBytesMatrixTexture:function(){return dW},uploadDenseMatrixToTexture:function(){return bW},uploadPixelDataToTexture:function(){return xW}});var NW=function(){function e(t){h(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var n=hn().getNumber("WEBGL_VERSION");if(null!=t?(this.gl=t,wz(n,t)):this.gl=Sz(n),t=this.gl,2===hn().getNumber("WEBGL_VERSION")){var r=t;this.createVertexArray=function(){return Tz(r,(function(){return r.createVertexArray()}))},this.bindVertexArray=function(e){return Tz(r,(function(){return r.bindVertexArray(e)}))},this.deleteVertexArray=function(e){return Tz(r,(function(){return r.deleteVertexArray(e)}))},this.getVertexArray=function(){return Tz(r,(function(){return r.getParameter(r.VERTEX_ARRAY_BINDING)}))}}else if(null!=t){var a=t.getExtension("OES_vertex_array_object");if(null==a)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return Tz(t,(function(){return a.createVertexArrayOES()}))},this.bindVertexArray=function(e){return Tz(t,(function(){return a.bindVertexArrayOES(e)}))},this.deleteVertexArray=function(e){return Tz(t,(function(){return a.deleteVertexArrayOES(e)}))},this.getVertexArray=function(){return Tz(t,(function(){return t.getParameter(a.VERTEX_ARRAY_BINDING_OES)}))}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===hn().getNumber("WEBGL_VERSION")){var s="OES_texture_half_float";if(this.textureFloatExtension=Dz(this.gl,"OES_texture_float"),bB(this.gl,s))this.textureHalfFloatExtension=Dz(this.gl,s);else if(hn().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),bB(this.gl,o))this.colorBufferHalfFloatExtension=Dz(this.gl,o);else if(hn().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",bB(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else{if(!bB(this.gl,o))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(o)}this.vertexBuffer=iW(this.gl),this.indexBuffer=oW(this.gl),this.framebuffer=Xz(this.gl),this.textureConfig=Cz(this.gl,this.textureHalfFloatExtension)}return v(e,[{key:"debug",get:function(){return hn().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Tz(t,(function(){return t.finish()})),Tz(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Tz(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),Tz(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Tz(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Tz(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),cW(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),pW(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),fW(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),xW(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),bW(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),gW(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),mW(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(rB(this.gl,this.framebuffer),this.outputTexture=null),Tz(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return SW(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return IW(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return wW(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=kW(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(hn().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return _W(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=aW(n));var r,a=Wz(n);return Tz(n,(function(){return n.attachShader(a,t.vertexShader)})),Tz(n,(function(){return n.attachShader(a,e)})),Uz(n,a),r=Object.assign(a,{vao:this.createVertexArray()}),this.bindVertexArray(r.vao),Tz(n,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer)})),console.assert(yW(n,r,this.vertexBuffer),"gpgpu_util.bindVertexProgramAttributeStreams not fully successful."),this.debug&&Vz(n,r),this.setProgram(r),r}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&(Tz(this.gl,(function(){return t.gl.deleteProgram(e)})),this.deleteVertexArray(e.vao))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&(this.bindVertexArray(this.program.vao),this.debug&&Vz(this.gl,this.program)),Tz(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?Jz(this.gl,e,t):$z(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),Tz(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),eB(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=o(Nz(t,n),2),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&Vz(this.gl,this.program),aB(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Tz(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),Tz(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Dz(this.gl,2===hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=y(f().mark((function e(t){var n=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Hi.repeatedTry((function(){return n.disposed||n.isQueryAvailable(t,hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n,r=this;(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)||("setTimeoutCustom"in hn().platform&&(n=hn().platform.setTimeoutCustom.bind(hn().platform)),Hi.repeatedTry((function(){return r.pollItems(),0===r.itemsToPoll.length}),(function(){return 0}),null,n))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),nB(this.gl,e,this.framebuffer),this.debug&&aB(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(nB(this.gl,this.outputTexture,this.framebuffer),this.debug&&aB(this.gl)):rB(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;nB(r,e,this.framebuffer),this.debug&&aB(r),this.outputTexture=e,Tz(r,(function(){return r.viewport(0,0,t,n)})),Tz(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),Tz(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var CW=GR.addImpl,TW=GR.bincountImpl,EW=GR.bincountReduceImpl,AW=GR.castImpl,RW=GR.ceilImpl,FW=GR.concatImpl,DW=GR.equalImpl,MW=GR.expImpl,OW=GR.expm1Impl,PW=GR.floorImpl,LW=GR.gatherNdImpl,zW=GR.gatherV2Impl,BW=GR.greaterImpl,WW=GR.greaterEqualImpl,UW=GR.lessImpl,VW=GR.lessEqualImpl,jW=GR.linSpaceImpl,GW=GR.logImpl,HW=GR.maxImpl,qW=GR.maximumImpl,KW=GR.minimumImpl,XW=GR.multiplyImpl,YW=GR.negImpl,QW=GR.notEqualImpl,ZW=GR.prodImpl,JW=GR.raggedGatherImpl,$W=GR.raggedRangeImpl,eU=GR.raggedTensorToTensorImpl,tU=GR.rangeImpl,nU=GR.rsqrtImpl,rU=GR.scatterImpl,aU=GR.sigmoidImpl,iU=GR.simpleAbsImpl,oU=GR.sliceImpl,sU=GR.sparseFillEmptyRowsImpl,uU=GR.sparseReshapeImpl,cU=GR.sparseSegmentReductionImpl,lU=GR.sqrtImpl,pU=GR.stridedSliceImpl,dU=GR.stringNGramsImpl,fU=GR.stringSplitImpl,hU=GR.stringToHashBucketFastImpl,mU=GR.subImpl,vU=GR.tileImpl,gU=GR.topKImpl,yU=GR.transposeImpl,bU=GR.uniqueImpl;function xU(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function kU(e,t){return 1===t?[e]:xU(e,t)}var wU=function(){function e(t){if(h(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=YB(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=kU("rc",this.rank),r=jB(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return v(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);return 1===this.rank?"getA(rc), (rc + 1 >= ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]," ? 0. : getA(rc + 1)), 0, 0"):"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),SU=v((function e(t,n){h(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=YB(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(t?AB(["r","c","d"],"inputShape"):TB(["r","c","d"],e),"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":RB(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var IU=function(){function e(t){h(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return v(e,[{key:"acquireTexture",value:function(e,t,n){var r=NU(t,n),a=CU(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=_U(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===bz.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===bz.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===bz.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===bz.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===bz.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=NU(n,r),i=CU(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=_U(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=hn().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function _U(e,t,n,r,a){var i,s=function(e,t){switch(e){case bz.PACKED_2X2_FLOAT32:return hW(t);case bz.PACKED_2X2_FLOAT16:return vW(t);case bz.UNPACKED_FLOAT32:return uW(t);case bz.UNPACKED_FLOAT16:return lW(t);case bz.PACKED_4X1_UNSIGNED_BYTE:return dW(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var u=o(Nz(e[0],e[1]),2);i=u[0]*u[1]}else{var c=o(Iz(e[0],e[1]),2);i=c[0]*c[1]}var l=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F||t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,s);return i*l}function NU(e,t){if(e===yz.UPLOAD)return bz.PACKED_2X2_FLOAT32;if(e===yz.RENDER||null==e)return function(e){return hn().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?bz.PACKED_2X2_FLOAT32:bz.UNPACKED_FLOAT32:e?bz.PACKED_2X2_FLOAT16:bz.UNPACKED_FLOAT16}(t);if(e===yz.DOWNLOAD||e===yz.PIXELS)return bz.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function CU(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var TU=v((function e(t,n){h(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=YB(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),EU="if (isnan(x)) return x;",AU="return x;",RU="return abs(x);",FU="return (x >= 0.0) ? x : (exp(x) - 1.0);",DU=EU+"\n  return (x < 0.0) ? 0.0 : x;\n",MU=EU+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",OU="return x;",PU="return 1.0 / (1.0 + exp(-1.0 * x));",LU="return x;",zU="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",BU="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",WU="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",UU="return 1.0 / (1.0 + exp(-1.0 * x));",VU=v((function e(t,n){h(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=YB(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),jU=v((function e(t){h(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=YB(this.outputShape.length);var n=t.length,r=kU("rc",n),a=jB(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),GU=Lg.whereImpl,HU={};var qU=hn().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),KU=600;var XU=function(e){Ae(n,e);var t=Re(n);function n(e){var r,a;if(h(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!hn().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof NW)a=e;else{var i=Sz(hn().getNumber("WEBGL_VERSION"),e);a=new NW(i)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var o=Sz(hn().getNumber("WEBGL_VERSION"));a=new NW(o),r.binaryCache=function(e){return e in HU||(HU[e]={}),HU[e]}(hn().getNumber("WEBGL_VERSION")),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new IU(r.gpgpu),r.numMBBeforeWarning=null==hn().global.screen?1024:hn().global.screen.height*hn().global.screen.width*window.devicePixelRatio*KU/1024/1024,r.texData=new ht(Ie(r),Fu()),Ee(r)}return v(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"writeTexture",value:function(e,t,n,r,a,i){var o=this.makeTensorInfo(t,n),s=this.texData.get(o.dataId);s.isPacked=!1,s.texture={texture:e,texShape:[r,a]},s.texShape=[r,a];var u=lB(t),c=new tW(u,!1,i),l=this.runWebGLProgram(c,[o],n,[[r,a]]);return l.shape=t,s.texture=null,this.disposeIntermediateTensorInfo(o),l.dataId}},{key:"write",value:function(e,t,n){if((hn().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||hn().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:yz.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(hn().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:yz.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new VU(o,OU):new TU(o,OU);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var p,d,f=null!=this.activeTimers;if(f&&(p=Hi.now()),"complex64"===r){var h=this.readSync(a.real.dataId),m=this.readSync(a.imag.dataId);d=Rv.mergeRealAndImagArrays(h,m)}else d=this.getValuesFromTexture(e);return f&&(this.downloadWaitMs+=Hi.now()-p),this.convertAndCacheOnCPU(e,d)}},{key:"read",value:function(){var e=y(f().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,d,h,m,v,g,y,b,x,k,w,S,I,_;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=8;break}return l=c?new VU(i,OU):new TU(i,OU),p=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:s}],s),d=this.read(p.dataId),e.abrupt("return",(this.disposeIntermediateTensorInfo(p),d));case 8:if(null==a){e.next=10;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 10:if(!hn().getBool("DEBUG")||hn().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==hn().getNumber("WEBGL_VERSION")){e.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(h=null,"complex64"!==s&&hn().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),g=this.texData.get(m.dataId),h=(v=this.gpgpu).createBufferFromTexture.apply(v,[g.texture.texture].concat(Fe(_z(i))))),this.pendingRead.set(t,[]),e.t0="complex64"!==s,!e.t0){e.next=19;break}return e.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==s){e.next=28;break}return e.next=22,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 22:b=e.sent,x=b[0],k=b[1],y=Rv.mergeRealAndImagArrays(x,k),e.next=29;break;case 28:null==h?y=this.getValuesFromTexture(t):(w=Hi.sizeFromShape(i),y=this.gpgpu.downloadFloat32MatrixFromBuffer(h,w));case 29:return null!=m&&this.disposeIntermediateTensorInfo(m),null!=h&&Tz(S=this.gpgpu.gl,(function(){return S.deleteBuffer(h)})),I=this.convertAndCacheOnCPU(t,y),_=this.pendingRead.get(t),e.abrupt("return",(this.pendingRead.delete(t),_.forEach((function(e){return e(I)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&Fu().removeDataId(t,this),this.pendingDeletes--),I));case 32:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var c;c=s?new VU(a,OU):new TU(a,OU);var l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),p=this.readToGPU(l,t);return this.disposeIntermediateTensorInfo(l),p}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var d=this.decode(e,t.customTexShape),f=Fu().makeTensorFromTensorInfo(d),h=this.texData.get(d.dataId);return Object.assign({tensorRef:f},h.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return Hi.decodeString(e)}));return Su(e.shape,e.dtype,n)}catch(n){throw new Error("Failed to decode encoded string bytes into utf-8")}return Su(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!Rz(n))throw hn().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'")):Error("The value ".concat(n," cannot be represented on this device."))}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=Hi.sizeFromShape(n);if(hn().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat(Fe(_z(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=hn().getBool("WEBGL_PACK")&&!0===a,p=l?lB(n):n,d=l?new $B(p):new JB(p),f=this.runWebGLProgram(d,[{shape:p,dtype:r,dataId:e}],"float32"),h=this.texData.get(f.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(h.texture.texture,h.texShape[0],h.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(f),m}},{key:"timerAvailable",value:function(){return hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=Hi.flatten(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=Hi.flatten(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return y(f().mark((function e(){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=7;break}return e.next=3,Promise.all(i);case 3:n=e.sent,s.kernelMs=Hi.sum(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=8;break;case 7:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 8:return e.abrupt("return",(t.uploadWaitMs=0,t.downloadWaitMs=0,s));case 9:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Hi.now(),endMs:null}}},{key:"endTimer",value:function(e){return hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Hi.now(),e)}},{key:"getQueryTime",value:function(){var e=y(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(hn().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e).complexTensorInfos;return null!=n&&(this.disposeData(n.real.dataId,t),this.disposeData(n.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qU;return hn().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&Hi.sizeFromShape(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){Rv.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return GU(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new VU(e.shape,t),a=this.compileAndRun(r,[e],n);return Fu().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=iU(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(hn().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,RU,e.dtype);var n=new TU(e.shape,RU),r=this.compileAndRun(n,[e]);return Fu().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Hi.isString(n[0])){var a=n.map((function(e){return Hi.encodeString(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return Fu().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new jU(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new wU(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[uB(e.shape)].concat(Fe(cB(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[uB(t)].concat(Fe(cB(t))),i=new SU(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;if(null!=t){var o=Hi.sizeFromShape(a),s=t[0]*t[1]*4;Hi.assert(o<=s,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}))}var u,c=lB(a);u=r?new ZB(c):new QB(c);var l=[null!=t?t:_z(c)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(u,[{shape:c,dtype:i,dataId:e}],i,l,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===gz.DENSE){var c=null!=o?o:_z(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===Hi.sizeFromShape(s.shape))return u.values=Hi.getTypedArrayFromDType(s.dtype,0),s;var l=[],p=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Hi.sizeFromShape(t.shape)<=hn().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!fB(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var d,f={shape:s.shape,texData:u,isUniform:!1},h=function(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=GB(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,c=o.keptDims,l="",p="",d="";if(1===u.length&&e.packedInputs){var f=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];l="".concat(f[0]>1,"_").concat(f[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var h=Hi.computeStrides(u);d="".concat(h[0]===i[1],"_").concat(h[h.length-1]===i[1])}}else p="".concat(u[0]>1,"_").concat(u[1]>1);var m=t.shape.length,v=2===u.length&&Hi.arraysEqual(t.shape,i),g=1===Hi.sizeFromShape(t.shape),y=Rv.getBroadcastDims(t.shape,n.shape),b=!e.packedInputs&&m===n.shape.length&&Hi.arraysEqual(i,n.texData.texShape),x=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(m,"_").concat(b,"_").concat(s?c:"","_").concat(u.length,"_").concat(g,"_").concat(y,"_").concat(v,"_").concat(l,"_").concat(p,"_").concat(d,"_").concat(x,"_").concat(a)}else{var k=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(k,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+"_"+r+"_"+a+"".concat(hn().getNumber("WEBGL_VERSION"))}(e,p,f),m=this.getAndSaveBinary(h,(function(){return function(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=MB(a,o,t),u=Oz(e.gl,s),c=e.createProgram(u);return hn().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},KB(e,t,c))}(a.gpgpu,e,p,f)})),v=null!=this.activeTimers;v&&(d=this.startTimer()),hn().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(XB(t.inShapeInfos,n),XB([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),1===hn().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset".concat(a)],s=t.inShapesLocations["".concat(a,"Shape")],u=t.inTexShapesLocations["".concat(a,"TexShape")];if(s){var c=GB(t.program.packedInputs,n.shape,n.texData.texShape).uniformShape;switch(c.length){case 1:e.gl.uniform1iv(s,new Int32Array(c));break;case 2:e.gl.uniform2iv(s,new Int32Array(c));break;case 3:e.gl.uniform3iv(s,new Int32Array(c));break;case 4:e.gl.uniform4iv(s,new Int32Array(c))}}if(u&&e.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=i){if(n.isUniform){if(Hi.sizeFromShape(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var l=n.uniformValues;l instanceof Float32Array||(l=new Float32Array(l)),e.gl.uniform1fv(i,l)}return}null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,i,r)}}));var s=t.outShapeLocation;if(s)switch(r.shape.length){case 1:e.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(s,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var u=Hi.computeStrides(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a&&t.program.customUniforms.forEach((function(n,r){var i=t.customUniformLocations[r],o=a[r];if("float"===n.type)e.gl.uniform1fv(i,o);else if("vec2"===n.type)e.gl.uniform2fv(i,o);else if("vec3"===n.type)e.gl.uniform3fv(i,o);else if("vec4"===n.type)e.gl.uniform4fv(i,o);else if("int"===n.type)e.gl.uniform1iv(i,o);else if("ivec2"===n.type)e.gl.uniform2iv(i,o);else if("ivec3"===n.type)e.gl.uniform3iv(i,o);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(i,o)}})),e.executeProgram()}(this.gpgpu,m,p,f,r),l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),v&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)}));var g=hn().get("WEBGL_FLUSH_THRESHOLD");if(g>0){var y=Hi.now();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!hn().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(hn().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Ou((function(){if(!hn().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=hn().getBool("DEBUG");hn().set("DEBUG",!1);var n=e.abs(Pl(1e-8)).dataSync()[0];if(hn().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,s=t.usage,u=t.isPacked;if(null==i){var c,l=null!=this.activeTimers;l&&(c=Hi.now());var p=t.texShape;if(null==p&&(p=pB(n,u),t.texShape=p),null!=a){var d,f,h=lB(n),m=p[1],v=p[0],g=a instanceof Uint8Array||a instanceof Uint8ClampedArray;(u||!g)&&(m=(d=o(Nz(p[0],p[1]),2))[0],v=d[1]),f=u?new nW(h,g):new tW(h,g);var y=g?[v,m]:p,b=this.makeTensorInfo(y,r),x=this.texData.get(b.dataId);x.usage=g?yz.PIXELS:yz.UPLOAD,x.texShape=y,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),m,v,a);var k=[[v,m]],w=this.runWebGLProgram(f,[b],r,k,!0),S=this.texData.get(w.dataId);t.texShape=S.texShape,t.isPacked=S.isPacked,t.usage=S.usage,hn().get("ENGINE_COMPILE_ONLY")?this.disposeData(w.dataId):(t.texture=S.texture,t.values=null,this.texData.delete(w.dataId)),this.disposeIntermediateTensorInfo(b),l&&(this.uploadWaitMs+=Hi.now()-c)}else{var I=this.acquireTexture(p,s,r,u);t.texture=I}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*Hi.bytesPerElement(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=o(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i,s,u,c,l=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=o(r[n],2),i=a[1],t.push(this.checkCompletionAsync_(i));return e.abrupt("return",Promise.all(t));case 6:s=f().mark((function e(){var n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=o(c[u],2),r=n[1],a=new Promise((function(e){try{l.checkCompletion_(r),e(!0)}catch(k){throw k}})),t.push(a);case 3:case"end":return e.stop()}}),e)})),u=0,c=Object.entries(this.binaryCache);case 8:if(!(u<c.length)){e.next=13;break}return e.delegateYield(s(),"t0",10);case 10:u++,e.next=8;break;case 13:return e.abrupt("return",Promise.all(t));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}e.t0=this.checkCompletion_(t),e.next=7;break;case 4:return e.next=6,Ev();case 6:e.t0=this.checkCompletionAsync_(t);case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS))throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)?(Bz(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=o(t[e],2)[1],r=KB(this.gpgpu,n.program,n.webGLProgram),a=r.uniformLocations,i=r.customUniformLocations,s=r.infLoc,u=r.nanLoc,c=r.inShapesLocations,l=r.inTexShapesLocations,p=r.outShapeLocation,d=r.outShapeStridesLocation,f=r.outTexShapeLocation;n.uniformLocations=a,n.customUniformLocations=i,n.infLoc=s,n.nanLoc=u,n.inShapesLocations=c,n.inTexShapesLocations=l,n.outShapeLocation=p,n.outShapeStridesLocation=d,n.outTexShapeLocation=f}}},{key:"createTensorFromGPUData",value:function(e,t,n){e.channels=e.channels||"RGBA";var r=e.texture,a=e.height,i=e.width,o=e.channels,s=Fu().backend;if(!s.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var u=s.writeTexture(r,t,n,a,i,o);return Fu().makeTensorFromDataId(u,t,n,s)}}]),n}(mt);XU.nextDataId=0;var YU="4.2.0";function QU(){hn().set("WEBGL_FORCE_F16_TEXTURES",!0)}Jo.isBrowser()&&Hu("webgl",(function(){return new XU}),2);var ZU={forceHalfFloat:QU},JU="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",$U=v((function e(t,n,r){h(this,e),this.variableNames=["A","B"],this.outputShape=Rv.assertAndGetBroadcastShape(n,r),this.enableShapeUniforms=YB(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),eV="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n",tV=v((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];h(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Rv.assertAndGetBroadcastShape(n,r);var i=this.outputShape.length;this.enableShapeUniforms=YB(i);var o="";if(a)if(0===i||1===Hi.sizeFromShape(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          ".concat(jB(i)," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var s=kU("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(s[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(s[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function nV(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var rV={kernelName:Dr,backendName:"webgl",kernelFunc:nV};function aV(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=nV({inputs:{x:r},backend:n}),u=nV({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var iV={kernelName:Hn,backendName:"webgl",kernelFunc:aV},oV="return (a < 0.) ? b * a : a;",sV="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var uV={kernelName:Br,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",Hi.createScalarValue(i,"float32")),s=hn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new tV(sV,a.shape,o.shape):new $U(oV,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},cV="return (a < 0.) ? b * a : a;",lV="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var pV={kernelName:Ia,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=hn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new tV(lV,r.shape,a.shape):new $U(cV,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}},dV="if (isnan(x)) return x;";function fV(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var p=c.texData.get(u.dataId),d=r(p.values,l);return c.makeTensorInfo(u.shape,l,d)}return i=hn().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new VU(u.shape,n):new TU(u.shape,t),c.runWebGLProgram(i,[u],l)}}function hV(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,s=void 0!==i&&i,u=e.cpuKernelImpl,c=e.dtype;return function(e){var r=e.inputs,i=e.backend,l=r.a,p=r.b,d=i;if(s&&"complex64"===l.dtype){var f=d.texData.get(l.dataId),h=d.texData.get(p.dataId),m=[[f.complexTensorInfos.real,h.complexTensorInfos.real],[f.complexTensorInfos.imag,h.complexTensorInfos.imag]].map((function(e){var n=o(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:l.shape},s={dataId:a.dataId,dtype:a.dtype,shape:p.shape},u=new $U(t,l.shape,p.shape);return d.runWebGLProgram(u,[i,s],zo(r.dtype,a.dtype))})),v=o(m,2),g=v[0],y=v[1],b=aV({inputs:{real:g,imag:y},backend:d});return d.disposeIntermediateTensorInfo(g),d.disposeIntermediateTensorInfo(y),b}var x,k=c||zo(l.dtype,p.dtype);if(("string"===l.dtype||"string"===p.dtype||d.shouldExecuteOnCPU([l,p]))&&null!=u){var w=d.texData.get(l.dataId).values,S=d.texData.get(p.dataId).values,I="string"===l.dtype?Rv.fromUint8ToStringArray(w):w,_="string"===l.dtype?Rv.fromUint8ToStringArray(S):S,N=o(u(l.shape,p.shape,I,_,k),2),C=N[0],T=N[1],E=d.makeTensorInfo(T,k);return d.texData.get(E.dataId).values=C,E}return x=hn().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new tV(n,l.shape,p.shape,a):new $U(t,l.shape,p.shape),d.runWebGLProgram(x,[l,p],k)}}function mV(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?LU:AU;if("relu"===e)return t?BU:DU;if("elu"===e)return t?zU:FU;if("relu6"===e)return t?WU:MU;if("prelu"===e)return t?lV:cV;if("leakyrelu"===e)return t?sV:oV;if("sigmoid"===e)return t?UU:PU;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var vV=v((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];h(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=YB(this.outputShape.length);var l=a?t[1]:t[2],p=Math.ceil(l/2),d=a?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",m=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",y="";s&&(g=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),y="result = activation(result);");var b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var x="rc.x",k="rc.x";t[0]<n[0]?x="imod(rc.x, ".concat(t[0],")"):n[0]<t[0]&&(k="imod(rc.x, ".concat(n[0],")")),this.userCode="\n      ".concat(g,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(p,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        int batchA = ").concat(x,";\n        int batchB = ").concat(k,";\n        for (int i = 0; i < ").concat(p,"; i++) {\n          vec4 a = getMatrixA(batchA, ").concat(d,");\n          vec4 b = getMatrixB(batchB, ").concat(f,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(m[0]," * ").concat(v[0],");\n          result += (").concat(m[1]," * ").concat(v[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(b,"\n\n        ").concat(y,"\n\n        setOutput(result);\n      }\n    ")})),gV={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},yV=v((function e(t,n,r){h(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Rv.assertAndGetBroadcastShape(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),bV="return a * b;";function xV(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,s=Rv.upcastType(a.dtype,i.dtype);if("complex64"===a.dtype){var u=r.texData.get(a.dataId),c=r.texData.get(i.dataId),l=new yV(gV.REAL,a.shape,i.shape),p=new yV(gV.IMAG,a.shape,i.shape),d=[{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:a.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:i.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:i.shape}],f=r.runWebGLProgram(l,d,"float32"),h=r.runWebGLProgram(p,d,"float32"),m=aV({inputs:{real:f,imag:h},backend:r});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(h),m}if(r.shouldExecuteOnCPU([a,i])){var v=r.texData.get(a.dataId),g=r.texData.get(i.dataId),y=o(XW(a.shape,i.shape,v.values,g.values,s),2),b=y[0],x=y[1],k=r.makeTensorInfo(x,s);return r.texData.get(k.dataId).values=b,k}return t=hn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new tV(bV,a.shape,i.shape):new $U(bV,a.shape,i.shape),r.runWebGLProgram(t,[a,i],s)}var kV={kernelName:da,backendName:"webgl",kernelFunc:xV};function wV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=Hi.sizeFromShape(a.shape),u=Hi.inferFromImplicitShape(i,s),c=Hi.sizeFromShape(u);Hi.assert(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old shape (").concat(a.shape,") has ").concat(s," elements. The new shape and old shape must have the same number of elements.")}));var l=o.texData.get(a.dataId);return!l.isPacked||fB(a.shape,u)||null!==l.texture&&fB(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[uB(e.shape)].concat(Fe(cB(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[uB(t)].concat(Fe(cB(t))),o=new SU(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var SV={kernelName:Da,backendName:"webgl",kernelFunc:wV},IV=v((function e(t,n){h(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(Hi.isInt(l)?l.toPrecision(2):l,", ones);")}var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),_V=v((function e(t,n){h(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),p=r%4,d="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),f="vec4";"all"===n?(s="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(s="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var m="";i%r>0&&(m="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(m,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(d,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===p,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(2===p,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(3===p,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(d,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function NV(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=Rv.computeOptimalWindowSize(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,p=u.outSize,d=void 0;d="mean"===n?0===o?new IV({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},c):new IV({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p}):new _V({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:p},n),s=i,i=r.runWebGLProgram(d,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var CV=v((function e(t,n){h(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=jB(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var TV=v((function e(t,n){h(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=jB(this.rank),o=xU("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),p="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(p,";\n      if(").concat(l,") {\n        result[1] = ").concat(p,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(p,";\n        if(").concat(l,") {\n          result[3] = ").concat(p,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function EV(e,t,n){var r=hn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new TV(e.shape,t):new CV(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function AV(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,s=Hi.parseAxisParam(a,e.shape),u=s,c=Rv.getAxesPermutation(u,i),l=null!=c,p=e;l&&(p=EV(e,c,r),u=Rv.getInnerMostAxes(u.length,i)),Rv.assertAxesAreInnerMostDims("sum",u,i);var d=o(Rv.computeOutAndReduceShapes(p.shape,u),2),f=d[0],h=d[1],m=f;n&&(m=Rv.expandShapeToKeepDim(f,s));var v=Hi.sizeFromShape(h),g=wV({inputs:{x:p},attrs:{shape:[Hi.sizeFromShape(e.shape)/v,v]},backend:r}),y=NV(g,Bo(e.dtype),"sum",r),b=wV({inputs:{x:y},attrs:{shape:m},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(y),l&&r.disposeIntermediateTensorInfo(p),b}(t.x,r.axis,r.keepDims,n)}var RV={kernelName:$a,backendName:"webgl",kernelFunc:AV};function FV(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var p=s.texData.get(i.dataId).values,d=yU(p,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=d}else t=EV(i,o,s);return t}var DV={kernelName:xi,backendName:"webgl",kernelFunc:FV},MV=1e3;function OV(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,d=e.activation,f=void 0===d?null:d,h=t.shape.length,m=n.shape.length,v=r?t.shape[h-2]:t.shape[h-1],g=a?n.shape[m-1]:n.shape[m-2],y=r?t.shape[h-1]:t.shape[h-2],b=a?n.shape[m-2]:n.shape[m-1],x=t.shape.slice(0,-2),k=n.shape.slice(0,-2),w=Hi.sizeFromShape(x),S=Hi.sizeFromShape(k),I=fl.assertAndGetBroadcastShape(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);Hi.assert(v===g,(function(){return"Error in matMul: inner shapes (".concat(v,") and (").concat(g,") of Tensors with shapes ").concat(t.shape," and ").concat(n.shape," and transposeA=").concat(r," and transposeB=").concat(a," must match.")}));var _,N=r?[w,v,y]:[w,y,v],C=a?[S,b,g]:[S,g,b],T=wV({inputs:{x:t},backend:i,attrs:{shape:N}}),E=wV({inputs:{x:n},backend:i,attrs:{shape:C}}),A=[T,E],R=Math.max(w,S),F=r?T.shape[1]:T.shape[2],D=null!=s,M=null!=c,O="leakyrelu"===f,P=null!=f?mV(f,!0):null;if((1===y||1===b)&&F>MV&&!1===(D||M||O||null!=P)){var L=T,z=E;r&&(L=FV({inputs:{x:T},backend:i,attrs:{perm:[0,2,1]}}),A.push(L)),a&&(z=FV({inputs:{x:E},backend:i,attrs:{perm:[0,2,1]}}),A.push(z));var B=1===b,W=L;1!==b&&(W=wV({inputs:{x:L},backend:i,attrs:{shape:[R,F,1]}}),A.push(W));var U=1===b?2:1,V=z;B&&(V=wV({inputs:{x:z},backend:i,attrs:{shape:[R,1,F]}}),A.push(V));var j=xV({inputs:{a:W,b:V},backend:i});_=AV({inputs:{x:j},backend:i,attrs:{axis:U,keepDims:!0}}),A.push(j)}else{var G=zo(t.dtype,n.dtype),H=new vV(N,C,[R,y,b],r,a,D,P,M,O),q=[T,E];if(null!=s&&q.push(s),M&&q.push(c),O){var K=i.makeTensorInfo([],"float32",Hi.createScalarValue(p,"float32"));q.push(K),A.push(K)}_=i.runWebGLProgram(H,q,G)}var X=wV({inputs:{x:_},backend:i,attrs:{shape:I}});A.push(_);for(var Y=0,Q=A;Y<Q.length;Y++){var Z=Q[Y];i.disposeIntermediateTensorInfo(Z)}return X}var PV={kernelName:Ei,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return OV({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},LV="return abs(x);";var zV={kernelName:bn,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=iU(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=hn().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new VU(a.shape,LV):new TU(a.shape,LV),r.runWebGLProgram(t,[a],a.dtype)}},BV=fV({opSnippet:EU+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),WV={kernelName:xn,backendName:"webgl",kernelFunc:BV},UV=fV({opSnippet:EU+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),VV={kernelName:kn,backendName:"webgl",kernelFunc:UV},jV="return a + b;",GV=hV({opSnippet:jV,packedOpSnippet:jV,supportsComplex:!0,cpuKernelImpl:CW}),HV={kernelName:wn,backendName:"webgl",kernelFunc:GV},qV=v((function e(t,n){h(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),KV=v((function e(t,n){h(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var XV={kernelName:Sn,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return nV({inputs:{x:a[0]},backend:r});if(a.length>hn().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return zo(e,t)})),c=a.map((function(e){return e.shape})),l=hn().getBool("WEBGL_PACK")?new KV(a[0].shape,c):new qV(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var YV={kernelName:In,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,s=r.keepDims,u=a.shape.length,c=Hi.parseAxisParam(i,a.shape),l=c,p=Rv.getAxesPermutation(l,u),d=a;null!=p&&(d=FV({inputs:{x:a},backend:n,attrs:{perm:p}}),l=Rv.getInnerMostAxes(l.length,u)),Rv.assertAxesAreInnerMostDims("all",l,u);var f,h=o(Rv.computeOutAndReduceShapes(d.shape,l),2),m=h[0],v=h[1],g=wV({inputs:{x:d},backend:n,attrs:{shape:[-1,Hi.sizeFromShape(v)]}}),y=NV(g,g.dtype,"all",n);return f=wV(s?{inputs:{x:y},backend:n,attrs:{shape:Rv.expandShapeToKeepDim(m,c)}}:{inputs:{x:y},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),null!=p&&n.disposeIntermediateTensorInfo(d),f}};var QV={kernelName:_n,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,s=r.keepDims,u=a.shape.length,c=Hi.parseAxisParam(i,a.shape),l=c,p=Rv.getAxesPermutation(l,u),d=a;null!=p&&(d=FV({inputs:{x:a},backend:n,attrs:{perm:p}}),l=Rv.getInnerMostAxes(l.length,u)),Rv.assertAxesAreInnerMostDims("any",l,u);var f,h=o(Rv.computeOutAndReduceShapes(d.shape,l),2),m=h[0],v=h[1],g=wV({inputs:{x:d},backend:n,attrs:{shape:[-1,Hi.sizeFromShape(v)]}}),y=NV(g,g.dtype,"any",n);return f=wV(s?{inputs:{x:y},backend:n,attrs:{shape:Rv.expandShapeToKeepDim(m,c)}}:{inputs:{x:y},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),null!=p&&n.disposeIntermediateTensorInfo(d),f}},ZV=v((function e(t,n,r){h(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),JV=v((function e(t,n,r,a){h(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Hi.assert(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,p=jB(l),d=kU("coords",l);if(1===o){var f=jB(u=l+1);s="\n        ".concat(f," sourceLocR = ").concat(f,"(").concat(d.join(),", 0);\n        ++").concat(d[l-1],";\n        ").concat(f," sourceLocG = ").concat(f,"(").concat(d.join(),", 0);\n        ++").concat(d[l-2],";\n        ").concat(f," sourceLocA = ").concat(f,"(").concat(d.join(),", 0);\n        --").concat(d[l-1],";\n        ").concat(f," sourceLocB = ").concat(f,"(").concat(d.join(),", 0);\n        --").concat(d[l-2],";")}else u=l,s="\n        ".concat(p," sourceLocR = coords;\n        ++").concat(d[l-1],";\n        ").concat(p," sourceLocG = coords;\n        ++").concat(d[l-2],";\n        ").concat(p," sourceLocA = coords;\n        --").concat(d[l-1],";\n        ").concat(p," sourceLocB = coords;\n        --").concat(d[l-2],";");var m=["x","y","z","w","u","v"].slice(0,u),v="."+m[u-1],g=m.map((function(e){return"int "+e})),y=kU("sourceLocR",u-1).concat("inIdx.r"),b=kU("sourceLocG",u-1).concat("inIdx.g"),x=kU("sourceLocB",u-1).concat("inIdx.b"),k=kU("sourceLocA",u-1).concat("inIdx.a"),w="max"===r?"greaterThan":"lessThan",S=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),"),\n                             getBestIndicesAChannel(").concat(k.join(),")));"),I="vec4(\n            getAChannel(".concat(y.join(),"),\n            hasNextCol ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(x.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(k.join(),") : 0.)"),_=a?"":"\n      float getBestIndicesAChannel(".concat(g.join(),") {\n        return getChannel(getBestIndicesA(").concat(m.join(),"),\n                                          vec2(").concat(m.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(g.join(),") {\n        return getChannel(getA(").concat(m.join(),"),\n                               vec2(").concat(m.slice(-2).join(),"));\n      }\n      ").concat(_,"\n      void main() {\n        ").concat(p," coords = getOutputCoords();\n        bool hasNextCol = ").concat(d[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(d[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(v,", sourceLocG").concat(v,",\n          sourceLocB").concat(v,", sourceLocA").concat(v,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(I,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(S,"\n          vec4 candidate = ").concat(I,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(w,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function $V(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=Rv.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new ZV(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var p=$V(e,t,n,l);return e.disposeIntermediateTensorInfo(l),p}function ej(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=a[a.length-1],o=Rv.computeOptimalWindowSize(i),s=new JV(a,o,n,null==r),u=null==r?[t]:[t,r],c=e.runWebGLProgram(s,u,"int32");if(c.shape.length===t.shape.length){var l=ej(e,t,n,c);return e.disposeIntermediateTensorInfo(c),l}return c}function tj(e,t,n,r){var a=[n];if(Rv.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!hn().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],s=e.texData.get(t.dataId),u=t;null!==s&&s.isPacked&&(u=e.unpackTensor(t),i.push(u));var c=o(Rv.computeOutAndReduceShapes(u.shape,a),2),l=c[0],p=c[1],d=Hi.sizeFromShape(p),f=wV({inputs:{x:u},backend:e,attrs:{shape:[-1,d]}});i.push(f);var h=$V(e,f,r);i.push(h);var m=wV({inputs:{x:h},backend:e,attrs:{shape:l}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),m}return ej(e,t,r)}var nj={kernelName:Nn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=Hi.parseAxisParam(i,a.shape),s=Rv.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=FV({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=Rv.getInnerMostAxes(o.length,u.shape.length)),Rv.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=tj(n,u,o[0],"max");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}};var rj={kernelName:Cn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=Hi.parseAxisParam(i,a.shape),s=Rv.getAxesPermutation(o,a.shape.length),u=a,c=[];null!=s&&(u=FV({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=Rv.getInnerMostAxes(o.length,u.shape.length)),Rv.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=tj(n,u,o[0],"min");return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),l}},aj=fV({opSnippet:EU+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),ij={kernelName:Tn,backendName:"webgl",kernelFunc:aj},oj=fV({opSnippet:EU+"return log(x + sqrt(x * x + 1.0));"}),sj={kernelName:En,backendName:"webgl",kernelFunc:oj},uj=fV({opSnippet:EU+"\n  return atan(x);\n"}),cj={kernelName:An,backendName:"webgl",kernelFunc:uj},lj=hV({opSnippet:JU+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+eV+"\n  return result;\n"}),pj={kernelName:Fn,backendName:"webgl",kernelFunc:lj},dj=fV({opSnippet:EU+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),fj={kernelName:Rn,backendName:"webgl",kernelFunc:dj},hj=v((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(h(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=t.padInfo.top,m=t.padInfo.left;this.outputShape=t.outShape;var v="avg"===n,g="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),b="0.0";if(v||(b="-1.0 / 1e-20"),r){this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(f,", ").concat(m,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(p,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(">="," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?g:y:"wR * ".concat(d," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var x="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(x="avgValue / max(count, 1.0)");var k=4*Math.floor(o/4),w=o%4,S="\n      if (".concat(v,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(f,", ").concat(m,");\n      const float initializationValue = ").concat(b,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(b,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(k,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(S,"\n          }\n\n          int xC = xCCorner + ").concat(k,";\n          if (").concat(1===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(2===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(3===w,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(S,"\n          }\n        }\n        setOutput(").concat(x,");\n      }\n    ")}})),mj=v((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(h(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,p=t.dilationHeight,d=t.dilationWidth,f=t.effectiveFilterDepth,m=t.effectiveFilterHeight,v=t.effectiveFilterWidth,g=t.padInfo.front,y=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;var x="avg"===n,k="0.0";if(x||(k="-1.0 / 1e-20"),r){this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(g,", ").concat(y,", ").concat(b,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(f,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(m,";\n                wR += ").concat(p,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(v,";\n                  wC += ").concat(d,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(">="," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(m," * ").concat(v," +\n                      wR * ").concat(v," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(w="avgValue / max(count, 1.0)");var S=4*Math.floor(o/4),I=o%4,_="\n      if (".concat(x,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat("max","(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(g,", ").concat(y,", ").concat(b,");\n      const float initializationValue = ").concat(k,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(k,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(f,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(m,";\n            wR += ").concat(p,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(S,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(d,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(d,", ch)\n              );\n\n              ").concat(_,"\n            }\n\n            int xC = xCCorner + ").concat(S,";\n            if (").concat(1===I,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(2===I,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(3===I,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                initializationValue\n              );\n\n              ").concat(_,"\n            }\n          }\n        }\n        setOutput(").concat(w,");\n      }\n    ")}}));var vj={kernelName:Dn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;_B(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Hi.assert(Rv.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Rv.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Hi.arraysEqual(c.inShape,c.outShape))return nV({inputs:{x:a},backend:n});var l=new hj(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var gj={kernelName:On,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Rv.computePool3DInfo(a.shape,i,o,[1,1,1],s,u,c),p=new mj(l,"avg",!1);return n.runWebGLProgram(p,[a],"float32")}},yj=v((function e(t){h(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,p=c-1-t.padInfo.left,d=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(p,");\n      const float avgMultiplier = float(").concat(d,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),bj=v((function e(t){h(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,m=p-1-t.padInfo.front,v=d-1-t.padInfo.top,g=f-1-t.padInfo.left,y=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(m,", ").concat(v,", ").concat(g,");\n      const float avgMultiplier = float(").concat(y,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(p,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(d,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var xj={kernelName:Pn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Rv.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),p=new bj(l);return n.runWebGLProgram(p,[a],i.dtype)}};var kj={kernelName:Mn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;_B([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=Rv.computePool2DInfo(o.shape,s,u,1,c),p=new yj(l);return n.runWebGLProgram(p,[a],o.dtype)}};var wj={kernelName:Ln,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return OV({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},Sj=v((function e(t,n,r,a,i,o){h(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],Rv.assertAndGetBroadcastShape(t,n),Rv.assertAndGetBroadcastShape(t,r);var s="0.0";null!=a&&(Rv.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(Rv.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),Ij=v((function e(t,n,r,a,i,o){h(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Rv.assertAndGetBroadcastShape(t,n),Rv.assertAndGetBroadcastShape(t,r);var s="vec4(0.0)";null!=a&&(Rv.assertAndGetBroadcastShape(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(Rv.assertAndGetBroadcastShape(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),_j={kernelName:Tr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;Hi.assert(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Hi.assert(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Hi.assert(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],p=null;null!=s&&(p=s.shape,l.push(s));var d=null;null!=u&&(d=u.shape,l.push(u));var f=hn().getBool("WEBGL_PACK_NORMALIZATION")?new Ij(a.shape,i.shape,o.shape,p,d,c):new Sj(a.shape,i.shape,o.shape,p,d,c);return n.runWebGLProgram(f,l,l[0].dtype)}},Nj=v((function e(t){h(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=jB(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return Cj.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(Cj[t]," = start[").concat(t,"] + coords.").concat(Cj[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),Cj=["x","y","z","w","u","v"];var Tj=v((function e(t){h(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=jB(this.rank),r=kU("coords",this.rank),a=kU("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function Ej(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,s=r.size,u=o(iv.parseSliceParams(a,i,s),2),c=u[0],l=u[1];if(iv.assertParamsValid(a,c,l),0===Hi.sizeFromShape(l))return n.makeTensorInfo(l,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var p=n.texData.get(a.dataId),d=oU(p.values,c,l,a.shape,a.dtype);return n.makeTensorInfo(l,a.dtype,d)}var f=n.texData.get(a.dataId).isPacked,h=iv.isSliceContinous(a.shape,c,l);if(f||!h){var m=hn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Tj(l):new Nj(l),v=[c];return n.runWebGLProgram(m,[a],a.dtype,v)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=iv.computeFlatOffset(t,Hi.computeStrides(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,c,l,n)}var Aj={kernelName:qa,backendName:"webgl",kernelFunc:Ej},Rj={kernelName:zn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;Hi.assert(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=Rv.getReshaped(a.shape,i,s),c=Rv.getPermuted(u.length,i.length),l=Rv.getReshapedPermuted(a.shape,i,s),p=Rv.getSliceBeginCoords(o,i.length),d=Rv.getSliceSize(l,o,i.length),f=[],h=wV({inputs:{x:a},backend:n,attrs:{shape:u}}),m=FV({inputs:{x:h},backend:n,attrs:{perm:c}}),v=wV({inputs:{x:m},backend:n,attrs:{shape:l}}),g=Ej({inputs:{x:v},backend:n,attrs:{begin:p,size:d}});return f.push(h),f.push(m),f.push(v),f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var Fj={kernelName:Bn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=TW(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var Dj={kernelName:Un,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=Rv.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},Mj=hV({opSnippet:"return float(a != b);",cpuKernelImpl:QW,dtype:"bool"}),Oj={kernelName:ha,backendName:"webgl",kernelFunc:Mj};function Pj(e){var t=e.inputs,n=e.backend,r=t.input;return nV({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var Lj={kernelName:Aa,backendName:"webgl",kernelFunc:Pj},zj="return float(int(x));";var Bj={kernelName:Vn,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,s=a.dtype;if("complex64"===s){if("complex64"===i.dtype)return nV({inputs:{x:i},backend:r});var u=Mp(i.shape),c=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),l=aV({inputs:{real:c,imag:u},backend:r});return u.dispose(),r.disposeIntermediateTensorInfo(c),l}if("complex64"===i.dtype){var p=Pj({inputs:{input:i},backend:r}),d=e({inputs:{x:p},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(p),d}if(!Hi.hasEncodingLoss(i.dtype,s)){var f=nV({inputs:{x:i},backend:r});return{dataId:f.dataId,shape:f.shape,dtype:s}}if(r.shouldExecuteOnCPU([i])){var h=r.texData.get(i.dataId).values,m=o(AW(h,i.shape,i.dtype,s),3),v=m[0],g=m[1],y=m[2];return r.makeTensorInfo(v,g,y)}if("int32"===s)return function(e,t){var n=new TU(e.shape,zj),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===s){var b=r.makeTensorInfo([],"bool",Hi.getTypedArrayFromDType("bool",1)),x=Mj({inputs:{a:i,b:b},backend:r});return r.disposeIntermediateTensorInfo(b),x}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(s))}},Wj="return ceil(x);",Uj=fV({opSnippet:Wj,packedOpSnippet:Wj,cpuKernelImpl:RW}),Vj={kernelName:jn,backendName:"webgl",kernelFunc:Uj},jj=v((function e(t){h(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),Gj=v((function e(t){h(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}));var Hj={kernelName:Gn,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=hn().getBool("WEBGL_PACK_CLIP")?new Gj(i.shape):new jj(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},qj=v((function e(t){h(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function Kj(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var Xj={kernelName:qn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new qj(r.shape),o=[Kj(r,a.complexTensorInfos.real),Kj(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},Yj=v((function e(t){h(this,e),this.outputShape=[],this.outputShape=Rv.computeOutShape(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") setOutput(getT").concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),Qj=v((function e(t,n){h(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Rv.computeOutShape(t,n);var r=this.outputShape,a=r.length,i=jB(a),o=kU("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],p=s.slice(-2),d=s.join(),f="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(d,"), vec2(").concat(p.join(),"));\n        }"),m=1;m<u.length;m++){var v=u[m-1];f+="\n        if (".concat(l," < ").concat(u[m],"  && ").concat(l," >= ").concat(u[m-1],") {\n          return getChannel(\n            getT").concat(m,"(").concat(Zj(s,l,v),"),\n            vec2(").concat(Zj(p,l,v),"));\n        }")}var g=u.length,y=u[u.length-1];f+="\n        return getChannel(\n          getT".concat(g,"(").concat(Zj(s,l,y),"),\n          vec2(").concat(Zj(p,l,y),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(f,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function Zj(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function Jj(e){var t=e.inputs,n=e.backend,r=t.input;return nV({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var $j={kernelName:Or,backendName:"webgl",kernelFunc:Jj};function eG(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return Pj({inputs:{input:e},backend:n})})),i=e.map((function(e){return Jj({inputs:{input:e},backend:n})})),o=eG(a,t,n),s=eG(i,t,n),u=aV({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var l=e.map((function(e){var r=[-1,Hi.sizeFromShape(e.shape.slice(t))];return wV({inputs:{x:e},backend:n,attrs:{shape:r}})})),p=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),d=Rv.computeOutShape(l.map((function(e){return e.shape})),1),f=1===l[0].shape[0],h=FW(p,d,r,f),m=Rv.computeOutShape(e.map((function(e){return e.shape})),t),v=n.makeTensorInfo(m,r,h);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}var g=e.filter((function(e){return Hi.sizeFromShape(e.shape)>0})),y=hn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&g[0].shape.length>1;if(1===g.length){var b=y?new TU(e[0].shape,OU):new VU(e[0].shape,OU);return n.runWebGLProgram(b,e,r)}var x=hn().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(g.length>x){for(var k=[],w=0;w<g.length;w+=x){var S=g.slice(w,w+x);k.push(eG(S,t,n))}for(var I=eG(k,t,n),_=0,N=k;_<N.length;_++){var C=N[_];n.disposeIntermediateTensorInfo(C)}return I}if(y){var T=new Qj(g.map((function(e){return e.shape})),t);return n.runWebGLProgram(T,g,r)}var E=function(e,t,n){var r=Rv.computeOutShape(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return wV({inputs:{x:e},attrs:{shape:[-1,Hi.sizeFromShape(e.shape.slice(t))]},backend:n})})),outShape:r}}(g,t,n),A=E.tensors2D,R=E.outShape,F=new Yj(A.map((function(e){return e.shape}))),D=n.runWebGLProgram(F,A,r);A.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var M=wV({inputs:{x:D},attrs:{shape:R},backend:n});return n.disposeIntermediateTensorInfo(D),M}function tG(e){var t=e.inputs,n=e.backend,r=e.attrs.axis,a=Hi.parseAxisParam(r,t[0].shape)[0],i=t.map((function(e){return e.shape}));Rv.assertParamsConsistent(i,a);var o=Rv.computeOutShape(t.map((function(e){return e.shape})),a);if(0===Hi.sizeFromShape(o))return n.makeTensorInfo(o,t[0].dtype,[]);var s=t.filter((function(e){return Hi.sizeFromShape(e.shape)>0}));return 1===s.length?nV({inputs:{x:s[0]},backend:n}):eG(s,a,n)}var nG={kernelName:Kn,backendName:"webgl",kernelFunc:tG},rG=v((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];h(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,p=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,m=4*Math.floor(t.inChannels/4),v=t.inChannels%4,g="channelsLast"===t.dataFormat,y=g?1:2,b=g?2:3,x=g?3:1,k="",w="";r&&(k=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),w="result = activation(result);");var S=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(k,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(x,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(y,"], coords[").concat(b,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(d,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(p,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(m,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(g,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===v,") {\n\n              if (").concat(g,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(m,") *\n                    getW(wR, wC, ").concat(m,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(m,", xR, xC) *\n                    getW(wR, wC, ").concat(m,", d2);\n              }\n\n            } else if (").concat(2===v,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(m,", d2),\n                getW(wR, wC, ").concat(m," + 1, d2)\n              );\n\n              if (").concat(g,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(m,"),\n                  getX(batch, xR, xC, ").concat(m," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(m,", xR, xC),\n                  getX(batch, ").concat(m," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===v,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(m,", d2),\n                getW(wR, wC, ").concat(m," + 1, d2),\n                getW(wR, wC, ").concat(m," + 2, d2)\n              );\n\n              if (").concat(g,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(m,"),\n                  getX(batch, xR, xC, ").concat(m," + 1),\n                  getX(batch, xR, xC, ").concat(m," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(m,", xR, xC),\n                  getX(batch, ").concat(m," + 1, xR, xC),\n                  getX(batch, ").concat(m," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(S,"\n        ").concat(w,"\n        setOutput(result);\n      }\n    ")})),aG=v((function e(t){h(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,p=t.filterDepth,d=t.filterHeight,f=t.filterWidth,m=4*Math.floor(t.inChannels/4),v=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(p,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(d,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(m,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===v,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(m,") *\n                  getW(wF, wR, wC, ").concat(m,", d2);\n              } else if (").concat(2===v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(m,"),\n                  getX(batch, xF, xR, xC, ").concat(m," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(m,", d2),\n                  getW(wF, wR, wC, ").concat(m," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(m,"),\n                  getX(batch, xF, xR, xC, ").concat(m," + 1),\n                  getX(batch, xF, xR, xC, ").concat(m," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(m,", d2),\n                  getW(wF, wR, wC, ").concat(m," + 1, d2),\n                  getW(wF, wR, wC, ").concat(m," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),iG=v((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];h(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=YB(this.outputShape.length);for(var o=t.padInfo.left,s=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,l=t.filterWidth,p=l,d="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;",f=0;f<l;f++)d+="\n           vec4 xTexelC".concat(2*f,";\n           int xTexelC").concat(2*f,"Ready;\n           vec4 xTexelC").concat(2*f+1,";\n           int xTexelC").concat(2*f+1,"Ready;\n           vec4 xC").concat(f,";");d+="\n     for (int r = 0; r < ".concat(c,"; r++) {\n      for (int d1 = 0; d1 < ").concat(t.inChannels,"; d1 += 2) {\n       ");for(var m=0;m<l;m++)d+="\n           xTexelC".concat(2*m," = vec4(0.0);\n           xTexelC").concat(2*m,"Ready = 0;\n           xTexelC").concat(2*m+1," = vec4(0.0);\n           xTexelC").concat(2*m+1,"Ready = 0;\n           xC").concat(m," = vec4(0.0);");d+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(var v=0;v<(p+1)/2;v++){var g=2*v;if(d+="\n           xC = xCCorner + ".concat(g*u,";\n           "),1===s){if(g<l&&(o%2===1?(d+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n               "),d+=1===u&&g>0?"\n                 xC".concat(g," = vec4(xTexelC").concat(g-2,".zw, xTexelC").concat(g,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(g," = vec4(previous.zw, xTexelC").concat(g,".xy);\n                   } else {\n                     xC").concat(g," = vec4(0.0, 0.0, xTexelC").concat(g,".xy);\n                   }\n                   ")):d+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n\n                 xC").concat(g," = xTexelC").concat(g,";\n                 "),g+1<l)){var y=o%2===0?Hi.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(d+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(y,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                     xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(g+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(g+1,"Ready = 1;\n                   }\n                   "),d+=u>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(g+1," = vec4(previous.zw, xTexelC").concat(g+1,".xy);\n                     } else {\n                      xC").concat(g+1," = vec4(0.0, 0.0, xTexelC").concat(g+1,".xy);\n                     }\n                     "):"\n                     xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".xy);\n                     ")):d+=1===y?"\n                     xC".concat(g+1," = xTexelC").concat(g,";\n                     "):"\n                     xCOffset = xC + ".concat(y,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                       xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(g+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(g+1,"Ready = 1;\n                     }\n\n                     xC").concat(g+1," = xTexelC").concat(g+1,";\n                     ")}}else g<l&&(o%2===1?(d+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                   xTexelC").concat(g+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(g+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g+1,"Ready = 1;\n                 }\n\n                 xC").concat(g," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n               "),g+1<l&&(d+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(g+1," = vec4(xTexelC").concat(g+1,".xy, final.xy);\n                 "))):(d+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                   xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(g+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(g+1,"Ready = 1;\n                 }\n\n                 xC").concat(g," = vec4(\n                   xTexelC").concat(g,".xy, xTexelC").concat(g+1,".xy);\n               "),g+1<l&&(d+="\n                   xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n                 "))));g<l&&(d+="\n             wTexel = getW(r, ".concat(g,", d1, d2);\n             dotProd += xC").concat(g,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(t.inChannels,") {\n               dotProd += xC").concat(g,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),g+1<l&&(d+="\n               wTexel = getW(r, ".concat(g+1,", d1, d2);\n               dotProd += xC").concat(g+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(t.inChannels,") {\n                 dotProd += xC").concat(g+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}d+="\n     }\n   ",d+="\n     }\n   ",d+="\n     }\n   ";var b="",x="";r&&(b=a?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(r,"\n         }"):i?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(r,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(r,"\n         }"),x="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(b,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(d,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(k,"\n         ").concat(x,"\n         setOutput(result);\n       }\n     ")})),oG=v((function e(t,n){h(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=YB(this.outputShape.length);for(var r=n.dataFormat,a=CB(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",l=0;l<=1;l++)for(var p=0;p<=1;p++)c+="\n          blockIndex = rc.z + ".concat(p,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+p,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function sG(e,t){var n=e.length;return n>=3?[].concat(Fe(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function uG(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,d=e.activation,f=void 0===d?null:d,h=n.shape,m=i.texData.get(n.dataId),v=a.inChannels,g=h[0]*h[1]*h[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[];if(null!=c){var k=sG(c.shape,b);null!=k&&(c=wV({inputs:{x:c},backend:i,attrs:{shape:k}}),x.push(c))}if(null!=s){var w=sG(s.shape,b);null!=w&&(s=wV({inputs:{x:s},backend:i,attrs:{shape:w}}),x.push(s))}if((1!==g&&1!==y||!(v>MV))&&m.isPacked&&b&&null!=m.texture&&h[2]%2!==0&&Hi.arraysEqual(m.shape.slice(-3),h.slice(-3))){var S=h[0]*h[1]*(h[2]+1),I={dataId:n.dataId,shape:[1,S,a.inChannels],dtype:n.dtype},_=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,Hi.assert(fB(m.shape,I.shape),(function(){return"packed reshape ".concat(m.shape," to ").concat(I.shape," isn't free")}));var N=wV({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(N);var C=OV({a:I,b:N,backend:i,transposeA:!1,transposeB:false,bias:s,activation:f,preluActivationWeights:c,leakyreluAlpha:p}),T=i.texData.get(C.dataId);Hi.assert(T.isPacked,(function(){return"batchMatMul result is expected to be packed"})),m.shape=_,T.shape=a.outShape,(t=nV({inputs:{x:C},backend:i})).shape=a.outShape,x.push(C)}else{var E=a.outHeight*a.outWidth,A=wV({inputs:{x:n},backend:i,attrs:{shape:b?[a.batchSize,E,a.inChannels]:[a.batchSize,a.inChannels,E]}}),R=wV({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),F=OV({a:b?A:R,b:b?R:A,transposeA:!b,transposeB:false,backend:i,bias:s,activation:f,preluActivationWeights:c,leakyreluAlpha:p});t=wV({inputs:{x:F},backend:i,attrs:{shape:a.outShape}}),x.push(A),x.push(R),x.push(F)}for(var D=0,M=x;D<M.length;D++){var O=M[D];i.disposeIntermediateTensorInfo(O)}return t}function cG(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,p=e.activation,d=void 0===p?null:p,f=r.filterWidth,h=r.filterHeight,m=r.inChannels,v=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=f*h*m,x=g*v,k=[r.batchSize,b,x],w=[];if(null!=u){var S=sG(u.shape,y);null!=S&&(u=wV({inputs:{x:u},backend:a,attrs:{shape:S}}),w.push(u))}if(null!=o){var I=sG(o.shape,y);null!=I&&(o=wV({inputs:{x:o},backend:a,attrs:{shape:I}}),w.push(o))}var _=wV({inputs:{x:n},backend:a,attrs:{shape:[1,b,Hi.sizeFromShape(n.shape)/b]}});w.push(_);var N=new oG(k,r),C=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],T=a.runWebGLProgram(N,[t],"float32",C),E=wV({inputs:{x:T},backend:a,attrs:{shape:k}});w.push(T),w.push(E);var A=null!=o,R=null!=u,F="leakyrelu"===d,D=d?mV(d,!0):null,M=new vV(y?E.shape:_.shape,y?_.shape:E.shape,y?[r.batchSize,x,r.outChannels]:[r.batchSize,r.outChannels,x],!0,!1,A,D,R,F),O=y?[E,_]:[_,E];if(o&&O.push(o),R&&O.push(u),F){var P=a.makeTensorInfo([],"float32",Hi.createScalarValue(l,"float32"));O.push(P),w.push(P)}var L=a.runWebGLProgram(M,O,"float32"),z=wV({inputs:{x:L},backend:a,attrs:{shape:r.outShape}});w.push(L);for(var B=0,W=w;B<W.length;B++){var U=W[B];a.disposeIntermediateTensorInfo(U)}return z}var lG={kernelName:Xn,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,p=a.dimRoundingMode,d=Rv.convertConv2DDataFormat(c),f=Rv.computeConv2DInfo(i.shape,o.shape,s,l,u,p,!1,d);if(1!==f.filterHeight||1!==f.filterWidth||1!==f.dilationHeight||1!==f.dilationWidth||1!==f.strideHeight||1!==f.strideWidth||"SAME"!==f.padInfo.type&&"VALID"!==f.padInfo.type)if(f.strideWidth<=2&&"channelsLast"===d&&hn().getBool("WEBGL_EXP_CONV")){var h=new iG(f),m=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];t=r.runWebGLProgram(h,[i,o],"float32",m)}else if(hn().getBool("WEBGL_CONV_IM2COL"))t=cG({x:i,filter:o,convInfo:f,backend:r});else{var v=new rG(f);t=r.runWebGLProgram(v,[i,o],"float32")}else t=uG({x:i,filter:o,convInfo:f,backend:r});var g=wV({inputs:{x:t},backend:r,attrs:{shape:f.outShape}});return r.disposeIntermediateTensorInfo(t),g}},pG=v((function e(t){h(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),dG=v((function e(t){h(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,p=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(p,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),fG=v((function e(t){h(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),hG=v((function e(t){h(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var mG={kernelName:Yn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,p=Rv.convertConv2DDataFormat(u),d=Rv.computeConv2DInfo(a.shape,l,o,1,s,c,!1,p),f=new pG(d);return n.runWebGLProgram(f,[a,i],"float32")}};var vG={kernelName:Qn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,p=Rv.convertConv2DDataFormat(c),d=Rv.computeConv2DInfo(o,i.shape,s,1,u,l,!1,p),f=new dG(d);return n.runWebGLProgram(f,[a,i],"float32")}};var gG={kernelName:Zn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=Rv.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new aG(c);return n.runWebGLProgram(l,[a,i],"float32")}};var yG={kernelName:Jn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=Rv.computeConv3DInfo(a.shape,u,o,1,s),l=new fG(c);return n.runWebGLProgram(l,[a,i],"float32")}};var bG,xG={kernelName:$n,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape,c=Rv.computeConv3DInfo(u,i.shape,s,1,o),l=new hG(c);return n.runWebGLProgram(l,[a,i],"float32")}},kG=fV({opSnippet:dV+"\n  return cos(x);\n"}),wG={kernelName:er,backendName:"webgl",kernelFunc:kG},SG=fV({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),IG={kernelName:tr,backendName:"webgl",kernelFunc:SG},_G=v((function e(t,n,r,a,i){h(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var s=o(t,4),u=s[0],c=s[1],l=s[2],p=s[3],d=o(n,1)[0],f=o(r,2),m=f[0],v=f[1];this.outputShape=[d,m,v,p];var g="bilinear"===a?1:0,y="".concat(c-1,".0"),b="".concat(l-1,".0"),x=o(m>1?["".concat((c-1)/(m-1)),"(y2-y1) * height_ratio","y1*".concat(y," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(y)],3),k=x[0],w=x[1],S=x[2],I=o(v>1?["".concat((l-1)/(v-1)),"(x2-x1) * width_ratio","x1*".concat(b," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(b)],3),_=I[0],N=I[1],C=I[2];this.userCode="\n      const float height_ratio = float(".concat(k,");\n      const float width_ratio = float(").concat(_,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(u,") {\n          return;\n        }\n\n        float height_scale = ").concat(w,";\n        float width_scale = ").concat(N,";\n\n        float in_y = ").concat(S,";\n        if( in_y < 0.0 || in_y > ").concat(y," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(C,";\n        if( in_x < 0.0 || in_x > ").concat(b," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(g," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),NG={kernelName:ar,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new _G(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(bG||(bG={}));var CG=v((function e(t,n,r,a){h(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===bG.Prod?"1.0":"0.0",s=r?o:"getX(".concat(TG(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(jB(i)," coords = getOutputCoords();\n        int end = ").concat(EG(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(EG(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(TG(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}));function TG(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function EG(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function AG(e,t,n,r,a,i){var o=t.shape.length,s=Rv.getAxesPermutation([r],o),u=t;null!=s&&(u=FV({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=Rv.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," but got axis=").concat(r));for(var l=u.shape[c],p=nV({inputs:{x:u},backend:n}),d=0;d<=Math.ceil(Math.log2(l))-1;d++){var f=new CG(e,u.shape,!1,i),h=[[d]],m=p;p=n.runWebGLProgram(f,[p],p.dtype,h),n.disposeIntermediateTensorInfo(m)}if(a){var v=new CG(e,u.shape,a,i),g=p;p=n.runWebGLProgram(v,[p],p.dtype),n.disposeIntermediateTensorInfo(g)}if(null!=s){var y=FV({inputs:{x:p},backend:n,attrs:{perm:Rv.getUndoAxesPermutation(s)}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(u),y}return p}var RG={kernelName:nr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return AG(bG.Prod,a,n,i,o,s)}};var FG={kernelName:rr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return AG(bG.Sum,a,n,i,o,s)}};var DG={kernelName:ir,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=TW(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var p=n.bufferSync(a),d=n.bufferSync(i),f=EW(p,d,o,s);return n.makeTensorInfo(f.shape,i.dtype,f.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},MG=function(){function e(t,n,r){h(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return v(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var OG={kernelName:or,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),p=new MG("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(p,[a],a.dtype)}},PG=v((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];h(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=YB(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var p=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(p,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")})),LG=v((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];h(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=YB(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,p=t.filterWidth,d=p,f="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",m=0;m<p;m++)f+="\n          vec4 xTexelC".concat(2*m,";\n          int xTexelC").concat(2*m,"Ready;\n          vec4 xTexelC").concat(2*m+1,";\n          int xTexelC").concat(2*m+1,"Ready;\n          vec4 xC").concat(m,";");f+="\n    for (int r = 0; r < ".concat(l,"; r++) {\n      ");for(var v=0;v<p;v++)f+="\n          xTexelC".concat(2*v," = vec4(0.0);\n          xTexelC").concat(2*v,"Ready = 0;\n          xTexelC").concat(2*v+1," = vec4(0.0);\n          xTexelC").concat(2*v+1,"Ready = 0;\n          xC").concat(v," = vec4(0.0);");f+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var g=0;g<(d+1)/2;g++){var y=2*g;if(f+="\n          xC = xCCorner + ".concat(y*c,";\n          "),1===u){if(y<p&&(s%2===1?(f+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n              "),f+=1===c&&y>0?"\n                xC".concat(y," = vec4(xTexelC").concat(y-2,".zw, xTexelC").concat(y,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(y," = vec4(previous.zw, xTexelC").concat(y,".xy);\n                  } else {\n                    xC").concat(y," = vec4(0.0, 0.0, xTexelC").concat(y,".xy);\n                  }\n                  ")):f+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                xC").concat(y," = xTexelC").concat(y,";\n                "),y+1<p)){var b=s%2===0?Hi.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(f+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(b,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                    xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(y+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(y+1,"Ready = 1;\n                  }\n                  "),f+=c>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(y+1," = vec4(previous.zw, xTexelC").concat(y+1,".xy);\n                    } else {\n                     xC").concat(y+1," = vec4(0.0, 0.0, xTexelC").concat(y+1,".xy);\n                    }\n                    "):"\n                    xC".concat(y+1," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".xy);\n                    ")):f+=1===b?"\n                    xC".concat(y+1," = xTexelC").concat(y,";\n                    "):"\n                    xCOffset = xC + ".concat(b,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                      xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(y+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(y+1,"Ready = 1;\n                    }\n\n                    xC").concat(y+1," = xTexelC").concat(y+1,";\n                    ")}}else y<p&&(s%2===1?(f+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                  xTexelC").concat(y+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(y+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y+1,"Ready = 1;\n                }\n\n                xC").concat(y," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".zw);\n              "),y+1<p&&(f+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(y+1," = vec4(xTexelC").concat(y+1,".xy, final.xy);\n                "))):(f+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                  xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(y+1,"Ready = 1;\n                }\n\n                xC").concat(y," = vec4(\n                  xTexelC").concat(y,".xy, xTexelC").concat(y+1,".xy);\n              "),y+1<p&&(f+="\n                  xC".concat(y+1," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".zw);\n                "))));y<p&&(f+="\n            wTexel = getW(r, ".concat(y,", d1, q);\n            dotProd += xC").concat(y," * vec4(wTexel.xz, wTexel.xz);\n          "),y+1<p&&(f+="\n              wTexel = getW(r, ".concat(y+1,", d1, q);\n              dotProd += xC").concat(y+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}f+="\n    }\n  ",f+="\n      }\n    ";var x="",k="";r&&(x=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(f,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")}));var zG={kernelName:sr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),Hi.assert(Rv.eitherStridesOrDilationsAreOne(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var p,d=Rv.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0);p=hn().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?new LG(d):new PG(d);var f=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(p,[a,i],"float32",f)}},BG=v((function e(t){h(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),WG=v((function e(t){h(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var UG={kernelName:ur,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,p=Rv.computeConv2DInfo(a.shape,l,o,s,u,c,!0),d=new BG(p);return n.runWebGLProgram(d,[a,i],"float32")}};var VG={kernelName:cr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape,p=Rv.computeConv2DInfo(l,i.shape,o,s,u,c,!0),d=new WG(p);return n.runWebGLProgram(d,[a,i],"float32")}},jG=v((function e(t){h(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var GG={kernelName:lr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(Fe(r.shape),Fe(r.shape)),i=Hi.sizeFromShape(r.shape),o=wV({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new jG(i),u=n.runWebGLProgram(s,[o],o.dtype),c=wV({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},HG=v((function e(t){h(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,p=a.top,d=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(p,", ").concat(d,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var qG={kernelName:pr,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=Rv.computeDilation2DInfo(i.shape,o.shape,s,u,"NHWC",c),p=new HG(l),d=wV({inputs:{x:t=r.runWebGLProgram(p,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),d}};var KG={kernelName:mr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.equation,a=t,i=Rv.decodeEinsumEquation(r,a.length),o=i.allDims,s=i.summedDims,u=i.idDims;Rv.checkEinsumDimSizes(o.length,u,a);for(var c=Rv.getEinsumComputePath(s,u),l=c.path,p=c.steps,d=p.length,f=null,h=o.length,m=[],v=0;v<d;++v){var g,y=De(p[v]);try{for(y.s();!(g=y.n()).done;){var b=g.value,x=Rv.getEinsumPermutation(h,u[b]),k=x.permutationIndices,w=x.expandDims,S=void 0;Rv.isIdentityPermutation(k)?S=a[b]:(S=FV({inputs:{x:a[b]},backend:n,attrs:{perm:k}}),m.push(S));for(var I=S.shape.slice(),_=0;_<w.length;++_)I.splice(w[_],0,1);Hi.arraysEqual(S.shape,I)||(S=wV({inputs:{x:S},backend:n,attrs:{shape:I}}),m.push(S)),null===f?f=S:(f=xV({inputs:{a:S,b:f},backend:n}),m.push(f))}}catch(E){y.e(E)}finally{y.f()}v<d-1&&(l[v]>=0&&(f=AV({inputs:{x:f},backend:n,attrs:{axis:l[v]-(o.length-h),keepDims:!1}}),m.push(f)),h--)}for(var N=0,C=m;N<C.length;N++){var T=C[N];T!==f&&n.disposeIntermediateTensorInfo(T)}return f}},XG=fV({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),YG={kernelName:vr,backendName:"webgl",kernelFunc:XG},QG={kernelName:gr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=hn().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new tV("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new $U("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},ZG=hV({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:DW}),JG={kernelName:br,backendName:"webgl",kernelFunc:ZG},$G=fV({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(Rv.ERF_P,";\n  float a1 = ").concat(Rv.ERF_A1,";\n  float a2 = ").concat(Rv.ERF_A2,";\n  float a3 = ").concat(Rv.ERF_A3,";\n  float a4 = ").concat(Rv.ERF_A4,";\n  float a5 = ").concat(Rv.ERF_A5,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),eH={kernelName:yr,backendName:"webgl",kernelFunc:$G},tH=fV({opSnippet:dV+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:MW,dtype:"float32"}),nH={kernelName:xr,backendName:"webgl",kernelFunc:tH};function rH(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(Hi.assert(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),wV({inputs:{x:i},backend:r,attrs:{shape:s}})}var aH={kernelName:kr,backendName:"webgl",kernelFunc:rH},iH="return exp(x) - 1.0;",oH=fV({opSnippet:iH,packedOpSnippet:iH,cpuKernelImpl:OW}),sH={kernelName:wr,backendName:"webgl",kernelFunc:oH},uH=v((function e(t,n,r){h(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function cH(e,t,n){var r=n.texData.get(e.dataId),a=Hi.sizeFromShape(e.shape),i=e.shape[e.shape.length-1],o=wV({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new uH("real",s,t),c=new uH("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],p=n.runWebGLProgram(u,l,"float32"),d=n.runWebGLProgram(c,l,"float32"),f=aV({inputs:{real:p,imag:d},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d);var h=wV({inputs:{x:f},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(f),h}var lH={kernelName:Sr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return cH(t.input,!1,n)}},pH=v((function e(t,n){h(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function dH(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||Hi.inferDtype(a))){var o=Hi.getArrayFromDType(i,Hi.sizeFromShape(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new pH(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var fH,hH={kernelName:Ir,backendName:"webgl",kernelFunc:dH},mH=v((function e(t){h(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),vH={kernelName:_r,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new mH(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},gH="return floor(x);",yH=fV({opSnippet:gH,packedOpSnippet:gH,cpuKernelImpl:PW}),bH={kernelName:Nr,backendName:"webgl",kernelFunc:yH},xH=hV({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),kH={kernelName:Cr,backendName:"webgl",kernelFunc:xH},wH=v((function e(t){h(this,e),this.variableNames=["A"];var n=CB(),r=o(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),SH=v((function e(t){h(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=CB(),r=o(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),IH={kernelName:Ci,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,s="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,u="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,c=s?[a.videoWidth,a.videoHeight]:[a.width,a.height],l=o(c,2),p=l[0],d=l[1],f=[d,p],h=[d,p,i];if(u||s){var m=hn().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(null==fH||m!==_H)&&(_H=m,fH=document.createElement("canvas").getContext("2d",{willReadFrequently:_H})),fH.canvas.width=p,fH.canvas.height=d,fH.drawImage(a,0,0,p,d),a=fH.canvas}var v=n.makeTensorInfo(f,"int32");n.texData.get(v.dataId).usage=yz.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(v.dataId),a);var g=hn().getBool("WEBGL_PACK")?new SH(h):new wH(h),y=n.runWebGLProgram(g,[v],"int32");return n.disposeData(v.dataId),y}},_H=hn().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");var NH={kernelName:Ai,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,p=a.dataFormat,d=a.dilations,f=a.dimRoundingMode,h=a.activation,m=a.leakyreluAlpha,v=Rv.convertConv2DDataFormat(p),g=Rv.computeConv2DInfo(i.shape,o.shape,c,d,l,f,!1,v),y=[],b=null!=s,x=null!=u,k="leakyrelu"===h,w=function(){var e=[i,o],t=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=wV({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return y.push(n),n}return e};if(b&&e.push(t(s,p)),x&&e.push(t(u,p)),k){var n=r.makeTensorInfo([],"float32",Hi.createScalarValue(m,"float32"));e.push(n),y.push(n)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===v&&hn().getBool("WEBGL_EXP_CONV")){var S=h?mV(h,!0):null,I=new iG(g,b,S,x,k),_=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],N=w();t=r.runWebGLProgram(I,N,"float32",_)}else if(hn().getBool("WEBGL_CONV_IM2COL"))t=cG({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:h,preluActivationWeights:u,leakyreluAlpha:m});else{var C=h?mV(h,!1):null,T=new rG(g,b,C,x,k),E=w();t=r.runWebGLProgram(T,E,"float32")}else t=uG({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:h,preluActivationWeights:u,leakyreluAlpha:m});var A=wV({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),A}};var CH={kernelName:Ri,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,p=r.dimRoundingMode,d=r.activation,f=r.leakyreluAlpha,h=[],m=l;null==m&&(m=[1,1]),Hi.assert(Rv.eitherStridesOrDilationsAreOne(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var v,g=Rv.computeConv2DInfo(a.shape,i.shape,u,m,c,p,!0),y=hn().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=d?mV(d,y):null,x=[a,i],k=null!=o,w=null!=s,S="leakyrelu"===d;if(k&&x.push(o),w&&x.push(s),S){var I=n.makeTensorInfo([],"float32",Hi.createScalarValue(f,"float32"));x.push(I),h.push(I)}v=y?new LG(g,k,b,w,S):new PG(g,k,b,w,S);var _=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],N=n.runWebGLProgram(v,x,"float32",_);return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),N}},TH=v((function e(t,n,r,a){h(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=jB(r.length),o="\n    int index;",s=0;s<this.sliceDim;s++)o+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(o,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}));var EH={kernelName:Ar,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,s=i[i.length-1],u=Hi.sizeFromShape(r.shape),c=o(Rv.prepareAndValidate(r,a),4),l=c[0],p=c[1],d=c[2],f=c[3],h=wV({inputs:{x:a},backend:n,attrs:{shape:[p,s]}}),m=wV({inputs:{x:r},backend:n,attrs:{shape:[Hi.sizeFromShape(r.shape)/d,d]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var v=n.readSync(a.dataId),g=n.bufferSync(r),y=LW(v,g,r.dtype,p,s,d,f,r.shape,u);return n.makeTensorInfo(l,r.dtype,y.values)}var b=new TH(s,f,[p,d],r.shape),x=n.runWebGLProgram(b,[m,h],m.dtype),k=wV({inputs:{x:x},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(x),k}},AH=v((function e(t,n){h(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=jB(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function RH(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=Hi.parseAxisParam(o,a.shape)[0];if(hn().get("DEBUG"))for(var c=n.readSync(i.dataId),l=a.shape[u],p=function(){var e=c[d];Hi.assert(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},d=0;d<c.length;++d)p();var f=Rv.segment_util.collectGatherOpShapeInfo(a,i,u,s),h=Hi.sizeFromShape(i.shape),m=[],v=wV({inputs:{x:a},backend:n,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),g=wV({inputs:{x:i},backend:n,attrs:{shape:[f.batchSize,h/f.batchSize]}});m.push(v),m.push(g);var y=[f.batchSize,f.outerSize,h/f.batchSize,f.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var b=n.bufferSync(g),x=n.bufferSync(v),k=zW(x,b,y);return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(f.outputShape,k.dtype,k.values)}var w=new AH(v.shape,y),S=n.runWebGLProgram(w,[v,g],v.dtype);m.push(S);var I=wV({inputs:{x:S},backend:n,attrs:{shape:f.outputShape}});return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),I}var FH={kernelName:Er,backendName:"webgl",kernelFunc:RH},DH=hV({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:BW,dtype:"bool"}),MH={kernelName:Rr,backendName:"webgl",kernelFunc:DH},OH=hV({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:WW}),PH={kernelName:Fr,backendName:"webgl",kernelFunc:OH};var LH={kernelName:Mr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return cH(t.input,!0,n)}},zH=fV({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),BH={kernelName:Pr,backendName:"webgl",kernelFunc:zH},WH=fV({opSnippet:"return float(isinf(x));",dtype:"bool"}),UH={kernelName:Lr,backendName:"webgl",kernelFunc:WH},VH=fV({opSnippet:"return float(isnan(x));",dtype:"bool"}),jH={kernelName:zr,backendName:"webgl",kernelFunc:VH},GH=hV({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:UW,dtype:"bool"}),HH={kernelName:Wr,backendName:"webgl",kernelFunc:GH},qH=hV({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:VW,dtype:"bool"}),KH={kernelName:Ur,backendName:"webgl",kernelFunc:qH};var XH={kernelName:Vr,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=jW(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},YH=fV({opSnippet:dV+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:GW}),QH={kernelName:jr,backendName:"webgl",kernelFunc:YH},ZH=fV({opSnippet:dV+"\n  return log(1.0 + x);\n"}),JH={kernelName:Gr,backendName:"webgl",kernelFunc:ZH},$H=hV({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),eq={kernelName:Hr,backendName:"webgl",kernelFunc:$H},tq=fV({opSnippet:"return float(!(x >= 1.0));"}),nq={kernelName:qr,backendName:"webgl",kernelFunc:tq},rq=hV({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),aq={kernelName:Kr,backendName:"webgl",kernelFunc:rq},iq=v((function e(t,n,r,a,i){h(this,e),this.variableNames=["x"],this.outputShape=[];var o=n,s=t[3]-1;this.outputShape=t;var u,c="float(".concat(r,") + float(").concat(a,") * sum");u=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(o,"; j <= ").concat(o,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(s,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(u,";\n        setOutput(val);\n      }\n    ")})),oq=v((function e(t,n,r,a,i){h(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=n,s=t[3]-1;this.outputShape=t;var u,c="float(".concat(r,") + float(").concat(a,") * sum");u=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(o,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(o,"; j <= ").concat(o,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(s,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(u,";\n        setOutput(result);\n      }\n    ")})),sq={kernelName:Zr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=hn().getBool("WEBGL_PACK_NORMALIZATION")?new oq(a.shape,i,o,s,u):new iq(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},uq=v((function e(t,n,r,a,i){h(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),cq={kernelName:Jr,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,p=new uq(a.shape,s,u,c,l);return n.runWebGLProgram(p,[a,i,o],a.dtype)}};function lq(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,s=r.keepDims,u=a.shape.length,c=Hi.parseAxisParam(i,a.shape),l=c,p=Rv.getAxesPermutation(l,u),d=null!=p,f=n.shouldExecuteOnCPU([a]),h=a;if(d){if(f){for(var m=n.texData.get(h.dataId).values,v=new Array(u),g=0;g<v.length;g++)v[g]=a.shape[p[g]];var y=yU(m,a.shape,a.dtype,p,v);h=n.makeTensorInfo(v,a.dtype),n.texData.get(h.dataId).values=y}else h=EV(a,p,n);l=Rv.getInnerMostAxes(l.length,u)}Rv.assertAxesAreInnerMostDims("max",l,u);var b,x=o(Rv.computeOutAndReduceShapes(h.shape,l),2),k=x[0],w=x[1],S=k;if(s&&(S=Rv.expandShapeToKeepDim(k,c)),f){var I=n.texData.get(h.dataId).values,_=HW(I,Hi.sizeFromShape(w),S,a.dtype);b=n.makeTensorInfo(S,a.dtype),n.texData.get(b.dataId).values=_}else b=function(e,t,n,r){var a=Hi.sizeFromShape(t),i=wV({inputs:{x:e},attrs:{shape:[Hi.sizeFromShape(e.shape)/a,a]},backend:r}),o=NV(i,e.dtype,"max",r),s=wV({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(h,w,S,n);return d&&n.disposeIntermediateTensorInfo(h),b}var pq={kernelName:$r,backendName:"webgl",kernelFunc:lq},dq=hV({opSnippet:JU+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+eV+"\n  return result;\n",cpuKernelImpl:qW}),fq={kernelName:ea,backendName:"webgl",kernelFunc:dq};var hq={kernelName:ta,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;_B(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Hi.assert(Rv.eitherStridesOrDilationsAreOne(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Rv.computePool2DInfo(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Hi.arraysEqual(c.inShape,c.outShape))return nV({inputs:{x:a},backend:n});var l=new hj(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var mq={kernelName:ra,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=Rv.computePool3DInfo(a.shape,i,o,[1,1,1],s,c,u),p=new mj(l,"max",!1);return n.runWebGLProgram(p,[a],a.dtype)}},vq=v((function e(t){h(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),gq=v((function e(t){h(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,p=u-1-t.padInfo.front,d=c-1-t.padInfo.top,f=l-1-t.padInfo.left,m=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(d,", ").concat(f,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(m," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var yq={kernelName:aa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Rv.computePool3DInfo(i.shape,o,s,[1,1,1],u,c),p=new mj(l,"max",!0),d=n.runWebGLProgram(p,[i],i.dtype),f=new gq(l),h=n.runWebGLProgram(f,[a,d],i.dtype);return n.disposeIntermediateTensorInfo(d),h}};var bq={kernelName:na,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;_B([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=Rv.computePool2DInfo(o.shape,s,u,1,c,l),d=new hj(p,"max",!0),f=n.runWebGLProgram(d,[o],o.dtype),h=new vq(p),m=n.runWebGLProgram(h,[a,f],o.dtype);return n.disposeIntermediateTensorInfo(f),m}};var xq={kernelName:ia,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,s=n.strides,u=n.pad,c=n.includeBatchInIndex,l=r;Hi.assert(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var p=[1,1];Hi.assert(Rv.eitherStridesOrDilationsAreOne(s,p),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(s," and dilations '").concat(p,"'")}));var d=Rv.computePool2DInfo(a.shape,i,s,p,u),f=function(e,t,n,r){var a=new hj(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new hj(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,c,d,l),h=o(f,2);return[h[0],h[1]]}};var kq={kernelName:oa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,s=n.axis,u=r,c=a.shape.length,l=Hi.parseAxisParam(s,a.shape),p=l,d=Rv.getAxesPermutation(p,c),f=null!=d,h=u.shouldExecuteOnCPU([a]),m=[],v=a;if(f){if(h){for(var g=u.texData.get(v.dataId).values,y=new Array(c),b=0;b<y.length;b++)y[b]=a.shape[d[b]];var x=yU(g,a.shape,a.dtype,d,y);v=u.makeTensorInfo(y,a.dtype),u.texData.get(v.dataId).values=x}else v=EV(a,d,u);m.push(v),p=Rv.getInnerMostAxes(p.length,c)}Rv.assertAxesAreInnerMostDims("sum",p,c);var k=o(Rv.computeOutAndReduceShapes(v.shape,p),2),w=k[0],S=k[1],I=w;i&&(I=Rv.expandShapeToKeepDim(w,l));for(var _=function(e,t,n,r){var a=Hi.sizeFromShape(t),i=wV({inputs:{x:e},attrs:{shape:[Hi.sizeFromShape(e.shape)/a,a]},backend:r}),o=NV(i,"float32","mean",r),s=wV({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(v,S,I,u),N=0,C=m;N<C.length;N++){var T=C[N];u.disposeIntermediateTensorInfo(T)}return _}};var wq={kernelName:sa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,s=r.keepDims,u=a.shape.length,c=Hi.parseAxisParam(i,a.shape),l=c,p=Rv.getAxesPermutation(l,u),d=a;null!=p&&(d=FV({inputs:{x:a},backend:n,attrs:{perm:p}}),l=Rv.getInnerMostAxes(l.length,a.shape.length)),Rv.assertAxesAreInnerMostDims("min",l,u);var f,h=o(Rv.computeOutAndReduceShapes(d.shape,l),2),m=h[0],v=h[1],g=wV({inputs:{x:d},backend:n,attrs:{shape:[-1,Hi.sizeFromShape(v)]}}),y=NV(g,g.dtype,"min",n);return f=wV(s?{inputs:{x:y},backend:n,attrs:{shape:Rv.expandShapeToKeepDim(m,c)}}:{inputs:{x:y},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),null!=p&&n.disposeIntermediateTensorInfo(d),f}},Sq=hV({opSnippet:JU+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+eV+"\n  return result;\n",cpuKernelImpl:KW}),Iq={kernelName:ua,backendName:"webgl",kernelFunc:Sq},_q=v((function e(t,n,r){h(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=jB(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),Nq=v((function e(t,n,r){h(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=jB(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=kU("rc",a),c=kU("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),d="reflect"===r?0:1,f="";if(1===a){var m="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(d,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(d,";\n        }\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ")}else{var v="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(d,") +\n                gte * ((end - 1) * 2 - source + ").concat(d,");\n        source -= start;\n      ");f="\n        ".concat(i," rc = outputLoc;\n        ").concat(v,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(v,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(v,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(v,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")})),Cq={kernelName:ca,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=hn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Nq(a.shape,i,o):new _q(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},Tq=hV({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+eV+"\n  return result;\n"}),Eq={kernelName:la,backendName:"webgl",kernelFunc:Tq},Aq=v((function e(t,n,r){h(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),Rq=hV({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),Fq={kernelName:hr,backendName:"webgl",kernelFunc:Rq},Dq="return a - b;",Mq=hV({opSnippet:Dq,packedOpSnippet:Dq,supportsComplex:!0,cpuKernelImpl:mU}),Oq={kernelName:hi,backendName:"webgl",kernelFunc:Mq};function Pq(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=Hi.parseAxisParam([i],a.shape),s=lq({inputs:{x:a},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=Rv.expandShapeToKeepDim(s.shape,o),c=wV({inputs:{x:s},backend:n,attrs:{shape:u}}),l=Mq({inputs:{a:a,b:c},backend:n}),p=tH({inputs:{x:l},backend:n}),d=AV({inputs:{x:p},backend:n,attrs:{axis:o,keepDims:!1}}),f=wV({inputs:{x:d},backend:n,attrs:{shape:u}}),h=Rq({inputs:{a:p,b:f},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),h}var Lq={kernelName:ni,backendName:"webgl",kernelFunc:Pq};var zq={kernelName:pa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:Pq({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],p=new Aq(c,l,i),d=[[o]],f=n.runWebGLProgram(p,[u],"int32",d);return s||n.disposeIntermediateTensorInfo(u),f}},Bq=EU+"\n  return -x;\n",Wq="\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n";var Uq={kernelName:fa,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),s=o(YW(i.values,a.shape,a.dtype),2),u=s[0],c=s[1];return r.makeTensorInfo(c,a.dtype,u)}return t=hn().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new VU(a.shape,Wq):new TU(a.shape,Bq),r.runWebGLProgram(t,[a],a.dtype)}},Vq=Lg.nonMaxSuppressionV3Impl;var jq={kernelName:ma,backendName:"webgl",kernelFunc:function(e){Rv.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),p=Vq(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},Gq=Lg.nonMaxSuppressionV4Impl;var Hq={kernelName:va,backendName:"webgl",kernelFunc:function(e){Rv.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),p=n.readSync(i.dataId),d=Gq(l,p,o,s,u,c),f=d.selectedIndices,h=d.validOutputs;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([],"int32",new Int32Array([h]))]}},qq=Lg.nonMaxSuppressionV5Impl;var Kq={kernelName:ga,backendName:"webgl",kernelFunc:function(e){Rv.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),p=n.readSync(i.dataId),d=qq(l,p,o,s,u,c),f=d.selectedIndices,h=d.selectedScores;return[n.makeTensorInfo([f.length],"int32",new Int32Array(f)),n.makeTensorInfo([h.length],"float32",new Float32Array(h))]}},Xq=v((function e(t,n,r,a){h(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),Yq={kernelName:ba,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=Hi.sizeFromShape(a.shape),l=new Xq(c,o,s,u),p=wV({inputs:{x:a},backend:n,attrs:{shape:[c]}}),d=n.runWebGLProgram(l,[p],i);n.disposeIntermediateTensorInfo(p);var f=wV({inputs:{x:d},backend:n,attrs:{shape:[].concat(Fe(a.shape),[o])}});return n.disposeIntermediateTensorInfo(d),f}};function Qq(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=Pj({inputs:{input:r},backend:n}),i=Qq({inputs:{x:a},backend:n}),o=Jj({inputs:{input:r},backend:n}),s=Qq({inputs:{x:o},backend:n}),u=aV({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return dH({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var Zq={kernelName:_i,backendName:"webgl",kernelFunc:Qq};var Jq={kernelName:ya,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=Pj({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=Jj({inputs:{input:a},backend:r}),u=Qq({inputs:{x:s},backend:r}),c=aV({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return dH({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var $q={kernelName:xa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return rH({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Hi.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Hi.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=t.map((function(e){var t=rH({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),u=tG({inputs:s,backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}},eK=v((function e(t,n,r){h(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=jB(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),tK=v((function e(t,n,r){h(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=jB(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=kU("rc",a),c=kU("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),p=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),d=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],f=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="",v=0,g=1===a?2:4;v<g;v++)m+="\n        ".concat(d[v],"\n        if (").concat(f,") {\n          result[").concat(v,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(v,"] = getChannel(getX(").concat(c.join(),"), ").concat(p,");\n        }\n      ");m+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(m,"\n        setOutput(result);\n      }\n    ")})),nK=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===Hi.sizeFromShape(a.shape)){var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]}));return dH({backend:n,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=hn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new tK(a.shape,i,o):new eK(a.shape,i,o),c=[[o]];return n.runWebGLProgram(u,[a],a.dtype,c)},rK={kernelName:ka,backendName:"webgl",kernelFunc:nK},aK=hV({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+eV+"\n  return result;\n"}),iK={kernelName:Sa,backendName:"webgl",kernelFunc:aK};var oK={kernelName:_a,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,s=a.axis,u=a.keepDims,c=i.shape.length,l=[],p=Hi.parseAxisParam(s,i.shape),d=p,f=Rv.getAxesPermutation(d,c),h=i;if(null!=f&&(h=FV({inputs:{x:i},backend:r,attrs:{perm:f}}),d=Rv.getInnerMostAxes(d.length,c),l.push(h)),Rv.assertAxesAreInnerMostDims("prod",d,c),r.shouldExecuteOnCPU([h])){var m=r.texData.get(h.dataId).values,v=ZW(h.shape,h.dtype,m,d),g=v.outVals,y=v.outShape,b=v.outDtype;t=r.makeTensorInfo(y,b,g)}else{var x=o(Rv.computeOutAndReduceShapes(h.shape,d),2),k=x[0],w=x[1],S=Hi.sizeFromShape(w),I=wV({inputs:{x:h},backend:r,attrs:{shape:[-1,S]}}),_=NV(I,Bo(i.dtype),"prod",r);t=wV({inputs:{x:_},backend:r,attrs:{shape:k}}),l.push(I),l.push(_)}if(u){l.push(t);var N=Rv.expandShapeToKeepDim(t.shape,p);t=wV({inputs:{x:t},backend:r,attrs:{shape:N}})}return l.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}};var sK={kernelName:Na,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,i=t.paramsDenseValues,s=t.indices,u=r.outputRaggedRank,c=a.map((function(e){return n.readSync(e.dataId)})),l=a.map((function(e){return e.shape})),p=n.readSync(i.dataId),d=n.readSync(s.dataId),f=o(JW(c,l,p,i.shape,i.dtype,d,s.shape,u),3),h=f[0],m=f[1],v=f[2],g=h.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),y=n.makeTensorInfo(v,i.dtype,m);return g.concat([y])}};var uK={kernelName:Ca,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.starts,a=t.limits,i=t.deltas,s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=o($W(s,r.shape,r.dtype,u,a.shape,c,i.shape),2),p=l[0],d=l[1];return[n.makeTensorInfo([p.length],"int32",p),n.makeTensorInfo([d.length],r.dtype,d)]}};var cK={kernelName:Ta,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,s=t.defaultValue,u=t.rowPartitionTensors,c=r.rowPartitionTypes,l=n.readSync(a.dataId),p=n.readSync(i.dataId),d=n.readSync(s.dataId),f=u.map((function(e){return n.readSync(e.dataId)})),h=u.map((function(e){return e.shape})),m=o(eU(l,a.shape,p,i.shape,i.dtype,d,s.shape,f,h,c),2),v=m[0],g=m[1];return n.makeTensorInfo(v,i.dtype,g)}},lK=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=tU(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},pK={kernelName:Ea,backendName:"webgl",kernelFunc:lK},dK=fV({opSnippet:"return 1.0 / x;"}),fK={kernelName:Ra,backendName:"webgl",kernelFunc:dK},hK=fV({opSnippet:EU+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),mK={kernelName:Fa,backendName:"webgl",kernelFunc:hK},vK=fV({opSnippet:EU+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),gK={kernelName:za,backendName:"webgl",kernelFunc:vK},yK=v((function e(t,n,r,a,i){h(this,e),this.variableNames=["A"],this.outputShape=[];var s=o(t,4),u=s[0],c=s[1],l=s[2],p=s[3];this.outputShape=[u,n,r,p];var d,f=[a&&n>1?c-1:c,a&&r>1?l-1:l],m=[a&&n>1?n-1:n,a&&r>1?r-1:r];d=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/m[0],",\n          ").concat(f[1]/m[1],");\n      const vec2 inputShapeRC = vec2(").concat(c,".0, ").concat(l,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),bK=v((function e(t,n,r,a,i){h(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var s=o(t,4),u=s[0],c=s[1],l=s[2],p=s[3];this.outputShape=[u,n,r,p];var d,f=[a&&n>1?c-1:c,a&&r>1?l-1:l],m=[a&&n>1?n-1:n,a&&r>1?r-1:r];d=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(f[0]/m[0],",\n          ").concat(f[1]/m[1],",\n          ").concat(f[1]/m[1],");\n      const vec3 inputShapeRC = vec3(").concat(c,".0, ").concat(l,".0,\n                                     ").concat(l,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(p-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var xK={kernelName:Pa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,s=r.halfPixelCenters,u=o(r.size,2),c=u[0],l=u[1],p=hn().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new bK(a.shape,c,l,i,s):new yK(a.shape,c,l,i,s);return n.runWebGLProgram(p,[a],"float32")}},kK=v((function e(t,n,r){h(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=o(n,3),i=a[1],s=a[2],u=o(t,3),c=u[1],l=u[2],p=[r&&c>1?i-1:i,r&&l>1?s-1:s],d=[r&&c>1?c-1:c,r&&l>1?l-1:l],f=p[0]/d[0],m=p[1]/d[1],v=1/f,g=1/m,y=2*Math.ceil(v)+2,b=2*Math.ceil(g)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(m,");\n\n        const float invHeightScale = float(").concat(v,");\n        const float invWidthScale = float(").concat(g,");\n\n        const int winHeight = int(").concat(y,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(c,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(l,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(s-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var wK={kernelName:La,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new kK(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},SK=v((function e(t,n,r,a,i){h(this,e),this.variableNames=["A"],this.outputShape=[];var s=o(t,4),u=s[0],c=s[1],l=s[2],p=s[3];this.outputShape=[u,n,r,p];var d,f=[a&&n>1?c-1:c,a&&r>1?l-1:l],m=[a&&n>1?n-1:n,a&&r>1?r-1:r],v=a?"0.5":"0.0";d=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/m[0],",\n          ").concat(f[1]/m[1],");\n      const vec2 inputShapeRC = vec2(").concat(c,".0, ").concat(l,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(v,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),IK=v((function e(t,n,r,a,i){h(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var s=o(t,4),u=s[0],c=s[1],l=s[2],p=s[3];this.outputShape=[u,n,r,p];var d,f=[a&&n>1?c-1:c,a&&r>1?l-1:l],m=[a&&n>1?n-1:n,a&&r>1?r-1:r],v=a?"0.5":"0.0";d=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(f[0]/m[0],",\n          ").concat(f[1]/m[1],",\n          ").concat(f[1]/m[1],");\n      const vec3 inputShapeRC = vec3(").concat(c,".0, ").concat(l,".0,\n                                     ").concat(l,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(v,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(p-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}));var _K={kernelName:Ma,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,s=r.halfPixelCenters,u=o(r.size,2),c=u[0],l=u[1],p=hn().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new IK(a.shape,c,l,i,s):new SK(a.shape,c,l,i,s);return n.runWebGLProgram(p,[a],a.dtype)}},NK=v((function e(t,n,r){h(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=o(n,3),i=a[1],s=a[2],u=o(t,3),c=u[1],l=u[2],p=[r&&c>1?i-1:i,r&&l>1?s-1:s],d=[r&&c>1?c-1:c,r&&l>1?l-1:l],f=p[0]/d[0],m=p[1]/d[1],v=1/f,g=1/m,y=2*Math.ceil(v)+2,b=2*Math.ceil(g)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(m,");\n\n        const float invHeightScale = float(").concat(v,");\n        const float invWidthScale = float(").concat(g,");\n\n        const int winHeight = int(").concat(y,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(c,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(l,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(p[0],") *\n                (float(dyR) / float(").concat(d[0],"));\n\n            float sourceFracCol =\n                float(").concat(p[1],") *\n                  (float(dyC) / float(").concat(d[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(s,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var CK={kernelName:Oa,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new NK(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},TK=v((function e(t,n){h(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=jB(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),EK=v((function e(t,n){h(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=kU("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=jB(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var AK={kernelName:Ba,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=Hi.parseAxisParam(i,a.shape);if(0===o)return nV({inputs:{x:a},backend:n});var u=hn().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new EK(a.shape,s):new TK(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},RK=v((function e(t,n){h(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"==typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),FK={kernelName:Ti,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,s=n.fillValue,u=n.center,c=r,l=new RK(a.shape,s),p=o(Rv.getImageCenter(u,a.shape[1],a.shape[2]),2),d=[[p[0],p[1],Math.sin(i),Math.cos(i)]];return c.runWebGLProgram(l,[a],a.dtype,d)}},DK=fV({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),MK={kernelName:Wa,backendName:"webgl",kernelFunc:DK},OK=fV({opSnippet:"return inversesqrt(x);",cpuKernelImpl:nU}),PK={kernelName:Ua,backendName:"webgl",kernelFunc:OK},LK=v((function e(t,n,r,a,i,o){h(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=jB(i.length),u=jB(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="getIndices(".concat(c,")"),p="";1===a?p="i":2===a&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),f=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(f,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")}));var zK={kernelName:Va,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=Rv.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,d=s.outputSize,f=[d/l,l];if(0===d)return n.makeTensorInfo(o,a.dtype);var h=wV({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),m=wV({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),v=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new LK(c,u,h.shape.length,m.shape.length,p,f),y=n.runWebGLProgram(g,[m,h,v],m.dtype),b=wV({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(v),b}},BK=v((function e(t,n,r,a){h(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),o=2===hn().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(o,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}));var WK={kernelName:ja,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new BK(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},UK=v((function e(t,n,r){var a,i;if(h(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=jB(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var VK={kernelName:Ga,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new UK(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],zo(a.dtype,i.dtype))}},jK=fV({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(Rv.SELU_SCALEALPHA,";\n  float scale = ").concat(Rv.SELU_SCALE,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),GK={kernelName:Ha,backendName:"webgl",kernelFunc:jK},HK=fV({opSnippet:dV+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:aU}),qK={kernelName:Qa,backendName:"webgl",kernelFunc:HK},KK=fV({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),XK={kernelName:Ya,backendName:"webgl",kernelFunc:KK},YK=fV({opSnippet:dV+"\n  return sin(x);\n"}),QK={kernelName:Ka,backendName:"webgl",kernelFunc:YK},ZK=fV({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),JK={kernelName:Xa,backendName:"webgl",kernelFunc:ZK},$K=fV({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),eX={kernelName:Za,backendName:"webgl",kernelFunc:$K},tX={kernelName:ei,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;Hi.assert(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,Fe(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],p=nK({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),d=Rv.getReshaped(p.shape,i,s,!1),f=Rv.getPermuted(d.length,i.length,!1),h=Rv.getReshapedPermuted(p.shape,i,s,!1),m=wV({inputs:{x:p},backend:n,attrs:{shape:d}}),v=FV({inputs:{x:m},backend:n,attrs:{perm:f}}),g=wV({inputs:{x:v},backend:n,attrs:{shape:h}});return l.push(p),l.push(m),l.push(v),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var nX={kernelName:ri,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,s=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==s.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(s.shape));var u=n.readSync(r.dataId),c=n.readSync(a.dataId),l=n.readSync(i.dataId),p=n.readSync(s.dataId)[0],d=o(sU(u,r.shape,r.dtype,c,a.dtype,l,p),5),f=d[0],h=d[1],m=d[2],v=d[3],g=d[4];return[n.makeTensorInfo(h,r.dtype,f),n.makeTensorInfo([h[0]],a.dtype,m),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([g.length],r.dtype,new Int32Array(g))]}};var rX={kernelName:ai,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var s=Array.from(n.readSync(a.dataId)),u=n.readSync(r.dataId),c=Array.from(n.readSync(i.dataId)),l=o(uU(u,r.shape,r.dtype,s,c),3),p=l[0],d=l[1],f=l[2];return[n.makeTensorInfo(d,r.dtype,p),n.makeTensorInfo([f.length],i.dtype,new Int32Array(f))]}};var aX={kernelName:ii,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=o(cU(s,r.shape,r.dtype,u,c,!0),2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var iX={kernelName:oi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=o(cU(s,r.shape,r.dtype,u,c),2),p=l[0],d=l[1];return n.makeTensorInfo(d,r.dtype,p)}};var oX={kernelName:si,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=Rv.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,d=u.strides,f=u.outputSize;if("string"===i.dtype){var h=n.bufferSync(a),m=n.bufferSync(i),v=Hi.decodeString(n.readSync(o.dataId)[0]),g=rU(h,m,s,f,p,l,c,d,v,false);return n.makeTensorInfo(s,g.dtype,g.values)}var y=new LK(l,c,a.shape.length,i.shape.length,d,[f,1],false),b=n.runWebGLProgram(y,[i,a,o],i.dtype),x=wV({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(b),x}};var sX={kernelName:ti,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=r.axis,s=Hi.parseAxisParam(o,a.shape)[0],u=Rv.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),p=a.shape.slice();return u.map((function(e){var t=Fe(p);t[s]=e;var r=Ej({inputs:{x:a},backend:n,attrs:{begin:l,size:t}});return l[s]+=e,r}))}},uX="return sqrt(x);",cX=fV({opSnippet:uX,packedOpSnippet:uX,cpuKernelImpl:lU}),lX={kernelName:Ja,backendName:"webgl",kernelFunc:cX},pX=fV({opSnippet:"return x * x;"}),dX={kernelName:ci,backendName:"webgl",kernelFunc:pX},fX="return (a - b) * (a - b);",hX=hV({opSnippet:fX,packedOpSnippet:fX}),mX={kernelName:ui,backendName:"webgl",kernelFunc:hX};var vX={kernelName:Ni,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=EU+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new TU(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},gX=v((function e(t,n,r){h(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=jB(r.length),o=jB(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var yX={kernelName:li,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,d=a.newAxisMask,f=a.shrinkAxisMask,h=iv.sliceInfo(i.shape,o,s,u,c,l,p,d,f),m=h.finalShapeSparse,v=h.finalShape,g=h.isIdentity,y=h.sliceDim0,b=h.isSimpleSlice,x=h.begin,k=h.end,w=h.strides;if(g)t=wV({inputs:{x:i},backend:r,attrs:{shape:v}});else if(y||b){Hi.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var S=iv.computeOutShape(x,k,w),I=Ej({inputs:{x:i},backend:r,attrs:{begin:x,size:S}});t=wV({inputs:{x:I},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(I)}else if(r.shouldExecuteOnCPU([i])){var _=r.readSync(i.dataId),N=Su(i.shape,i.dtype,_),C=pU(m,N,w,x);t=r.makeTensorInfo(v,i.dtype,C.values)}else{var T=new gX(x,w,m);t=r.runWebGLProgram(T,[i],i.dtype)}var E=wV({inputs:{x:t},backend:r,attrs:{shape:v}});return r.disposeIntermediateTensorInfo(t),E}};var bX={kernelName:pi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,s=r.leftPad,u=r.rightPad,c=r.padWidth,l=r.preserveShortSequences,p=t.data,d=t.dataSplits,f=n.readSync(p.dataId),h=n.readSync(d.dataId),m=o(dU(f,h,a,i,s,u,c,l),2),v=m[0],g=m[1];return[n.makeTensorInfo([v.length],"string",v),n.makeTensorInfo(d.shape,"int32",g)]}};var xX={kernelName:di,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var s=n.readSync(a.dataId),u=n.readSync(i.dataId)[0],c=o(fU(s,u,r),3),l=c[0],p=c[1],d=c[2],f=p.length;return[n.makeTensorInfo([f,2],"int32",l),n.makeTensorInfo([f],"string",p),n.makeTensorInfo([2],"int32",new Int32Array(d))]}};var kX={kernelName:fi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=hU(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},wX=fV({opSnippet:"return tan(x);"}),SX={kernelName:mi,backendName:"webgl",kernelFunc:wX},IX=fV({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),_X={kernelName:vi,backendName:"webgl",kernelFunc:IX},NX=v((function e(t,n){h(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=jB(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function CX(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return Hi.decodeString(e)})):o,u=Su(a.shape,a.dtype,s),c=vU(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new NX(a.shape,i);return n.runWebGLProgram(l,[a],a.dtype)}var TX={kernelName:gi,backendName:"webgl",kernelFunc:CX},EX=v((function e(t){h(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),AX=v((function e(t){h(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function RX(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function FX(e){for(var t=1;t<e;)t*=2;return t}var DX={kernelName:yi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,s=r.sorted,u=hn().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=hn().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=a.shape,p=l[l.length-1];if(n.shouldExecuteOnCPU([a])||p<u||i>c){var d=n.readSync(a.dataId),f=o(gU(d,l,a.dtype,i,s),2),h=f[0],m=f[1];return[n.makeTensorInfo(h.shape,h.dtype,h.values),n.makeTensorInfo(m.shape,m.dtype,m.values)]}if(0===i)return l[l.length-1]=0,[n.makeTensorInfo(l,a.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(1===p)return[a,dH({attrs:{shape:l,dtype:"int32",value:0},backend:n})];var v=n.texData.get(a.dataId),g=null!==v&&v.isPacked,y=g?n.unpackTensor(a):a,b=Hi.sizeFromShape(l)/p,x=wV({inputs:{x:y},attrs:{shape:[b,p]},backend:n});g&&RX(n,y);for(var k=FX(i),w=FX(p),S=null,I=function(){return null===S?[x,x]:[x,S]},_=function(e,t,r){var a=I(),i=new EX(r),o=[[p],[null===S?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=S;S=n.runWebGLProgram(i,a,"int32",o),RX(n,s)},N=1;N<k;N*=2)for(var C=2*N,T=N;T>=1;T/=2)_(C,T,[b,w]);for(var E=w;E>k;E/=2){var A=I(),R=new AX([b,E/2]),F=[[p],[null===S?1:0],[k]],D=S;S=n.runWebGLProgram(R,A,"int32",F),RX(n,D);for(var M=k/2,O=2*M,P=M;P>=1;P/=2)_(O,P,S.shape)}var L=S;S=Ej({inputs:{x:S},backend:n,attrs:{begin:0,size:[b,i]}}),RX(n,L);var z=RH({inputs:{x:x,indices:S},backend:n,attrs:{axis:1,batchDims:1}});RX(n,x);var B=l.slice(0,-1);B.push(i),L=S,S=wV({inputs:{x:S},attrs:{shape:B},backend:n}),RX(n,L);var W=z;return z=wV({inputs:{x:z},attrs:{shape:B},backend:n}),RX(n,W),[z,S]}},MX=v((function e(t,n,r,a,i,o){h(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}));var OX={kernelName:bi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.transforms,s=r.interpolation,u=r.fillMode,c=r.fillValue,l=r.outputShape,p=o(a.shape,4),d=p[0],f=p[1],h=p[2],m=p[3],v=o(null!=l?l:[f,h],2),g=v[0],y=v[1],b=new MX(f,h,s,u,c,[d,g,y,m]);return n.runWebGLProgram(b,[a,i],"float32")}};var PX={kernelName:ki,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;_B(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=bU(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var LX={kernelName:wi,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,p=0;p<s;p++)p!==i&&(c[l++]=o.shape[p]);var d=[],f=new Array(s).fill(0),h=o.shape.slice();h[i]=1;for(var m=new Array(u),v=0;v<m.length;v++){f[i]=v;var g=Ej({inputs:{x:o},backend:n,attrs:{begin:f,size:h}}),y=wV({inputs:{x:g},backend:n,attrs:{shape:c}});m[v]=y,d.push(g)}return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},zX=v((function e(t,n){h(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(d,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var BX,WX,UX,VX={kernelName:Si,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=Rv.getAxesPermutation([c],s),p=a;null!=l&&(p=FV({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(p),c=Rv.getInnerMostAxes(1,s)[0]);var d=Rv.segment_util.computeOutShape(p.shape,c,o),f=Hi.sizeFromShape([p.shape[c]]),h=wV({inputs:{x:p},backend:n,attrs:{shape:[-1,f]}});u.push(h);var m=function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=Rv.segment_util.segOpComputeOptimalWindowSize(c,o),p=new zX({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),d=n.compileAndRun(p,[t,a],i);if(u.push(d),d.shape[1]===o)return d;var f=lK({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),h=CX({inputs:{x:f},backend:n,attrs:{reps:[c/l]}});return u.push(f),u.push(h),e(d,r,h,i,o)}(h,"unsortedSegmentSum",i,Bo(a.dtype),o),v=wV({inputs:{x:m},backend:n,attrs:{shape:d}}),g=v;if(null!=l){u.push(v);var y=Rv.getUndoAxesPermutation(l);g=FV({inputs:{x:g},backend:n,attrs:{perm:y}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},jX=0,GX=[PV,zV,WV,VV,HV,XV,YV,QV,nj,rj,ij,sj,cj,pj,fj,vj,gj,xj,kj,wj,_j,Rj,Fj,Dj,Bj,Vj,Hj,iV,Xj,nG,lG,mG,vG,gG,yG,xG,wG,IG,NG,RG,FG,DG,OG,zG,UG,VG,GG,qG,KG,YG,QG,JG,eH,nH,aH,sH,lH,hH,vH,bH,kH,IH,NH,CH,EH,FH,MH,PH,rV,LH,$j,BH,UH,jH,uV,HH,KH,XH,QH,JH,eq,nq,aq,sq,cq,pq,fq,hq,mq,yq,bq,xq,kq,wq,Iq,Cq,Eq,zq,kV,Uq,jq,Hq,Kq,Oj,Yq,Jq,$q,rK,iK,pV,oK,sK,uK,cK,pK,Lj,Fq,fK,mK,gK,SV,xK,wK,_K,CK,AK,FK,MK,PK,zK,WK,VK,GK,qK,XK,QK,JK,Aj,Lq,eX,tX,nX,rX,aX,iX,oX,sX,lX,dX,mX,vX,yX,bX,xX,kX,Oq,RV,SX,_X,TX,DX,OX,DV,PX,LX,VX,Zq];jX<GX.length;jX++){Bi(GX[jX])}!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(BX||(BX={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu",e[e.sigmoid=5]="sigmoid",e[e.elu=6]="elu"}(WX||(WX={}));var HX={kernelName:Ei,backendName:"wasm",setupFunc:function(e){UX=e.wasm.cwrap(Ei,null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");var u=r.transposeA,c=r.transposeB,l=r.activation,p=r.leakyreluAlpha,d=n.dataIdMap.get(a.dataId).id,f=n.dataIdMap.get(i.dataId).id,h=0;if(null!=o){var m=n.dataIdMap.get(o.dataId);if(1!==m.shape.length)throw new Error("_FusedMatMul only supports rank-1 bias but got rank ".concat(m.shape.length,"."));h=m.id}var v=null==s?0:n.dataIdMap.get(s.dataId).id,g=WX[l];if(null==g)throw new Error("".concat(l," activation not yet supported for FusedConv2D in the wasm backend."));var y=u?a.shape[2]:a.shape[1],b=c?i.shape[1]:i.shape[2],x=fl.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),k=n.makeOutput([].concat(Fe(x),[y,b]),a.dtype),w=n.dataIdMap.get(k.dataId).id,S=new Uint8Array(new Int32Array(a.shape).buffer),I=new Uint8Array(new Int32Array(i.shape).buffer);return UX(d,S,a.shape.length,f,I,i.shape.length,u,c,g,h,v,p||0,w),k}};function qX(e,t){var n;return{kernelName:e,backendName:"wasm",setupFunc:function(t){n=t.wasm.cwrap(e,null,["number","number","number"])},kernelFunc:function(e){var r=e.backend,a=e.inputs.x,i=r.dataIdMap.get(a.dataId).id,o=r.makeOutput(a.shape,t||a.dtype),s=r.dataIdMap.get(o.dataId).id;return 0===Hi.sizeFromShape(o.shape)||n(i,BX[a.dtype],s),o}}}var KX=qX(bn);function XX(e,t,n){var r;return{kernelName:e,backendName:"wasm",setupFunc:function(t){r=t.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function(e){var t=e.backend,a=e.inputs,i=a.a,o=a.b,s=t.dataIdMap.get(i.dataId).id,u=t.dataIdMap.get(o.dataId).id,c=null!=n?n:i.dtype,l=Rv.assertAndGetBroadcastShape(i.shape,o.shape),p=t.makeOutput(l,c);if(0===Hi.sizeFromShape(l))return p;var d=new Uint8Array(new Int32Array(i.shape).buffer),f=new Uint8Array(new Int32Array(o.shape).buffer),h=t.dataIdMap.get(p.dataId).id;return r(s,d,i.shape.length,u,f,o.shape.length,BX[i.dtype],h),p}}}var YX,QX=XX(wn);var ZX={kernelName:Sn,backendName:"wasm",setupFunc:function(e){YX=e.wasm.cwrap(Sn,null,["array","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=n.makeOutput(t[0].shape,t[0].dtype);if(0===Hi.sizeFromShape(r.shape))return r;var a=t.map((function(e){return n.dataIdMap.get(e.dataId).id})),i=new Uint8Array(new Int32Array(a).buffer),o=n.dataIdMap.get(r.dataId).id;return YX(i,a.length,BX[r.dtype],o),r}};function JX(e){var t=e.inputs.x,n=e.backend;if("string"===t.dtype)return ds(n.readSync(t.dataId),t.shape,t.dtype);var r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var $X,eY={kernelName:Dr,backendName:"wasm",kernelFunc:JX};function tY(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=function(e,t){for(var n=[],r=[],a=0;a<e.length;++a)1!==e[a]&&n.push(e[a]),1!==e[t[a]]&&r.push(t[a]);for(var i=0;i<r.length;++i){for(var o=-1,s=0;s<r.length;++s)r[s]>=i&&(-1===o||r[o]>r[s])&&(o=s);r[o]=i}return[n,r]}(t.x.shape,r.perm),i=o(a,2),s=i[0],u=i[1],c=!0,l=0;l<u.length;l++)u[l]!==l&&(c=!1);var p=function(e,t){for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];return n}(t.x.shape,r.perm),d={dataId:t.x.dataId,shape:s,dtype:t.x.dtype};if(c){var f=JX({inputs:t,backend:n});return f.shape=p,f}var h=n.makeOutput(p,d.dtype),m=n.dataIdMap.get(d.dataId).id,v=n.dataIdMap.get(h.dataId).id,g=new Uint8Array(new Int32Array(u).buffer),y=new Uint8Array(new Int32Array(d.shape).buffer);return $X(m,y,d.shape.length,BX[d.dtype],v,g,u.length),h}var nY,rY={kernelName:xi,backendName:"wasm",kernelFunc:tY,setupFunc:function(e){$X=e.wasm.cwrap(xi,null,["number","array","number","number","number","array","number"])}};function aY(e,t,n){var r=e.shape,a=e.shape.length,i=Hi.parseAxisParam(t,r),o=i,s=Rv.getAxesPermutation(o,a),u=null,c=!1;if(null!=s){for(var l=new Array(a),p=0;p<l.length;p++)l[p]=r[s[p]];o=Rv.getInnerMostAxes(o.length,a),u=tY({inputs:{x:e},attrs:{perm:s},backend:n});var d=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(u.dataId).id!==d&&(c=!0)}return{transposed:u,originalAxes:i,axes:o,inputWasTransposed:c}}var iY,oY={kernelName:In,backendName:"wasm",setupFunc:function(e){nY=e.wasm.cwrap(In,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,s=n.x,u=t.dataIdMap.get(s.dataId).id,c=s,l=aY(s,a,t),p=l.transposed,d=l.axes,f=l.originalAxes,h=l.inputWasTransposed;h&&(c=p,u=t.dataIdMap.get(p.dataId).id);var m=c.shape.length;Rv.assertAxesAreInnerMostDims("all",d,m);var v=o(Rv.computeOutAndReduceShapes(c.shape,d),2),g=v[0],y=v[1],b=Hi.sizeFromShape(y),x=t.makeOutput(g,s.dtype);if(0!==Hi.sizeFromShape(c.shape)){var k=t.dataIdMap.get(x.dataId).id;nY(u,b,k)}if(h&&t.disposeData(p.dataId),i){var w=Rv.expandShapeToKeepDim(x.shape,f);x.shape=w}return x}};var sY,uY={kernelName:_n,backendName:"wasm",setupFunc:function(e){iY=e.wasm.cwrap(_n,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,s=n.x,u=t.dataIdMap.get(s.dataId).id,c=s,l=aY(s,a,t),p=l.transposed,d=l.axes,f=l.originalAxes,h=l.inputWasTransposed;h&&(c=p,u=t.dataIdMap.get(p.dataId).id);var m=c.shape.length;Rv.assertAxesAreInnerMostDims("any",d,m);var v=o(Rv.computeOutAndReduceShapes(c.shape,d),2),g=v[0],y=v[1],b=Hi.sizeFromShape(y),x=t.makeOutput(g,s.dtype);if(0!==Hi.sizeFromShape(c.shape)){var k=t.dataIdMap.get(x.dataId).id;iY(u,b,k)}if(h&&t.disposeData(p.dataId),i){var w=Rv.expandShapeToKeepDim(x.shape,f);x.shape=w}return x}};var cY,lY={kernelName:Nn,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.axis,a=n.x,i=t.dataIdMap.get(a.dataId).id,o=i,s=a,u=aY(a,r,t),c=u.transposed,l=u.axes,p=u.inputWasTransposed;if(p){var d=t.dataIdMap.get(c.dataId).id;d!==i&&(s=c,o=d)}var f=s.shape.slice(0,-1),h=t.makeOutput(f,"int32"),m=t.dataIdMap.get(h.dataId).id,v=Hi.sizeFromShape(h.shape),g=s.shape[l[0]];return sY(o,BX[s.dtype],v,g,m),p&&t.disposeData(c.dataId),h},setupFunc:function(e){sY=e.wasm.cwrap(Nn,null,["number","number","number","number","number"])}};var pY={kernelName:Dn,backendName:"wasm",setupFunc:function(e){cY=e.wasm.cwrap(Dn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=r.dataIdMap.get(a.dataId).id,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=Rv.computePool2DInfo(a.shape,o,s,1,u,c),p=l.filterHeight,d=l.filterWidth,f=l.padInfo.top,h=l.padInfo.right,m=l.padInfo.bottom,v=l.padInfo.left,g=l.strideHeight,y=l.strideWidth,b=l.inChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));if(1!==l.dilationWidth||1!==l.dilationHeight)throw new Error("was backend only supports average pooling with dilation = [1, 1], got [".concat(l.dilationHeight,", ").concat(l.dilationWidth,"]."));var x=r.makeOutput(l.outShape,"float32"),k=r.dataIdMap.get(x.dataId).id;return cY(i,a.shape[0],a.shape[1],a.shape[2],p,d,f,h,m,v,g,y,b,k),x}};function dY(e){var t=e.inputs,n=e.attrs,r=t.x,a=n.shape,i=Hi.sizeFromShape(r.shape),o=Hi.inferFromImplicitShape(a,i);return Hi.assert(i===Hi.sizeFromShape(o),(function(){return"new shape: ".concat(o,", old shape: ").concat(r.shape,". New shape and old shape must have the same number of elements.")})),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:o,dtype:r.dtype}}var fY,hY={kernelName:Da,backendName:"wasm",kernelFunc:dY};var mY={kernelName:Ln,backendName:"wasm",setupFunc:function(e){fY=e.wasm.cwrap(Ln,null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],p=s?i.shape[c-1]:i.shape[c-2],d=o?a.shape[u-1]:a.shape[u-2],f=s?i.shape[c-2]:i.shape[c-1],h=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=Hi.sizeFromShape(h),g=Hi.sizeFromShape(m),y=fl.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,f]);Hi.assert(l===p,(function(){return"Error in matMul: inner shapes (".concat(l,") and (").concat(p,") of Tensors with shapes ").concat(a.shape," and ").concat(i.shape," and transposeA=").concat(o," and transposeB=").concat(s," must match.")}));var b=s?[g,f,p]:[g,p,f],x=dY({inputs:{x:a},backend:n,attrs:{shape:o?[v,l,d]:[v,d,l]}}),k=dY({inputs:{x:i},backend:n,attrs:{shape:b}}),w=n.dataIdMap.get(x.dataId).id,S=n.dataIdMap.get(k.dataId).id,I=o?x.shape[2]:x.shape[1],_=s?k.shape[1]:k.shape[2],N=Math.max(v,g),C=n.makeOutput([N,I,_],x.dtype),T=n.dataIdMap.get(C.dataId).id,E=new Uint8Array(new Int32Array(x.shape).buffer),A=new Uint8Array(new Int32Array(k.shape).buffer);return fY(w,E,x.shape.length,S,A,k.shape.length,o,s,T),n.disposeData(x.dataId),n.disposeData(k.dataId),C.shape=y,C}};function vY(e){var t=e.inputs.x,n=e.attrs,r=n.begin,a=n.size,i=e.backend,s=o(iv.parseSliceParams(t,r,a),2),u=s[0],c=s[1],l=iv.isSliceContinous(t.shape,u,c),p=i.readSync(t.dataId),d=i.makeOutput(c,t.dtype),f=Hi.computeStrides(t.shape),h=i.dataIdMap.get(d.dataId);if(l){var m=iv.computeFlatOffset(u,f);return"string"===t.dtype?h.stringBytes=p.slice(m,m+Hi.sizeFromShape(c)):i.typedArrayFromHeap(d).set(p.subarray(m,m+Hi.sizeFromShape(c))),d}if("string"===t.dtype){var v=OD(p,u,c,t.shape,t.dtype);return h.stringBytes=v,d}var g=i.typedArrayFromHeap(d),y=t.shape.length;if(2===y)!function(e,t,n,r,a){for(var i=0,o=r[0],s=r[1],u=o+a[0],c=o;c<u;c++){var l=c*t+s;n.set(e.subarray(l,l+a[1]),i),i+=a[1]}}(p,f[0],g,u,c);else if(3===y)!function(e,t,n,r,a,i){for(var o=0,s=a[0],u=a[1],c=a[2],l=s+i[0],p=u+i[1],d=s;d<l;d++)for(var f=u;f<p;f++){var h=d*t+f*n+c;r.set(e.subarray(h,h+i[2]),o),o+=i[2]}}(p,f[0],f[1],g,u,c);else if(4===y)!function(e,t,n,r,a,i,o){for(var s=0,u=i[0],c=i[1],l=i[2],p=u+o[0],d=c+o[1],f=l+o[2],h=i[3],m=u;m<p;m++)for(var v=c;v<d;v++)for(var g=l;g<f;g++){var y=m*t+v*n+g*r+h;a.set(e.subarray(y,y+o[3]),s),s+=o[3]}}(p,f[0],f[1],f[2],g,u,c);else{var b=OD(p,u,c,t.shape,t.dtype);g.set(b)}return d}var gY={kernelName:qa,backendName:"wasm",kernelFunc:vY};var yY={kernelName:zn,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops,s=i.reduce((function(e,t){return e*t})),u=Rv.getReshaped(a.shape,i,s),c=Rv.getPermuted(u.length,i.length),l=Rv.getReshapedPermuted(a.shape,i,s),p=Rv.getSliceBeginCoords(o,i.length),d=Rv.getSliceSize(l,o,i.length),f=dY({inputs:{x:a},backend:n,attrs:{shape:u}}),h=tY({inputs:{x:f},backend:n,attrs:{perm:c}}),m=vY({inputs:{x:dY({inputs:{x:h},backend:n,attrs:{shape:l}})},backend:n,attrs:{begin:p,size:d}});return n.disposeData(f.dataId),n.disposeData(h.dataId),n.disposeData(f.dataId),m}};function bY(e){var t=e.inputs.x,n=e.attrs.dtype,r=e.backend,a=r.makeOutput(t.shape,n),i=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(i),a}var xY,kY={kernelName:Vn,backendName:"wasm",kernelFunc:bY},wY=qX(jn);var SY={kernelName:Gn,backendName:"wasm",setupFunc:function(e){xY=e.wasm.cwrap(Gn,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.clipValueMin,o=r.clipValueMax,s=n.dataIdMap.get(a.dataId).id,u=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(u.dataId).id;return xY(s,i,o,c),u}};function IY(e){var t=e.inputs,n=e.backend,r=Hi.parseAxisParam(e.attrs.axis,t[0].shape)[0],a=t.map((function(e){return e.shape}));Rv.assertParamsConsistent(a,r);var i=Rv.computeOutShape(t.map((function(e){return e.shape})),r),o=t.filter((function(e){return Hi.sizeFromShape(e.shape)>0}));if(1===o.length)return JX({inputs:{x:o[0]},backend:n});var s=n.makeOutput(i,t[0].dtype);if(0===Hi.sizeFromShape(i))return s;if("string"===o[0].dtype){var u=o.map((function(e){var t=[-1,Hi.sizeFromShape(e.shape.slice(r))];return dY({inputs:{x:e},backend:n,attrs:{shape:t}})})),c=u.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}}));i=Rv.computeOutShape(u.map((function(e){return e.shape})),1);var l=1===u[0].shape[0],p=yF(c,i,t[0].dtype,l),d=Rv.computeOutShape(o.map((function(e){return e.shape})),r);return s.shape=d,n.dataIdMap.get(s.dataId).stringBytes=Rv.fromStringArrayToUint8(p),u.forEach((function(e){return n.disposeData(e.dataId)})),s}for(var f=Hi.sizeFromShape(o[0].shape.slice(0,r)),h=0,m=o.map((function(e){var t=Hi.sizeFromShape(e.shape.slice(r));return h+=t,t})),v=o.map((function(e){return n.typedArrayFromHeap(e)})),g=n.typedArrayFromHeap(s),y=0;y<f;y++)for(var b=y*h,x=0;x<v.length;x++){var k=m[x],w=y*k,S=v[x].subarray(w,w+k);g.set(S,b),b+=k}return s}var _Y,NY={kernelName:Kn,backendName:"wasm",kernelFunc:IY};var CY,TY={kernelName:Xn,backendName:"wasm",setupFunc:function(e){_Y=e.wasm.cwrap(Xn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(i.dataId).id,u=n.strides,c=n.dilations,l=n.pad,p=n.dimRoundingMode,d=n.dataFormat,f=Rv.convertConv2DDataFormat(d),h=Rv.computeConv2DInfo(a.shape,i.shape,u,c,l,p,!1,f),m=h.filterHeight,v=h.filterWidth,g=h.padInfo.top,y=h.padInfo.right,b=h.padInfo.bottom,x=h.padInfo.left,k=h.dilationHeight,w=h.dilationWidth,S=h.strideHeight,I=h.strideWidth,_=h.inChannels,N=h.outChannels,C="SAME"===h.padInfo.type?1:0;if("channelsLast"!==h.dataFormat)throw new Error("wasm backend Conv2D does not support dataFormat:'".concat(h.dataFormat,"'. Please use 'channelsLast'."));var T=r.makeOutput(h.outShape,"float32"),E=r.dataIdMap.get(T.dataId).id;return _Y(o,a.shape[0],a.shape[1],a.shape[2],s,m,v,g,y,b,x,C,k,w,S,I,_,N,E),T}};var EY,AY,RY={kernelName:Qn,backendName:"wasm",setupFunc:function(e){CY=e.wasm.cwrap(Qn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.dy,i=n.filter,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,p=r.inputShape,d=Rv.convertConv2DDataFormat(c),f=Rv.computeConv2DInfo(p,i.shape,s,1,u,l,!1,d),h=f.batchSize,m=f.filterHeight,v=f.filterWidth,g=f.inChannels,y=f.inHeight,b=f.inWidth,x=f.outChannels,k=f.outHeight,w=f.outWidth,S=f.strideHeight,I=f.strideWidth,_=m-1-f.padInfo.top,N=v-1-f.padInfo.left,C="channelsLast"===f.dataFormat,T=Hi.computeStrides(f.inShape),E=Hi.computeStrides(a.shape),A=o(Hi.computeStrides(i.shape),3),R=A[0],F=A[1],D=A[2],M=T[0],O=C?T[1]:T[2],P=C?T[2]:1,L=C?1:T[1],z=E[0],B=C?E[1]:E[2],W=C?E[2]:1,U=C?1:E[1],V=t.makeOutput(f.inShape,"float32"),j=t.dataIdMap.get(V.dataId).id,G=t.dataIdMap.get(a.dataId).id,H=t.dataIdMap.get(i.dataId).id;return CY(G,H,h,m,v,y,b,g,k,w,x,S,I,_,N,R,F,D,M,O,P,L,z,B,W,U,j),V}},FY=qX(er),DY=qX(tr);!function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"}(EY||(EY={}));var MY,OY={kernelName:ar,backendName:"wasm",setupFunc:function(e){AY=e.wasm.cwrap(ar,null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=a.method,s=a.extrapolationValue,u=a.cropSize,c=r.image,l=r.boxes,p=r.boxInd,d=l.shape[0],f=o(u,2),h=f[0],m=f[1],v=[d,h,m,c.shape[3]],g=n.dataIdMap.get(c.dataId);"float32"!==c.dtype&&(t=bY({backend:n,inputs:{x:c},attrs:{dtype:"float32"}}),g=n.dataIdMap.get(t.dataId));var y=g.id,b=n.dataIdMap.get(l.dataId).id,x=n.dataIdMap.get(p.dataId).id,k=n.makeOutput(v,"float32"),w=n.dataIdMap.get(k.dataId).id,S=new Uint8Array(new Int32Array(c.shape).buffer);return AY(y,b,x,d,S,h,m,EY[i],s,w),null!=t&&n.disposeData(t.dataId),k}};var PY,LY={kernelName:nr,backendName:"wasm",setupFunc:function(e){MY=e.wasm.cwrap(nr,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length;Hi.assert("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumprod does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=Rv.getAxesPermutation([i],u),l=a;null!==c&&(l=tY({inputs:{x:a},attrs:{perm:c},backend:n}));var p=Rv.getInnerMostAxes(1,u)[0];Rv.assertAxesAreInnerMostDims("cumprod",[p],u);var d=n.makeOutput(l.shape,l.dtype),f=l.shape[p],h=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(d.dataId).id;MY(h,o?1:0,s?1:0,f,m,BX[a.dtype]);var v=d;return null!==c&&(v=tY({inputs:{x:d},attrs:{perm:Rv.getUndoAxesPermutation(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(d.dataId)),v}};var zY,BY={kernelName:rr,backendName:"wasm",setupFunc:function(e){PY=e.wasm.cwrap(rr,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length;Hi.assert("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumsum does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=Rv.getAxesPermutation([i],u),l=a;null!==c&&(l=tY({inputs:{x:a},attrs:{perm:c},backend:n}));var p=Rv.getInnerMostAxes(1,u)[0];Rv.assertAxesAreInnerMostDims("cumsum",[p],u);var d=n.makeOutput(l.shape,l.dtype),f=l.shape[p],h=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(d.dataId).id;PY(h,o?1:0,s?1:0,f,m,BX[a.dtype]);var v=d;return null!==c&&(v=tY({inputs:{x:d},attrs:{perm:Rv.getUndoAxesPermutation(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(d.dataId)),v}};var WY,UY={kernelName:or,backendName:"wasm",setupFunc:function(e){zY=e.wasm.cwrap(or,null,["number","number","number","array","number","array","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),p="NHWC"===o?[s,u,c,l]:[s,l,u,c],d=t.makeOutput(p,"float32"),f=t.dataIdMap.get(a.dataId).id,h=new Uint8Array(new Int32Array(Hi.computeStrides(a.shape)).buffer),m=new Uint8Array(new Int32Array(p).buffer),v=new Uint8Array(new Int32Array(Hi.computeStrides(p)).buffer),g=t.dataIdMap.get(d.dataId).id;return zY(f,i,"NHWC"===o?1:0,h,a.shape.length-1,m,v,p.length,g),d}};var VY={kernelName:sr,backendName:"wasm",setupFunc:function(e){WY=e.wasm.cwrap(sr,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(i.dataId).id,u=n.strides,c=n.dilations,l=n.pad,p=n.dimRoundingMode,d=null==c?[1,1]:c,f=Rv.computeConv2DInfo(a.shape,i.shape,u,d,l,p,!0),h=f.filterHeight,m=f.filterWidth,v=f.padInfo.top,g=f.padInfo.right,y=f.padInfo.bottom,b=f.padInfo.left,x=f.dilationHeight,k=f.dilationWidth,w=f.strideHeight,S=f.strideWidth,I=f.inChannels,_=f.outChannels,N="SAME"===f.padInfo.type?1:0;if("channelsLast"!==f.dataFormat)throw new Error("wasm backend DepthwiseConv2dNative does not support dataFormat:'".concat(f.dataFormat,"'. Please use 'channelsLast'."));var C=r.makeOutput(f.outShape,"float32"),T=r.dataIdMap.get(C.dataId).id;return WY(o,a.shape[0],a.shape[1],a.shape[2],s,h,m,v,g,y,b,N,x,k,w,S,I,_,T),C}},jY=qX(vr),GY=XX(br,0,"bool"),HY=qX(xr,"float32");function qY(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.input,i=n.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Hi.assert(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),dY({inputs:{x:a},backend:r,attrs:{shape:s}})}var KY={kernelName:kr,backendName:"wasm",kernelFunc:qY};function XY(e){var t=e.attrs,n=t.shape,r=t.value,a=t.dtype,i=e.backend,o=i.makeOutput(n,a);return i.typedArrayFromHeap(o).fill(r),o}var YY,QY={kernelName:Ir,backendName:"wasm",kernelFunc:XY};var ZY,JY={kernelName:_r,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n.makeOutput(r.shape,r.dtype),i=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,u=o(r.shape,4),c=u[0],l=u[1],p=u[2],d=u[3];return YY(i,c,l,p,d,s),a},setupFunc:function(e){YY=e.wasm.cwrap(_r,null,["number","number","number","number","number","number"])}},$Y=qX(Nr),eQ=XX(Cr);var tQ,nQ={kernelName:Tr,backendName:"wasm",setupFunc:function(e){ZY=e.wasm.cwrap(Tr,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.varianceEpsilon,a=n.x,i=n.mean,o=n.variance,s=n.offset,u=n.scale,c=t.dataIdMap.get(a.dataId).id,l=t.dataIdMap.get(i.dataId).id,p=t.dataIdMap.get(o.dataId).id,d=null!=s?t.dataIdMap.get(s.dataId).id:0,f=null!=u?t.dataIdMap.get(u.dataId).id:0,h=t.makeOutput(a.shape,a.dtype);if(0===Hi.sizeFromShape(a.shape))return h;var m=t.dataIdMap.get(h.dataId).id;return ZY(c,l,p,d,f,r,m),h}};var rQ,aQ={kernelName:Ai,backendName:"wasm",setupFunc:function(e){tQ=e.wasm.cwrap(Ai,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,p=n.dataFormat,d=n.dimRoundingMode,f=n.activation,h=n.leakyreluAlpha,m=Rv.computeConv2DInfo(a.shape,i.shape,u,l,c,d),v=WX[f];if(null==v)throw new Error("".concat(f," activation not yet supported for FusedConv2D in the wasm backend."));var g=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(i.dataId).id,b=m.outChannels,x=0;if(null!=o){var k=r.dataIdMap.get(o.dataId);if(1!==k.shape.length)throw new Error("FusedConv2D only supports rank-1 bias but got rank ".concat(k.shape.length,"."));if(k.shape[0]!==b)throw new Error("FusedConv2D bias shape (".concat(k.shape,") does not match the number of output channels (").concat(b,")"));x=k.id}var w=m.filterHeight,S=m.filterWidth,I=m.padInfo.top,_=m.padInfo.right,N=m.padInfo.bottom,C=m.padInfo.left,T=m.dilationHeight,E=m.dilationWidth,A=m.strideHeight,R=m.strideWidth,F=m.inChannels,D="SAME"===m.padInfo.type?1:0,M=m.batchSize,O=m.inHeight,P=m.inWidth;if("NHWC"!==p)throw new Error("wasm backend FusedConv2D does not support dataFormat:'".concat(p,"'. Please use 'NHWC'."));var L=r.makeOutput(m.outShape,"float32"),z=r.dataIdMap.get(L.dataId).id,B=null==s?0:r.dataIdMap.get(s.dataId).id;return tQ(g,M,O,P,y,w,S,x,I,_,N,C,D,T,E,A,R,F,b,v,B,h||0,z),L}};var iQ,oQ={kernelName:Ri,backendName:"wasm",setupFunc:function(e){rQ=e.wasm.cwrap(Ri,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,p=n.dataFormat,d=n.dimRoundingMode,f=n.activation,h=n.leakyreluAlpha,m=Rv.computeConv2DInfo(a.shape,i.shape,u,l,c,d,!0),v=WX[f];if(null==v)throw new Error("".concat(f," activation not yet supported for FusedDepthwiseConv2D in the wasm backend."));var g=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(i.dataId).id,b=m.outChannels,x=0;if(null!=o){var k=r.dataIdMap.get(o.dataId);if(1!==k.shape.length)throw new Error("FusedDepthwiseConv2D only supports rank-1 bias but got rank ".concat(k.shape.length,"."));if(k.shape[0]!==b)throw new Error("FusedDepthwiseConv2D bias shape (".concat(k.shape,") does not match the number of output channels (").concat(b,")"));x=k.id}var w=m.filterHeight,S=m.filterWidth,I=m.padInfo.top,_=m.padInfo.right,N=m.padInfo.bottom,C=m.padInfo.left,T=m.dilationHeight,E=m.dilationWidth,A=m.strideHeight,R=m.strideWidth,F=m.inChannels,D="SAME"===m.padInfo.type?1:0,M=m.batchSize,O=m.inHeight,P=m.inWidth;if("NHWC"!==p)throw new Error("wasm backend FusedDepthwiseConv2D does not support dataFormat:'".concat(p,"'. Please use 'NHWC'."));var L=r.makeOutput(m.outShape,"float32"),z=r.dataIdMap.get(L.dataId).id,B=null==s?0:r.dataIdMap.get(s.dataId).id;return rQ(g,M,O,P,y,w,S,x,I,_,N,C,D,T,E,A,R,F,b,v,B,h||0,z),L}};var sQ,uQ={kernelName:Ar,backendName:"wasm",setupFunc:function(e){iQ=e.wasm.cwrap(Ar,null,["number","number","number","number","number","number","array","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.params,a=n.indices,i=o(rv.prepareAndValidate(r,a),4),s=i[0],u=i[1],c=i[2],l=i[3],p=t.makeOutput(s,r.dtype);if(0===u)return p;var d=a.shape,f=d[d.length-1],h=t.dataIdMap.get(r.dataId).id,m=t.dataIdMap.get(a.dataId).id,v=new Uint8Array(new Int32Array(l).buffer),g=t.dataIdMap.get(p.dataId).id;return iQ(h,BX[r.dtype],m,u,f,c,v,g),p}};var cQ,lQ={kernelName:Er,backendName:"wasm",setupFunc:function(e){sQ=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function(e){for(var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,i=n.indices,o=r.axis,s=r.batchDims,u=Hi.parseAxisParam(o,a.shape)[0],c=t.readSync(i.dataId),l=a.shape[u],p=function(){var e=c[d];Hi.assert(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},d=0;d<c.length;++d)p();var f=Rv.segment_util.collectGatherOpShapeInfo(a,i,u,s),h=dY({inputs:{x:a},attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]},backend:t}),m=Hi.sizeFromShape(i.shape),v=dY({inputs:{x:i},attrs:{shape:[f.batchSize,m/f.batchSize]},backend:t}),g=[f.batchSize,f.outerSize,m/f.batchSize,f.sliceSize],y=t.makeOutput(g,a.dtype);if(0===Hi.sizeFromShape(a.shape))return y;var b=h.shape.length-1,x=t.dataIdMap.get(h.dataId).id,k=t.dataIdMap.get(v.dataId).id,w=t.dataIdMap.get(y.dataId).id,S=new Uint8Array(new Int32Array(Hi.computeStrides(h.shape)).buffer),I=new Uint8Array(new Int32Array(Hi.computeStrides(g)).buffer);return sQ(x,BX[a.dtype],S,b,k,f.batchSize,I,w),t.disposeData(h.dataId),t.disposeData(v.dataId),y.shape=f.outputShape,y}},pQ=XX(Rr,0,"bool"),dQ=XX(Fr,0,"bool"),fQ=qX(zr,"bool");var hQ,mQ={kernelName:Br,backendName:"wasm",setupFunc:function(e){cQ=e.wasm.cwrap(Br,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs.x,n=e.attrs.alpha,r=e.backend,a=r.dataIdMap.get(t.dataId).id,i=r.makeOutput(t.shape,"float32");if(0!==Hi.sizeFromShape(t.shape)){var o=r.dataIdMap.get(i.dataId).id;cQ(a,BX[t.dtype],n,o)}return i}},vQ=XX(Wr,0,"bool"),gQ=XX(Ur,0,"bool"),yQ=qX(jr),bQ=XX(Hr,0,"bool"),xQ=qX(qr),kQ=XX(Kr,0,"bool"),wQ=XX(Xr,0,"bool");var SQ,IQ={kernelName:$r,backendName:"wasm",setupFunc:function(e){hQ=e.wasm.cwrap($r,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.reductionIndices,i=r.keepDims,s=n.x,u=t.dataIdMap.get(s.dataId).id,c=s,l=aY(s,a,t),p=l.transposed,d=l.axes,f=l.originalAxes,h=l.inputWasTransposed;h&&(c=p,u=t.dataIdMap.get(p.dataId).id);var m=c.shape.length;Rv.assertAxesAreInnerMostDims("max",d,m);var v=o(Rv.computeOutAndReduceShapes(c.shape,d),2),g=v[0],y=v[1],b=Hi.sizeFromShape(y),x=t.makeOutput(g,s.dtype);if(0!==Hi.sizeFromShape(c.shape)){var k=t.dataIdMap.get(x.dataId).id;hQ(u,BX[s.dtype],b,k)}if(h&&t.disposeData(p.dataId),i){var w=Rv.expandShapeToKeepDim(x.shape,f);x.shape=w}return x}},_Q=XX(ea);var NQ,CQ={kernelName:ta,backendName:"wasm",setupFunc:function(e){SQ=e.wasm.cwrap(ta,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=r.dataIdMap.get(a.dataId).id;Hi.assert("float32"===a.dtype,(function(){return"Error in MaxPool: only float32 input is supported. Got ".concat(a.dtype,".")}));var o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=Rv.computePool2DInfo(a.shape,o,s,1,u,c),p=l.filterHeight,d=l.filterWidth,f=l.padInfo.top,h=l.padInfo.right,m=l.padInfo.bottom,v=l.padInfo.left,g=l.dilationHeight,y=l.dilationWidth,b=l.strideHeight,x=l.strideWidth,k=l.inChannels,w=l.outChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));var S=r.makeOutput(l.outShape,"float32"),I=r.dataIdMap.get(S.dataId).id;return SQ(i,a.shape[0],a.shape[1],a.shape[2],p,d,f,h,m,v,g,y,b,x,k,w,I),S}};var TQ,EQ={kernelName:oa,backendName:"wasm",setupFunc:function(e){NQ=e.wasm.cwrap(oa,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,s=n.x,u=t.dataIdMap.get(s.dataId).id,c=u,l=s,p=aY(s,a,t),d=p.transposed,f=p.axes,h=p.originalAxes,m=p.inputWasTransposed,v=f;if(m){var g=t.dataIdMap.get(d.dataId).id;g!==u&&(l=d,c=g,v=Rv.getInnerMostAxes(v.length,l.shape.length))}Rv.assertAxesAreInnerMostDims("mean",v,l.shape.length);var y=o(Rv.computeOutAndReduceShapes(l.shape,v),2),b=y[0],x=y[1],k=Hi.sizeFromShape(x),w=l;"float32"!==l.dtype&&(w=bY({backend:t,inputs:{x:l},attrs:{dtype:"float32"}}),c=t.dataIdMap.get(w.dataId).id);var S=t.makeOutput(b,"float32");if(0!==Hi.sizeFromShape(l.shape)){var I=t.dataIdMap.get(S.dataId).id;NQ(c,k,I)}if(m&&t.disposeData(d.dataId),i){var _=Rv.expandShapeToKeepDim(S.shape,h);S.shape=_}return"float32"!==l.dtype&&t.disposeData(w.dataId),S}};var AQ,RQ,FQ={kernelName:sa,backendName:"wasm",setupFunc:function(e){TQ=e.wasm.cwrap(sa,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,s=n.x,u=t.dataIdMap.get(s.dataId).id,c=u,l=s,p=aY(s,a,t),d=p.transposed,f=p.axes,h=p.originalAxes,m=p.inputWasTransposed;if(m){var v=t.dataIdMap.get(d.dataId).id;v!==u&&(l=d,c=v)}var g=l.shape.length;Rv.assertAxesAreInnerMostDims("min",f,g);var y=o(Rv.computeOutAndReduceShapes(l.shape,f),2),b=y[0],x=y[1],k=Hi.sizeFromShape(x),w=t.makeOutput(b,l.dtype);if(0!==Hi.sizeFromShape(l.shape)){var S=t.dataIdMap.get(w.dataId).id;TQ(c,BX[s.dtype],k,S)}if(m&&t.disposeData(d.dataId),i){var I=Rv.expandShapeToKeepDim(w.shape,h);w.shape=I}return w}},DQ=XX(ua);!function(e){e[e.reflect=0]="reflect",e[e.symmetric=1]="symmetric"}(AQ||(AQ={}));var MQ,OQ={kernelName:ca,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,i=r.mode,o=a.map((function(e,n){return e[0]+t.shape[n]+e[1]})),s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(o,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),p=a.map((function(e){return e[0]})),d=a.map((function(e){return e[1]})),f=new Uint8Array(new Int32Array(p).buffer),h=new Uint8Array(new Int32Array(d).buffer);return RQ(s,l,t.shape.length,BX[t.dtype],f,h,AQ[i],c),u},setupFunc:function(e){RQ=e.wasm.cwrap(ca,null,["number","array","number","number","array","array","number","number"])}},PQ=XX(da),LQ=qX(fa);function zQ(e,t){var n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],i=n[2],o=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:i,pValidOutputs:o}}var BQ,WQ={kernelName:ma,backendName:"wasm",setupFunc:function(e){MQ=e.wasm.cwrap(ma,"number",["number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=n.boxes,u=n.scores,c=t.dataIdMap.get(s.dataId).id,l=t.dataIdMap.get(u.dataId).id,p=zQ(t,MQ(c,l,i,a,o)),d=p.pSelectedIndices,f=p.selectedSize,h=p.pSelectedScores,m=p.pValidOutputs;return t.wasm._free(h),t.wasm._free(m),t.makeOutput([f],"int32",d)}};var UQ,VQ={kernelName:va,backendName:"wasm",setupFunc:function(e){BQ=e.wasm.cwrap(va,"number",["number","number","number","number","number","bool"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=r.padToMaxOutputSize,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,p=t.dataIdMap.get(c.dataId).id,d=zQ(t,BQ(l,p,i,a,o,s)),f=d.pSelectedIndices,h=d.selectedSize,m=d.pSelectedScores,v=d.pValidOutputs;return t.wasm._free(m),[t.makeOutput([h],"int32",f),t.makeOutput([],"int32",v)]}};var jQ,GQ={kernelName:ga,backendName:"wasm",setupFunc:function(e){UQ=e.wasm.cwrap(ga,"number",["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,i=r.maxOutputSize,o=r.scoreThreshold,s=r.softNmsSigma,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,p=t.dataIdMap.get(c.dataId).id,d=zQ(t,UQ(l,p,i,a,o,s)),f=d.pSelectedIndices,h=d.selectedSize,m=d.pSelectedScores,v=d.pValidOutputs;return t.wasm._free(v),[t.makeOutput([h],"int32",f),t.makeOutput([h],"float32",m)]}},HQ=XX(ha,0,"bool");var qQ={kernelName:ba,backendName:"wasm",setupFunc:function(e){jQ=e.wasm.cwrap(ba,null,["number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=n.makeOutput([].concat(Fe(a.shape),[o]),i),l=n.dataIdMap.get(c.dataId).id,p=n.dataIdMap.get(a.dataId).id;return jQ(p,o,s,u,l),c}};var KQ={kernelName:ya,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}};var XQ,YQ={kernelName:xa,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return qY({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Hi.assertShapesMatch(a,e.shape,"All tensors passed to stack must have matching shapes"),Hi.assert(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=t.map((function(e){var t=qY({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),u=IY({inputs:s,backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeData(e.dataId)})),u}};var QQ,ZQ={kernelName:ka,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,i=r.constantValue,o=a.map((function(e,n){return e[0]+t.shape[n]+e[1]}));if(0===Hi.sizeFromShape(t.shape))return XY({backend:n,attrs:{shape:o,value:i,dtype:t.dtype}});var s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(o,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),p=a.map((function(e){return e[0]})),d=a.map((function(e){return e[1]})),f=new Uint8Array(new Int32Array(p).buffer),h=new Uint8Array(new Int32Array(d).buffer);return XQ(s,l,t.shape.length,BX[t.dtype],f,h,i,c),u},setupFunc:function(e){XQ=e.wasm.cwrap(ka,null,["number","array","number","number","array","array","number","number"])}},JQ=XX(Sa);var $Q,eZ={kernelName:Ia,backendName:"wasm",setupFunc:function(e){QQ=e.wasm.cwrap(Ia,null,["number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=n.dataIdMap.get(r.dataId).id,o=n.dataIdMap.get(a.dataId).id,s=i,u=r,c=u;"float32"!==u.dtype&&(c=bY({backend:n,inputs:{x:r},attrs:{dtype:"float32"}}),s=n.dataIdMap.get(c.dataId).id);var l=n.makeOutput(r.shape,"float32"),p=n.dataIdMap.get(l.dataId).id;return QQ(s,o,p),"float32"!==u.dtype&&n.disposeData(c.dataId),l}};var tZ,nZ={kernelName:_a,backendName:"wasm",setupFunc:function(e){$Q=e.wasm.cwrap(_a,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,s=n.x,u=t.dataIdMap.get(s.dataId).id,c=u,l=s,p=aY(s,a,t),d=p.transposed,f=p.axes,h=p.originalAxes,m=p.inputWasTransposed,v=f;if(m){var g=t.dataIdMap.get(d.dataId).id;g!==u&&(l=d,c=g,v=Rv.getInnerMostAxes(v.length,l.shape.length))}Rv.assertAxesAreInnerMostDims("prod",v,l.shape.length);var y=o(Rv.computeOutAndReduceShapes(l.shape,v),2),b=y[0],x=y[1],k=Hi.sizeFromShape(x),w=t.makeOutput(b,l.dtype);if(0!==Hi.sizeFromShape(l.shape)){var S=t.dataIdMap.get(w.dataId).id;$Q(c,k,BX[w.dtype],S)}if(m&&t.disposeData(d.dataId),i){var I=Rv.expandShapeToKeepDim(w.shape,h);w.shape=I}return w}},rZ={kernelName:Ea,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=CD(r,a,i,o),u=t.makeOutput([s.length],o);return t.typedArrayFromHeap(u).set(s),u}},aZ=XX(hr),iZ=qX(Ra),oZ=qX(Fa),sZ=qX(za);var uZ,cZ={kernelName:Pa,backendName:"wasm",setupFunc:function(e){tZ=e.wasm.cwrap(Pa,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.images,s=a.alignCorners,u=a.halfPixelCenters,c=o(a.size,2),l=c[0],p=c[1],d=o(i.shape,4),f=d[0],h=d[1],m=d[2],v=d[3],g=[f,l,p,v],y=n.dataIdMap.get(i.dataId);"float32"!==y.dtype&&(t=bY({backend:n,inputs:{x:i},attrs:{dtype:"float32"}}),y=n.dataIdMap.get(t.dataId));var b=y.id,x=n.makeOutput(g,"float32");if(0===Hi.sizeFromShape(i.shape))return x;var k=n.dataIdMap.get(x.dataId).id;return tZ(b,f,h,m,v,l,p,s?1:0,u?1:0,k),null!=t&&n.disposeData(t.dataId),x}};var lZ,pZ={kernelName:Ma,backendName:"wasm",setupFunc:function(e){uZ=e.wasm.cwrap(Ma,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.images,i=r.alignCorners,s=r.halfPixelCenters,u=o(r.size,2),c=u[0],l=u[1],p=o(a.shape,4),d=p[0],f=p[1],h=p[2],m=p[3],v=[d,c,l,m],g=t.makeOutput(v,"float32");if(0===Hi.sizeFromShape(a.shape))return g;var y,b=t.dataIdMap.get(a.dataId);"float32"!==b.dtype&&(y=bY({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),b=t.dataIdMap.get(y.dataId));var x=b.id,k=t.dataIdMap.get(g.dataId).id;return uZ(x,d,f,h,m,c,l,i?1:0,s?1:0,k),null!=y&&t.disposeData(y.dataId),g}};var dZ,fZ={kernelName:Ba,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=Hi.parseAxisParam(i,a.shape);if(0===a.shape.length)return JX({inputs:{x:a},backend:n});var s=n.makeOutput(a.shape,a.dtype),u=n.dataIdMap.get(a.dataId).id,c=n.dataIdMap.get(s.dataId).id,l=new Uint8Array(new Int32Array(o).buffer),p=new Uint8Array(new Int32Array(a.shape).buffer);lZ(u,l,o.length,p,a.shape.length,c);var d=dY({inputs:{x:s},attrs:{shape:a.shape},backend:n});return n.disposeData(s.dataId),d},setupFunc:function(e){lZ=e.wasm.cwrap(Ba,null,["number","array","number","array","number","number"])}};var hZ,mZ={kernelName:Ti,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=r.radians,s=r.fillValue,u=r.center,c=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(a.dataId).id,p=n.dataIdMap.get(c.dataId).id,d=o(a.shape,4),f=d[0],h=d[1],m=d[2],v=d[3],g=o(Rv.getImageCenter(u,h,m),2),y=g[0],b=g[1],x="number"==typeof s?[s,s,s,0===s?0:255]:[].concat(Fe(s),[255]),k=new Uint8Array(new Int32Array(x).buffer);return dZ(l,f,h,m,v,i,y,b,k,x.length,p),c},setupFunc:function(e){dZ=e.wasm.cwrap(Ti,null,["number","number","number","number","number","number","number","number","array","number","number"])}},vZ=qX(Wa),gZ=qX(Ua);var yZ,bZ={kernelName:Va,backendName:"wasm",setupFunc:function(e){hZ=e.wasm.cwrap(Va,null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.indices,i=n.updates,o=r.shape,s=t.makeOutput(o,i.dtype);if(0===Hi.sizeFromShape(o))return s;var u=Ff.calculateShapes(i,a,o),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,d=u.strides,f=u.outputSize,h=t.dataIdMap.get(a.dataId).id,m=t.dataIdMap.get(i.dataId).id,v=new Uint8Array(new Int32Array(d).buffer),g=t.dataIdMap.get(s.dataId).id;return hZ(h,m,BX[i.dtype],c,l,p,v,f,g),s}};var xZ,kZ={kernelName:Ga,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(i.dataId).id,c=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(c.dataId).id,p=r.shape.length,d=a.shape.length,f=0===p||p>1||1===d?1:Hi.sizeFromShape(a.shape.slice(1));return yZ(o,s,u,f,l),c},setupFunc:function(e){yZ=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}};var wZ,SZ={kernelName:"Sigmoid",backendName:"wasm",setupFunc:function(e){xZ=e.wasm.cwrap(Qa,null,["number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs.x,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),i=t.dataIdMap.get(a.dataId).id;return 0===Hi.sizeFromShape(a.shape)||xZ(r,i),a}},IZ=qX(Ka);var _Z={kernelName:ni,backendName:"wasm",setupFunc:function(e){wZ=e.wasm.cwrap(ni,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs.logits,r=e.attrs.dim,a=t.dataIdMap.get(n.dataId).id,i=t.makeOutput(n.shape,n.dtype),o=t.dataIdMap.get(i.dataId).id,s=n.shape[r],u=Hi.sizeFromShape(n.shape)/s;return 0===Hi.sizeFromShape(i.shape)||wZ(a,o,s,u),i}};var NZ,CZ={kernelName:ei,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings,s=Hi.sizeFromShape(i),u=[[0,0]];u.push.apply(u,Fe(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=ZQ.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),p=Rv.getReshaped(l.shape,i,s,!1),d=Rv.getPermuted(p.length,i.length,!1),f=Rv.getReshapedPermuted(l.shape,i,s,!1),h=dY({inputs:{x:l},backend:n,attrs:{shape:p}}),m=tY({inputs:{x:h},backend:n,attrs:{perm:d}}),v=dY({inputs:{x:m},backend:n,attrs:{shape:f}});return n.disposeData(l.dataId),n.disposeData(h.dataId),n.disposeData(m.dataId),v}};var TZ,EZ={kernelName:ri,backendName:"wasm",setupFunc:function(e){NZ=e.wasm.cwrap("SparseFillEmptyRows","number",["number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=r.indices,i=r.values,o=r.denseShape,s=r.defaultValue,u=a.shape[0],c=a.shape[1],l=n.readSync(o.dataId)[0],p=[u+l,c],d=n.dataIdMap.get(a.dataId).id,f=n.dataIdMap.get(i.dataId).id,h=n.dataIdMap.get(s.dataId).id,m=n.makeOutput(p,a.dtype),v=n.dataIdMap.get(m.dataId).id,g=n.makeOutput(p.slice(0,1),i.dtype),y=n.dataIdMap.get(g.dataId).id,b=n.makeOutput([l],"bool"),x=n.dataIdMap.get(b.dataId).id,k=n.makeOutput([u],a.dtype),w=n.dataIdMap.get(k.dataId).id,S=n.makeOutput([4],"int32"),I=n.dataIdMap.get(S.dataId).id,_=NZ(d,f,BX[i.dtype],u,l,c,h,v,y,x,w,I),N=n.readSync(S.dataId);switch(N[0]){case 1:t=Rv.getSparseFillEmptyRowsIndicesDenseShapeMismatch(N[1]);break;case 2:t=Rv.getSparseFillEmptyRowsNegativeIndexErrorMessage(N[1],N[2]);break;case 3:t=Rv.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(N[1],N[2],N[3]);break;default:t=""}if(n.disposeData(S.dataId),t)throw n.disposeData(m.dataId),n.disposeData(g.dataId),n.disposeData(b.dataId),n.disposeData(k.dataId),new Error(t);var C=m,T=g;return _!==p[0]&&(C=vY({inputs:{x:m},attrs:{begin:0,size:[_,c]},backend:n}),T=vY({inputs:{x:g},attrs:{begin:0,size:_},backend:n}),n.disposeData(m.dataId),n.disposeData(g.dataId)),[C,T,b,k]}};var AZ,RZ={kernelName:ai,backendName:"wasm",setupFunc:function(e){TZ=e.wasm.cwrap(ai,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.inputIndices,a=n.inputShape,i=n.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=t.dataIdMap.get(r.dataId).id,s=t.dataIdMap.get(a.dataId).id,u=t.dataIdMap.get(i.dataId).id,c=r.shape[0],l=Hi.sizeFromShape(i.shape),p=t.makeOutput([c,l],r.dtype),d=t.dataIdMap.get(p.dataId).id,f=t.makeOutput([l],i.dtype),h=t.dataIdMap.get(f.dataId).id,m=t.makeOutput([3],"int32"),v=t.dataIdMap.get(m.dataId).id;TZ(o,s,u,c,d,h,v);var g,y=t.readSync(m.dataId);switch(y[0]){case 0:g=Rv.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(y[1],y[2]);break;case 1:g=Rv.getSparseReshapeNegativeOutputDimErrorMessage(y[1],y[2]);break;case 2:g=Rv.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage();break;case 3:var b=Array.from(t.readSync(a.dataId)),x=Array.from(t.readSync(f.dataId));g=Rv.getSparseReshapeInputOutputMultipleErrorMessage(b,x);break;case 4:var k=Array.from(t.readSync(a.dataId)),w=Array.from(t.readSync(f.dataId));g=Rv.getSparseReshapeInputOutputMismatchErrorMessage(k,w);break;default:g=""}if(t.disposeData(m.dataId),g)throw t.disposeData(p.dataId),t.disposeData(f.dataId),new Error(g);return[p,f]}};function FZ(e){AZ=e.wasm.cwrap("SparseSegmentReduction",null,["number","number","number","number","number","number","number","number","number"])}function DZ(e,t){var n=e.backend,r=e.inputs,a=r.data,i=r.indices,o=r.segmentIds,s=i.shape[0],u=n.readSync(o.dataId,s-1,s)[0],c=s>0?u+1:0;if(c<0)throw new Error(Rv.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var l=a.shape.slice();l[0]=c;var p=n.dataIdMap.get(a.dataId).id,d=n.dataIdMap.get(i.dataId).id,f=n.dataIdMap.get(o.dataId).id,h=n.makeOutput(l,a.dtype),m=n.dataIdMap.get(h.dataId).id,v=n.makeOutput([4],"int32"),g=n.dataIdMap.get(v.dataId).id;AZ(p,BX[a.dtype],a.shape[0],d,f,m,g,t,0);var y,b=n.readSync(v.dataId);switch(b[0]){case 0:y=Rv.getSparseSegmentReductionNegativeSegmentIdsErrorMessage();break;case 1:y=Rv.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage();break;case 2:y=Rv.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(b[1],b[2]);break;case 3:y=Rv.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b[1],b[2],b[3]);break;default:y=""}if(n.disposeData(v.dataId),y)throw n.disposeData(h.dataId),new Error(y);return h}var MZ={kernelName:ii,backendName:"wasm",setupFunc:FZ,kernelFunc:function(e){return DZ(e,!0)}};var OZ={kernelName:oi,backendName:"wasm",setupFunc:FZ,kernelFunc:function(e){return DZ(e,!1)}};var PZ,LZ={kernelName:ti,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.numOrSizeSplits,o=n.axis,s=Hi.parseAxisParam(o,a.shape)[0],u=Rv.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map((function(e){var t=Fe(l);t[s]=e;var n=vY({inputs:{x:a},attrs:{begin:c,size:t},backend:r});return c[s]+=e,n}))}},zZ=qX(Ja),BZ=qX(ci),WZ=XX(ui);var UZ,VZ={kernelName:Ni,backendName:"wasm",setupFunc:function(e){PZ=e.wasm.cwrap(Ni,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.alpha,a=n.x,i=t.dataIdMap.get(a.dataId).id,o=t.makeOutput(a.shape,a.dtype),s=t.dataIdMap.get(o.dataId).id;return PZ(i,r,BX[a.dtype],s),o}};var jZ={kernelName:li,backendName:"wasm",setupFunc:function(e){UZ=e.wasm.cwrap(li,null,["number","array","number","array","array","array","array","array","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,d=a.newAxisMask,f=a.shrinkAxisMask,h=iv.sliceInfo(i.shape,o,s,u,c,l,p,d,f),m=h.finalShapeSparse,v=h.finalShape,g=h.isIdentity,y=h.sliceDim0,b=h.isSimpleSlice,x=h.begin,k=h.end,w=h.strides;if(g)t=dY({inputs:{x:i},backend:n,attrs:{shape:v}});else if(y||b){Hi.assert(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var S=iv.computeOutShape(x,k,w),I=vY({inputs:{x:i},backend:n,attrs:{begin:x,size:S}});t=dY({inputs:{x:I},backend:n,attrs:{shape:v}}),n.disposeData(I.dataId)}else{var _=n.makeOutput(m,"float32"),N=n.dataIdMap.get(i.dataId).id,C=new Uint8Array(new Int32Array(Hi.computeStrides(i.shape)).buffer),T=new Uint8Array(new Int32Array(x).buffer),E=new Uint8Array(new Int32Array(k).buffer),A=new Uint8Array(new Int32Array(w).buffer),R=new Uint8Array(new Int32Array(m).buffer),F=new Uint8Array(new Int32Array(Hi.computeStrides(m)).buffer),D=n.dataIdMap.get(_.dataId).id;UZ(N,C,i.shape.length,T,E,A,R,F,m.length,D),t=dY({inputs:{x:_},backend:n,attrs:{shape:v}}),n.disposeData(_.dataId)}return t}};var GZ={kernelName:pi,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.data,i=n.dataSplits,s=r.separator,u=r.nGramWidths,c=r.leftPad,l=r.rightPad,p=r.padWidth,d=r.preserveShortSequences,f=o(YD(t.readSync(a.dataId),t.readSync(i.dataId),s,u,c,l,p,d),2),h=f[0],m=f[1],v=t.makeOutput([h.length],"string");t.dataIdMap.get(v.dataId).stringBytes=h;var g=t.makeOutput(i.shape,"int32");return t.typedArrayFromHeap(g).set(m),[v,g]}};var HZ={kernelName:di,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,i=n.delimiter,s=r.skipEmpty,u=o(ZD(t.readSync(a.dataId),t.readSync(i.dataId)[0],s),3),c=u[0],l=u[1],p=u[2],d=l.length,f=t.makeOutput([d,2],"int32");t.typedArrayFromHeap(f).set(c);var h=t.makeOutput([d],"string");t.dataIdMap.get(h.dataId).stringBytes=l;var m=t.makeOutput([2],"int32");return t.typedArrayFromHeap(m).set(p),[f,h,m]}};var qZ,KZ={kernelName:fi,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,i=r.numBuckets,o=JD(t.readSync(a.dataId),i),s=t.makeOutput(a.shape,"int32");return t.typedArrayFromHeap(s).set(o),s}},XZ=XX(hi);var YZ,QZ={kernelName:$a,backendName:"wasm",setupFunc:function(e){qZ=e.wasm.cwrap($a,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,i=r.keepDims,s=n.x,u=t.dataIdMap.get(s.dataId).id,c=u,l=s,p=aY(s,a,t),d=p.transposed,f=p.axes,h=p.originalAxes,m=p.inputWasTransposed,v=f;if(m){var g=t.dataIdMap.get(d.dataId).id;g!==u&&(l=d,c=g,v=Rv.getInnerMostAxes(v.length,l.shape.length))}Rv.assertAxesAreInnerMostDims("sum",v,l.shape.length);var y=o(Rv.computeOutAndReduceShapes(l.shape,v),2),b=y[0],x=y[1],k=Hi.sizeFromShape(x),w=t.makeOutput(b,l.dtype);if(0!==Hi.sizeFromShape(l.shape)){var S=t.dataIdMap.get(w.dataId).id;qZ(c,k,BX[w.dtype],S)}if(m&&t.disposeData(d.dataId),i){var I=Rv.expandShapeToKeepDim(w.shape,h);w.shape=I}return w}},ZZ=qX(mi),JZ=qX(vi);var $Z,eJ={kernelName:gi,backendName:"wasm",setupFunc:function(e){YZ=e.wasm.cwrap(gi,null,["number","array","number","array","number","number"])},kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=n.dataIdMap.get(a.dataId).id,o=r.reps,s=new Array(a.shape.length),u=0;u<s.length;u++)s[u]=a.shape[u]*o[u];var c=new Uint8Array(new Int32Array(a.shape).buffer),l=new Uint8Array(new Int32Array(s).buffer),p=n.makeOutput(s,a.dtype),d=n.dataIdMap.get(p.dataId).id;return YZ(i,c,a.shape.length,l,s.length,BX[p.dtype],d),p}};var tJ,nJ={kernelName:yi,backendName:"wasm",setupFunc:function(e){$Z=e.wasm.cwrap(yi,null,["number","array","number","number","number","bool","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=n.dataIdMap.get(a.dataId).id,u=new Uint8Array(new Int32Array(a.shape).buffer),c=a.shape.slice();c[c.length-1]=i;var l=n.makeOutput(c,a.dtype),p=n.dataIdMap.get(l.dataId).id,d=n.makeOutput(c,"int32"),f=n.dataIdMap.get(d.dataId).id;return $Z(s,u,a.shape.length,BX[a.dtype],i,o,p,f),[l,d]}};var rJ={kernelName:bi,backendName:"wasm",setupFunc:function(e){tJ=e.wasm.cwrap(bi,null,["number","number","bool","number","number","number","number","number","number","array","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,i=r.image,s=r.transforms,u=a.interpolation,c=a.fillMode,l=a.fillValue,p=a.outputShape,d=o(i.shape,4),f=d[0],h=d[1],m=d[2],v=d[3],g=o(null!=p?p:[h,m],2),y=g[0],b=g[1],x=[f,y,b,v],k=new Uint8Array(new Int32Array(Hi.computeStrides(i.shape)).buffer),w=new Uint8Array(new Int32Array(Hi.computeStrides(x)).buffer),S=n.makeOutput(x,i.dtype),I=n.dataIdMap.get(S.dataId).id,_=n.dataIdMap.get(i.dataId).id,N=n.dataIdMap.get(s.dataId).id,C="nearest"===u?1:2;switch(c){case"constant":default:t=1;break;case"reflect":t=2;break;case"wrap":t=3;break;case"nearest":t=4}return tJ(_,N,s.shape[0]>1,f,y,b,v,m,h,k,i.shape.length-1,w,x.length-1,C,t,l,I),S}};var aJ={kernelName:wi,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape[i],s=a.shape.length,u=new Array(s-1),c=0,l=0;l<s;l++)l!==i&&(u[c++]=a.shape[l]);var p=new Array(o),d=new Array(s).fill(0),f=a.shape.slice();f[i]=1;for(var h=0;h<p.length;h++)d[i]=h,p[h]=vY({inputs:{x:a},attrs:{begin:d,size:f},backend:n});return p.map((function(e){return{dataId:e.dataId,dtype:e.dtype,shape:u}}))}};for(var iJ={kernelName:_i,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}},oJ=0,sJ=[HX,KX,QX,ZX,oY,uY,lY,pY,mY,yY,kY,wY,SY,NY,TY,RY,FY,DY,OY,LY,BY,UY,VY,jY,GY,HY,KY,QY,JY,$Y,eQ,nQ,aQ,oQ,uQ,lQ,pQ,dQ,eY,fQ,mQ,vQ,gQ,yQ,bQ,xQ,kQ,wQ,IQ,_Q,CQ,EQ,FQ,DQ,OQ,PQ,LQ,WQ,VQ,GQ,HQ,qQ,KQ,YQ,ZQ,JQ,eZ,nZ,rZ,aZ,iZ,oZ,sZ,hY,cZ,pZ,fZ,mZ,vZ,gZ,bZ,kZ,SZ,IZ,gY,_Z,CZ,EZ,RZ,MZ,OZ,LZ,zZ,BZ,WZ,VZ,jZ,GZ,HZ,KZ,XZ,QZ,ZZ,JZ,eJ,nJ,rJ,rY,aJ,iJ];oJ<sJ.length;oJ++){Bi(sJ[oJ])}var uJ=hn();uJ.registerFlag("WASM_HAS_SIMD_SUPPORT",y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])));case 4:return e.prev=4,e.t0=e.catch(0),e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})))),uJ.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!uJ.get("IS_NODE")){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.abrupt("return",((new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))));case 6:return e.prev=6,e.t0=e.catch(2),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[2,6]])}))));var cJ=qe(pt()),lJ=qe(dt()),pJ=qe(ft()),dJ=cJ.default||cJ,fJ=pJ.default||pJ,hJ=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this)).wasm=e,r.dataIdNextNumber=1,r.wasm.tfjs.initWithThreadsCount(CJ),TJ=r.wasm.tfjs.getThreadsCount(),r.dataIdMap=new ht(Ie(r),Fu()),r}return v(n,[{key:"write",value:function(e,t,n){var r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}},{key:"numDataIds",value:function(){return this.dataIdMap.numDataIds()}},{key:"time",value:function(){var e=y(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Hi.now(),e.abrupt("return",(t(),{kernelMs:Hi.now()-n}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"move",value:function(e,t,n,r,a){var i=this.dataIdNextNumber++;if("string"!==r){var o=Hi.sizeFromShape(n),s=o*Hi.bytesPerElement(r),u=this.wasm._malloc(s);this.dataIdMap.set(e,{id:i,memoryOffset:u,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(i,o,u),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,s),u)}else{var c=t;this.dataIdMap.set(e,{id:i,stringBytes:c,shape:n,dtype:r,memoryOffset:null,refCount:a})}}},{key:"read",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e,t,n){var r=this.dataIdMap.get(e),a=r.memoryOffset,i=r.dtype,o=r.shape,s=r.stringBytes;if("string"===i)return null!=t&&0!==t||!(null==n||n>=s.length)?s.slice(t,n):s;t=t||0,n=n||Hi.sizeFromShape(o);var u=Hi.bytesPerElement(i);return function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error("Unknown dtype ".concat(t))}}(this.wasm.HEAPU8.slice(a+t*u,a+n*u).buffer,i)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.dataIdMap.has(e)){var n=this.dataIdMap.get(e);if(n.refCount--,!t&&n.refCount>0)return!1;this.wasm._free(n.memoryOffset),this.wasm.tfjs.disposeData(n.id),this.dataIdMap.delete(e)}return!0}},{key:"refCount",value:function(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}},{key:"incRef",value:function(e){var t=this.dataIdMap.get(e);null!=t&&t.refCount++}},{key:"floatPrecision",value:function(){return 32}},{key:"getMemoryOffset",value:function(e){return this.dataIdMap.get(e).memoryOffset}},{key:"dispose",value:function(){this.wasm.tfjs.dispose(),"PThread"in this.wasm&&this.wasm.PThread.terminateAllThreads(),this.wasm=null}},{key:"memory",value:function(){return{unreliable:!1}}},{key:"makeOutput",value:function(e,t,n){var r;if(null==n)r=this.write(null,e,t);else{var a=this.dataIdNextNumber++;r={id:a},this.dataIdMap.set(r,{id:a,memoryOffset:n,shape:e,dtype:t,refCount:1});var i=Hi.sizeFromShape(e);this.wasm.tfjs.registerTensor(a,i,n)}return{dataId:r,shape:e,dtype:t}}},{key:"typedArrayFromHeap",value:function(e){var t=e.shape,n=e.dtype,r=e.dataId,a=this.wasm.HEAPU8.buffer,i=this.dataIdMap.get(r).memoryOffset,o=Hi.sizeFromShape(t);switch(n){case"float32":return new Float32Array(a,i,o);case"int32":return new Int32Array(a,i,o);case"bool":return new Uint8Array(a,i,o);default:throw new Error("Unknown dtype ".concat(n))}}}]),n}(mt);function mJ(e){return function(t,n){return Hi.fetch(e,{credentials:"same-origin"}).then((function(r){r.ok||t.env.a("failed to load wasm binary file at '".concat(e,"'")),r.arrayBuffer().then((function(e){WebAssembly.instantiate(e,t).then((function(e){n(e.instance,e.module)}))}))})),{}}}function vJ(e,t,n){if(null!=xJ)return xJ;var r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),null!=wJ&&null!=wJ[r]?wJ[r]:n+r}function gJ(){return yJ.apply(this,arguments)}function yJ(){return yJ=y(f().mark((function e(){var t,n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([hn().getAsync("WASM_HAS_SIMD_SUPPORT"),hn().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);case 2:return t=e.sent,n=o(t,2),r=n[0],a=n[1],e.abrupt("return",new Promise((function(e,t){var n={locateFile:function(e,t){if(e.endsWith(".worker.js")){var n=lJ.wasmWorkerContents.replace(/\n/g,"\\n"),i=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(i)}return e.endsWith(".wasm")?vJ(r,a,null!=kJ?kJ:t):t+e}};IJ&&(n.instantiateWasm=mJ(vJ(r,a,null!=kJ?kJ:"")));var i,o=!1;n.onAbort=function(){o||SJ||(SJ=!0,t({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))},a&&r&&null==xJ?(n.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+dJ.toString()],{type:"text/javascript"}),i=dJ(n)):i=fJ(n),i.then((function(t){o=!0,SJ=!1;t.tfjs={init:t.cwrap("init",null,[]),initWithThreadsCount:t.cwrap("init_with_threads_count",null,["number"]),getThreadsCount:t.cwrap("get_threads_count","number",[]),registerTensor:t.cwrap("register_tensor",null,["number","number","number"]),disposeData:t.cwrap("dispose_data",null,["number"]),dispose:t.cwrap("dispose",null,[])},e({wasm:t})})).catch(t)})));case 7:case"end":return e.stop()}}),e)}))),yJ.apply(this,arguments)}var bJ=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],xJ=null,kJ=null,wJ={},SJ=!1,IJ=!1;function _J(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Au("setWasmPath has been deprecated in favor of setWasmPaths and will be removed in a future release."),SJ)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPath()` before you call `tf.setBackend()` or `tf.ready()`");xJ=e,IJ=t}function NJ(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(SJ)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if("string"==typeof e)kJ=e;else{wJ=e;var n=bJ.filter((function(e){return null==wJ[e]}));if(n.length>0)throw new Error("There were no entries found for the following binaries: ".concat(n.join(","),". Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found."))}IJ=t}var CJ=-1,TJ=-1;function EJ(e){CJ=e}function AJ(){if(-1===TJ)throw new Error("WASM backend not initialized.");return TJ}var RJ="4.2.0";Hu("wasm",y(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gJ();case 2:return t=e.sent,n=t.wasm,e.abrupt("return",new hJ(n));case 5:case"end":return e.stop()}}),e)}))),2);var FJ="4.2.0",DJ={tfjs:FJ,"tfjs-core":FJ,"tfjs-converter":"4.2.0","tfjs-backend-cpu":"4.2.0","tfjs-backend-webgl":"4.2.0","tfjs-backend-wasm":"4.2.0"};function MJ(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.beginPath(),t.slice(1).forEach((function(n,r){var a=n.x,i=n.y,o=t[r];e.moveTo(o.x,o.y),e.lineTo(a,i)})),n){var r=t[t.length-1],a=t[0];if(!r||!a)return;e.moveTo(r.x,r.y),e.lineTo(a.x,a.y)}e.stroke()}Le({},{AnchorPosition:function(){return k$},DrawBox:function(){return _$},DrawBoxOptions:function(){return I$},DrawFaceLandmarks:function(){return S0},DrawFaceLandmarksOptions:function(){return w0},DrawTextField:function(){return S$},DrawTextFieldOptions:function(){return w$},drawContour:function(){return MJ},drawDetections:function(){return N$},drawFaceExpressions:function(){return b0},drawFaceLandmarks:function(){return I0}});Le({},{computeReshapedDimensions:function(){return HJ},getCenterPoint:function(){return qJ},isDimensions:function(){return GJ},isEven:function(){return VJ},isFloat:function(){return UJ},isTensor:function(){return PJ},isTensor1D:function(){return LJ},isTensor2D:function(){return zJ},isTensor3D:function(){return BJ},isTensor4D:function(){return WJ},isValidNumber:function(){return XJ},isValidProbablitiy:function(){return YJ},range:function(){return KJ},round:function(){return jJ}});var OJ=function(){function e(t,n){if(h(this,e),!XJ(t)||!XJ(n))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have ".concat(JSON.stringify({width:t,height:n})));this._width=t,this._height=n}return v(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"reverse",value:function(){return new e(1/this.width,1/this.height)}}]),e}();function PJ(e,t){return e instanceof To&&e.shape.length===t}function LJ(e){return PJ(e,1)}function zJ(e){return PJ(e,2)}function BJ(e){return PJ(e,3)}function WJ(e){return PJ(e,4)}function UJ(e){return e%1!==0}function VJ(e){return e%2===0}function jJ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=Math.pow(10,t);return Math.floor(e*n)/n}function GJ(e){return e&&e.width&&e.height}function HJ(e,t){var n=e.width,r=e.height,a=t/Math.max(r,n);return new OJ(Math.round(n*a),Math.round(r*a))}function qJ(e){return e.reduce((function(e,t){return e.add(t)}),new QJ(0,0)).div(new QJ(e.length,e.length))}function KJ(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function XJ(e){return!!e&&e!==1/0&&e!==-1/0&&!Number.isNaN(e)||0===e}function YJ(e){return XJ(e)&&e>=0&&e<=1}var QJ=function(){function e(t,n){h(this,e),this._x=t,this._y=n}return v(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"add",value:function(t){return new e(this.x+t.x,this.y+t.y)}},{key:"sub",value:function(t){return new e(this.x-t.x,this.y-t.y)}},{key:"mul",value:function(t){return new e(this.x*t.x,this.y*t.y)}},{key:"div",value:function(t){return new e(this.x/t.x,this.y/t.y)}},{key:"abs",value:function(){return new e(Math.abs(this.x),Math.abs(this.y))}},{key:"magnitude",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"floor",value:function(){return new e(Math.floor(this.x),Math.floor(this.y))}}]),e}(),ZJ=function(){function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];h(this,e);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every(XJ),i=[r.x,r.y,r.width,r.height].every(XJ);if(!i&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have ".concat(JSON.stringify(r)));var s=o(i?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],4),u=s[0],c=s[1],l=s[2],p=s[3];e.assertIsValidBox({x:u,y:c,width:l,height:p},"Box.constructor",n),this._x=u,this._y=c,this._width=l,this._height=p}return v(e,[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"left",get:function(){return this.x}},{key:"top",get:function(){return this.y}},{key:"right",get:function(){return this.x+this.width}},{key:"bottom",get:function(){return this.y+this.height}},{key:"area",get:function(){return this.width*this.height}},{key:"topLeft",get:function(){return new QJ(this.left,this.top)}},{key:"topRight",get:function(){return new QJ(this.right,this.top)}},{key:"bottomLeft",get:function(){return new QJ(this.left,this.bottom)}},{key:"bottomRight",get:function(){return new QJ(this.right,this.bottom)}},{key:"round",value:function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)})),n=o(t,4);return new e({x:n[0],y:n[1],width:n[2],height:n[3]})}},{key:"floor",value:function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)})),n=o(t,4);return new e({x:n[0],y:n[1],width:n[2],height:n[3]})}},{key:"toSquare",value:function(){var t=this.x,n=this.y,r=this.width,a=this.height,i=Math.abs(r-a);return r<a&&(t-=i/2,r+=i),a<r&&(n-=i/2,a+=i),new e({x:t,y:n,width:r,height:a})}},{key:"rescale",value:function(t){var n=GJ(t)?t.width:t,r=GJ(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})}},{key:"pad",value:function(t,n){return new e({x:this.x-t/2,y:this.y-n/2,width:this.width+t,height:this.height+n})}},{key:"clipAtImageBorders",value:function(t,n){var r=this.x,a=this.y,i=this.right,o=this.bottom,s=Math.max(r,0),u=Math.max(a,0),c=i-s,l=o-u;return new e({x:s,y:u,width:Math.min(c,t-s),height:Math.min(l,n-u)}).floor()}},{key:"shift",value:function(t,n){var r=this.width,a=this.height;return new e({x:this.x+t,y:this.y+n,width:r,height:a})}},{key:"padAtBorders",value:function(e,t){var n=this.width+1,r=this.height+1,a=n,i=r,o=this.left,s=this.top,u=this.right,c=this.bottom;return u>t&&(a=-u+t+n,u=t),c>e&&(i=-c+e+r,c=e),o<1&&(i=2-o,o=1),s<1&&(i=2-s,s=1),{dy:1,edy:i,dx:1,edx:a,y:s,ey:c,x:o,ex:u,w:n,h:r}}},{key:"calibrate",value:function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()}}],[{key:"isRect",value:function(e){return!!e&&[e.x,e.y,e.width,e.height].every(XJ)}},{key:"assertIsValidBox",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e.isRect(t))throw new Error("".concat(n," - invalid box: ").concat(JSON.stringify(t),", expected object with properties x, y, width, height"));if(!r&&(t.width<0||t.height<0))throw new Error("".concat(n," - width (").concat(t.width,") and height (").concat(t.height,") must be positive numbers"))}}]),e}(),JJ=function(e){Ae(n,e);var t=Re(n);function n(e,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return h(this,n),t.call(this,{left:e,top:r,right:a,bottom:i},o)}return v(n)}(ZJ),$J=function(){function e(t,n,r,a,i){h(this,e),this._imageDims=new OJ(i.width,i.height),this._score=t,this._classScore=n,this._className=r,this._box=new ZJ(a).rescale(this._imageDims)}return v(e,[{key:"score",get:function(){return this._score}},{key:"classScore",get:function(){return this._classScore}},{key:"className",get:function(){return this._className}},{key:"box",get:function(){return this._box}},{key:"imageDims",get:function(){return this._imageDims}},{key:"imageWidth",get:function(){return this.imageDims.width}},{key:"imageHeight",get:function(){return this.imageDims.height}},{key:"relativeBox",get:function(){return new ZJ(this._box).rescale(this.imageDims.reverse())}},{key:"forSize",value:function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})}}]),e}(),e$=function(e){Ae(n,e);var t=Re(n);function n(e,r,a){return h(this,n),t.call(this,e,e,"",r,a)}return v(n,[{key:"forSize",value:function(e,t){var r=Se(we(n.prototype),"forSize",this).call(this,e,t);return new n(r.score,r.relativeBox,r.imageDims)}}]),n}($J);function t$(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function n$(e,t,n){for(var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),i=[],o=function(){var t=a.pop();i.push(t);for(var o=a,s=[],u=0;u<o.length;u++){var c=o[u],l=e[t],p=e[c];s.push(t$(l,p,r))}a=a.filter((function(e,t){return s[t]<=n}))};a.length>0;)o();return i}function r$(e,t){return Ou((function(){var n=o(t,3),r=n[0],a=n[1],i=n[2],s=Hc([].concat(Fe(e.shape.slice(0,3)),[1]),r,"float32"),u=Hc([].concat(Fe(e.shape.slice(0,3)),[1]),a,"float32"),c=Hc([].concat(Fe(e.shape.slice(0,3)),[1]),i,"float32"),l=Ec([s,u,c],3);return bp(e,l)}))}function a$(e){return 1/(1+Math.exp(-e))}var i$,o$=function(e){Ae(n,e);var t=Re(n);function n(e,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return h(this,n),t.call(this,{x:e,y:r,width:a,height:i},o)}return v(n)}(ZJ),s$=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new QJ(0,0);h(this,e);var a=n.width,i=n.height;this._imgDims=new OJ(a,i),this._shift=r,this._positions=t.map((function(e){return e.mul(new QJ(a,i)).add(r)}))}return v(e,[{key:"shift",get:function(){return new QJ(this._shift.x,this._shift.y)}},{key:"imageWidth",get:function(){return this._imgDims.width}},{key:"imageHeight",get:function(){return this._imgDims.height}},{key:"positions",get:function(){return this._positions}},{key:"relativePositions",get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new QJ(e.imageWidth,e.imageHeight))}))}},{key:"forSize",value:function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})}},{key:"shiftBy",value:function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new QJ(e,t))}},{key:"shiftByPoint",value:function(e){return this.shiftBy(e.x,e.y)}},{key:"align",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){var n=e instanceof e$?e.box.floor():new ZJ(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=p({useDlibAlignment:!1,minBoxPadding:.2},t),a=r.useDlibAlignment,i=r.minBoxPadding;return a?this.alignDlib():this.alignMinBbox(i)}},{key:"alignDlib",value:function(){var e=this.getRefPointsForAlignment(),t=o(e,3),n=t[0],r=t[1],a=t[2],i=function(e){return a.sub(e).magnitude()},s=(i(n)+i(r))/2,u=Math.floor(s/.45),c=qJ(e),l=Math.floor(Math.max(0,c.x-.5*u)),p=Math.floor(Math.max(0,c.y-.43*u));return new o$(l,p,Math.min(u,this.imageWidth+l),Math.min(u,this.imageHeight+p))}},{key:"alignMinBbox",value:function(e){var t=function(e){var t=e.map((function(e){return e.x})),n=e.map((function(e){return e.y})),r=t.reduce((function(e,t){return t<e?t:e}),1/0),a=n.reduce((function(e,t){return t<e?t:e}),1/0),i=t.reduce((function(e,t){return e<t?t:e}),0),o=n.reduce((function(e,t){return e<t?t:e}),0);return new JJ(r,a,i,o)}(this.positions);return t.pad(t.width*e,t.height*e)}},{key:"getRefPointsForAlignment",value:function(){throw new Error("getRefPointsForAlignment not implemented by base class")}}]),e}(),u$=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"getJawOutline",value:function(){return this.positions.slice(0,17)}},{key:"getLeftEyeBrow",value:function(){return this.positions.slice(17,22)}},{key:"getRightEyeBrow",value:function(){return this.positions.slice(22,27)}},{key:"getNose",value:function(){return this.positions.slice(27,36)}},{key:"getLeftEye",value:function(){return this.positions.slice(36,42)}},{key:"getRightEye",value:function(){return this.positions.slice(42,48)}},{key:"getMouth",value:function(){return this.positions.slice(48,68)}},{key:"getRefPointsForAlignment",value:function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(qJ)}}]),n}(s$);function c$(e){return e.detection instanceof e$}function l$(e,t){return p(p({},e),{detection:t})}function p$(){var e=window.fetch;if(!e)throw new Error("fetch - missing fetch implementation for browser environment");return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},createVideoElement:function(){return document.createElement("video")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function d$(){return"object"==typeof n.g&&"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node}function f$(e){var t="";if(!e&&d$())try{e=Pe("fs")}catch(N){t=N.toString()}return{readFile:e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: ".concat(t))}}}function h$(){var e=n.g.Canvas||n.g.HTMLCanvasElement,t=n.g.Image||n.g.HTMLImageElement,r=n.g.Video||n.g.HTMLVideoElement,a=n.g.fetch,i=f$();return p({Canvas:e||function(){return v((function e(){h(this,e)}))}(),CanvasRenderingContext2D:n.g.CanvasRenderingContext2D||function(){return v((function e(){h(this,e)}))}(),Image:t||function(){return v((function e(){h(this,e)}))}(),ImageData:n.g.ImageData||function(){return v((function e(){h(this,e)}))}(),Video:n.g.HTMLVideoElement||function(){return v((function e(){h(this,e)}))}(),createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},createVideoElement:function(){if(r)return new r;throw new Error("createVideoElement - missing Video implementation for nodejs environment")},fetch:a},i)}function m$(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function v$(e){i$=e}function g$(){return m$()?v$(p$()):d$()?v$(h$()):null}var y$={getEnv:function(){if(!i$)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return i$},setEnv:v$,initialize:g$,createBrowserEnv:p$,createFileSystem:f$,createNodejsEnv:h$,monkeyPatch:function(e){if(i$||g$(),!i$)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?i$.Canvas:t,r=e.Image,a=void 0===r?i$.Image:r;i$.Canvas=n,i$.Image=a,i$.createCanvasElement=e.createCanvasElement||function(){return new n},i$.createImageElement=e.createImageElement||function(){return new a},i$.ImageData=e.ImageData||i$.ImageData,i$.Video=e.Video||i$.Video,i$.fetch=e.fetch||i$.fetch,i$.readFile=e.readFile||i$.readFile},isBrowser:m$,isNodejs:d$};function b$(e){return y$.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function x$(e){var t=y$.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=b$(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var a=r.getContext("2d");if(!a)throw new Error("resolveContext2d - canvas 2d context is null");return a}g$();var k$=function(e){return e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT",e}(k$||{}),w$=v((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,e);var n=t.anchorPosition,r=t.backgroundColor,a=t.fontColor,i=t.fontSize,o=t.fontStyle,s=t.padding;this.anchorPosition=n||"TOP_LEFT",this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=a||"rgba(255, 255, 255, 1)",this.fontSize=i||14,this.fontStyle=o||"Georgia",this.padding=s||4})),S$=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};h(this,e),this.text="string"==typeof t?[t]:t instanceof e?t.text:t,this.anchor=n,this.options=new w$(r)}return v(e,[{key:"measureWidth",value:function(e){var t=this.options.padding;return this.text.map((function(t){return e.measureText(t).width})).reduce((function(e,t){return e<t?t:e}),0)+2*t}},{key:"measureHeight",value:function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n}},{key:"getUpperLeft",value:function(e,t){var n=this.options.anchorPosition,r="BOTTOM_RIGHT"===n||"TOP_RIGHT"===n,a="BOTTOM_LEFT"===n||"BOTTOM_RIGHT"===n,i=this.measureWidth(e),o=this.measureHeight(),s=r?this.anchor.x-i:this.anchor.x,u=a?this.anchor.y-o:this.anchor.y;if(t){var c=t.width,l=t.height;return{x:Math.max(Math.min(s,c-i),0),y:Math.max(Math.min(u,l-o),0)}}return{x:s,y:u}}},{key:"draw",value:function(e){var t=b$(e),n=x$(t),r=this.options,a=r.backgroundColor,i=r.fontColor,o=r.fontSize,s=r.fontStyle,u=r.padding;n.font="".concat(o,"px ").concat(s);var c=this.measureWidth(n),l=this.measureHeight();n.fillStyle=a;var p=this.getUpperLeft(n,t);n.fillRect(p.x,p.y,c,l),n.fillStyle=i,this.text.forEach((function(e,t){var r=u+p.x,a=u+p.y+(t+1)*o;n.fillText(e,r,a)}))}}]),e}(),I$=v((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,e);var n=t.boxColor,r=t.lineWidth,a=t.label,i=t.drawLabelOptions;this.boxColor=n||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=a;var o={anchorPosition:"BOTTOM_LEFT",backgroundColor:this.boxColor};this.drawLabelOptions=new w$(p(p({},o),i))})),_$=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h(this,e),this.box=new ZJ(t),this.options=new I$(n)}return v(e,[{key:"draw",value:function(e){var t=x$(e),n=this.options,r=n.boxColor,a=n.lineWidth,i=this.box,o=i.x,s=i.y,u=i.width,c=i.height;t.strokeStyle=r,t.lineWidth=a,t.strokeRect(o,s,u,c);var l=this.options.label;l&&new S$([l],{x:o-a/2,y:s},this.options.drawLabelOptions).draw(e)}}]),e}();function N$(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof e$?t.score:c$(t)?t.detection.score:void 0,r=t instanceof e$?t.box:c$(t)?t.detection.box:new ZJ(t),a=n?"".concat(jJ(n)):void 0;new _$(r,{label:a}).draw(e)}))}function C$(e){var t=y$.getEnv(),n=t.Image,r=t.Video;return e instanceof n&&e.complete||e instanceof r&&e.readyState>=3}function T$(e){return new Promise((function(t,n){function r(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",a),e.currentTarget.removeEventListener("error",r),n(e))}function a(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",a),e.currentTarget.removeEventListener("error",r),t(e))}(e instanceof y$.getEnv().Canvas||C$(e))&&t(null),e.addEventListener("load",a),e.addEventListener("error",r)}))}function E$(e){var t=y$.getEnv(),n=t.Image,r=t.Video;return e instanceof n?new OJ(e.naturalWidth,e.naturalHeight):e instanceof r?new OJ(e.videoWidth,e.videoHeight):new OJ(e.width,e.height)}function A$(e){var t=e.width,n=e.height,r=(0,y$.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function R$(e,t){var n=y$.getEnv().ImageData;if(!(e instanceof n)&&!C$(e))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||E$(e),a=r.width,i=r.height,o=A$({width:a,height:i});return e instanceof n?x$(o).putImageData(e,0,0):x$(o).drawImage(e,0,0,a,i),o}function F$(e,t){return D$.apply(this,arguments)}function D$(){return D$=y(f().mark((function e(t,n){var r,a,i,s,u,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n||y$.getEnv().createCanvasElement(),a=t.shape.slice(WJ(t)?1:0),i=o(a,3),s=i[0],u=i[1],c=i[2],l=Ou((function(){return t.as3D(s,u,c).toInt()})),e.next=3,Ym.toPixels(l,r);case 3:return l.dispose(),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)}))),D$.apply(this,arguments)}function M$(e){var t=y$.getEnv(),n=t.Image,r=t.Canvas,a=t.Video;return e instanceof n||e instanceof r||e instanceof a}var O$=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h(this,e),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],this._inputSize=0,!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have ".concat(t));this._treatAsBatchInput=r,this._batchSize=t.length,t.forEach((function(e,t){if(BJ(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(WJ(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize ".concat(r," passed, but not supported in input array"));return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var a=e instanceof y$.getEnv().Canvas?e:R$(e);n._canvases[t]=a,n._inputDimensions[t]=[a.height,a.width,3]}))}return v(e,[{key:"imageTensors",get:function(){return this._imageTensors}},{key:"canvases",get:function(){return this._canvases}},{key:"isBatchInput",get:function(){return this.batchSize>1||this._treatAsBatchInput}},{key:"batchSize",get:function(){return this._batchSize}},{key:"inputDimensions",get:function(){return this._inputDimensions}},{key:"inputSize",get:function(){return this._inputSize}},{key:"reshapedInputDimensions",get:function(){var e=this;return KJ(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))}},{key:"getInput",value:function(e){return this.canvases[e]||this.imageTensors[e]}},{key:"getInputDimensions",value:function(e){return this._inputDimensions[e]}},{key:"getInputHeight",value:function(e){return this._inputDimensions[e][0]}},{key:"getInputWidth",value:function(e){return this._inputDimensions[e][1]}},{key:"getReshapedInputDimensions",value:function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return HJ({width:this.getInputWidth(e),height:this.getInputHeight(e)},this.inputSize)}},{key:"toBatchTensor",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._inputSize=e,Ou((function(){var r=KJ(t.batchSize,0,1).map((function(r){var a=t.getInput(r);if(a instanceof To){var i=WJ(a)?a:Gl(a);return i=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Ou((function(){var n=o(e.shape.slice(1),2),r=n[0],a=n[1];if(r===a)return e;var i=Math.abs(r-a),s=Math.round(i*(t?.5:1)),u=r>a?2:1,c=function(t){var n=e.shape.slice();return n[u]=t,Hc(n,0,"float32")},l=c(s),p=i-l.shape[u],d=[t&&p?c(p):null,e,l].filter((function(e){return!!e})).map((function(e){return Iu(e,"float32")}));return Ec(d,u)}))}(i,n),(i.shape[1]!==e||i.shape[2]!==e)&&(i=tm.resizeBilinear(i,[e,e],!1,!1)),i.as3D(e,e,3)}if(a instanceof y$.getEnv().Canvas)return Ym.fromPixels(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=y$.getEnv(),a=r.Image,i=r.Canvas;if(!(e instanceof a||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");if(t<=0)return A$({width:1,height:1});var o=E$(e),s=t/Math.max(o.height,o.width),u=s*o.width,c=s*o.height,l=A$({width:t,height:t}),p=e instanceof i?e:R$(e),d=Math.abs(u-c)/2,f=n&&u<c?d:0,h=n&&c<u?d:0;return p.width>0&&p.height>0&&x$(l).drawImage(p,f,h,u,c),l}(a,e,n));throw new Error("toBatchTensor - at batchIdx ".concat(r,", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have ").concat(a))}));return uf(r.map((function(e){return Iu(e,"float32")}))).as4D(t.batchSize,e,e,3)}))}}]),e}();function P$(e){return L$.apply(this,arguments)}function L$(){return L$=y(f().mark((function e(t){var n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof O$)){e.next=2;break}return e.abrupt("return",t);case 2:if((n=Array.isArray(t)?t:[t]).length){e.next=5;break}throw new Error("toNetInput - empty array passed as input");case 5:return r=function(e){return Array.isArray(t)?" at input index ".concat(e,":"):""},(a=n.map(b$)).forEach((function(e,t){if(!M$(e)&&!BJ(e)&&!WJ(e))throw"string"==typeof n[t]?new Error("toNetInput -".concat(r(t)," string passed, but could not resolve HTMLElement for element id ").concat(n[t])):new Error("toNetInput -".concat(r(t)," expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id"));if(WJ(e)){var a=e.shape[0];if(1!==a)throw new Error("toNetInput -".concat(r(t)," tf.Tensor4D with batchSize ").concat(a," passed, but not supported in input array"))}})),e.next=9,Promise.all(a.map((function(e){return M$(e)&&T$(e)})));case 9:return e.abrupt("return",new O$(a,Array.isArray(t)));case 10:case"end":return e.stop()}}),e)}))),L$.apply(this,arguments)}function z$(e,t){return B$.apply(this,arguments)}function B$(){return B$=y(f().mark((function e(t,n){var r,a,i,o,s,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=y$.getEnv(),a=r.Canvas,i=t,t instanceof a){e.next=16;break}return e.next=4,P$(t);case 4:if(!((o=e.sent).batchSize>1)){e.next=7;break}throw new Error("extractFaces - batchSize > 1 not supported");case 7:if(!((s=o.getInput(0))instanceof a)){e.next=12;break}e.t0=s,e.next=15;break;case 12:return e.next=14,F$(s);case 14:e.t0=e.sent;case 15:i=e.t0;case 16:return u=x$(i),e.abrupt("return",n.map((function(e){return e instanceof e$?e.forSize(i.width,i.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(i.width,i.height)})).map((function(e){var t=e.x,n=e.y,r=e.width,a=e.height,i=A$({width:r,height:a});return r>0&&a>0&&x$(i).putImageData(u.getImageData(t,n,r,a),0,0),i})));case 18:case"end":return e.stop()}}),e)}))),B$.apply(this,arguments)}function W$(e,t){return U$.apply(this,arguments)}function U$(){return U$=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(BJ(t)||WJ(t)){e.next=2;break}throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");case 2:if(!(WJ(t)&&t.shape[0]>1)){e.next=4;break}throw new Error("extractFaceTensors - batchSize > 1 not supported");case 4:return e.abrupt("return",Ou((function(){var e=o(t.shape.slice(WJ(t)?1:0),3),r=e[0],a=e[1],i=e[2];return n.map((function(e){return e instanceof e$?e.forSize(a,r).box:e})).map((function(e){return e.clipAtImageBorders(a,r)})).filter((function(e){return e.width>0&&e.height>0})).map((function(e){var n=e.x,o=e.y,s=e.width,u=e.height;return Zd(t.as3D(r,a,i),[o,n,0],[u,s,i])}))})));case 5:case"end":return e.stop()}}),e)}))),U$.apply(this,arguments)}function V$(e,t){return j$.apply(this,arguments)}function j$(){return j$=y(f().mark((function e(t,n){var r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y$.getEnv(),a=r.fetch,e.next=4,a(t,n);case 4:if((i=e.sent).status<400){e.next=7;break}throw new Error("failed to fetch: (".concat(i.status,") ").concat(i.statusText,", from url: ").concat(i.url));case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)}))),j$.apply(this,arguments)}function G$(e){return H$.apply(this,arguments)}function H$(){return H$=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V$(t);case 2:return e.abrupt("return",e.sent.json());case 3:case"end":return e.stop()}}),e)}))),H$.apply(this,arguments)}function q$(e,t){var n="".concat(t,"-weights_manifest.json");if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/".concat(n)};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",a=(e=e.replace(r,"")).split("/").filter((function(e){return e})),i=e.endsWith(".json")?a[a.length-1]:n,o=r+(e.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return{modelBaseUri:o=e.startsWith("/")?"/".concat(o):o,manifestUri:"/"===o?"/".concat(i):"".concat(o,"/").concat(i)}}function K$(e,t){return X$.apply(this,arguments)}function X$(){return X$=y(f().mark((function e(t,n){var r,a,i,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=q$(t,n),a=r.manifestUri,i=r.modelBaseUri,e.next=5,G$(a);case 5:return o=e.sent,e.abrupt("return",bm.loadWeights(o,i));case 7:case"end":return e.stop()}}),e)}))),X$.apply(this,arguments)}var Y$=function(){function e(t){h(this,e),this._params=void 0,this._paramMappings=[],this._name=t}return v(e,[{key:"params",get:function(){return this._params}},{key:"paramMappings",get:function(){return this._paramMappings}},{key:"isLoaded",get:function(){return!!this.params}},{key:"getParamFromPath",value:function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]}},{key:"reassignParamFromPath",value:function(e,t){var n=this.traversePropertyPath(e),r=n.obj,a=n.objProp;r[a].dispose(),r[a]=t}},{key:"getParamList",value:function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))}},{key:"getTrainableParams",value:function(){return this.getParamList().filter((function(e){return e.tensor instanceof Ao}))}},{key:"getFrozenParams",value:function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof Ao)}))}},{key:"variable",value:function(){var e=this;this.getFrozenParams().forEach((function(t){var n=t.path,r=t.tensor;e.reassignParamFromPath(n,r.variable())}))}},{key:"freeze",value:function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,a=ds(r.dataSync());r.dispose(),e.reassignParamFromPath(n,a)}))}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path ".concat(t.path));t.tensor.dispose()})),this._params=void 0}},{key:"serializeParams",value:function(){return new Float32Array(this.getParamList().map((function(e){var t=e.tensor;return Array.from(t.dataSync())})).reduce((function(e,t){return e.concat(t)})))}},{key:"load",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof Float32Array)){e.next=3;break}return this.extractWeights(t),e.abrupt("return");case 3:return e.next=5,this.loadFromUri(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromUri",value:function(){var e=y(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("".concat(this._name,".loadFromUri - expected model uri"));case 2:return e.next=4,K$(t,this.getDefaultModelName());case 4:n=e.sent,this.loadFromWeightMap(n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromDisk",value:function(){var e=y(f().mark((function e(t){var n,r,a,i,o,s,u,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("".concat(this._name,".loadFromDisk - expected model file path"));case 2:return n=y$.getEnv(),r=n.readFile,a=q$(t,this.getDefaultModelName()),i=a.manifestUri,o=a.modelBaseUri,s=function(e){return Promise.all(e.map((function(e){return r(e).then((function(e){return e.buffer}))})))},u=bm.weightsLoaderFactory(s),e.t0=JSON,e.next=12,r(i);case 12:return e.t1=e.sent.toString(),c=e.t0.parse.call(e.t0,e.t1),e.next=16,u(c,o);case 16:l=e.sent,this.loadFromWeightMap(l);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadFromWeightMap",value:function(e){var t=this.extractParamsFromWeightMap(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r}},{key:"extractWeights",value:function(e){var t=this.extractParams(e),n=t.paramMappings,r=t.params;this._paramMappings=n,this._params=r}},{key:"traversePropertyPath",value:function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property ".concat(n,", for path ").concat(e));return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!n||!r||!(n[r]instanceof To))throw new Error("traversePropertyPath - parameter is not a tensor, for path ".concat(e));return{obj:n,objProp:r}}}]),e}();function Q$(e,t,n){return Ou((function(){var r=jd(e,t.depthwise_filter,t.pointwise_filter,n,"same");return r=Xu(r,t.bias)}))}function Z$(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ou((function(){var r=Dd(n?Xu(Zc(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):Q$(e,t.conv0,[2,2])),a=Q$(r,t.conv1,[1,1]),i=Q$(Dd(Xu(r,a)),t.conv2,[1,1]);return Dd(Xu(r,Xu(a,i)))}))}function J$(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return Ou((function(){var a=Dd(n?Xu(Zc(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):Q$(e,t.conv0,r?[2,2]:[1,1])),i=Q$(a,t.conv1,[1,1]),o=Q$(Dd(Xu(a,i)),t.conv2,[1,1]),s=Q$(Dd(Xu(a,Xu(i,o))),t.conv3,[1,1]);return Dd(Xu(a,Xu(i,Xu(o,s))))}))}function $$(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"same",r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Ou((function(){var a=Xu(Zc(e,t.filters,[1,1],n),t.bias);return r?Dd(a):a}))}function e0(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function t0(e,t){return function(n,r,a,i){var o=mf(e(n*r*a*a),[a,a,n,r]),s=df(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/bias")}),{filters:o,bias:s}}}function n0(e,t){return function(n,r,a){var i=ff(e(n*r),[n,r]),o=df(e(r));return t.push({paramPath:"".concat(a,"/weights")},{paramPath:"".concat(a,"/bias")}),{weights:i,bias:o}}}var r0=v((function e(t,n,r){h(this,e),this.depthwise_filter=t,this.pointwise_filter=n,this.bias=r}));function a0(e,t){return function(n,r,a){var i=mf(e(9*n),[3,3,n,1]),o=mf(e(n*r),[1,1,n,r]),s=df(e(r));return t.push({paramPath:"".concat(a,"/depthwise_filter")},{paramPath:"".concat(a,"/pointwise_filter")},{paramPath:"".concat(a,"/bias")}),new r0(i,o,s)}}function i0(e){return function(t){var n=e("".concat(t,"/depthwise_filter"),4),r=e("".concat(t,"/pointwise_filter"),4),a=e("".concat(t,"/bias"),1);return new r0(n,r,a)}}function o0(e,t){return function(n,r,a){var i=e[n];if(!PJ(i,r))throw new Error("expected weightMap[".concat(n,"] to be a Tensor").concat(r,"D, instead have ").concat(i));return t.push({originalPath:n,paramPath:a||n}),i}}function s0(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function u0(e,t){var n=t0(e,t),r=a0(e,t);function a(e,t,a){return{conv0:arguments.length>3&&void 0!==arguments[3]&&arguments[3]?n(e,t,3,"".concat(a,"/conv0")):r(e,t,"".concat(a,"/conv0")),conv1:r(t,t,"".concat(a,"/conv1")),conv2:r(t,t,"".concat(a,"/conv2"))}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:function(e,t,n){var i=a(e,t,n,arguments.length>3&&void 0!==arguments[3]&&arguments[3]);return{conv0:i.conv0,conv1:i.conv1,conv2:i.conv2,conv3:r(t,t,"".concat(n,"/conv3"))}}}}function c0(e){return function(t){return{filters:e("".concat(t,"/filters"),4),bias:e("".concat(t,"/bias"),1)}}}function l0(e,t){var n=o0(e,t),r=c0(n),a=i0(n);return{extractDenseBlock3Params:function(e){return{conv0:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?r("".concat(e,"/conv0")):a("".concat(e,"/conv0")),conv1:a("".concat(e,"/conv1")),conv2:a("".concat(e,"/conv2"))}},extractDenseBlock4Params:function(e){return{conv0:arguments.length>1&&void 0!==arguments[1]&&arguments[1]?r("".concat(e,"/conv0")):a("".concat(e,"/conv0")),conv1:a("".concat(e,"/conv1")),conv2:a("".concat(e,"/conv2")),conv3:a("".concat(e,"/conv3"))}}}}var p0=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.call(this,"FaceFeatureExtractor")}return v(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return Ou((function(){var n=J$(r$(Iu(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),t.dense0,!0);return n=J$(n,t.dense1),n=J$(n,t.dense2),n=J$(n,t.dense3),n=Cc(n,[7,7],[2,2],"valid")}))}},{key:"forward",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,P$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_feature_extractor_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=l0(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return e0(e,t),{params:r,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=s0(e),r=n.extractWeights,a=n.getRemainingWeights,i=u0(r,t).extractDenseBlock4Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2"),c=i(128,256,"dense3");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u,dense3:c}}}(e)}}]),n}(Y$);function d0(e,t){return Ou((function(){return Xu(Ac(e,t.weights),t.bias)}))}function f0(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var h0=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this,e))._faceFeatureExtractor=r,a}return v(n,[{key:"faceFeatureExtractor",get:function(){return this._faceFeatureExtractor}},{key:"runNet",value:function(e){var t=this,n=this.params;if(!n)throw new Error("".concat(this._name," - load model before inference"));return Ou((function(){var r=e instanceof O$?t.faceFeatureExtractor.forwardInput(e):e;return d0(r.as2D(r.shape[0],-1),n.fc)}))}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.faceFeatureExtractor.dispose(e),Se(we(n.prototype),"dispose",this).call(this,e)}},{key:"loadClassifierParams",value:function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r}},{key:"extractClassifierParams",value:function(e){return function(e,t,n){var r=[],a=s0(e),i=a.extractWeights,o=a.getRemainingWeights,s=n0(i,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: ".concat(o().length));return{paramMappings:r,params:{fc:s}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())}},{key:"extractParamsFromWeightMap",value:function(e){var t=f0(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=o0(e,t),r={fc:function(e){return{weights:n("".concat(e,"/weights"),2),bias:n("".concat(e,"/bias"),1)}}("fc")};return e0(e,t),{params:r,paramMappings:t}}(r)}},{key:"extractParams",value:function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,a=e.slice(0,e.length-r),i=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(i)}}]),n}(Y$),m0=["neutral","happy","sad","angry","fearful","disgusted","surprised"],v0=function(){function e(t){var n=this;if(h(this,e),this.neutral=0,this.happy=0,this.sad=0,this.angry=0,this.fearful=0,this.disgusted=0,this.surprised=0,7!==t.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: ".concat(t.length));m0.forEach((function(e,r){n[e]=t[r]}))}return v(e,[{key:"asSortedArray",value:function(){var e=this;return m0.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))}}]),e}(),g0=function(e){Ae(n,e);var t=Re(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p0;return h(this,n),t.call(this,"FaceExpressionNet",e)}return v(n,[{key:"forwardInput",value:function(e){var t=this;return Ou((function(){return $d(t.runNet(e))}))}},{key:"forward",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,P$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predictExpressions",value:function(){var e=y(f().mark((function e(t){var n,r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P$(t);case 2:return n=e.sent,e.next=5,this.forwardInput(n);case 5:return r=e.sent,e.next=8,Promise.all(wf(r).map(function(){var e=y(f().mark((function e(t){var n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dataSync(),e.abrupt("return",(t.dispose(),n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return a=e.sent,r.dispose(),i=a.map((function(e){return new v0(e)})),e.abrupt("return",n.isBatchInput?i:i[0]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_expression_model"}},{key:"getClassifierChannelsIn",value:function(){return 256}},{key:"getClassifierChannelsOut",value:function(){return 7}}]),n}(h0);function y0(e,t){return p(p({},e),{expressions:t})}function b0(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3?arguments[3]:void 0;(Array.isArray(t)?t:[t]).forEach((function(t){var a=t instanceof v0?t:function(e){return e.expressions instanceof v0}(t)?t.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var i=a.asSortedArray().filter((function(e){return e.probability>n})),o=c$(t)?t.detection.box.bottomLeft:r||new QJ(0,0);new S$(i.map((function(e){return"".concat(e.expression," (").concat(jJ(e.probability),")")})),o).draw(e)}))}function x0(e){return c$(e)&&e.landmarks instanceof s$&&e.unshiftedLandmarks instanceof s$&&e.alignedRect instanceof e$}function k0(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),a=r.align(),i=e.detection.imageDims,o=new e$(e.detection.score,a.rescale(i.reverse()),i),s=function(e){var t=function(e){return 180*e/Math.PI},n=function(e,t){return Math.sqrt(Math.pow(e._x-t._x,2)+Math.pow(e._y-t._y,2))},r={roll:void 0,pitch:void 0,yaw:void 0};if(!e||!e._positions||68!==e._positions.length)return r;var a=e._positions;return r.roll=function(e,n){var r=Math.hypot(n._x-e._x,n._y-e._y),a=n._y-e._y,i=Math.asin(a/r),o=t(i);return Math.floor(90-o)*(n._x-e._x<0?-1:1)}(a[27],a[66]),r.pitch=function(e,r,a){var i=n(e,a),o={_x:(e._x+a._x)/2,_y:(e._y+a._y)/2},s=n(r,o),u=Math.atan(s/i);return Math.floor(t(u))*(o._y-r._y<0?-1:1)}(a[14],a[30],a[2]),r.yaw=function(e,t,n){return Math.floor(e._x-t._x)-Math.floor(t._x-n._x)}(a[14],a[33],a[2]),r}(t);return p(p({},e),{landmarks:r,unshiftedLandmarks:t,alignedRect:o,angle:s})}var w0=v((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h(this,e);var n=t.drawLines,r=void 0===n||n,a=t.drawPoints,i=void 0===a||a,o=t.lineWidth,s=t.lineColor,u=t.pointSize,c=t.pointColor;this.drawLines=r,this.drawPoints=i,this.lineWidth=o||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=c||"rgba(255, 0, 255, 1)"})),S0=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};h(this,e),this.faceLandmarks=t,this.options=new w0(n)}return v(e,[{key:"draw",value:function(e){var t=x$(e),n=this.options,r=n.drawLines,a=n.drawPoints,i=n.lineWidth,o=n.lineColor,s=n.pointSize,u=n.pointColor;if(r&&this.faceLandmarks instanceof u$&&(t.strokeStyle=o,t.lineWidth=i,MJ(t,this.faceLandmarks.getJawOutline()),MJ(t,this.faceLandmarks.getLeftEyeBrow()),MJ(t,this.faceLandmarks.getRightEyeBrow()),MJ(t,this.faceLandmarks.getNose()),MJ(t,this.faceLandmarks.getLeftEye(),!0),MJ(t,this.faceLandmarks.getRightEye(),!0),MJ(t,this.faceLandmarks.getMouth(),!0)),a){t.strokeStyle=u,t.fillStyle=u;this.faceLandmarks.positions.forEach((function(e){t.beginPath(),t.arc(e.x,e.y,s,0,2*Math.PI),t.fill()}))}}}]),e}();function I0(e,t){(Array.isArray(t)?t:[t]).forEach((function(t){var n=t instanceof s$?t:x0(t)?t.landmarks:void 0;if(!n)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new S0(n).draw(e)}))}function _0(e,t){var n=[],r=s0(e),a=r.extractWeights,i=r.getRemainingWeights,o=function(e,t){var n=t0(e,t),r=a0(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,a){return{separable_conv0:r(e,t,"".concat(a,"/separable_conv0")),separable_conv1:r(t,t,"".concat(a,"/separable_conv1")),expansion_conv:n(e,t,1,"".concat(a,"/expansion_conv"))}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,"".concat(t,"/separable_conv0")),separable_conv1:r(e,e,"".concat(t,"/separable_conv1")),separable_conv2:r(e,e,"".concat(t,"/separable_conv2"))}}}}(a,n),s=o.extractConvParams,u=o.extractSeparableConvParams,c=o.extractReductionBlockParams,l=o.extractMainBlockParams,p={conv_in:s(3,32,3,"entry_flow/conv_in"),reduction_block_0:c(32,64,"entry_flow/reduction_block_0"),reduction_block_1:c(64,128,"entry_flow/reduction_block_1")},d={};KJ(t,0,1).forEach((function(e){d["main_block_".concat(e)]=l(128,"middle_flow/main_block_".concat(e))}));var f={reduction_block:c(128,256,"exit_flow/reduction_block"),separable_conv:u(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: ".concat(i().length));return{paramMappings:n,params:{entry_flow:p,middle_flow:d,exit_flow:f}}}function N0(e,t){var n=[],r=function(e,t){var n=o0(e,t),r=c0(n),a=i0(n);return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:function(e){return{separable_conv0:a("".concat(e,"/separable_conv0")),separable_conv1:a("".concat(e,"/separable_conv1")),expansion_conv:r("".concat(e,"/expansion_conv"))}},extractMainBlockParams:function(e){return{separable_conv0:a("".concat(e,"/separable_conv0")),separable_conv1:a("".concat(e,"/separable_conv1")),separable_conv2:a("".concat(e,"/separable_conv2"))}}}}(e,n),a=r.extractConvParams,i=r.extractSeparableConvParams,o=r.extractReductionBlockParams,s=r.extractMainBlockParams,u={conv_in:a("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},c={};KJ(t,0,1).forEach((function(e){c["main_block_".concat(e)]=s("middle_flow/main_block_".concat(e))}));var l={reduction_block:o("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return e0(e,n),{params:{entry_flow:u,middle_flow:c,exit_flow:l},paramMappings:n}}function C0(e,t,n){return Xu(Zc(e,t.filters,n,"same"),t.bias)}function T0(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?Dd(e):e;return n=Q$(n,t.separable_conv0,[1,1]),n=Q$(Dd(n),t.separable_conv1,[1,1]),n=Ep(n,[3,3],[2,2],"same"),n=Xu(n,C0(e,t.expansion_conv,[2,2]))}var E0=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),(r=t.call(this,"TinyXception"))._numMainBlocks=e,r}return v(n,[{key:"forwardInput",value:function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return Ou((function(){var r=r$(Iu(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),a=Dd(C0(r,n.entry_flow.conv_in,[2,2]));return a=T0(a,n.entry_flow.reduction_block_0,!1),a=T0(a,n.entry_flow.reduction_block_1),KJ(t._numMainBlocks,0,1).forEach((function(e){a=function(e,t){var n=Q$(Dd(e),t.separable_conv0,[1,1]);return n=Q$(Dd(n),t.separable_conv1,[1,1]),n=Q$(Dd(n),t.separable_conv2,[1,1]),Xu(n,e)}(a,n.middle_flow["main_block_".concat(e)])})),a=T0(a,n.exit_flow.reduction_block),a=Dd(Q$(a,n.exit_flow.separable_conv,[1,1]))}))}},{key:"forward",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,P$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"tiny_xception_model"}},{key:"extractParamsFromWeightMap",value:function(e){return N0(e,this._numMainBlocks)}},{key:"extractParams",value:function(e){return _0(e,this._numMainBlocks)}}]),n}(Y$);var A0=function(e){return e.FEMALE="female",e.MALE="male",e}(A0||{}),R0=function(e){Ae(n,e);var t=Re(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new E0(2);return h(this,n),(e=t.call(this,"AgeGenderNet"))._faceFeatureExtractor=r,e}return v(n,[{key:"faceFeatureExtractor",get:function(){return this._faceFeatureExtractor}},{key:"runNet",value:function(e){var t=this,n=this.params;if(!n)throw new Error("".concat(this._name," - load model before inference"));return Ou((function(){var r=e instanceof O$?t.faceFeatureExtractor.forwardInput(e):e,a=Cc(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:d0(a,n.fc.age).as1D(),gender:d0(a,n.fc.gender)}}))}},{key:"forwardInput",value:function(e){var t=this;return Ou((function(){var n=t.runNet(e),r=n.age,a=n.gender;return{age:r,gender:$d(a)}}))}},{key:"forward",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,P$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"predictAgeAndGender",value:function(){var e=y(f().mark((function e(t){var n,r,a,i,o,s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P$(t);case 2:return n=e.sent,e.next=5,this.forwardInput(n);case 5:return r=e.sent,a=wf(r.age),i=wf(r.gender),o=a.map((function(e,t){return{ageTensor:e,genderTensor:i[t]}})),e.next=11,Promise.all(o.map(function(){var e=y(f().mark((function e(t){var n,r,a,i,o,s,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.ageTensor,r=t.genderTensor,a=n.dataSync()[0],i=r.dataSync()[0],s=(o=i>.5)?"male":"female",u=o?i:1-i,e.abrupt("return",(n.dispose(),r.dispose(),{age:a,gender:s,genderProbability:u}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return s=e.sent,e.abrupt("return",(r.age.dispose(),r.gender.dispose(),n.isBatchInput?s:s[0]));case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"age_gender_model"}},{key:"dispose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.faceFeatureExtractor.dispose(e),Se(we(n.prototype),"dispose",this).call(this,e)}},{key:"loadClassifierParams",value:function(e){var t=this.extractClassifierParams(e),n=t.params,r=t.paramMappings;this._params=n,this._paramMappings=r}},{key:"extractClassifierParams",value:function(e){return function(e){var t=[],n=s0(e),r=n.extractWeights,a=n.getRemainingWeights,i=n0(r,t),o=i(512,1,"fc/age"),s=i(512,2,"fc/gender");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{fc:{age:o,gender:s}}}}(e)}},{key:"extractParamsFromWeightMap",value:function(e){var t=f0(e),n=t.featureExtractorMap,r=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(n),function(e){var t=[],n=o0(e,t);function r(e){return{weights:n("".concat(e,"/weights"),2),bias:n("".concat(e,"/bias"),1)}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return e0(e,t),{params:a,paramMappings:t}}(r)}},{key:"extractParams",value:function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)}}]),n}(Y$),F0=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"postProcess",value:function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,a=t/Math.max(r,n);return{width:n*a,height:r*a}})),a=r.length;return Ou((function(){var n=function(e,t){return uf([Hc([68],e,"float32"),Hc([68],t,"float32")],1).as2D(1,136).as1D()},i=function(e,t){var n=r[e],a=n.width,i=n.height;return t(a,i)?Math.abs(a-i)/2:0};return e.mul(Hc([a,136],t,"float32")).sub(uf(Array.from(Array(a),(function(e,t){return n(function(e){return i(e,(function(e,t){return e<t}))}(t),function(e){return i(e,(function(e,t){return t<e}))}(t))})))).div(uf(Array.from(Array(a),(function(e,t){return n(r[t].width,r[t].height)}))))}))}},{key:"forwardInput",value:function(e){var t=this;return Ou((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){var t=o(e,2);return{height:t[0],width:t[1]}})))}))}},{key:"forward",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,P$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"detectLandmarks",value:function(){var e=y(f().mark((function e(t){var n,r,a,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P$(t);case 2:return n=e.sent,r=Ou((function(){return wf(i.forwardInput(n))})),e.next=6,Promise.all(r.map(function(){var e=y(f().mark((function e(t,r){var a,i,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array.from(t.dataSync()),i=a.filter((function(e,t){return VJ(t)})),o=a.filter((function(e,t){return!VJ(t)})),e.abrupt("return",new u$(Array(68).fill(0).map((function(e,t){return new QJ(i[t],o[t])})),{height:n.getInputHeight(r),width:n.getInputWidth(r)}));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 6:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e.dispose()})),n.isBatchInput?a:a[0]));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getClassifierChannelsOut",value:function(){return 136}}]),n}(h0),D0=function(e){Ae(n,e);var t=Re(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new p0;return h(this,n),t.call(this,"FaceLandmark68Net",e)}return v(n,[{key:"getDefaultModelName",value:function(){return"face_landmark_68_model"}},{key:"getClassifierChannelsIn",value:function(){return 256}}]),n}(F0);var M0=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.call(this,"TinyFaceFeatureExtractor")}return v(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Ou((function(){var n=Z$(r$(Iu(e.toBatchTensor(112,!0),"float32"),[122.782,117.001,104.298]).div(255),t.dense0,!0);return n=Z$(n,t.dense1),n=Z$(n,t.dense2),n=Cc(n,[14,14],[2,2],"valid")}))}},{key:"forward",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,P$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_feature_extractor_tiny_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=l0(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return e0(e,t),{params:r,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=s0(e),r=n.extractWeights,a=n.getRemainingWeights,i=u0(r,t).extractDenseBlock3Params,o=i(3,32,"dense0",!0),s=i(32,64,"dense1"),u=i(64,128,"dense2");if(0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{paramMappings:t,params:{dense0:o,dense1:s,dense2:u}}}(e)}}]),n}(Y$),O0=function(e){Ae(n,e);var t=Re(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new M0;return h(this,n),t.call(this,"FaceLandmark68TinyNet",e)}return v(n,[{key:"getDefaultModelName",value:function(){return"face_landmark_68_tiny_model"}},{key:"getClassifierChannelsIn",value:function(){return 128}}]),n}(F0);function P0(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"same",i=t.conv,o=i.filters,s=i.bias,u=Zc(e,o,n,a);return u=function(e,t){return Xu(Zu(e,t.weights),t.biases)}(u=Xu(u,s),t.scale),r?Dd(u):u}function L0(e,t){return P0(e,t,[1,1],!1)}function z0(e,t){return P0(e,t,[2,2],!0,"valid")}function B0(e,t){function n(n,r,a,i){var o=function(t,n,r){var a=e(t),i=a.length/(n*r*r);if(UJ(i))throw new Error("depth has to be an integer: ".concat(i,", weights.length: ").concat(a.length,", numFilters: ").concat(n,", filterSize: ").concat(r));return Ou((function(){return Af(mf(a,[n,i,r,r]),[2,3,1,0])}))}(n,r,a),s=df(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/bias")}),{filters:o,bias:s}}function r(r,a,i,o){var s=n(r,a,i,"".concat(o,"/conv")),u=function(n,r){var a=df(e(n)),i=df(e(n));return t.push({paramPath:"".concat(r,"/weights")},{paramPath:"".concat(r,"/biases")}),{weights:a,biases:i}}(a,"".concat(o,"/scale"));return{conv:s,scale:u}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,a){return{conv1:r((arguments.length>4&&void 0!==arguments[4]&&arguments[4]?.5:1)*e,t,n,"".concat(a,"/conv1")),conv2:r(e,t,n,"".concat(a,"/conv2"))}}}}function W0(e,t){var n=o0(e,t);function r(e){var t=n("".concat(e,"/conv/filters"),4),r=n("".concat(e,"/conv/bias"),1),a=function(e){return{weights:n("".concat(e,"/scale/weights"),1),biases:n("".concat(e,"/scale/biases"),1)}}(e);return{conv:{filters:t,bias:r},scale:a}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r("".concat(e,"/conv1")),conv2:r("".concat(e,"/conv2"))}}}}function U0(e,t){var n=function(e,t){return P0(e,t,[1,1],!0)}(e,t.conv1);return n=L0(n,t.conv2),n=Xu(n,e),n=Dd(n)}function V0(e,t){var n=z0(e,t.conv1);n=L0(n,t.conv2);var r=Cc(e,2,2,"valid"),a=Mp(r.shape),i=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var o=Fe(n.shape);o[1]=1;var s=Mp(o),u=Fe((n=Ec([n,s],1)).shape);u[2]=1;var c=Mp(u);n=Ec([n,c],2)}return r=i?Ec([r,a],3):r,n=Xu(r,n),n=Dd(n)}var j0=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.call(this,"FaceRecognitionNet")}return v(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return Ou((function(){var n=z0(r$(Iu(e.toBatchTensor(150,!0),"float32"),[122.782,117.001,104.298]).div(255),t.conv32_down);n=U0(n=Ep(n,3,2,"valid"),t.conv32_1),n=U0(n,t.conv32_2),n=U0(n,t.conv32_3),n=U0(n=V0(n,t.conv64_down),t.conv64_1),n=U0(n,t.conv64_2),n=U0(n,t.conv64_3),n=U0(n=V0(n,t.conv128_down),t.conv128_1),n=U0(n,t.conv128_2),n=U0(n=V0(n,t.conv256_down),t.conv256_1);var r=(n=V0(n=U0(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Ac(r,t.fc)}))}},{key:"forward",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,P$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"computeFaceDescriptor",value:function(){var e=y(f().mark((function e(t){var n,r,a,i,o=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=null==t?void 0:t.shape)||!n.some((function(e){return e<=0}))){e.next=2;break}return e.abrupt("return",new Float32Array(128));case 2:return e.next=4,P$(t);case 4:return r=e.sent,a=Ou((function(){return wf(o.forwardInput(r))})),e.next=8,Promise.all(a.map((function(e){return e.data()})));case 8:return i=e.sent,e.abrupt("return",(a.forEach((function(e){return e.dispose()})),r.isBatchInput?i:i[0]));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"face_recognition_model"}},{key:"extractParamsFromWeightMap",value:function(e){return function(e){var t=[],n=W0(e,t),r=n.extractConvLayerParams,a=n.extractResidualLayerParams,i=r("conv32_down"),o=a("conv32_1"),s=a("conv32_2"),u=a("conv32_3"),c=a("conv64_down"),l=a("conv64_1"),p=a("conv64_2"),d=a("conv64_3"),f=a("conv128_down"),h=a("conv128_1"),m=a("conv128_2"),v=a("conv256_down"),g=a("conv256_1"),y=a("conv256_2"),b=a("conv256_down_out"),x=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!zJ(x))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have ".concat(x));var k={conv32_down:i,conv32_1:o,conv32_2:s,conv32_3:u,conv64_down:c,conv64_1:l,conv64_2:p,conv64_3:d,conv128_down:f,conv128_1:h,conv128_2:m,conv256_down:v,conv256_1:g,conv256_2:y,conv256_down_out:b,fc:x};return e0(e,t),{params:k,paramMappings:t}}(e)}},{key:"extractParams",value:function(e){return function(e){var t=s0(e),n=t.extractWeights,r=t.getRemainingWeights,a=[],i=B0(n,a),o=i.extractConvLayerParams,s=i.extractResidualLayerParams,u=o(4704,32,7,"conv32_down"),c=s(9216,32,3,"conv32_1"),l=s(9216,32,3,"conv32_2"),p=s(9216,32,3,"conv32_3"),d=s(36864,64,3,"conv64_down",!0),f=s(36864,64,3,"conv64_1"),h=s(36864,64,3,"conv64_2"),m=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),g=s(147456,128,3,"conv128_1"),y=s(147456,128,3,"conv128_2"),b=s(589824,256,3,"conv256_down",!0),x=s(589824,256,3,"conv256_1"),k=s(589824,256,3,"conv256_2"),w=s(589824,256,3,"conv256_down_out"),S=Ou((function(){return Af(ff(n(32768),[128,256]),[1,0])}));if(a.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: ".concat(r().length));return{params:{conv32_down:u,conv32_1:c,conv32_2:l,conv32_3:p,conv64_down:d,conv64_1:f,conv64_2:h,conv64_3:m,conv128_down:v,conv128_1:g,conv128_2:y,conv256_down:b,conv256_1:x,conv256_2:k,conv256_down_out:w,fc:S},paramMappings:a}}(e)}}]),n}(Y$);function G0(e,t){return p(p({},e),{descriptor:t})}function H0(e,t){return p(p({},e),{age:t})}function q0(e,t,n){return p(p({},e),{gender:t,genderProbability:n})}function K0(e,t){function n(n,r,a,i,o){var s=mf(e(n*r*a*a),[a,a,n,r]),u=df(e(r));return t.push({paramPath:"".concat(i,"/filters")},{paramPath:"".concat(i,"/").concat(o?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,a){var i=n(e,t,r,a,!0);return{filters:i.filters,batch_norm_offset:i.bias}}function a(n,a,i){var o=function(n,r){var a=mf(e(9*n),[3,3,n,1]),i=df(e(n)),o=df(e(n)),s=df(e(n)),u=df(e(n));return t.push({paramPath:"".concat(r,"/filters")},{paramPath:"".concat(r,"/batch_norm_scale")},{paramPath:"".concat(r,"/batch_norm_offset")},{paramPath:"".concat(r,"/batch_norm_mean")},{paramPath:"".concat(r,"/batch_norm_variance")}),{filters:a,batch_norm_scale:i,batch_norm_offset:o,batch_norm_mean:s,batch_norm_variance:u}}(n,"".concat(i,"/depthwise_conv"));return{depthwise_conv:o,pointwise_conv:r(n,a,1,"".concat(i,"/pointwise_conv"))}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:a(32,64,"mobilenetv1/conv_1"),conv_2:a(64,128,"mobilenetv1/conv_2"),conv_3:a(128,128,"mobilenetv1/conv_3"),conv_4:a(128,256,"mobilenetv1/conv_4"),conv_5:a(256,256,"mobilenetv1/conv_5"),conv_6:a(256,512,"mobilenetv1/conv_6"),conv_7:a(512,512,"mobilenetv1/conv_7"),conv_8:a(512,512,"mobilenetv1/conv_8"),conv_9:a(512,512,"mobilenetv1/conv_9"),conv_10:a(512,512,"mobilenetv1/conv_10"),conv_11:a(512,512,"mobilenetv1/conv_11"),conv_12:a(512,1024,"mobilenetv1/conv_12"),conv_13:a(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}function X0(e){var t=[],n=function(e,t){var n=o0(e,t);function r(e,t,r){return{filters:n("".concat(e,"/Conv2d_").concat(t,"_pointwise/weights"),4,"".concat(r,"/filters")),batch_norm_offset:n("".concat(e,"/Conv2d_").concat(t,"_pointwise/convolution_bn_offset"),1,"".concat(r,"/batch_norm_offset"))}}function a(e){var t="mobilenetv1/conv_".concat(e),a="MobilenetV1/Conv2d_".concat(e,"_depthwise"),i="".concat(t,"/depthwise_conv"),o="".concat(t,"/pointwise_conv");return{depthwise_conv:{filters:n("".concat(a,"/depthwise_weights"),4,"".concat(i,"/filters")),batch_norm_scale:n("".concat(a,"/BatchNorm/gamma"),1,"".concat(i,"/batch_norm_scale")),batch_norm_offset:n("".concat(a,"/BatchNorm/beta"),1,"".concat(i,"/batch_norm_offset")),batch_norm_mean:n("".concat(a,"/BatchNorm/moving_mean"),1,"".concat(i,"/batch_norm_mean")),batch_norm_variance:n("".concat(a,"/BatchNorm/moving_variance"),1,"".concat(i,"/batch_norm_variance"))},pointwise_conv:r("MobilenetV1",e,o)}}function i(e,t){return{filters:n("".concat(e,"/weights"),4,"".concat(t,"/filters")),bias:n("".concat(e,"/biases"),1,"".concat(t,"/bias"))}}function o(e){return{box_encoding_predictor:i("Prediction/BoxPredictor_".concat(e,"/BoxEncodingPredictor"),"prediction_layer/box_predictor_".concat(e,"/box_encoding_predictor")),class_predictor:i("Prediction/BoxPredictor_".concat(e,"/ClassPredictor"),"prediction_layer/box_predictor_".concat(e,"/class_predictor"))}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:o(0),box_predictor_1:o(1),box_predictor_2:o(2),box_predictor_3:o(3),box_predictor_4:o(4),box_predictor_5:o(5)}}}}(e,t),r=n.extractMobilenetV1Params,a=n.extractPredictionLayerParams,i=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!BJ(i))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have ".concat(i));var o={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:i}};return e0(e,t),{params:o,paramMappings:t}}function Y0(e,t,n){return Ou((function(){var r=Zc(e,t.filters,n,"same");return r=Xu(r,t.batch_norm_offset),qc(r,0,6)}))}var Q0=.0010000000474974513;function Z0(e,t){return Ou((function(){var n,r=Y0(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var a=t+1,i=function(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}(a);r=function(e,t,n){return Ou((function(){var r=ll(e,t.filters,n,"same");return r=Lc(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,Q0),qc(r,0,6)}))}(r,e.depthwise_conv,i),r=Y0(r,e.pointwise_conv,[1,1]),11===a&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}function J0(e,t,n){var r=e.arraySync(),a=Math.min(r[t][0],r[t][2]),i=Math.min(r[t][1],r[t][3]),o=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),p=Math.max(r[n][1],r[n][3]),d=(o-a)*(s-i),f=(l-u)*(p-c);if(d<=0||f<=0)return 0;var h=Math.max(a,u),m=Math.max(i,c),v=Math.min(o,l),g=Math.min(s,p),y=Math.max(v-h,0)*Math.max(g-m,0);return y/(d+f-y)}function $0(e,t,n,r,a){var i=e.shape[0],o=Math.min(n,i),s=t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>a})).sort((function(e,t){return t.score-e.score})),u=function(e){return e<=r?1:0},c=[];return s.forEach((function(t){if(!(c.length>=o)){for(var n=t.score,r=c.length-1;r>=0;--r){var i=J0(e,t.boxIndex,c[r]);if(0!==i&&(t.score*=u(i),t.score<=a))break}n===t.score&&c.push(t.boxIndex)}})),c}function e1(e,t){var n=function(e){var t=wf(Af(e,[1,0])),n=[bp(t[2],t[0]),bp(t[3],t[1])];return{sizes:n,centers:[Xu(t[0],Qu(n[0],2)),Xu(t[1],Qu(n[1],2))]}}(e),r=n.sizes,a=n.centers,i=wf(Af(t,[1,0])),o=Qu(Zu(jl(Qu(i[2],5)),r[0]),2),s=Xu(Zu(Qu(i[0],10),r[0]),a[0]),u=Qu(Zu(jl(Qu(i[3],5)),r[1]),2),c=Xu(Zu(Qu(i[1],10),r[1]),a[1]);return Af(uf([bp(s,o),bp(c,u),Xu(s,o),Xu(c,u)]),[1,0])}function t1(e,t){return Ou((function(){var n=e.shape[0];return{boxPredictionEncoding:Nc($$(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:Nc($$(e,t.class_predictor),[n,-1,3])}}))}var n1=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.minConfidence,r=t.maxResults;if(h(this,e),this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error("".concat(this._name," - expected minConfidence to be a number between 0 and 1"));if("number"!=typeof this._maxResults)throw new Error("".concat(this._name," - expected maxResults to be a number"))}return v(e,[{key:"minConfidence",get:function(){return this._minConfidence}},{key:"maxResults",get:function(){return this._maxResults}}]),e}(),r1=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.call(this,"SsdMobilenetv1")}return v(n,[{key:"forwardInput",value:function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return Ou((function(){var n=Iu(e.toBatchTensor(512,!1),"float32"),r=Z0(bp(Qu(n,127.5),1),t.mobilenetv1),a=function(e,t,n){return Ou((function(){var r=Y0(e,n.conv_0,[1,1]),a=Y0(r,n.conv_1,[2,2]),i=Y0(a,n.conv_2,[1,1]),o=Y0(i,n.conv_3,[2,2]),s=Y0(o,n.conv_4,[1,1]),u=Y0(s,n.conv_5,[2,2]),c=Y0(u,n.conv_6,[1,1]),l=Y0(c,n.conv_7,[2,2]),p=t1(t,n.box_predictor_0),d=t1(e,n.box_predictor_1),f=t1(a,n.box_predictor_2),h=t1(o,n.box_predictor_3),m=t1(u,n.box_predictor_4),v=t1(l,n.box_predictor_5);return{boxPredictions:Ec([p.boxPredictionEncoding,d.boxPredictionEncoding,f.boxPredictionEncoding,h.boxPredictionEncoding,m.boxPredictionEncoding,v.boxPredictionEncoding],1),classPredictions:Ec([p.classPrediction,d.classPrediction,f.classPrediction,h.classPrediction,m.classPrediction,v.classPrediction],1)}}))}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return Ou((function(){var r=e.shape[0],a=e1(Nc(ql(n.extra_dim,[r,1,1]),[-1,4]),Nc(e,[-1,4]));a=Nc(a,[r,a.shape[0]/r,4]);var i=Rc(Fc(t,[0,0,1],[-1,-1,-1])),o=Fc(i,[0,0,0],[-1,-1,1]);return o=Nc(o,[r,o.shape[1]]),{boxes:wf(a),scores:wf(o)}}))}(a.boxPredictions,a.classPredictions,t.output_layer)}))}},{key:"forward",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,P$(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"locateFaces",value:function(){var e=y(f().mark((function e(t){var n,r,a,i,s,u,c,l,p,d,h,m,v,g,y,b,x,k,w=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new n1(w.length>1&&void 0!==w[1]?w[1]:{}),r=n.maxResults,a=n.minConfidence,e.next=6,P$(t);case 6:for(i=e.sent,s=this.forwardInput(i),u=s.boxes,c=s.scores,l=u[0],p=c[0],d=1;d<u.length;d++)u[d].dispose(),c[d].dispose();return h=Array.from(p.dataSync()),m=$0(l,h,r,.5,a),v=i.getReshapedInputDimensions(0),g=i.inputSize,y=g/v.width,b=g/v.height,x=l.arraySync(),k=m.map((function(e){var t=[Math.max(0,x[e][0]),Math.min(1,x[e][2])].map((function(e){return e*b})),n=o(t,2),r=n[0],a=n[1],s=[Math.max(0,x[e][1]),Math.min(1,x[e][3])].map((function(e){return e*y})),u=o(s,2),c=u[0],l=u[1];return new e$(h[e],new o$(c,r,l-c,a-r),{height:i.getInputHeight(0),width:i.getInputWidth(0)})})),e.abrupt("return",(l.dispose(),p.dispose(),k));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"ssd_mobilenetv1_model"}},{key:"extractParamsFromWeightMap",value:function(e){return X0(e)}},{key:"extractParams",value:function(e){return function(e){var t=[],n=s0(e),r=n.extractWeights,a=n.getRemainingWeights,i=K0(r,t),o=i.extractMobilenetV1Params,s=i.extractPredictionLayerParams,u=o(),c=s(),l={extra_dim:hf(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==a().length)throw new Error("weights remaing after extract: ".concat(a().length));return{params:{mobilenetv1:u,prediction_layer:c,output_layer:l},paramMappings:t}}(e)}}]),n}(Y$);var a1=.4,i1=[new QJ(.738768,.874946),new QJ(2.42204,2.65704),new QJ(4.30971,7.04493),new QJ(10.246,4.59428),new QJ(12.6868,11.8741)],o1=[new QJ(1.603231,2.094468),new QJ(6.041143,7.080126),new QJ(2.882459,3.518061),new QJ(4.266906,5.178857),new QJ(9.041765,10.66308)],s1=[117.001,114.697,97.404],u1=function(e){return"number"==typeof e};function c1(e){return Ou((function(){var t=Zu(e,Pl(.10000000149011612));return Xu(Dd(bp(e,t)),t)}))}function l1(e,t){return Ou((function(){var n=Kp(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Zc(n,t.conv.filters,[1,1],"valid"),n=bp(n,t.bn.sub),n=Zu(n,t.bn.truediv),c1(n=Xu(n,t.conv.bias))}))}function p1(e,t){return Ou((function(){var n=Kp(e,[[0,0],[1,1],[1,1],[0,0]]);return n=jd(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),c1(n=Xu(n,t.bias))}))}function d1(e,t){var n=t0(e,t);var r=a0(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,a,i){var o=n(r,a,3,"".concat(i,"/conv")),s=function(n,r){var a=df(e(n)),i=df(e(n));return t.push({paramPath:"".concat(r,"/sub")},{paramPath:"".concat(r,"/truediv")}),{sub:a,truediv:i}}(a,"".concat(i,"/bn"));return{conv:o,bn:s}},extractSeparableConvParams:r}}function f1(e,t){var n=o0(e,t);function r(e){return{filters:n("".concat(e,"/filters"),4),bias:n("".concat(e,"/bias"),1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){var t=r("".concat(e,"/conv")),a=function(e){return{sub:n("".concat(e,"/sub"),1),truediv:n("".concat(e,"/truediv"),1)}}("".concat(e,"/bn"));return{conv:t,bn:a}},extractSeparableConvParams:i0(n)}}var h1=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.inputSize,r=t.scoreThreshold;if(h(this,e),this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!==0)throw new Error("".concat(this._name," - expected inputSize to be a number divisible by 32"));if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error("".concat(this._name," - expected scoreThreshold to be a number between 0 and 1"))}return v(e,[{key:"inputSize",get:function(){return this._inputSize}},{key:"scoreThreshold",get:function(){return this._scoreThreshold}}]),e}(),m1=function(e){Ae(n,e);var t=Re(n);function n(e){var r;return h(this,n),r=t.call(this,"TinyYolov2"),function(e){if(!e)throw new Error("invalid config: ".concat(e));if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: ".concat(e.withSeparableConvs));if(!u1(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: ".concat(e.iouThreshold));if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"==typeof e})))throw new Error("config.classes has to be an array class names: string[], have: ".concat(JSON.stringify(e.classes)));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return u1(e.x)&&u1(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: ".concat(JSON.stringify(e.anchors)));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(u1)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: ".concat(JSON.stringify(e.meanRgb)))}(e),r._config=e,r}return v(n,[{key:"config",get:function(){return this._config}},{key:"withClassScores",get:function(){return this.config.withClassScores||this.config.classes.length>1}},{key:"boxEncodingSize",get:function(){return 5+(this.withClassScores?this.config.classes.length:0)}},{key:"runTinyYolov2",value:function(e,t){var n=l1(e,t.conv0);return n=l1(n=Ep(n,[2,2],[2,2],"same"),t.conv1),n=l1(n=Ep(n,[2,2],[2,2],"same"),t.conv2),n=l1(n=Ep(n,[2,2],[2,2],"same"),t.conv3),n=l1(n=Ep(n,[2,2],[2,2],"same"),t.conv4),n=l1(n=Ep(n,[2,2],[2,2],"same"),t.conv5),n=l1(n=Ep(n,[2,2],[1,1],"same"),t.conv6),$$(n=l1(n,t.conv7),t.conv8,"valid",!1)}},{key:"runMobilenet",value:function(e,t){var n=this.config.isFirstLayerConv2d?c1($$(e,t.conv0,"valid",!1)):p1(e,t.conv0);return n=p1(n=Ep(n,[2,2],[2,2],"same"),t.conv1),n=p1(n=Ep(n,[2,2],[2,2],"same"),t.conv2),n=p1(n=Ep(n,[2,2],[2,2],"same"),t.conv3),n=p1(n=Ep(n,[2,2],[2,2],"same"),t.conv4),n=p1(n=Ep(n,[2,2],[2,2],"same"),t.conv5),n=Ep(n,[2,2],[1,1],"same"),n=t.conv6?p1(n,t.conv6):n,$$(n=t.conv7?p1(n,t.conv7):n,t.conv8,"valid",!1)}},{key:"forwardInput",value:function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Ou((function(){var a=Iu(e.toBatchTensor(t,!1),"float32");return a=(a=n.config.meanRgb?r$(a,n.config.meanRgb):a).div(255),n.config.withSeparableConvs?n.runMobilenet(a,r):n.runTinyYolov2(a,r)}))}},{key:"forward",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,P$(t);case 3:return e.t1=e.sent,e.t2=n,e.abrupt("return",e.t0.forwardInput.call(e.t0,e.t1,e.t2));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"detect",value:function(){var e=y(f().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,d,h,m=this,v=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new h1(v.length>1&&void 0!==v[1]?v[1]:{}),r=n.inputSize,a=n.scoreThreshold,e.next=6,P$(t);case 6:return i=e.sent,e.next=9,this.forwardInput(i,r);case 9:return o=e.sent,s=Ou((function(){return wf(o)[0].expandDims()})),u={width:i.getInputWidth(0),height:i.getInputHeight(0)},e.next=14,this.extractBoxes(s,i.getReshapedInputDimensions(0),a);case 14:return c=e.sent,o.dispose(),s.dispose(),l=c.map((function(e){return e.box})),p=c.map((function(e){return e.score})),d=c.map((function(e){return e.classScore})),h=c.map((function(e){return m.config.classes[e.label]})),e.abrupt("return",n$(l.map((function(e){return e.rescale(r)})),p,this.config.iouThreshold,!0).map((function(e){return new $J(p[e],d[e],h[e],l[e],u)})));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return""}},{key:"extractParamsFromWeightMap",value:function(e){return function(e,t){var n,r=[],a=f1(e,r),i=a.extractConvParams,o=a.extractConvWithBatchNormParams,s=a.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?i("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:i("conv8")}}else n={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return e0(e,r),{params:n,paramMappings:r}}(e,this.config)}},{key:"extractParams",value:function(e){var t=this.config.filterSizes||n.DEFAULT_FILTER_SIZES,r=t?t.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found ".concat(r," filterSizes in config"));return function(e,t,n,r){var a,i=s0(e),s=i.extractWeights,u=i.getRemainingWeights,c=[],l=d1(s,c),p=l.extractConvParams,d=l.extractConvWithBatchNormParams,f=l.extractSeparableConvParams;if(t.withSeparableConvs){var h=o(r,9),m=h[0],v=h[1],g=h[2],y=h[3],b=h[4],x=h[5],k=h[6],w=h[7],S=h[8];a={conv0:t.isFirstLayerConv2d?p(m,v,3,"conv0"):f(m,v,"conv0"),conv1:f(v,g,"conv1"),conv2:f(g,y,"conv2"),conv3:f(y,b,"conv3"),conv4:f(b,x,"conv4"),conv5:f(x,k,"conv5"),conv6:w?f(k,w,"conv6"):void 0,conv7:S?f(w,S,"conv7"):void 0,conv8:p(S||w||k,5*n,1,"conv8")}}else{var I=o(r,9),_=I[0],N=I[1],C=I[2],T=I[3],E=I[4],A=I[5],R=I[6],F=I[7],D=I[8];a={conv0:d(_,N,"conv0"),conv1:d(N,C,"conv1"),conv2:d(C,T,"conv2"),conv3:d(T,E,"conv3"),conv4:d(E,A,"conv4"),conv5:d(A,R,"conv5"),conv6:d(R,F,"conv6"),conv7:d(F,D,"conv7"),conv8:p(D,5*n,1,"conv8")}}if(0!==u().length)throw new Error("weights remaing after extract: ".concat(u().length));return{params:a,paramMappings:c}}(e,this.config,this.boxEncodingSize,t)}},{key:"extractBoxes",value:function(){var e=y(f().mark((function e(t,n,r){var a,i,s,u,c,l,d,h,m,v,g,y,b,x,k,w,S,I,_,N,C,T,E,A,R,F,D,M,O,P=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.width,i=n.height,s=Math.max(a,i),u=s/a,c=s/i,l=t.shape[1],d=this.config.anchors.length,h=Ou((function(){var e=t.reshape([l,l,d,P.boxEncodingSize]);return[e.slice([0,0,0,0],[l,l,d,4]),e.slice([0,0,0,4],[l,l,d,1]),P.withClassScores?$d(e.slice([0,0,0,5],[l,l,d,P.config.classes.length]),3):Pl(0)]})),m=o(h,3),v=m[0],g=m[1],y=m[2],b=[],e.next=15,g.array();case 15:return x=e.sent,e.next=18,v.array();case 18:k=e.sent,w=0;case 20:if(!(w<l)){e.next=54;break}S=0;case 22:if(!(S<l)){e.next=51;break}I=0;case 24:if(!(I<d)){e.next=48;break}if(_=a$(x[w][S][I][0]),r&&!(_>r)){e.next=45;break}if(N=(S+a$(k[w][S][I][0]))/l*u,C=(w+a$(k[w][S][I][1]))/l*c,T=Math.exp(k[w][S][I][2])*this.config.anchors[I].x/l*u,E=Math.exp(k[w][S][I][3])*this.config.anchors[I].y/l*c,A=N-T/2,R=C-E/2,F={row:w,col:S,anchor:I},!this.withClassScores){e.next=40;break}return e.next=37,this.extractPredictedClass(y,F);case 37:e.t0=e.sent,e.next=41;break;case 40:e.t0={classScore:1,label:0};case 41:D=e.t0,M=D.classScore,O=D.label,b.push(p({box:new JJ(A,R,A+T,R+E),score:_,classScore:_*M,label:O},F));case 45:I++,e.next=24;break;case 48:S++,e.next=22;break;case 51:w++,e.next=20;break;case 54:return e.abrupt("return",(v.dispose(),g.dispose(),y.dispose(),b));case 55:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"extractPredictedClass",value:function(){var e=y(f().mark((function e(t,n){var r,a,i,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.row,a=n.col,i=n.anchor,e.next=5,t.array();case 5:return o=e.sent,e.abrupt("return",Array(this.config.classes.length).fill(0).map((function(e,t){return o[r][a][i][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(Y$),v1=m1;v1.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024];var g1=function(e){Ae(n,e);var t=Re(n);function n(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];h(this,n);var r=p({withSeparableConvs:e,iouThreshold:a1,classes:["face"]},e?{anchors:o1,meanRgb:s1}:{anchors:i1,withClassScores:!0});return t.call(this,r)}return v(n,[{key:"withSeparableConvs",get:function(){return this.config.withSeparableConvs}},{key:"anchors",get:function(){return this.config.anchors}},{key:"locateFaces",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.detect(t,n);case 2:return e.abrupt("return",e.sent.map((function(e){return new e$(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"}},{key:"extractParamsFromWeightMap",value:function(e){return Se(we(n.prototype),"extractParamsFromWeightMap",this).call(this,e)}}]),n}(v1);var y1=function(e){Ae(n,e);var t=Re(n);function n(){var e;return h(this,n),(e=t.apply(this,arguments))._name="TinyFaceDetectorOptions",e}return v(n)}(h1),b1=function(){function e(){h(this,e)}return v(e,[{key:"then",value:function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,this.run();case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"run",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("ComposableTask - run is not implemented");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();function x1(e,t,n,r){return k1.apply(this,arguments)}function k1(){return k1=y(f().mark((function e(t,n,r,a){var i,o,s,u,c=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=c.length>4&&void 0!==c[4]?c[4]:function(e){return e.alignedRect},o=t.map((function(e){return x0(e)?i(e):e.detection})),e.t0=a,e.t0){e.next=14;break}if(!(n instanceof To)){e.next=10;break}return e.next=7,W$(n,o);case 7:e.t1=e.sent,e.next=13;break;case 10:return e.next=12,z$(n,o);case 12:e.t1=e.sent;case 13:e.t0=e.t1;case 14:return s=e.t0,e.next=17,r(s);case 17:return u=e.sent,e.abrupt("return",(s.forEach((function(e){return e instanceof To&&e.dispose()})),u));case 19:case"end":return e.stop()}}),e)}))),k1.apply(this,arguments)}var w1=.4,S1=[new QJ(1.603231,2.094468),new QJ(6.041143,7.080126),new QJ(2.882459,3.518061),new QJ(4.266906,5.178857),new QJ(9.041765,10.66308)],I1=[117.001,114.697,97.404],_1=function(e){Ae(n,e);var t=Re(n);function n(){h(this,n);var e={withSeparableConvs:!0,iouThreshold:w1,classes:["face"],anchors:S1,meanRgb:I1,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t.call(this,e)}return v(n,[{key:"anchors",get:function(){return this.config.anchors}},{key:"locateFaces",value:function(){var e=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.detect(t,n);case 2:return e.abrupt("return",e.sent.map((function(e){return new e$(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getDefaultModelName",value:function(){return"tiny_face_detector_model"}},{key:"extractParamsFromWeightMap",value:function(e){return Se(we(n.prototype),"extractParamsFromWeightMap",this).call(this,e)}}]),n}(v1),N1={ssdMobilenetv1:new r1,tinyFaceDetector:new _1,tinyYolov2:new g1,faceLandmark68Net:new D0,faceLandmark68TinyNet:new O0,faceRecognitionNet:new j0,faceExpressionNet:new g0,ageGenderNet:new R0},C1=function(e){Ae(n,e);var t=Re(n);function n(e,r,a){var i;return h(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.extractedFaces=a,i}return v(n)}(b1),T1=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"run",value:function(){var e=y(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,x1(t,this.input,function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return N1.faceExpressionNet.predictExpressions(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.extractedFaces);case 5:return n=e.sent,e.abrupt("return",t.map((function(e,t){return y0(e,n[t])})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withAgeAndGender",value:function(){return new R1(this,this.input)}}]),n}(C1),E1=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"withAgeAndGender",value:function(){return new F1(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new M1(this,this.input)}}]),n}(T1),A1=function(e){Ae(n,e);var t=Re(n);function n(e,r,a){var i;return h(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.extractedFaces=a,i}return v(n)}(b1),R1=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"run",value:function(){var e=y(f().mark((function e(){var t,n;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,x1(t,this.input,function(){var e=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return N1.ageGenderNet.predictAgeAndGender(e)}))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.extractedFaces);case 5:return n=e.sent,e.abrupt("return",t.map((function(e,t){var r=n[t],a=r.age;return H0(q0(e,r.gender,r.genderProbability),a)})));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new T1(this,this.input)}}]),n}(A1),F1=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"withFaceExpressions",value:function(){return new E1(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new M1(this,this.input)}}]),n}(R1),D1=function(e){Ae(n,e);var t=Re(n);function n(e,r){var a;return h(this,n),(a=t.call(this)).parentTask=e,a.input=r,a}return v(n)}(b1),M1=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"run",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:return t=e.sent,e.next=5,x1(t,this.input,(function(e){return Promise.all(e.map((function(e){return N1.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}));case 5:return e.abrupt("return",e.sent.map((function(e,n){return G0(t[n],e)})));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new E1(this,this.input)}},{key:"withAgeAndGender",value:function(){return new F1(this,this.input)}}]),n}(D1),O1=function(e){Ae(n,e);var t=Re(n);function n(e,r,a){var i;return h(this,n),(i=t.call(this)).parentTask=e,i.input=r,i.useTinyLandmarkNet=a,i}return v(n,[{key:"landmarkNet",get:function(){return this.useTinyLandmarkNet?N1.faceLandmark68TinyNet:N1.faceLandmark68Net}}]),n}(b1),P1=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"run",value:function(){var e=y(f().mark((function e(){var t,n,r,a,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentTask;case 2:if(t=e.sent,n=t.map((function(e){return e.detection})),!(this.input instanceof To)){e.next=10;break}return e.next=7,W$(this.input,n);case 7:e.t0=e.sent,e.next=13;break;case 10:return e.next=12,z$(this.input,n);case 12:e.t0=e.sent;case 13:return r=e.t0,e.next=16,Promise.all(r.map((function(e){return i.landmarkNet.detectLandmarks(e)})));case 16:return a=e.sent,e.abrupt("return",(r.forEach((function(e){return e instanceof To&&e.dispose()})),t.filter((function(e,t){return a[t]})).map((function(e,t){return k0(e,a[t])}))));case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withFaceExpressions",value:function(){return new E1(this,this.input)}},{key:"withAgeAndGender",value:function(){return new F1(this,this.input)}},{key:"withFaceDescriptors",value:function(){return new M1(this,this.input)}}]),n}(O1),L1=function(e){Ae(n,e);var t=Re(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n1;return h(this,n),(r=t.call(this)).input=e,r.options=a,r}return v(n)}(b1),z1=function(e){Ae(n,e);var t=Re(n);function n(){return h(this,n),t.apply(this,arguments)}return v(n,[{key:"run",value:function(){var e=y(f().mark((function e(){var t,n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.input,!((n=this.options)instanceof y1)){e.next=5;break}r=N1.tinyFaceDetector.locateFaces(t,n),e.next=14;break;case 5:if(!(n instanceof n1)){e.next=9;break}r=N1.ssdMobilenetv1.locateFaces(t,n),e.next=14;break;case 9:if(!(n instanceof h1)){e.next=13;break}r=N1.tinyYolov2.locateFaces(t,n),e.next=14;break;case 13:throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | TinyYolov2Options");case 14:return e.abrupt("return",r);case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"runAndExtendWithFaceDetections",value:function(){var e=this;return new Promise((function(t,n){e.run().then((function(e){return t(e.map((function(e){return l$({},e)})))})).catch((function(e){return n(e)}))}))}},{key:"withFaceLandmarks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new P1(this.runAndExtendWithFaceDetections(),this.input,e)}},{key:"withFaceExpressions",value:function(){return new T1(this.runAndExtendWithFaceDetections(),this.input)}},{key:"withAgeAndGender",value:function(){return new R1(this.runAndExtendWithFaceDetections(),this.input)}}]),n}(L1);function B1(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n1;return new z1(e,t)}function W1(e,t,n,r,a){var i=document.createElement("canvas");i.width=r,i.height=a;var o=i.getContext("2d");return o?(o.putImageData(e,-t,-n),o.getImageData(0,0,r,a)):e}var U1=Date.now()+Math.round(1e5*Math.random());function V1(){return"uuid-".concat((U1++).toString(16))}function j1(e,t,n){var r=new Promise((function(r,a){var i,o="".concat(t,"-").concat(V1()),s=function t(n){var a=n.data;a.token===o&&(e.removeEventListener("message",t,!0),clearTimeout(i),r(a.response))};i=setTimeout((function(){e.removeEventListener("message",s,!0),a(new Error("Expect worker to respond ".concat(o)))}),6e4);try{e.addEventListener("message",s,!0),e.postMessage({type:t,token:o,payload:n})}catch(pA){clearTimeout(i),e.removeEventListener("message",s,!0),a(be(pA))}}));return r}var G1=n(864),H1=n.n(G1)()();function q1(e,t){return{detector:e,result:{type:"document",image:t,box:[.1*t.width,.1*t.height,.8*t.width,.5*t.height]}}}var K1=function(){function e(){h(this,e),this._disposed=void 0,this._loaded=void 0,this._loading=void 0,this._mocked=void 0,this._disposed=!1,this._loaded=!1,this._loading=!1,this._mocked=!1}return v(e,[{key:"load",value:function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._loading||this._disposed||this._loaded)){e.next=2;break}return e.abrupt("return");case 2:return this._loading=!0,e.next=5,j1(H1,"load");case 5:this._loading=!1,this._loaded=!0;case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"detect",value:function(){var e=y(f().mark((function e(t){var n,r,a,i,s,u;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._loading&&!this._disposed&&this._loaded){e.next=2;break}return e.abrupt("return",null);case 2:if(!this._mocked){e.next=4;break}return e.abrupt("return",q1(this,t));case 4:return e.next=6,j1(H1,"detect",{image:t});case 6:if(n=e.sent,!this._disposed){e.next=9;break}return e.abrupt("return",null);case 9:if(!n){e.next=12;break}return r=o(n.box,4),a=r[0],i=r[1],s=r[2],u=r[3],e.abrupt("return",{detector:this,result:p(p({},n),{},{image:W1(t,a,i,s,u)})});case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this._disposed=!0}}]),e}(),X1=null,Y1="https://cdn.jsdelivr.net/gh/cgarciagl/face-api.js@0.22.2/weights";function Q1(){return Z1.apply(this,arguments)}function Z1(){return(Z1=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[N1.tinyFaceDetector.isLoaded?Promise.resolve(void 0):N1.tinyFaceDetector.loadFromUri(Y1)].filter(Boolean),N1.tinyFaceDetector.isLoaded){e.next=4;break}return e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var J1=function(){function e(){h(this,e),this._loading=void 0,this._disposed=void 0,this._startTime=void 0,this._disabled=void 0,this._mocked=void 0,this._loaded=void 0,this._preview=void 0,this._countdown=void 0,this._loading=!1,this._disposed=!1,this._disabled=!1,this._mocked=!1,this._loaded=!1,this._preview=!1,this._startTime=0,this._countdown=3}return v(e,[{key:"load",value:function(){var e=y(f().mark((function e(){var t=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._loading&&!this._loaded){this._loading=!0;try{Q1().then((function(){t._loaded=!0,t._loading=!1}),(function(e){alert("FaceDetector load error: ".concat(e))}))}catch(pA){console.error("error loading face API",pA)}}case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"detect",value:function(){var e=y(f().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,d,h,m,v,g;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._disabled||this._disposed||this._loading)&&this._loaded){e.next=2;break}return e.abrupt("return",null);case 2:if(n=Date.now(),this._startTime=this._startTime||n,!(this._countdown>0)){e.next=7;break}return console.log("wait for face detector count down : ".concat(this._countdown)),e.abrupt("return",{detector:this,result:{type:"countdown",countdown:this._countdown--,image:t}});case 7:if(!this._mocked){e.next=9;break}return e.abrupt("return",{detector:this,result:{type:"face",image:t,box:[.1*t.width,.1*t.height,.8*t.width,.5*t.height]}});case 9:if(r=t.width,a=t.height,(i=X1||document.createElement("canvas")).width=r,i.height=a,o=i.getContext("2d")){e.next=16;break}return e.abrupt("return",null);case 16:return o.clearRect(0,0,i.width,i.height),o.putImageData(t,0,0),e.next=20,B1(i,new y1);case 20:if(!((s=e.sent).length>1)){e.next=23;break}return e.abrupt("return",null);case 23:if(0!==s.length){e.next=25;break}return e.abrupt("return",null);case 25:if(u=s[0],c=u.box,l=u.score,console.log(">>>score",l),!(l<.5)){e.next=30;break}return e.abrupt("return",null);case 30:return p=c.left,d=c.top,h=c.width,m=c.height,v=150,p=Math.max(p-v,0),d=Math.max(d-v,0),h=Math.min(h+v,t.width-p),m=Math.min(m+v,t.height-d),g=W1(t,p,d,h,m),this._preview?(i.style.cssText="position:fixed;top:0;left:0;z-index:1000;",o.clearRect(0,0,i.width,i.height),i.width=g.width,i.height=g.height,o.putImageData(g,0,0),X1=i):(o.clearRect(0,0,i.width,i.height),i.remove()),e.abrupt("return",{detector:this,result:{type:"face",box:[p,d,h,m],image:g}});case 39:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){}}]),e}();function $1(e,t){return e.filter((function(e){return e!==t}))}var e2=1e3,t2={requiredSides:[],collectedSides:[],confirmedSides:[],mapping:{}},n2={active:!1,count:0,detectors:[],documentImages:t2,faceImages:t2,ready:!1,record:null,side:"front",timerId:setTimeout((function(){})),type:"document"};function r2(e){if("document"===e)return["front","back"];if("face"===e){var t=function(e){for(var t=e.slice(),n=t.length-1;n>0;n--){var r=Math.floor(Math.random()*(n+1)),a=t[n];t[n]=t[r],t[r]=a}return t}(["up","down","left","right"]).slice(0,3);return t.push("center"),t}return[]}function a2(e){var t=e.requiredSides,n=e.collectedSides,r=new Set(n);return t.find((function(e){return!r.has(e)}))||""}function i2(e){var t=e.collectedSides,n=e.confirmedSides,r=new Set(n);return t.find((function(e){return!r.has(e)}))||""}function o2(e){return s2.apply(this,arguments)}function s2(){return s2=y(f().mark((function e(t){var n,r,a,i,o,s,u,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.state.detection,r=n.type,a=n.active,e.prev=2,a){e.next=5;break}return e.abrupt("return");case 5:return console.log(">>detect next",r),i=n.documentImages,o=n.faceImages,s="","face"===r?s=a2(o):"document"===r?s=a2(i):alert("unable to find side for type ".concat(r)),t.state=ye(t.state,(function(e){e.detection.side=s})),t.state=ye(t.state,(function(e){e.detection.detectors.length||("document"===r?e.detection.detectors.push(new K1):"face"===r?e.detection.detectors.push(new J1):console.warn("Invalid detection type ".concat(r)))})),e.next=13,Promise.all(t.state.detection.detectors.map((function(e){return e.load()})));case 13:if(t.state.detection.active){e.next=15;break}return e.abrupt("return");case 15:return t.state=ye(t.state,(function(e){e.detection.ready=!0})),u=null,e.next=19,t.getCameraImage();case 19:if(!(c=e.sent)){e.next=28;break}return e.next=23,Promise.all(t.state.detection.detectors.map((function(e){return e.detect(c)})));case 23:l=e.sent,t.state=ye(t.state,(function(e){e.detection.count++})),u=l.find((function(e){return(null===e||void 0===e?void 0:e.result.type)===r||"countdown"===(null===e||void 0===e?void 0:e.result.type)})),e.next=29;break;case 28:console.warn("video image is not found");case 29:if(t.state.detection.side===s&&t.state.detection.type===r){e.next=31;break}return e.abrupt("return");case 31:console.log(">>>>setDetectionRecord",r,s,u),t.setDetectionRecord(r,s,u||null),e.next=39;break;case 35:return e.prev=35,e.t0=e.catch(2),e.next=39,t.setDetectionError(r,be(e.t0));case 39:case"end":return e.stop()}}),e,null,[[2,35]])}))),s2.apply(this,arguments)}function u2(e,t){return c2.apply(this,arguments)}function c2(){return(c2=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){e.detection.type=n}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l2(e,t){return p2.apply(this,arguments)}function p2(){return p2=y(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=function(){var e=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.state=ye(t.state,(function(e){var t=e.detection;t.record=null,"document"===n?(t.type=n,t.side=a2(t.documentImages)):"face"===n?(t.type=n,t.side=a2(t.faceImages)):(t.type=n,e.error=new Error("invalid type ".concat(n)))})),e.next=3,o2(t);case 3:t.state=ye(t.state,(function(e){!e.error&&e.detection.active&&(e.detection.timerId=setTimeout(r,e2))}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t.state=ye(t.state,(function(e){var t=e.detection;if(!t.active){var a="";if("document"===t.type)a=a2(t.documentImages);else{if("face"!==t.type)throw new Error("unable to find side for derection type ".concat(n));a=a2(t.faceImages)}t.active=!0,t.side=a,t.timerId=setTimeout(r,e2),console.log(">>>started detection ".concat(t.type,", ").concat(t.side))}}));case 2:case"end":return e.stop()}}),e)}))),p2.apply(this,arguments)}function d2(e,t,n,r){return f2.apply(this,arguments)}function f2(){return(f2=y(f().mark((function e(t,n,r,a){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){var t=e.detection,i="document"===n&&t.documentImages||"face"===n&&t.faceImages||null;i&&r?(i.collectedSides.push(r),i.mapping[r]=a,i.collectedSides=Array.from(new Set(i.collectedSides)).sort(),console.log(">>>>detected image",n,r,a),t.side=a2(i)||t.side):console.warn(">> collectDetectionImage fail:, type=".concat(n,", side=").concat(r,", image=").concat(a,"]"))}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h2(e,t,n){return m2.apply(this,arguments)}function m2(){return(m2=y(f().mark((function e(t,n,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){var t=e.detection,a=t.faceImages,i=t.documentImages;r.forEach((function(t){if("document"===n){var r=i.confirmedSides,o=i.mapping;!r.includes(t)&&o[t]&&(r.push(t),r.sort()),e.detection.side=a2(i)||t}else if("face"===n){var s=a.confirmedSides,u=a.mapping;!s.includes(t)&&u[t]&&(s.push(t),s.sort())}}))}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v2(e,t,n){return g2.apply(this,arguments)}function g2(){return(g2=y(f().mark((function e(t,n,r){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){var t=e.detection,a=e.detection,i=a.faceImages,o=a.documentImages;r.forEach((function(e){if("document"===n&&o.mapping[e]){var t=o.mapping,r=o.collectedSides,a=o.confirmedSides;delete t[e],o.collectedSides=$1(r,e),o.confirmedSides=$1(a,e)}else if("face"===n){var s=i.mapping,u=i.collectedSides,c=i.confirmedSides;delete s[e],i.collectedSides=$1(u,e),i.confirmedSides=$1(c,e)}})),"document"===n?t.side=a2(o):"face"===n&&(t.side=a2(i))}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y2(e,t){return b2.apply(this,arguments)}function b2(){return(b2=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){var t=e.detection;return"document"===n?(Object.assign(t.documentImages,{collectedSides:[],confirmedSides:[],mapping:{}}),void(t.type=n)):"face"===n?(Object.assign(t.faceImages,{collectedSides:[],confirmedSides:[],mapping:{}}),void(t.type=n)):void 0}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x2(e){return k2.apply(this,arguments)}function k2(){return k2=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){clearTimeout(e.detection.timerId),e.detection.active=!1,e.detection.record=null,e.detection.count=0;var t=e.detection.detectors;e.detection.detectors=[],t.forEach((function(e){e.dispose()}))})),console.log(">>>stopped detection");case 2:case"end":return e.stop()}}),e)}))),k2.apply(this,arguments)}function w2(e,t){return!!e.mapping[t]}function S2(e,t){return I2.apply(this,arguments)}function I2(){return(I2=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){e.tutorial.mapping[n]=!0}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _2(e,t){return!!t&&!!e.mapping[t]&&!!e.mapping[t].openedAt}function N2(e,t,n,r){return C2.apply(this,arguments)}function C2(){return(C2=y(f().mark((function e(t,n,r,a){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){console.log(">>>open layer",n),e.layers.zIndex++,Object.keys(e.layers.mapping).forEach((function(t){e.layers.mapping[t].behind=!0})),e.layers.mapping[n]=p(p({},a),{},{active:!0,closedAt:null,content:r,layerName:n,openedAt:Date.now(),zIndex:e.layers.zIndex,behind:!1}),e.layers.active=!0}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T2(e,t){return E2.apply(this,arguments)}function E2(){return(E2=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){var t,r=e.layers.mapping[n];r?(console.log("closing layer ".concat(n)),Object.assign(r,{active:!1,closedAt:Date.now(),openedAt:null}),e.layers.active=(t=e.layers,Object.keys(t.mapping).some((function(e){return t.mapping[e].active})))):console.warn("layer ".concat(n," does not exist"));var a=null;Object.keys(e.layers.mapping).forEach((function(t){var n=e.layers.mapping[t];n.active&&(a?a.zIndex<=n.zIndex?(a.behind=!0,n.behind=!1,a=n):n.behind=!0:(n.behind=!1,a=n))}))}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A2(e){return R2.apply(this,arguments)}function R2(){return(R2=y(f().mark((function e(t){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){Object.keys(e.layers.mapping).forEach((function(t){var n=e.layers.mapping[t];n.active?(console.log("closing layer ".concat(t)),Object.assign(n,{active:!1,closedAt:Date.now(),openedAt:null,behind:!0}),e.layers.active=!1):n.behind=!0}))}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var F2={path:"intro",id:V1()};function D2(e,t){return M2.apply(this,arguments)}function M2(){return(M2=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){console.log(">>>setLocation",n),e.location.path!==n&&(e.location.path=n,e.location.id="path-"+V1())}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O2(e){return"ended"===e.readyState}function P2(e){return L2.apply(this,arguments)}function L2(){return L2=y(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Array.from(t.getTracks()),r=Date.now(),n.forEach((function(e){e.enabled=!1,e.stop()})),e.next=5,new Promise((function(e,t){!function a(){var i=Date.now()-r;n.every(O2)?e(void 0):i>1e4?t(new Error("track did not stop in 10s")):setTimeout(a,16)}()}));case 5:case"end":return e.stop()}}),e)}))),L2.apply(this,arguments)}function z2(e){return B2.apply(this,arguments)}function B2(){return(B2=y(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(">>>startCamera"),!t.stream||t.video.srcObject!==t.stream||t.video.paused){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,G2(t);case 6:return n={deviceId:{ideal:"uuid-device-".concat(Date.now())},resizeMode:"crop-and-scale",facingMode:t.state.camera.facing},e.next=9,window.navigator.mediaDevices.getUserMedia({audio:!1,video:n});case 9:return r=e.sent,t.stream=r,t.video.srcObject=r,t.state=ye(t.state,(function(e){e.camera.active=!0,e.camera.mirrored="user"===e.camera.facing||!ke(!0)})),e.next=15,t.video.play();case 15:e.next=21;break;case 17:throw e.prev=17,e.t0=e.catch(3),t.state=ye(t.state,(function(e){e.camera.active=!1})),e.t0;case 21:case"end":return e.stop()}}),e,null,[[3,17]])})))).apply(this,arguments)}function W2(e,t){return U2.apply(this,arguments)}function U2(){return(U2=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){e.camera.manual=n}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V2(e,t){return j2.apply(this,arguments)}function j2(){return(j2=y(f().mark((function e(t,n){var r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.state.camera.facing!==n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,r=t.state.camera.active,e.next=6,G2(t);case 6:if(t.state=ye(t.state,(function(e){e.camera.facing=n,e.camera.mirrored="user"===n||!ke(!0)})),!r){e.next=10;break}return e.next=10,z2(t);case 10:e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(2),t.state=ye(t.state,(function(e){e.camera.active=!1})),e.t0;case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))).apply(this,arguments)}function G2(e){return H2.apply(this,arguments)}function H2(){return(H2=y(f().mark((function e(t){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t.state.camera.active){e.next=3;break}return e.abrupt("return");case 3:if(console.log(">>>stopCamera"),!(n=t.stream)){e.next=9;break}return e.next=8,P2(n);case 8:t.stream=null;case 9:(r=t.video).paused||r.pause(),r.srcObject&&(r.srcObject=null),t.state=ye(t.state,(function(e){e.camera.active=!1})),e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(0),t.state=ye(t.state,(function(e){e.camera.active=!1})),e.t0;case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function q2(e,t,n){if(e.length!==t.length)return!1;if(e===t)return!0;if(n)return q2(e.slice(0).sort(),t.slice(0).sort());for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function K2(e){return X2.apply(this,arguments)}function X2(){return(X2=y(f().mark((function e(t){var n,r,a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.videoHeight,r=t.videoWidth,n&&r){e.next=3;break}return e.abrupt("return",null);case 3:if(a=document.createElement("canvas"),i=a.getContext("2d")){e.next=7;break}return e.abrupt("return",null);case 7:return a.width=r,a.height=n,i.drawImage(t,0,0,r,n),e.abrupt("return",i.getImageData(0,0,r,n));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Y2={camera:{active:!1,facing:"environment",image:null,manual:!1,mirrored:!1},consentedAt:null,darkMode:!1,detection:n2,deviceType:ke(!0)?"mobile":"desktop",error:null,frameSize:[window.innerWidth,window.innerHeight],layers:{zIndex:1e3,mapping:{},active:!1},location:F2,startedAt:null,tutorial:{mapping:{}},working:!1};function Q2(e,t){return Z2.apply(this,arguments)}function Z2(){return(Z2=y(f().mark((function e(t,n){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.state=ye(t.state,(function(e){var r="mobile"===t.state.deviceType?1.5:1,a=[Math.min(415*r,n[0]),Math.min(736*r,n[1])];a[0]>a[1]&&(a[0]=Math.round(a[1]/.563858695652174)),e.frameSize=a}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var J2=function(){function e(){var t=this;h(this,e),this.state=void 0,this.calibratedState=void 0,this.video=void 0,this.stream=void 0,this._pendingJobs=void 0,this._callbacks=void 0,this._dispatching=void 0,this._dispatchedState=void 0,this._jobStartTime=void 0,this.dispatchChange=function(){t._dispatching?console.warn("nested dispatching cycle found, skip it"):t._dispatchedState!==t.state&&(t._dispatchedState=t.state,t._dispatching=!0,t._callbacks.forEach((function(e){return e(t)})),t._dispatching=!1)},this._onWindowResize=function(){t._scheduleJob(y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Q2(t,[window.innerWidth,window.innerHeight]);case 1:case"end":return e.stop()}}),e)}))))},this._scheduleJob=function(){var e=y(f().mark((function e(n,r){var a,i;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=14;break}return e.prev=1,t._beforeJobs(),e.next=5,n();case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),t.state=ye(t.state,(function(t){t.error=be(e.t0)}));case 10:return e.prev=10,t._afterJobs(),e.finish(10);case 13:return e.abrupt("return");case 14:if(t._pendingJobs.push(n),t._pendingJobs.length>100&&console.warn("".concat(t._pendingJobs.length," jobs in queue")),a=null,!t.state.working){e.next=20;break}return console.log(">>> working in progress, skip."),e.abrupt("return");case 20:return t.state=ye(t.state,(function(e){e.working=!0})),e.next=23,t._beforeJobs();case 23:i=f().mark((function e(){var n,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(n=t._pendingJobs.shift())){e.next=5;break}return e.next=5,n();case 5:e.next=13;break;case 7:return e.prev=7,e.t0=e.catch(0),r=be(e.t0),a=r,t.state=ye(t.state,(function(e){e.error=r})),e.abrupt("return","break");case 13:case"end":return e.stop()}}),e,null,[[0,7]])}));case 24:if(!t._pendingJobs.length||a){e.next=31;break}return e.delegateYield(i(),"t1",26);case 26:if("break"!==e.t1){e.next=29;break}return e.abrupt("break",31);case 29:e.next=24;break;case 31:return a&&t._pendingJobs.length&&console.warn(">>>> abort job due to error",a),t.state=ye(t.state,(function(e){e.working=!1})),e.next=35,t._afterJobs();case 35:case"end":return e.stop()}}),e,null,[[1,7,10,13]])})));return function(t,n){return e.apply(this,arguments)}}(),this._beforeJobs=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t._jobStartTime=Date.now();case 1:case"end":return e.stop()}}),e)}))),this._afterJobs=y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(">>> after jobs",Date.now()-t._jobStartTime),t._jobStartTime=0,e.next=4,$2(t);case 4:t.dispatchChange();case 5:case"end":return e.stop()}}),e)}))),this.state=ye(Y2,(function(e){var t=e.detection,n=t.documentImages,r=t.faceImages;n.requiredSides=r2("document"),r.requiredSides=r2("face")})),this.video=function(){var e=document.createElement("video");return e.setAttribute("autoplay",""),e.setAttribute("crossorigin","anonymous"),e.setAttribute("muted",""),e.setAttribute("playsinline",""),e.style.objectFit="cover",e}(),this.stream=null,this.calibratedState=this.state,this._callbacks=[],this._dispatching=!1,this._dispatchedState=null,this._pendingJobs=[],this._jobStartTime=0,this.dispatchChange=b(this.dispatchChange,0),this._onWindowResize=b(this._onWindowResize,0),window.addEventListener("resize",this._onWindowResize,!0),window.addEventListener("orientationchange",this._onWindowResize,!0),window.addEventListener("unhandledrejection",(function(e){var n=e.reason;e.preventDefault(),t.setError(be(n))})),this._scheduleJob(y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Q2(t,t.state.frameSize);case 1:case"end":return e.stop()}}),e)}))))}return v(e,[{key:"addCallback",value:function(e){var t=this;return this._callbacks.push(e),function(){t._callbacks=t._callbacks.filter((function(t){return t!==e}))}}},{key:"getCameraImage",value:function(){var e=y(f().mark((function e(){var t;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K2(this.video);case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"nextLocation",value:function(){var e=this;this._scheduleJob(y(f().mark((function t(){var n,r,a,i,o;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.state.location.path,r=e.state.detection,a=r.faceImages,i=r.documentImages,o=null,!(o=i.requiredSides.length>i.confirmedSides.length?"documents":a.requiredSides.length>a.confirmedSides.length?"selfies":"success")||o===n){t.next=7;break}return t.next=7,D2(e,o);case 7:case"end":return t.stop()}}),t)}))))}},{key:"setDarkMode",value:function(e){var t=this;this._scheduleJob(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.state=ye(t.state,(function(t){t.darkMode=e}));case 1:case"end":return n.stop()}}),n)}))))}},{key:"setError",value:function(e){var t=this;this._scheduleJob(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.state=ye(t.state,(function(t){t.error=e}));case 1:case"end":return n.stop()}}),n)}))))}},{key:"setTutorialDone",value:function(e){var t=this;this._scheduleJob(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,S2(t,e);case 2:case"end":return n.stop()}}),n)}))))}},{key:"startCamera",value:function(){var e=this;this._scheduleJob(y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,z2(e);case 2:case"end":return t.stop()}}),t)}))))}},{key:"setCameraFacing",value:function(e){var t=this;this._scheduleJob(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,V2(t,e);case 2:case"end":return n.stop()}}),n)}))))}},{key:"stopCamera",value:function(){var e=this;this._scheduleJob(y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G2(e);case 2:case"end":return t.stop()}}),t)}))))}},{key:"setCameraManual",value:function(e){var t=this;this._scheduleJob(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,W2(t,e);case 2:case"end":return n.stop()}}),n)}))))}},{key:"openLayer",value:function(e,t,n){var r=this;this._scheduleJob(y(f().mark((function a(){return f().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,N2(r,e,t,n);case 2:case"end":return a.stop()}}),a)}))))}},{key:"closeLayer",value:function(e){var t=this;this._scheduleJob(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,T2(t,e);case 2:case"end":return n.stop()}}),n)}))))}},{key:"setLocationPath",value:function(e){var t=this;this._scheduleJob(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:D2(t,e);case 1:case"end":return n.stop()}}),n)}))))}},{key:"setStarted",value:function(){var e=this;this._scheduleJob(y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.state=ye(e.state,(function(e){e.startedAt=Date.now()})),t.next=3,D2(e,"consent");case 3:case"end":return t.stop()}}),t)}))))}},{key:"setConsented",value:function(e){var t=this;this._scheduleJob(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.state=ye(t.state,(function(t){t.consentedAt=e?Date.now():null})),!e){n.next=4;break}return n.next=4,D2(t,"documents");case 4:case"end":return n.stop()}}),n)}))))}},{key:"startDetection",value:function(e){var t=this;this._scheduleJob(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l2(t,e);case 2:case"end":return n.stop()}}),n)}))))}},{key:"setDetectionType",value:function(e){var t=this;this._scheduleJob(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,u2(t,e);case 2:case"end":return n.stop()}}),n)}))))}},{key:"stopDetection",value:function(e){var t=this;this._scheduleJob(y(f().mark((function e(){return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x2(t);case 2:case"end":return e.stop()}}),e)}))))}},{key:"resetDetection",value:function(e){var t=this;this._scheduleJob(y(f().mark((function n(){return f().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,y2(t,e);case 2:case"end":return n.stop()}}),n)}))))}},{key:"collectDetectionImage",value:function(e,t,n){var r=this;this._scheduleJob(y(f().mark((function a(){return f().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,d2(r,e,t,n);case 2:case"end":return a.stop()}}),a)}))))}},{key:"clearDetectionSides",value:function(e,t){var n=this;this._scheduleJob(y(f().mark((function r(){return f().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,v2(n,e,t);case 2:case"end":return r.stop()}}),r)}))))}},{key:"setDetectionRecord",value:function(e,t,n){var r=this;this._scheduleJob(y(f().mark((function a(){var i;return f().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(r.state=ye(r.state,(function(e){e.detection.record=n})),!(i=null===n||void 0===n?void 0:n.result.image)){a.next=12;break}a.t0=n.result.type,a.next="document"===a.t0?6:"face"===a.t0?9:12;break;case 6:return a.next=8,d2(r,e,t,i);case 8:case 11:return a.abrupt("break",12);case 9:return a.next=11,d2(r,e,t,i);case 12:case"end":return a.stop()}}),a)}))))}},{key:"setDetectionError",value:function(e,t){console.log(">>>setDetectionError",e,t)}},{key:"confirmDetectionSides",value:function(e,t){var n=this;this._scheduleJob(y(f().mark((function r(){return f().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",h2(n,e,t));case 1:case"end":return r.stop()}}),r)}))))}}]),e}();function $2(e){return e3.apply(this,arguments)}function e3(){return(e3=y(f().mark((function e(t){var n,r,a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.state,r=n.location,a=n.error,t.calibratedState.location===r){e.next=4;break}return e.next=4,x2(t);case 4:if(!a){e.next=9;break}return e.next=7,N2(t,"AppError",void 0,{direction:"center"});case 7:e.next=21;break;case 9:if("documents"!==r.path){e.next=14;break}return e.next=12,r3(t);case 12:e.next=21;break;case 14:if("selfies"!==r.path){e.next=19;break}return e.next=17,t3(t);case 17:e.next=21;break;case 19:return e.next=21,G2(t);case 21:t.calibratedState=t.state;case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function t3(e){return n3.apply(this,arguments)}function n3(){return(n3=y(f().mark((function e(t){var n,r,a,i,o,s,u,c,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.state,r=n.layers,a=n.camera,i=n.detection,o=n.tutorial,s=i.faceImages,u=s.requiredSides,c=s.collectedSides,l=q2(u,c,!0),t.state=ye(t.state,(function(e){e.detection.type="face",e.detection.side=a2(e.detection.faceImages)})),w2(o,"selfies")){e.next=11;break}if(_2(r,"Tutorial")){e.next=9;break}return e.next=9,N2(t,"Tutorial");case 9:case 19:case 24:case 35:e.next=40;break;case 11:if(!l){e.next=21;break}if(_2(r,"FaceUploadReview")){e.next=19;break}return e.next=15,x2(t);case 15:return e.next=17,A2(t);case 17:return e.next=19,N2(t,"FaceUploadReview");case 21:if(!r.active){e.next=26;break}return e.next=24,x2(t);case 26:if(a.active&&!a.manual&&"user"===a.facing){e.next=37;break}return e.next=29,V2(t,"user");case 29:return e.next=31,W2(t,!1);case 31:return e.next=33,z2(t);case 33:return e.next=35,l2(t,"face");case 37:if(i.active||l){e.next=40;break}return e.next=40,l2(t,"face");case 40:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function r3(e){return a3.apply(this,arguments)}function a3(){return(a3=y(f().mark((function e(t){var n,r,a,i,o,s,u,c,l,p,d,h;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.state,r=n.layers,a=n.camera,i=n.detection,o=n.tutorial,s=i.documentImages,u=s.requiredSides,c=s.confirmedSides,l=s.collectedSides,p=i2(s),d=q2(u,c,!0),h=q2(u,l,!0),t.state=ye(t.state,(function(e){e.detection.type="document",e.detection.side=a2(e.detection.documentImages)})),w2(o,"documents")){e.next=13;break}if(_2(r,"Tutorial")){e.next=11;break}return e.next=11,N2(t,"Tutorial");case 11:case 21:case 30:case 35:case 46:case 51:e.next=56;break;case 13:if(!d){e.next=23;break}return e.next=16,x2(t);case 16:if(_2(r,"DocumentUploadReview")){e.next=21;break}return e.next=19,A2(t);case 19:return e.next=21,N2(t,"DocumentUploadReview");case 23:if(!p){e.next=32;break}return e.next=26,x2(t);case 26:return e.next=28,A2(t);case 28:return e.next=30,N2(t,"ConfirmDocumentImage");case 32:if(!r.active){e.next=37;break}return e.next=35,x2(t);case 37:if(a.active&&"environment"===a.facing){e.next=48;break}return e.next=40,V2(t,"environment");case 40:if(a.active){e.next=43;break}return e.next=43,z2(t);case 43:if(a.manual){e.next=46;break}return e.next=46,l2(t,"document");case 48:if(i.active||a.manual||d||h){e.next=53;break}return e.next=51,l2(t,"document");case 53:if(!a.manual){e.next=56;break}return e.next=56,x2(t);case 56:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var i3=new J2,o3=(0,e.createContext)({AppController:i3,appState:i3.state});function s3(){return(0,e.useContext)(o3)}var u3={Button:"Button_Button__DRD9X",fileInput:"Button_fileInput__qCmed"},c3=n(184),l3=new Set(["image/jpg","image/jpeg","image/png"]);function p3(e){var t=e.children,n=e.onClick,r=e.className,a=e.theme,i=e.size,o=e.appearance,s=e.feature,u=e.pressable,c=e.title,l={className:"".concat(u3.Button," ").concat(r||""),"data-theme":a,"data-size":i,"data-appearance":o||"button","data-pressable":u,"data-feature":s};if("file"===s){return(0,c3.jsxs)("label",p(p({},l),{},{tabIndex:0,children:[(0,c3.jsx)("input",{title:c||"",accept:"image/png,image/jpeg,image/jpg",type:"file",className:u3.fileInput,onChange:function(e){var t=e.currentTarget.files;if(t&&1===t.length){var r=t[0];if(l3.has(r.type)){var a=new Image,i=URL.createObjectURL(r);a.onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d");if(t){var r=a.width,o=a.height;e.width=r,e.height=o,t.drawImage(a,0,0,r,o);var s=t.getImageData(0,0,r,o);URL.revokeObjectURL(i),n&&s&&n(s)}else URL.revokeObjectURL(i)},a.onerror=function(){URL.revokeObjectURL(i)},a.src=i}else alert("invalid type ".concat(r.type))}}}),t]}))}return(0,c3.jsx)("button",p(p({},l),{},{onClick:n,title:c||"",children:t}))}var d3={Picture:"Picture_Picture__szzuy"};function f3(t){var n=function(t){var n=(0,e.useRef)(null),r=(0,e.useRef)([]);return(0,e.useEffect)((function(){r.current.forEach((function(e){URL.revokeObjectURL(e)})),r.current.length=0}),[]),(0,e.useEffect)((function(){var e=n.current;if(e){if(!t||!t.width||!t.height)return e.style.backgroundImage="",void(e.style.opacity="1");var a=document.createElement("canvas");a.width=t.width,a.height=t.height;var i=a.getContext("2d");if(i){var o=!1,s=setTimeout((function(){i.putImageData(t,0,0),a.toBlob((function(t){if(t&&!o){r.current.forEach((function(e){URL.revokeObjectURL(e)})),r.current.length=0;var n=new File([t],"image.png",{type:"image/png"}),a=URL.createObjectURL(n);r.current.push(a),e.style.backgroundImage="url(".concat(a,")"),e.style.opacity="1"}}),"image/png")}),50);return function(){clearTimeout(s),o=!0}}}}),[t]),n}(t.image);return(0,c3.jsx)("div",{className:d3.Picture,ref:n})}var h3={PreviewPicture:"DocumentUploadReview_PreviewPicture__i9o6z",closePreview:"DocumentUploadReview_closePreview__SP+8r",row:"DocumentUploadReview_row__Sj3GL",col:"DocumentUploadReview_col__dcNEJ"},m3={CloseButton:"CloseButton_CloseButton__EOBWj"};var v3=n.p+"auto-camera-demo/build/static/media/close-circle-svgrepo-com.69ee813a6e68cd5b076629c679ac5b2a.svg";function g3(e){var t=e.className,n=e.onClick;return(0,c3.jsx)(p3,{className:"".concat(m3.CloseButton," ").concat(t||""),onClick:n,appearance:"none",children:(0,c3.jsx)("img",{src:v3,width:"100%",height:"100%",alt:"close"})})}function y3(t){var n=s3().AppController,r=t.image,a=(0,e.useCallback)((function(){n.closeLayer("PreviewPicture")}),[n]);return(0,c3.jsxs)("div",{className:h3.PreviewPicture,children:[(0,c3.jsx)(g3,{onClick:a,className:h3.closePreview}),(0,c3.jsx)(f3,{image:r})]})}var b3={heading:"ConfirmDocumentImage_heading__IG4lI"};var x3={selfies:"FaceUploadReview_selfies__KfHdT",selfie:"FaceUploadReview_selfie__UQIky","cross-fade":"FaceUploadReview_cross-fade__Qso2t"};var k3={debug:"Atom_debug__pUnPV",overflowAuto:"Atom_overflowAuto__VAWF3",transOpacity:"Atom_transOpacity__IHqyV",center:"Atom_center__4HNdF",radius5:"Atom_radius5__xFhgl",borderBox:"Atom_borderBox__AwnJL",grid:"Atom_grid__JMuZD",flexRow:"Atom_flexRow__X1LyY",flexCol:"Atom_flexCol__LLBuJ",flex1:"Atom_flex1__hfcTQ",block:"Atom_block__idkTD",flexCol1:"Atom_flexCol1__8RDlZ",h100p:"Atom_h100p__4XNqn",w100p:"Atom_w100p__vJRU5",p0:"Atom_p0__WRYn2",p1:"Atom_p1__G2Hrl",p2:"Atom_p2__BXSNK",p4:"Atom_p4__gv+6h",p6:"Atom_p6__ccqO6",p8:"Atom_p8__X2i6I",p10:"Atom_p10__5paj3",px10:"Atom_px10__E6nbI",py10:"Atom_py10__d-W3A",m8:"Atom_m8__F9a7y",m10:"Atom_m10__iRymV",maxH25vh:"Atom_maxH25vh__mrQWi"};var w3=n.p+"auto-camera-demo/build/static/media/id-card-svgrepo-com.7b61941095e0ec550f71030e581b492b.svg";var S3=n.p+"auto-camera-demo/build/static/media/face-id-svgrepo-com.d8ed76a53cc790d97163cb99fb5d5e6e.svg",I3={ScrollableIndicator:"ScrollableIndicator_ScrollableIndicator__hC0Zq"};function _3(){var t=(0,e.useRef)(null);return(0,e.useEffect)((function(){var e=t.current;if(e){e.classList.add(I3.ScrollableIndicator);var n=b((function(){e.scrollTop?e.setAttribute("data-can-scroll-up","true"):e.removeAttribute("data-can-scroll-up"),e.scrollTop<e.scrollHeight-e.clientHeight?e.setAttribute("data-can-scroll-down","true"):e.removeAttribute("data-can-scroll-down")}));return e.addEventListener("scroll",n,!0),n(),function(){e.removeEventListener("scroll",n,!0)}}}),[]),t}var N3=new Map;function C3(e,t){if(N3.has(e))throw new Error;N3.set(e,t)}function T3(e){return Object.keys(e.mapping).map((function(t){return(0,c3.jsx)(A3,p({},e.mapping[t]),t)}))}function E3(t){var n=(0,e.useRef)(null),r=t.active,a=t.direction;return(0,e.useEffect)((function(){var e=n.current;if(e){var t=a||"btl",i=!1,o=requestAnimationFrame((function n(){i||(!function(e,t,n){if("rtl"===n)if(t){var r=-e.clientWidth;e.style.transform="translate3d(".concat(r,"px, 0, 0)")}else e.style.transform="translate3d(0, 0, 0)";else if("center"===n)if(t){var a=e.clientHeight/2,i=e.clientWidth/2,o="calc(50% - ".concat(Math.round(a),"px)"),s="calc(50% - ".concat(Math.round(i),"px)");e.style.top=o,e.style.left=s,e.style.transform="scale(0.98)"}else e.style.transform="scale(0)";else if(e.style.top="100%",t){var u=-e.clientHeight;e.style.transform="translate3d(0, ".concat(u,"px, 0)")}else e.style.transform="translate3d(0, 0, 0)"}(e,r,t),o=requestAnimationFrame(n))}));return function(){cancelAnimationFrame(o),i=!0}}}),[r,a]),n}function A3(t){var n=t.active,r=t.closedAt,a=t.content,i=t.layerName,o=t.openedAt,s=t.zIndex,u=t.appreance,c=t.direction,l=t.behind,f=E3(t);(0,e.useEffect)((function(){var e=document.body;ke()&&e&&(e.style.backgroundColor=n?"#000":"")}),[n]);var h={zIndex:s},m={"data-active":!!n,"data-closed-at":r,"data-layer-name":i,"data-opened-ad":o,"data-appreance":u||"card","data-direction":c||"btt","data-behind":l},v=void 0===a?function(e){var t=N3.get(e);return t?(0,c3.jsx)(t,{}):(0,c3.jsxs)("div",{children:["Error: Layer content ",e," isn't registered"]})}(i):a;return(0,c3.jsx)("div",p(p({className:d.Layer,style:h},m),{},{ref:f,children:(0,c3.jsx)("div",{className:d.layerContent,children:v})}))}function R3(e){var t=s3().appState,n=e.children,r=t.layers;return(0,c3.jsxs)("div",{className:d.layersRoot,children:[(0,c3.jsx)("div",{className:d.children,children:n}),(0,c3.jsx)("div",{className:d.backdrop,"data-backdrop":r.active}),T3(r)]})}C3("AppError",(function(t){var n=s3(),r=n.appState,a=n.AppController,i=r.error,o=i?String(i):"Unknown error",s=(0,e.useCallback)((function(){a.setError(null),a.closeLayer("AppError")}),[a]);return(0,c3.jsxs)("div",{className:k3.p10,children:[(0,c3.jsx)("h3",{children:"Oops, something went wrong"}),(0,c3.jsx)("p",{children:o}),(0,c3.jsx)("div",{children:(0,c3.jsx)(p3,{onClick:s,children:"Try again"})})]})})),C3("Tutorial",(function(t){var n=s3(),r=n.AppController,a=n.appState,i=_3(),o=a.location.path,s=(0,e.useCallback)((function(){r.setTutorialDone(o),r.closeLayer("Tutorial")}),[r,o]);return"selfies"===o?(0,c3.jsxs)("div",{className:k3.p10,children:[(0,c3.jsx)("h2",{children:"Prepare to capture selfies images"}),(0,c3.jsx)("p",{children:"Once your face is visible, we'll snap several shots automatically for you."}),(0,c3.jsx)("div",{className:"".concat(k3.center," ").concat(k3.flexRow," ").concat(k3.m8),children:(0,c3.jsx)("img",{src:S3,alt:"face",width:"20%"})}),(0,c3.jsxs)("ul",{className:[k3.overflowAuto,k3.maxH25vh,k3.radius5].join(" "),ref:i,children:[(0,c3.jsx)("li",{children:"Follow the instructions to take multiple selfies with the app."}),(0,c3.jsx)("li",{children:"Find good lighting: Lighting is crucial for taking high-quality selfies. Choose a well-lit area, either with natural or artificial light."}),(0,c3.jsx)("li",{children:"Frame the shot: Consider the background and surroundings before taking the photo. Make sure to frame the shot and remove any distractions."})]}),(0,c3.jsx)(p3,{theme:"primary",onClick:s,children:"OK"})]}):"documents"===o?(0,c3.jsxs)("div",{className:k3.p10,children:[(0,c3.jsx)("h2",{children:"Get your document for the camera"}),(0,c3.jsx)("div",{className:"".concat(k3.center," ").concat(k3.flexRow),children:(0,c3.jsx)("img",{src:w3,alt:"id card",width:"30%"})}),(0,c3.jsx)("p",{children:"Once the whole document is visible, we'll snap it automatically for you."}),(0,c3.jsxs)("ul",{className:[k3.overflowAuto,k3.maxH25vh,k3.radius5].join(" "),ref:i,children:[(0,c3.jsx)("li",{children:"Find good lighting: Take photos in a well-lit area to prevent hard-to-read text."}),(0,c3.jsx)("li",{children:"Use a flat surface: Keep the document steady to avoid blurring."}),(0,c3.jsx)("li",{children:"Steady the camera: Avoid shaking or blurring with a tripod or steady hand."}),(0,c3.jsx)("li",{children:"Get close: Capture high detail by moving the camera close to the document."}),(0,c3.jsx)("li",{children:"Focus: Ensure clear text by checking the camera's focus."})]}),(0,c3.jsx)(p3,{theme:"primary",onClick:s,children:"Auto snap"})]}):(0,c3.jsx)("div",{children:"Unknown Tutorial("})})),C3("ConfirmDocumentImage",(function(t){var n,r=s3(),a=r.AppController,i=r.appState.detection.documentImages,s=o((0,e.useState)(""),2),u=s[0],c=s[1],l=o((0,e.useState)(null),2),p=l[0],d=l[1],f=i2(i)||u,h=i.mapping[f]||p,m=(0,e.useCallback)((function(){c(f),d(h),a.closeLayer("ConfirmDocumentImage"),f&&a.confirmDetectionSides("document",[f])}),[a,f,h]),v=(0,e.useCallback)((function(){c(f),d(h),a.closeLayer("ConfirmDocumentImage"),f&&a.clearDetectionSides("document",[f])}),[a,f,h]);return n="front"===f&&h?(0,c3.jsxs)(c3.Fragment,{children:[(0,c3.jsx)("div",{className:b3.heading,children:"Review the front side of the document"}),(0,c3.jsx)(f3,{image:h}),(0,c3.jsxs)("div",{children:[(0,c3.jsx)(p3,{onClick:m,theme:"primary",children:"Looks good"}),(0,c3.jsx)(p3,{onClick:v,children:"Try another one"})]})]}):"back"===f&&h?(0,c3.jsxs)(c3.Fragment,{children:[(0,c3.jsx)("div",{className:b3.heading,children:"Review the back side of the document"}),(0,c3.jsx)(f3,{image:h}),(0,c3.jsxs)("div",{children:[(0,c3.jsx)(p3,{onClick:m,theme:"primary",children:"Looks good"}),(0,c3.jsx)(p3,{onClick:v,children:"Try another one"})]})]}):(0,c3.jsxs)("div",{children:["Invalid side ",f]}),(0,c3.jsx)("div",{children:n})})),C3("DocumentUploadReview",(function(t){var n=s3(),r=n.appState,a=n.AppController,i=r.detection.documentImages,s=i.collectedSides,u=o((0,e.useState)({}),2),c=u[0],l=u[1],p=(0,e.useCallback)((function(e){a.openLayer("PreviewPicture",(0,c3.jsx)(y3,{image:e}),{direction:"center"})}),[a]),d=(0,e.useCallback)((function(){a.confirmDetectionSides("document",s),a.closeLayer("DocumentUploadReview"),a.nextLocation()}),[a,s]),f=(0,e.useCallback)((function(){var e=s.reduce((function(e,t){return e[t]=i.mapping[t]||null,e}),{});l(e),a.clearDetectionSides("document",s),a.closeLayer("DocumentUploadReview")}),[a,s,i]),h=["front","back"].map((function(e){return function(e,t,n){return(0,c3.jsxs)(p3,{appearance:"none",className:h3.col,pressable:!!t,onClick:t?function(){return n(t)}:void 0,children:[(0,c3.jsx)("div",{children:(0,c3.jsxs)("b",{children:["The ",e," side"]})}),(0,c3.jsx)(f3,{image:t})]},e)}(e,i.mapping[e]||c[e],p)}));return(0,c3.jsxs)("div",{className:h3.DocumentUploadReview,children:[(0,c3.jsx)("h3",{children:"Review the captured document images"}),(0,c3.jsx)("p",{children:"We have reviewed these images and they appear to be in good condition. If the images look correct to you, you may proceed to the next step."}),(0,c3.jsx)("div",{className:h3.row,children:h}),(0,c3.jsxs)("div",{children:[(0,c3.jsx)(p3,{theme:"primary",onClick:d,children:"Next step"}),(0,c3.jsx)(p3,{onClick:f,children:"Clear the images and try again"})]})]})})),C3("FaceUploadReview",(function(t){var n=s3(),r=n.AppController,a=n.appState.detection.faceImages,i=a.collectedSides,o=a.mapping,s=(0,e.useCallback)((function(){r.clearDetectionSides("face",i),r.closeLayer("FaceUploadReview")}),[r,i]),u=(0,e.useCallback)((function(){r.confirmDetectionSides("face",i),r.closeLayer("FaceUploadReview"),r.nextLocation()}),[r,i]),c=i.map((function(e){return o[e]})).filter(Boolean);return(0,c3.jsxs)("div",{children:[(0,c3.jsx)("h3",{children:"Review the selfies taken"}),(0,c3.jsx)("p",{children:"We have reviewed these images and they appear to be in good condition. If the images look correct to you, you may proceed to the next step."}),(0,c3.jsx)("div",{className:x3.selfies,children:c.map((function(e,t){return(0,c3.jsx)("div",{className:x3.selfie,"data-index":t,children:(0,c3.jsx)(f3,{image:e})},"img_".concat(t))}))}),(0,c3.jsxs)("div",{children:[(0,c3.jsx)(p3,{theme:"primary",onClick:u,children:"Next step"}),(0,c3.jsx)(p3,{onClick:s,children:"Clear selfies and try again"})]})]})}));var F3={appFrame:"AppFrame_appFrame__SzMtg"},D3={Icon:"Icon_Icon__jzEdF","pops-in":"Icon_pops-in__dP4Wf"};function M3(e){var t=e.animation;return(0,c3.jsx)("div",{className:D3.Icon,"data-animation":t||"",children:(0,c3.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 64 64",enableBackground:"new 0 0 64 64",children:(0,c3.jsx)("path",{d:"M32,2C15.431,2,2,15.432,2,32c0,16.568,13.432,30,30,30c16.568,0,30-13.432,30-30C62,15.432,48.568,2,32,2z M25.025,50 l-0.02-0.02L24.988,50L11,35.6l7.029-7.164l6.977,7.184l21-21.619L53,21.199L25.025,50z",fill:"#43a047"})})})}function O3(){return(0,c3.jsx)("div",{className:D3.Icon,children:(0,c3.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"48",height:"48",children:(0,c3.jsx)("path",{d:"M 18.36,5.64 C 17.99,5.268 17.41,5.268 17.04,5.64 L 12,10.68 6.96,5.64 C 6.588,5.268 6.012,5.268 5.64,5.64 5.268,6.012 5.268,6.588 5.64,6.96 L 10.68,12 5.64,17.04 C 5.268,17.412 5.268,17.988 5.64,18.36 6.012,18.732 6.588,18.732 6.96,18.36 L 12,13.32 17.04,18.36 C 17.41,18.732 17.99,18.732 18.36,18.36 18.732,17.988 18.732,17.412 18.36,17.04 L 13.32,12 18.36,6.96 C 18.732,6.588 18.732,6.012 18.36,5.64 Z",fill:"#222"})})})}function P3(t){var n=s3().AppController,r=(0,e.useCallback)((function(){n.closeLayer("DataPrivacyHelp")}),[n]);return(0,c3.jsxs)("div",{children:[(0,c3.jsx)("h3",{children:"Where your data will be used"}),(0,c3.jsxs)("div",{className:k3.flexRow,children:[(0,c3.jsx)("div",{className:"".concat(k3.flexCol," ").concat(k3.p6),children:(0,c3.jsx)(M3,{})}),(0,c3.jsxs)("div",{className:"".concat(k3.flexCol1," ").concat(k3.p6),children:[(0,c3.jsx)("h4",{children:"Groundbreaking technology"}),(0,c3.jsx)("p",{children:"We leverage our own biometric technology to verify your identity through your document and selfie."})]})]}),(0,c3.jsxs)("div",{className:k3.flexRow,children:[(0,c3.jsx)("div",{className:"".concat(k3.flexCol," ").concat(k3.p6),children:(0,c3.jsx)(M3,{})}),(0,c3.jsxs)("div",{className:"".concat(k3.flexCol1," ").concat(k3.p6),children:[(0,c3.jsx)("h4",{children:"Service providers"}),(0,c3.jsxs)("p",{children:["We refer to the document issuer or authorized record holders to confirm document details."," "]})]})]}),(0,c3.jsxs)("div",{className:k3.flexRow,children:[(0,c3.jsx)("div",{className:"".concat(k3.flexCol," ").concat(k3.p6),children:(0,c3.jsx)(M3,{})}),(0,c3.jsxs)("div",{className:"".concat(k3.flexCol1," ").concat(k3.p6),children:[(0,c3.jsx)("h4",{children:"Third-party partners"}),(0,c3.jsx)("p",{children:"We rely on trusted partners to help us verify your ID numbers and addresses."})]})]}),(0,c3.jsx)("div",{children:(0,c3.jsx)(p3,{onClick:r,theme:"primary",children:"OK"})})]})}var L3={PageFooter:"PageFooter_PageFooter__4qNyd",provider:"PageFooter_provider__nPgQM",tos:"PageFooter_tos__vIkDW",privacy:"PageFooter_privacy__wDmU5"};function z3(e){return(0,c3.jsx)("div",{className:L3.PageFooter,children:(0,c3.jsxs)("span",{className:L3.provider,children:["Powered by ",(0,c3.jsx)("b",{children:"The Hedgerhog Workshop"})]})})}var B3={PageSideMenu:"PageSideMenu_PageSideMenu__QLeu1",closeButton:"PageSideMenu_closeButton__10NMe",close:"PageSideMenu_close__l2GRp"};function W3(t){var n=s3(),r=n.AppController,a=n.appState.darkMode,i=(0,e.useCallback)((function(){r.closeLayer("PageSideMenu")}),[r]),o=(0,e.useCallback)((function(){r.setDarkMode(!a)}),[r,a]);return(0,c3.jsxs)("div",{className:B3.PageSideMenu,children:[(0,c3.jsx)(g3,{onClick:i,className:B3.closeButton}),(0,c3.jsx)("h4",{children:"Settings"}),(0,c3.jsxs)("ul",{children:[(0,c3.jsx)("li",{children:(0,c3.jsxs)(p3,{appearance:"none",pressable:!0,children:["\u26aa\xa0"," Language"]})}),(0,c3.jsx)("li",{children:(0,c3.jsx)(p3,{appearance:"none",pressable:!0,onClick:o,children:a?"\u26aa\xa0 Light Mode":"\u26aa\xa0 Dark mode"})})]}),(0,c3.jsx)("h4",{children:"Links"}),(0,c3.jsxs)("ul",{children:[(0,c3.jsx)("li",{children:(0,c3.jsxs)(p3,{appearance:"none",pressable:!0,children:["\u26aa\xa0"," About"]})}),(0,c3.jsx)("li",{children:(0,c3.jsxs)(p3,{appearance:"none",pressable:!0,children:["\u26aa\xa0"," Feedback?"]})}),(0,c3.jsx)("li",{children:(0,c3.jsxs)(p3,{appearance:"none",pressable:!0,children:["\u26aa\xa0"," Contact"]})}),(0,c3.jsx)("li",{children:(0,c3.jsxs)(p3,{appearance:"none",pressable:!0,children:["\u26aa\xa0"," Privacy"]})}),(0,c3.jsx)("li",{children:(0,c3.jsxs)(p3,{appearance:"none",pressable:!0,children:["\u26aa\xa0"," Terms"]})})]})]})}var U3={TopPageNavBar:"TopPageNavBar_TopPageNavBar__ekr0b",row:"TopPageNavBar_row__SpOyy",brandName:"TopPageNavBar_brandName__YXj2I",breadCrumbs:"TopPageNavBar_breadCrumbs__OYSMT",breadCrumb:"TopPageNavBar_breadCrumb__ADbzF","reveal-in":"TopPageNavBar_reveal-in__oLRwG",sideMenuButton:"TopPageNavBar_sideMenuButton__dfS9j"};function V3(t){var n=s3().AppController,r=t.active,a=t.disabled,i=t.children,o=t.path,s=t.animated,u=t.done,c=(0,e.useCallback)((function(){n.setLocationPath(o)}),[n,o]);return(0,c3.jsx)("li",{className:U3.breadCrumb,"data-active":!!r,"data-animated":s,"data-disabled":!!a,"data-done":!!u,children:(0,c3.jsx)(p3,{appearance:"none",pressable:!r&&!a,onClick:a?void 0:c,children:i})})}function j3(){var t=s3(),n=t.appState,r=t.AppController,a=n.detection.documentImages,i=(0,e.useCallback)((function(){r.openLayer("PageSideMenu",(0,c3.jsx)(W3,{}),{direction:"rtl",appreance:"none"})}),[r]),o=n.location,s=n.consentedAt,u=n.startedAt,c=["intro","consent","documents","selfies"].indexOf(o.path)+1,l=q2(a.requiredSides,a.confirmedSides,!0);return(0,c3.jsxs)("div",{className:U3.TopPageNavBar,children:[(0,c3.jsx)("div",{className:U3.brandName,children:"Stealth Shots"}),(0,c3.jsxs)("div",{className:U3.row,children:[(0,c3.jsxs)("ul",{className:U3.breadCrumbs,children:[(0,c3.jsx)(V3,{path:"intro",active:"intro"===o.path,animated:1===c,disabled:!1,done:!!u,children:"Intro"}),(0,c3.jsx)(V3,{path:"consent",animated:2===c,active:"consent"===o.path,disabled:!u&&"consent"!==o.path,done:!!s,children:"Consent"}),(0,c3.jsx)(V3,{path:"documents",animated:3===c,active:"documents"===o.path,disabled:"documents"!==o.path&&!s,done:l,children:"Photos"}),(0,c3.jsx)(V3,{path:"selfies",animated:4===c,active:"selfies"===o.path,done:!1,disabled:"selfies"!==o.path&&(!l||!s),children:"Selfies"})]}),(0,c3.jsx)(p3,{appearance:"none",className:U3.sideMenuButton,pressable:!0,onClick:i,title:"Open side menu",children:(0,c3.jsx)("span",{children:"\u22ef"})})]})]})}var G3={Page:"Page_Page__j6GS3",header:"Page_header__K+EXL",body:"Page_body__EHjpW",footer:"Page_footer__s+nDt","fade-in":"Page_fade-in__UPhJt","slide-up":"Page_slide-up__kn8yS","pop-in":"Page_pop-in__pNF6B"};function H3(t){var n=t.bodyPadding,r=function(){var t=(0,e.useRef)(null),n=s3().appState.location.path;return(0,e.useEffect)((function(){if(t.current)return console.log(">>>> Enter page: "+n),function(){console.log(">>> Leave page:  "+n)}}),[t,n]),t}(),a=t.children,i=t.afterBody,o={padding:n};return(0,c3.jsxs)("div",{className:G3.Page,ref:r,children:[(0,c3.jsx)("div",{className:G3.header,children:(0,c3.jsx)(j3,{})}),(0,c3.jsx)("div",{className:G3.body,style:o,children:a}),i,(0,c3.jsx)("div",{className:G3.footer,children:(0,c3.jsx)(z3,{})})]})}function q3(){var t=s3().AppController,n=(0,e.useCallback)((function(){t.closeLayer("RejectConsentWarning")}),[t]);return(0,c3.jsxs)("div",{className:k3.p10,children:[(0,c3.jsx)("h2",{children:"Agree to Our Terms and Get Started!"}),(0,c3.jsx)("p",{children:"Welcome to our amazing platform! To begin using our services, we require your consent to our terms and conditions. We know this might sound like just another legal hoop to jump through, but it's important for both of us. By consenting to our terms, you're helping us create a safe and secure platform where everyone can thrive. Plus, you won't regret it!"}),(0,c3.jsx)(p3,{onClick:n,children:"Close"})]})}function K3(t){var n=s3().AppController,r=(0,e.useCallback)((function(){n.setConsented(!0)}),[n]),a=(0,e.useCallback)((function(){n.openLayer("RejectConsentWarning",(0,c3.jsx)(q3,{}),{direction:"center"})}),[n]),i=(0,e.useCallback)((function(){n.openLayer("DataPrivacyHelp",(0,c3.jsx)(P3,{}))}),[n]),o=(0,c3.jsxs)("div",{className:"".concat(k3.w100p," ").concat(k3.px10," ").concat(k3.borderBox),children:[(0,c3.jsx)(p3,{theme:"primary",onClick:r,children:"Agree to proceed"}),(0,c3.jsx)(p3,{onClick:a,children:"No, don't verify me"})]});return(0,c3.jsxs)(H3,{afterBody:o,children:[(0,c3.jsx)("h1",{children:"Verify its you"}),(0,c3.jsxs)("p",{children:["To continue identity verification, you\u2019ll need to provide some personal information."," ",(0,c3.jsx)(p3,{appearance:"link",onClick:i,children:"How will my data be used?"})]}),(0,c3.jsx)("p",{children:"What\u2019s required:"}),(0,c3.jsxs)("ul",{children:[(0,c3.jsx)("li",{children:"Driver\u2019s license or passport (not a screenshot)"}),(0,c3.jsx)("li",{children:"Selfie of you"}),(0,c3.jsx)("li",{children:"ID number"})]})]})}var X3={Camera:"Camera_Camera__HZGy3",video:"Camera_video__a6f+4",shadowFrame:"Camera_shadowFrame__F97OJ",animFrame:"Camera_animFrame__rR3eP","anim-frame":"Camera_anim-frame__yBXSh",videoContainer:"Camera_videoContainer__9gKCl",debugPanel:"Camera_debugPanel__Cgp+e"};function Y3(){var t=(0,e.useRef)(null),n=s3().AppController,r=n.video,a=n.stream;return(0,e.useEffect)((function(){var e=t.current;if(e){var n=e.getContext("2d");if(n){var i=requestAnimationFrame((function t(){!function(){var t=r.videoHeight,i=r.videoWidth;if(t&&i){var o=e.offsetWidth,s=e.offsetHeight;if(n.clearRect(0,0,Math.max(e.width||o,o),Math.max(e.height||s,s)),a){var u=a.getVideoTracks();if(u&&u[0]){var c=i,l=t;if(c>580){var p=c/580;c/=p,l/=p}e.width=c,e.height=l,function(e,t){var n=t.getContext("2d");n&&(n.imageSmoothingEnabled=!0,n.drawImage(e,0,0,t.width,t.height))}(r,e)}}}}(),i=requestAnimationFrame(t)}));return function(){cancelAnimationFrame(i)}}}}),[r,a]),t}var Q3=function(){var e=navigator.userAgent.toLowerCase();return!/chrome/.test(e)&&!/edge/.test(e)&&!/firefox/.test(e)&&!/mobile/.test(e)&&/safari/.test(e)&&/macintosh/.test(e)}()||!0;function Z3(){var t=s3().appState.camera.mirrored,n=Y3(),r=function(){var t=(0,e.useRef)(null),n=(0,e.useRef)(null),r=s3().AppController.stream,a=null===r||void 0===r?void 0:r.getVideoTracks(),i=a?a[0]:null;return(0,e.useEffect)((function(){var e=t.current;if(e&&(n.current&&(P2(n.current),n.current=null),i)){var r=new MediaStream;r.addTrack(i),e.srcObject=r,n.current=r,console.log(">>>>track",i)}}),[i]),t}();return Q3?(0,c3.jsx)("canvas",{ref:n,className:X3.video,"data-mirrored":t}):(0,c3.jsx)("video",{ref:r,playsInline:!0,muted:!0,autoPlay:!0,crossOrigin:"anonymous",className:X3.video,"data-mirrored":t})}function J3(e){var t=e.frameShape,n=e.width,r=e.height,a=e.shimmering,i=e.children,o={width:"".concat(n,"px"),height:"".concat(r,"px")};return(0,c3.jsxs)("div",{className:X3.Camera,"data-frame-shape":t,style:o,children:[(0,c3.jsx)("div",{className:X3.shadowFrame}),(0,c3.jsx)("div",{className:X3.animFrame,"data-active":a?"":void 0}),(0,c3.jsx)(Z3,{}),i]})}var $3=n(295),e4=n.n($3),t4={QRCode:"QRCode_QRCode__+AV0f",copy:"QRCode_copy__4FwhX",copiedLabel:"QRCode_copiedLabel__-i5CB","pop-in":"QRCode_pop-in__4PwLJ"},n4={Pill:"Pill_Pill__ESV8L"};function r4(e){var t=e.children,n=e.theme;return(0,c3.jsx)("div",{className:n4.Pill,"data-theme":n,"data-pill":!0,children:t})}function a4(){var t=function(){var t=(0,e.useRef)(null),n=(0,e.useRef)(null),r=o((0,e.useState)(null),2),a=r[0],i=r[1],s=window.location.href;return(0,e.useEffect)((function(){var e=t.current;if(e&&!n.current){n.current=new(e4())(e,{text:s,width:200,height:200,autoColorDark:"rgba(0, 0, 0, .6)",autoColorLight:"rgba(255, 255, 255, .7)",PO:"#1d48cc",PI:"#0c034f"});var r=e.querySelector("canvas");r&&r.toBlob((function(e){e&&i(e)}),"image/png")}}),[s]),{elRef:t,image:a,url:s}}(),n=t.elRef,r=t.image,a=t.url,i=o((0,e.useState)(0),2),s=i[0],u=i[1],c=(0,e.useCallback)((function(){var e="Open link: ".concat(a),t='Open link: <a href="'.concat(a,'">').concat(a,"</a>"),n={"text/plain":new Blob([e],{type:"text/plain"}),"text/html":new Blob([t],{type:"text/html"})};r&&(n[r.type]=r);var i=new ClipboardItem(n);window.navigator.clipboard.write([i]),u(Date.now())}),[r,a]);return(0,c3.jsxs)("div",{className:t4.QRCode,ref:n,children:[(0,c3.jsx)("button",{className:t4.copy,title:"click to copy QR code",onClick:c,tabIndex:0}),s&&(0,c3.jsx)("div",{className:t4.copiedLabel,children:(0,c3.jsx)(r4,{theme:"white",children:"Copied"})},s)]})}var i4={cols:"Handoff_cols__YbvRF",col1:"Handoff_col1__FFuS8",col2:"Handoff_col2__7hikc",footer:"Handoff_footer__uEJFz"};function o4(){var t=s3().AppController,n=(0,e.useCallback)((function(){t.closeLayer("HandoffHelp")}),[t]);return(0,c3.jsxs)("div",{children:[(0,c3.jsxs)("div",{className:i4.cols,children:[(0,c3.jsx)("div",{className:i4.col1,style:{"--flex":"1"},children:(0,c3.jsx)("h3",{children:"Having problem with scanning the QR Code?"})}),(0,c3.jsx)("div",{className:i4.col1,style:{"--flex":"0"},children:(0,c3.jsx)(p3,{appearance:"icon",onClick:n,pressable:!0,title:"Close",children:(0,c3.jsx)(O3,{})})})]}),(0,c3.jsx)("hr",{}),(0,c3.jsx)("div",{children:(0,c3.jsxs)("ul",{children:[(0,c3.jsxs)("li",{children:[(0,c3.jsx)("h4",{children:"Check the lighting:"}),"Make sure there's enough light to clearly see the QR code."]}),(0,c3.jsxs)("li",{children:[(0,c3.jsx)("h4",{children:"Check the distance:"}),"Hold your phone at the right distance from the QR code."]}),(0,c3.jsxs)("li",{children:[(0,c3.jsx)("h4",{children:"Clean the camera lens:"}),"If your phone's camera lens is dirty, it may be difficult to scan the QR code."]}),(0,c3.jsxs)("li",{children:[(0,c3.jsx)("h4",{children:"Copy the URL or phone number:"}),"If you're still having trouble scanning the QR code, try copying the URL or phone number and manually entering it into your phone's browser or messaging app."]})]})})]})}function s4(t){var n=s3().AppController,r=(0,e.useCallback)((function(){n.closeLayer("Handoff")}),[n]),a=(0,e.useCallback)((function(){n.openLayer("HandoffHelp",(0,c3.jsx)(o4,{}),{direction:"center"})}),[n]);return(0,c3.jsxs)("div",{children:[(0,c3.jsxs)("div",{className:i4.cols,children:[(0,c3.jsx)("div",{className:i4.col1,style:{"--flex":"1"},children:(0,c3.jsx)("h3",{children:"Verify on your phone for best results"})}),(0,c3.jsx)("div",{className:i4.col2,style:{"--flex":"0"},children:(0,c3.jsx)(p3,{appearance:"icon",onClick:r,pressable:!0,title:"Close",children:(0,c3.jsx)(O3,{})})})]}),(0,c3.jsxs)("div",{className:i4.cols,children:[(0,c3.jsx)("div",{className:i4.col1,style:{"--flex":"0.6","--valign":"center"},children:(0,c3.jsx)(a4,{})}),(0,c3.jsx)("div",{className:i4.col2,style:{"--flex":"0.4","--valign":"center"},children:(0,c3.jsx)("p",{children:"Scan this QR code with your phone or click to copy it"})})]}),(0,c3.jsx)("div",{className:i4.footer,children:(0,c3.jsx)(p3,{appearance:"link",onClick:a,children:"Need help with scanning the QRCode?"})})]})}var u4={suggestions:"CameraHelp_suggestions__UoBJv"};function c4(t){var n=s3(),r=n.AppController,a=n.appState,i=_3(),o=a.detection,s=a.location,u=(0,e.useCallback)((function(){r.closeLayer("CameraHelp"),r.openLayer("Handoff",(0,c3.jsx)(s4,{}))}),[r]),c=a2(o.documentImages),l=(0,e.useCallback)((function(e){e instanceof ImageData&&r.collectDetectionImage(o.type,c,e)}),[r,o,c]),p=(0,e.useCallback)((function(){r.closeLayer("CameraHelp")}),[r]),d=null;if("documents"===s.path){var f="Upload the ".concat(c," of the document");d=(0,c3.jsx)(p3,{onClick:l,feature:"file",children:f})}return(0,c3.jsxs)("div",{className:u4.CameraHelp,children:[(0,c3.jsx)("h3",{children:"Having trouble?"}),(0,c3.jsxs)("ul",{className:u4.suggestions,ref:i,children:[(0,c3.jsxs)("li",{children:[(0,c3.jsx)("h4",{children:"Make sure you are in good light"}),(0,c3.jsx)("p",{children:"We can only get a good capture in good light. Try turning on your lights!"})]}),(0,c3.jsxs)("li",{children:[(0,c3.jsx)("h4",{children:"Check the distance"}),"Hold your phone at the right distance from the document."]}),(0,c3.jsxs)("li",{children:[(0,c3.jsx)("h4",{children:"Clean the camera lens"}),"If your phone's camera lens is dirty, it may be difficult to scan the document."]}),(0,c3.jsxs)("li",{children:[(0,c3.jsx)("h4",{children:"Switch to a mobile device"}),(0,c3.jsx)("p",{children:"We know that mobile cameras perform much better than webcams. Try with mobile"})]}),(0,c3.jsxs)("li",{children:[(0,c3.jsx)("h4",{children:"Ensure all text is visible and in-frame."}),(0,c3.jsx)("p",{children:"Sometimes its easy to hold a thumb over part of the barcode, which causes failures."})]})]}),(0,c3.jsx)(p3,{theme:"primary",onClick:p,children:"Continue"}),(0,c3.jsx)(p3,{onClick:u,children:"Continue on another mobile"}),d]})}var l4={subHeading:"CameraContent_subHeading__XwTYu",subFooter:"CameraContent_subFooter__Qz6KO",Caption:"CameraContent_Caption__dRH8S","slide-up":"CameraContent_slide-up__emwO2",content:"CameraContent_content__tDpUr","fade-in":"CameraContent_fade-in__9CcEu",needHelp:"CameraContent_needHelp__H8Jn7",ManualCaptureControl:"CameraContent_ManualCaptureControl__2j2TP",ShutterButton:"CameraContent_ShutterButton__NI4j0",shutterIcon:"CameraContent_shutterIcon__+PmVh","pop-in":"CameraContent_pop-in__LpNNu"},p4={FaceGuide:"FaceGuide_FaceGuide__eYtgr",face:"FaceGuide_face__w2k4P","face-left":"FaceGuide_face-left__ZL-hQ","face-right":"FaceGuide_face-right__U-Xt-","face-down":"FaceGuide_face-down__mBZdE","face-up":"FaceGuide_face-up__cyoDW",nose:"FaceGuide_nose__EHTX5",eye:"FaceGuide_eye__H1vmS",eye1:"FaceGuide_eye1__R4R3L",eye2:"FaceGuide_eye2__+wjYR"};function d4(){var e=s3().appState,t=e.camera,n=e.detection,r=n.count,a=n.record;if("face"!==n.type||!t.active)return null;var i=n.side;(r<1||"countdown"===(null===a||void 0===a?void 0:a.result.type))&&(i="front");for(var o=[],s=0;s<10;s++)o.push((0,c3.jsx)("div",{className:"".concat(p4.nose," ").concat(p4["nose".concat(s)]),style:{transform:"perspective(".concat(80+s,"px) ")+"translateZ(".concat(s+5,"px) ")+"scale(".concat(1-.1*s,")")}},"node-".concat(s)));return(0,c3.jsx)("div",{className:p4.FaceGuide,children:(0,c3.jsxs)("div",{className:p4.face,"data-side":i,children:[(0,c3.jsx)("div",{className:"".concat(p4.eye," ").concat(p4.eye1)}),(0,c3.jsx)("div",{className:"".concat(p4.eye," ").concat(p4.eye2)}),o]})})}function f4(t){var n=s3().AppController,r=(0,e.useCallback)((function(){n.openLayer("CameraHelp",(0,c3.jsx)(c4,{}))}),[n]);return(0,c3.jsx)("div",{className:l4.needHelp,children:(0,c3.jsx)(p3,{appearance:"link",onClick:r,children:"Need help?"})})}function h4(){var t=s3(),n=t.appState,r=t.AppController,a=n.camera,i=n.detection,o=a.manual,s=(0,e.useCallback)((function(){r.setCameraManual(!o)}),[r,o]);return"document"===i.type&&a.active?(0,c3.jsx)(p3,{appearance:"none",onClick:s,className:l4.ManualCaptureControl,title:o?"Switch to auto capture":"Switch to manual capture",children:(0,c3.jsx)(r4,{theme:o?"dark-grey":"light-grey",children:o?"Auto Capture OFF":"Auto Capture ON"})}):null}function m4(){var t=s3(),n=t.AppController,r=t.appState,a=r.detection,i=r.camera,o=(0,e.useCallback)(y(f().mark((function e(){var t,a,i,o;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.getCameraImage();case 2:(t=e.sent)&&(a=r.detection,i=a.type,o=a.side,n.collectDetectionImage(i,o,t));case 4:case"end":return e.stop()}}),e)}))),[n,r]);return"document"===a.type&&i.active&&i.manual?(0,c3.jsx)(p3,{className:l4.ShutterButton,appearance:"none",pressable:!0,onClick:o,children:(0,c3.jsx)("div",{className:l4.shutterIcon})}):null}function v4(){var e=s3().appState.detection,t=e.side,n=e.type,r=e.count,a=e.record,i="";if("document"===n)switch(t){case"front":i="Captrue the front side of the document";break;case"back":i="Captrue the back side of the document"}else if("face"===n)if("countdown"===(null===a||void 0===a?void 0:a.result.type)&&r<=3){var o=(null===a||void 0===a?void 0:a.result.countdown)||3;i="Counting down ".concat(o)}else if(r<1)i="Face the camera";else switch(t){case"left":i="Look left";break;case"right":i="Look right";break;case"up":i="Look up";break;case"down":i="Look down";break;case"center":i="Look ahead"}return(0,c3.jsx)("div",{className:l4.Caption,"data-hidden":!i,children:i||"unknown(".concat(t,")")},"msg-".concat(String(t)))}function g4(){var t=(0,e.useRef)(0),n=s3().appState.detection,r=n.faceImages,a=n.documentImages;(0,e.useEffect)((function(){var e=r.collectedSides.length+a.collectedSides.length;1===e-t.current&&function(){var e=document.documentElement;e&&(e.setAttribute("data-shutter-flash-on","true"),setTimeout((function(){e.removeAttribute("data-shutter-flash-on")}),64))}(),t.current=e}),[r,a])}function y4(t){var n=s3().appState,r=(0,e.useRef)(null),a=function(t){var n=o((0,e.useState)([0,0]),2),r=n[0],a=n[1];return(0,e.useEffect)((function(){var e=b((function(){var e=t.current;if(e){var n=e.offsetWidth,r=e.offsetHeight;a([n,r])}}),0);return window.addEventListener("resize",e,!0),window.addEventListener("orientationchange",e,!0),e(),function(){window.removeEventListener("resize",e,!0),window.removeEventListener("orientationchange",e,!0)}}),[t]),r}(r),i=n.detection,s=a[0];g4();var u={opacity:s?1:0};return(0,c3.jsx)("div",{className:"".concat(k3.w100p," ").concat(k3.h100p," ").concat(k3.borderBox," ").concat(k3.p10," ").concat(k3.transOpacity),ref:r,style:u,children:(0,c3.jsxs)("div",{className:"".concat(k3.flexCol," ").concat(k3.center," ").concat(k3.h100p),children:[(0,c3.jsx)("div",{className:l4.subHeading,children:(0,c3.jsx)(v4,{})}),(0,c3.jsx)(J3,{width:s,height:s,shimmering:i.active&&n.camera.active,frameShape:"face"===i.type?"oval":"rect",children:(0,c3.jsxs)(c3.Fragment,{children:[(0,c3.jsx)(h4,{}),(0,c3.jsx)(m4,{}),(0,c3.jsx)(d4,{})]})},n.location.path),(0,c3.jsx)("div",{className:l4.subFooter,children:(0,c3.jsx)(f4,{})})]})})}function b4(e){return(0,c3.jsx)(H3,{bodyPadding:"2rem 1rem",children:(0,c3.jsx)(y4,{})})}function x4(e){return(0,c3.jsx)(H3,{bodyPadding:"2rem 1rem",children:(0,c3.jsx)(y4,{})})}function k4(){var t=s3().AppController,n=(0,e.useCallback)((function(){t.setStarted()}),[t]),r=(0,c3.jsx)("div",{className:"".concat(k3.w100p," ").concat(k3.px10," ").concat(k3.borderBox),children:(0,c3.jsx)(p3,{theme:"primary",onClick:n,children:"Getting started"})});return(0,c3.jsx)(H3,{afterBody:r,children:(0,c3.jsxs)("div",{children:[(0,c3.jsx)("h1",{children:"Hello!"}),(0,c3.jsx)("p",{children:"Thank you for choosing our demo app for capturing document and selfie images!"}),(0,c3.jsx)("p",{children:"Our app uses open-sourced ML models to capture anything that looks like a book, person, or photo frame. You don't need to use real ID documents to test the app."}),(0,c3.jsx)("p",{children:"Rest assured that our app does not have any real backend and it does not store any data locally or send any data remotely. The application data will be cleared after reloading or closing the app."}),(0,c3.jsx)("p",{children:"When you're ready, simply press the button below to get started."})]})})}var w4={SuccessPage:"SuccessPage_SuccessPage__+PYCL"};function S4(e){return(0,c3.jsxs)("div",{className:w4.SuccessPage,children:[(0,c3.jsx)(M3,{animation:"pops-in"}),(0,c3.jsx)("br",{}),(0,c3.jsx)("h2",{children:"Upload sucessful"}),(0,c3.jsx)("p",{children:"Nice work!, you had successfully submitted the dcouments and sellies needed."})]})}function I4(e){var t=e.appState.location.path;switch(t){case"intro":return(0,c3.jsx)(k4,{});case"consent":return(0,c3.jsx)(K3,{});case"documents":return(0,c3.jsx)(b4,{});case"selfies":return(0,c3.jsx)(x4,{});case"success":return(0,c3.jsx)(S4,{});default:return(0,c3.jsxs)("div",{children:["Not Found : ",String(t)]})}}function _4(){var t=function(){var t=o((0,e.useState)((function(){return{AppController:i3,appState:i3.state}})),2),n=t[0],r=t[1];return(0,e.useEffect)((function(){return i3.addCallback((function(e){r({AppController:e,appState:e.state})}))}),[r]),n}(),n=t.appState,r=n.frameSize,a=n.deviceType,i=n.darkMode,s={width:"".concat(r[0],"px"),height:"".concat(r[1],"px")};return(0,e.useEffect)((function(){var e=document.documentElement;e&&(e.setAttribute("data-device-type",a),e.setAttribute("data-dark-mode",String(i)))}),[a,i]),(0,c3.jsx)(o3.Provider,{value:t,children:(0,c3.jsx)("div",{className:F3.appFrame,style:s,children:(0,c3.jsx)(R3,{children:I4(t)})})})}function N4(){return(0,c3.jsx)("div",{className:r.App,children:(0,c3.jsx)(_4,{})})}window.addEventListener("load",(function(){setInterval((function(){window.scrollTo(0,100)}),100)})),t.createRoot(document.getElementById("root")).render((0,c3.jsx)(N4,{}))}()}();
//# sourceMappingURL=main.3d484234.js.map

</script>

<style>

body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;margin:0}code{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}:root{font-family:apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;font-size:16px}@media (max-height:400px){:root{font-size:10px}}@media (max-width:300px){:root{font-size:10px}}body,html{-webkit-tap-highlight-color:rgba(0,0,0,0);background-size:100vw 200vh;background:transparent;display:flex;flex:1 1;flex-direction:column;height:100%;overflow:hidden;overscroll-behavior:none;touch-action:manipulation}html{-webkit-animation:App_gradient__-SnfK 15s ease infinite;animation:App_gradient__-SnfK 15s ease infinite;background:linear-gradient(red,transparent),linear-gradient(to top left,lime,transparent),linear-gradient(to top right,blue,transparent);background-attachment:fixed;background-blend-mode:screen;background-size:400% 400%;height:100%}@-webkit-keyframes App_gradient__-SnfK{0%{background-position:0 50%}50%{background-position:100% 50%}to{background-position:0 50%}}@keyframes App_gradient__-SnfK{0%{background-position:0 50%}50%{background-position:100% 50%}to{background-position:0 50%}}body{align-items:center;display:flex;justify-content:center}h1,h2,h3,h4,h5,h6,ol,p,ul{all:unset;display:block}a,button{all:unset;display:inline-block}h1,h2,h3,h4,h5,h6{font-weight:700;margin:0 0 1rem}h1,h2,h3{font-size:1rem}h4,h5{font-size:.85rem;margin-bottom:.5rem}hr{all:unset;box-shadow:0 0 0 .5px rgba(0,0,0,.1);display:block;height:0;margin:0 .5rem 1rem}p{color:#444;font-size:.85rem;margin:0 0 1rem}li{margin:0 2rem .5rem}.App_App__XVtYz{display:flex;font-size:.765rem;height:100%;margin:0;overflow:hidden;place-items:center;position:relative;-webkit-user-select:none;user-select:none;width:100vw}@media (max-width:700px){html{-webkit-animation:none;animation:none;background:#fff}}html[data-device-type=mobile]{-webkit-animation:none;animation:none;background:#fff}.Layer_Layer__JQMs4{box-sizing:border-box;overflow:hidden;pointer-events:none;position:absolute;-webkit-transform:translateZ(0);transform:translateZ(0);-webkit-transform-origin:50%;transform-origin:50%;transition-delay:.1s;transition-duration:.25s;transition-property:-webkit-transform;transition-property:transform;transition-property:transform,-webkit-transform;transition-timing-function:ease-in-out;z-index:2}.Layer_Layer__JQMs4[data-active=true]{pointer-events:auto}.Layer_Layer__JQMs4[data-behind=true][data-active=true] .Layer_layerContent__7phdk{-webkit-filter:blur(2px);filter:blur(2px);pointer-events:none}.Layer_Layer__JQMs4[data-appreance=card]{background:#fff}.Layer_Layer__JQMs4[data-appreance=card][data-direction=center]{background:#fff;box-shadow:0 2px 8px -2px rgba(0,0,0,.6),inset 0 0 0 1.5px #99999a;box-sizing:border-box;left:50%;padding:1rem;top:50%}.Layer_Layer__JQMs4[data-direction=rtl]{bottom:0;left:100%;max-width:100vw;overflow:auto;right:auto;top:0}.Layer_Layer__JQMs4[data-appreance=card][data-direction=rtl]{background:#fff;box-shadow:-2px 0 2px rgba(0,0,0,.2);box-sizing:border-box;padding:1rem}.Layer_Layer__JQMs4[data-appreance=card][data-direction=btt]{border-top-left-radius:8px;border-top-right-radius:8px;box-shadow:0 10px 5px 5px rgba(0,0,0,.5);box-sizing:border-box;left:2.5%;margin:auto;padding:1rem;width:95%}.Layer_Layer__JQMs4[data-appreance=card][data-direction=center]{border-radius:8px;width:80%}.Layer_Layer__JQMs4[data-active=false]{box-shadow:none}.Layer_Layer__JQMs4[data-at-top=false]{pointer-events:none}.Layer_children__H2ywW,.Layer_layersRoot__YxkQd{height:100%;position:relative;width:100%}.Layer_children__H2ywW{overflow:auto;z-index:1}.Layer_backdrop__qu2ZM{background-color:rgba(0,0,0,.75);border-radius:8px;bottom:0;content:"";left:0;opacity:0;pointer-events:none;position:absolute;right:0;top:0;transition-delay:0ms;transition-duration:.35s;transition-property:opacity;transition-timing-function:ease-in;z-index:2}.Layer_backdrop__qu2ZM[data-backdrop=true]{opacity:1;pointer-events:all}.Layer_Layer__JQMs4[data-direction=rtl] .Layer_layerContent__7phdk{height:100%;max-height:100vh;max-width:100vw;overflow:auto;width:100%}.Layer_Layer__JQMs4[data-appreance=card][data-direction=btt] .Layer_layerContent__7phdk{height:100%;max-height:calc(90vh - 4rem);max-width:100vw;overflow:auto;width:100%}html[data-device-type=mobile] .Layer_backdrop__qu2ZM{border-color:transparent;border-radius:0;box-shadow:none}.Button_Button__DRD9X{all:unset;position:relative;-webkit-transform-origin:center;transform-origin:center;transition-duration:.1s;transition-property:-webkit-transform;transition-property:transform;transition-property:transform,-webkit-transform;transition-timing-function:ease-in-out}.Button_Button__DRD9X[data-feature=file]{overflow:hidden}.Button_Button__DRD9X[data-pressable=true]{cursor:pointer}.Button_Button__DRD9X[data-pressable=true]:active{-webkit-transform:scale(.98);transform:scale(.98)}.Button_fileInput__qCmed{all:unset;background-color:red;cursor:pointer;height:100%;left:0;opacity:0;padding:0;position:absolute;top:0;width:100%;z-index:99999}.Button_Button__DRD9X[data-appearance=link]{color:#007aff;cursor:pointer;display:inline-block;font-size:.8rem}.Button_Button__DRD9X[data-appearance=link]:hover{text-decoration:underline}.Button_Button__DRD9X[data-appearance=icon]{border-radius:.5rem;font-size:1rem;height:24px;line-height:100%}.Button_Button__DRD9X[data-appearance=icon]:hover{box-shadow:inset 0 0 0 2px hsla(0,0%,85%,.6)}.Button_Button__DRD9X[data-appearance=icon]:active{box-shadow:inset 0 0 0 2px hsla(0,0%,78%,.6);-webkit-transform:translateY(1px);transform:translateY(1px)}.Button_Button__DRD9X[data-appearance=button]{background-image:linear-gradient(180deg,#fff,#f0f0f0);border:1px solid #ccc;border-radius:.5rem;box-sizing:border-box;color:#222;cursor:pointer;display:block;font-size:1rem;font-weight:600;margin:.8rem 0;padding:.8rem;text-align:center;text-shadow:0 1px 2px hsla(0,0%,100%,.3);-webkit-user-select:none;user-select:none;width:100%}.Button_Button__DRD9X[data-appearance=button][data-theme=primary]{background-image:linear-gradient(180deg,#007aff,#005eff);color:#fff;text-shadow:0 1px 2px rgba(0,0,0,.3)}.Button_Button__DRD9X[data-appearance=button]:hover{background-image:linear-gradient(0deg,#fff,#f0f0f0)}.Button_Button__DRD9X[data-appearance=button][data-theme=primary]:hover{background-image:linear-gradient(180deg,#005eff,#007aff)}.Button_Button__DRD9X[data-appearance=button]:focus{box-shadow:0 0 0 2px hsla(0,0%,85%,.6);outline:none}.Button_Button__DRD9X[data-appearance=button][data-theme=primary]:focus{box-shadow:0 0 0 2px rgba(0,122,255,.6)}.Button_Button__DRD9X[data-appearance=button]:active{box-shadow:none;-webkit-transform:scale(.98);transform:scale(.98)}.Button_Button__DRD9X[data-appearance=button][data-theme=primary]:active{background-image:linear-gradient(0deg,#007aff,#005eff)}.Picture_Picture__szzuy{aspect-ratio:4/3;background-color:#ccc;background-position:50%;background-repeat:no-repeat;background-size:contain;border-radius:8px;margin:auto;opacity:0;overflow:hidden;transition-delay:0ms;transition-duration:.15s;transition-property:opacity;transition-timing-function:ease-in;width:100%}html[data-dark-mode=true] .Picture_Picture__szzuy{-webkit-filter:invert();filter:invert()}.DocumentUploadReview_PreviewPicture__i9o6z{position:relative;z-index:0}.DocumentUploadReview_closePreview__SP\+8r{position:absolute;right:-.8rem;top:-.8rem;z-index:100000}.DocumentUploadReview_row__Sj3GL{display:flex;flex-direction:row;margin:auto}.DocumentUploadReview_col__dcNEJ{align-items:center;display:flex;flex:1 1;flex-direction:column;line-height:2rem;margin:0;min-height:100px;padding:0 .5rem}.CloseButton_CloseButton__EOBWj{background-color:hsla(0,0%,100%,.8);border-radius:100%;cursor:pointer;height:24px;overflow:hidden;transition-duration:.1s;transition-property:box-shadow;transition-timing-function:ease-in-out;-webkit-user-select:none;user-select:none;width:24px}.CloseButton_CloseButton__EOBWj:hover{box-shadow:0 0 0 3px rgba(130,166,244,.8)}.CloseButton_CloseButton__EOBWj:active{box-shadow:0 0 0 8px rgba(130,166,244,.8)}.ConfirmDocumentImage_heading__IG4lI{font-size:1rem;font-weight:600;margin:0 0 1rem}.FaceUploadReview_selfies__KfHdT{aspect-ratio:1;margin:auto;overflow:hidden;position:relative;width:80%}.FaceUploadReview_selfie__UQIky{-webkit-animation:FaceUploadReview_cross-fade__Qso2t 4s ease-in-out infinite;animation:FaceUploadReview_cross-fade__Qso2t 4s ease-in-out infinite;-webkit-animation-direction:alternate;animation-direction:alternate;display:flex;height:100%;left:0;overflow:hidden;position:absolute;top:0;transition:opacity 1s ease-in-out;width:100%}.FaceUploadReview_selfie__UQIky[data-index="3"]{-webkit-animation-delay:0;animation-delay:0}.FaceUploadReview_selfie__UQIky[data-index="2"]{-webkit-animation-delay:1s;animation-delay:1s}.FaceUploadReview_selfie__UQIky[data-index="1"]{-webkit-animation-delay:2s;animation-delay:2s}.FaceUploadReview_selfie__UQIky[data-index="0"]{-webkit-animation-delay:3s;animation-delay:3s}@-webkit-keyframes FaceUploadReview_cross-fade__Qso2t{0%{opacity:1}25%{opacity:0}75%{opacity:0}to{opacity:1}}@keyframes FaceUploadReview_cross-fade__Qso2t{0%{opacity:1}25%{opacity:0}75%{opacity:0}to{opacity:1}}.Atom_debug__pUnPV{align-items:center;background-color:red;flex-direction:column;justify-content:center}.Atom_overflowAuto__VAWF3{overflow:auto}.Atom_transOpacity__IHqyV{transition-duration:.35s;transition-property:opacity;transition-timing-function:ease-in-out}.Atom_center__4HNdF{align-items:center;justify-content:center}.Atom_radius5__xFhgl{border-radius:.5rem}.Atom_borderBox__AwnJL{box-sizing:border-box}.Atom_grid__JMuZD{display:block;place-content:center}.Atom_flexRow__X1LyY{display:flex;flex-direction:row}.Atom_flexCol__LLBuJ{display:flex;flex-direction:column}.Atom_flex1__hfcTQ{flex:1 1}.Atom_block__idkTD{display:block}.Atom_flexCol1__8RDlZ{display:flex;flex:1 1;flex-direction:column}.Atom_h100p__4XNqn{height:100%}.Atom_w100p__vJRU5{width:100%}.Atom_p0__WRYn2{padding:0}.Atom_p1__G2Hrl{padding:.1rem}.Atom_p2__BXSNK{padding:.2rem}.Atom_p4__gv\+6h{padding:.4rem}.Atom_p6__ccqO6{padding:.6rem}.Atom_p8__X2i6I{padding:.8rem}.Atom_p10__5paj3{padding:1rem}.Atom_px10__E6nbI{padding-left:1rem;padding-right:1rem}.Atom_py10__d-W3A{padding-bottom:1rem;padding-top:1rem}.Atom_m8__F9a7y{margin:.8rem}.Atom_m10__iRymV{margin:1rem}.Atom_maxH25vh__mrQWi{max-height:25vh}.ScrollableIndicator_ScrollableIndicator__hC0Zq{transition:box-shadow .5s ease-in-out}.ScrollableIndicator_ScrollableIndicator__hC0Zq[data-can-scroll-down=true]{box-shadow:inset 0 -20px 20px -20px rgba(0,0,0,.25)}.ScrollableIndicator_ScrollableIndicator__hC0Zq[data-can-scroll-up=true]{box-shadow:inset 0 20px 20px -20px rgba(0,0,0,.25)}.ScrollableIndicator_ScrollableIndicator__hC0Zq[data-can-scroll-down=true][data-can-scroll-up=true]{box-shadow:inset 0 -20px 20px -20px rgba(0,0,0,.25),inset 0 20px 20px -20px rgba(0,0,0,.25)}.AppFrame_appFrame__SzMtg{background-color:#fff;border:1px solid #f0f0f0;border-radius:10px;box-shadow:0 2px 5px -1px rgba(50,50,93,.25),0 1px 3px -1px rgba(0,0,0,.3);display:inline-block;height:100%;margin:auto;overflow:hidden;position:relative;transition-duration:.1s;transition-property:width,height;transition-timing-function:ease-in-out;width:100%}@media (max-width:700px){.AppFrame_appFrame__SzMtg{border-color:transparent;border-radius:0;box-shadow:none}}html[data-device-type=mobile] .AppFrame_appFrame__SzMtg{border-radius:0;box-shadow:none}html[data-dark-mode=true] .AppFrame_appFrame__SzMtg{-webkit-filter:invert();filter:invert()}.Icon_Icon__jzEdF{align-items:center;display:inline-block;display:inline-flex;height:24px;justify-content:center;width:24px}.Icon_Icon__jzEdF svg{height:100%;width:100%}.Icon_Icon__jzEdF[data-animation=pops-in]{-webkit-animation:Icon_pops-in__dP4Wf .3s ease-in-out 1;animation:Icon_pops-in__dP4Wf .3s ease-in-out 1;-webkit-animation-delay:.25s;animation-delay:.25s}@-webkit-keyframes Icon_pops-in__dP4Wf{0%{-webkit-transform:scale(.8);transform:scale(.8)}50%{-webkit-transform:scale(2);transform:scale(2)}to{-webkit-transform:scale(1);transform:scale(1)}}@keyframes Icon_pops-in__dP4Wf{0%{-webkit-transform:scale(.8);transform:scale(.8)}50%{-webkit-transform:scale(2);transform:scale(2)}to{-webkit-transform:scale(1);transform:scale(1)}}.PageFooter_PageFooter__4qNyd{color:#aaa;display:flex;flex-direction:row;padding:1rem}.PageFooter_privacy__wDmU5,.PageFooter_provider__nPgQM,.PageFooter_tos__vIkDW{margin:0 .4rem}.PageSideMenu_PageSideMenu__QLeu1{background-color:rgba(0,0,0,.2);box-sizing:border-box;height:100%;min-width:200px;padding-top:1rem}.PageSideMenu_PageSideMenu__QLeu1:after{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);bottom:0;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0;z-index:-1}.PageSideMenu_PageSideMenu__QLeu1 ul{margin-bottom:1rem;margin-top:1rem}.PageSideMenu_PageSideMenu__QLeu1 h4{color:#fff;padding:0 1rem}.PageSideMenu_PageSideMenu__QLeu1 li{display:block;margin:0}.PageSideMenu_PageSideMenu__QLeu1 li button{background-color:hsla(0,0%,100%,.2);box-shadow:inset 0 1px 0 .5px hsla(0,0%,100%,.2);box-sizing:border-box;color:#fff;display:block;padding:1rem;width:100%}.PageSideMenu_PageSideMenu__QLeu1 li button:hover{background-color:hsla(0,0%,100%,.4)}.PageSideMenu_closeButton__10NMe{position:absolute;right:.8rem;top:.8rem}.PageSideMenu_close__l2GRp:active{box-shadow:0 0 0 10px rgba(84,113,141,.4)!important}.TopPageNavBar_TopPageNavBar__ekr0b{all:unset;border-bottom:1px solid #dedede;flex:1 1;line-height:150%;margin:0 20px;padding:.6rem}.TopPageNavBar_row__SpOyy{display:flex;flex-direction:row}.TopPageNavBar_brandName__YXj2I{font-weight:600;text-align:center}.TopPageNavBar_breadCrumbs__OYSMT{all:unset;align-items:center;display:flex;flex:1 1;flex-direction:row;justify-content:center}.TopPageNavBar_breadCrumb__ADbzF{all:unset;color:#666;cursor:pointer;display:inline-block;font-weight:600;position:relative;vertical-align:middle}.TopPageNavBar_breadCrumb__ADbzF>button:before{background-color:#3e3e3e;bottom:0;content:"";height:.15rem;left:1px;position:absolute;right:1px;-webkit-transform:scaleX(0);transform:scaleX(0)}.TopPageNavBar_breadCrumb__ADbzF button{padding:.2rem}.TopPageNavBar_breadCrumb__ADbzF[data-animated=true]>button:before{-webkit-animation:TopPageNavBar_reveal-in__oLRwG .15s ease-in;animation:TopPageNavBar_reveal-in__oLRwG .15s ease-in;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;-webkit-animation-iteration-count:1;animation-iteration-count:1}.TopPageNavBar_breadCrumb__ADbzF[data-disabled=true]{cursor:inherit}.TopPageNavBar_breadCrumb__ADbzF[data-disabled=true] button{color:#ccc}.TopPageNavBar_breadCrumb__ADbzF[data-done=true] button{color:#20b86a}.TopPageNavBar_breadCrumb__ADbzF[data-active=true] button{color:#000}.TopPageNavBar_breadCrumb__ADbzF:after{color:#666;content:"\2192";display:inline-block;font-weight:600;line-height:100%;margin:-.05rem .25rem 0;vertical-align:middle}@media (max-width:333px){.TopPageNavBar_breadCrumb__ADbzF:after{content:" "}}.TopPageNavBar_breadCrumb__ADbzF:last-of-type:after{display:none}.TopPageNavBar_sideMenuButton__dfS9j{align-items:center;border-radius:100%;box-sizing:border-box;display:flex;font-size:1rem;font-weight:700;height:24px;justify-content:center;padding:0 .2rem;transition-duration:.1s;transition-property:box-shadow;transition-timing-function:ease-in-out;width:24px}.TopPageNavBar_sideMenuButton__dfS9j:active{box-shadow:0 0 0 10px rgba(84,113,141,.4)}@-webkit-keyframes TopPageNavBar_reveal-in__oLRwG{0%{-webkit-transform:scaleX(0);transform:scaleX(0)}to{-webkit-transform:scaleX(1);transform:scaleX(1)}}@keyframes TopPageNavBar_reveal-in__oLRwG{0%{-webkit-transform:scaleX(0);transform:scaleX(0)}to{-webkit-transform:scaleX(1);transform:scaleX(1)}}.Page_Page__j6GS3{align-items:center;display:flex;flex-direction:column;height:100%;justify-content:center;width:100%}.Page_header__K\+EXL{display:flex;flex-direction:row;width:100%}.Page_body__EHjpW{box-sizing:border-box;height:100%;overflow:auto;padding:2rem;position:relative;width:100%}.Page_footer__s\+nDt{display:flex}@-webkit-keyframes Page_fade-in__UPhJt{0%{opacity:0}to{opacity:1}}@keyframes Page_fade-in__UPhJt{0%{opacity:0}to{opacity:1}}@-webkit-keyframes Page_slide-up__kn8yS{0%{-webkit-transform:translate3d(0,3rem,0);transform:translate3d(0,3rem,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes Page_slide-up__kn8yS{0%{-webkit-transform:translate3d(0,3rem,0);transform:translate3d(0,3rem,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@-webkit-keyframes Page_pop-in__pNF6B{0%{-webkit-transform:scale(.9);transform:scale(.9)}50%{-webkit-transform:scale(1.05);transform:scale(1.05)}to{-webkit-transform:scale(1);transform:scale(1)}}@keyframes Page_pop-in__pNF6B{0%{-webkit-transform:scale(.9);transform:scale(.9)}50%{-webkit-transform:scale(1.05);transform:scale(1.05)}to{-webkit-transform:scale(1);transform:scale(1)}}.Camera_Camera__HZGy3{background-color:#fff;border-radius:40px;-webkit-clip-path:inset(0 0 0 0 round 40px);clip-path:inset(0 0 0 0 round 40px);overflow:hidden;position:relative}html[data-dark-mode=true] .Camera_video__a6f\+4{-webkit-filter:invert();filter:invert()}.Camera_Camera__HZGy3[data-frame-shape=oval] .Camera_shadowFrame__F97OJ{border-radius:100%;box-shadow:0 0 0 10000px rgba(0,0,0,.5);-webkit-transform:scaleX(.6) scaleY(.8);transform:scaleX(.6) scaleY(.8)}.Camera_animFrame__rR3eP{border-radius:40px;bottom:0;left:0;position:absolute;right:0;top:0;z-index:1000}.Camera_animFrame__rR3eP[data-active]{-webkit-animation:Camera_anim-frame__yBXSh 1s linear infinite;animation:Camera_anim-frame__yBXSh 1s linear infinite;box-shadow:inset 0 0 0 10px rgba(73,193,40,.9)}.Camera_shadowFrame__F97OJ{border:8px solid rgba(0,0,0,.5);border-radius:40px;bottom:0;box-shadow:inset 0 0 0 3px hsla(0,0%,100%,.5);left:0;position:absolute;right:0;top:0;z-index:1000}@-webkit-keyframes Camera_anim-frame__yBXSh{0%{opacity:0}50%{opacity:1}to{opacity:0}}@keyframes Camera_anim-frame__yBXSh{0%{opacity:0}50%{opacity:1}to{opacity:0}}.Camera_videoContainer__9gKCl{display:contents}.Camera_video__a6f\+4{aspect-ratio:1;background-color:#111;height:100%;object-fit:cover;object-position:center;position:absolute;width:100%;z-index:0}.Camera_video__a6f\+4[data-mirrored=true]{-webkit-transform:rotateY(180deg);transform:rotateY(180deg)}.Camera_debugPanel__Cgp\+e{background-color:hsla(0,0%,100%,.4);left:20px;position:absolute;top:20px;z-index:10000}html[data-shutter-flash-on=true] body{opacity:.5}.QRCode_QRCode__\+AV0f{aspect-ratio:1;background-color:red;display:block;font-size:0;line-height:0;min-height:50px;overflow:hidden;position:relative;width:100%}.QRCode_QRCode__\+AV0f canvas{height:100%;position:relative;width:100%;z-index:1}.QRCode_copy__4FwhX{all:unset;background-color:initial;bottom:0;cursor:pointer;left:0;overflow:hidden;position:absolute;right:0;top:0;z-index:2}.QRCode_copy__4FwhX:hover{background-color:hsla(0,0%,100%,.4)}.QRCode_copy__4FwhX:active{background-color:rgba(0,0,0,.1)}.QRCode_copiedLabel__-i5CB{-webkit-animation-delay:.1s;animation-delay:.1s;-webkit-animation-direction:alternate;animation-direction:alternate;-webkit-animation-duration:.55s;animation-duration:.55s;-webkit-animation-iteration-count:1;animation-iteration-count:1;-webkit-animation-name:QRCode_pop-in__4PwLJ;animation-name:QRCode_pop-in__4PwLJ;bottom:0;color:#000;display:grid;font-size:1rem;left:0;padding:1rem;place-content:center;position:absolute;right:0;top:0;-webkit-transform:scale(0);transform:scale(0);z-index:3}@-webkit-keyframes QRCode_pop-in__4PwLJ{0%{-webkit-transform:scale(.6);transform:scale(.6)}50%{-webkit-transform:scale(2);transform:scale(2)}to{-webkit-transform:scale(0);transform:scale(0)}}@keyframes QRCode_pop-in__4PwLJ{0%{-webkit-transform:scale(.6);transform:scale(.6)}50%{-webkit-transform:scale(2);transform:scale(2)}to{-webkit-transform:scale(0);transform:scale(0)}}.Pill_Pill__ESV8L{background-color:red;border:1px solid #ccc;border-radius:.6rem;box-shadow:0 0 2px 2px rgba(0,0,0,.2);color:#fff;display:block;display:inline-block;font-size:.6rem;line-height:100%;margin:3px;padding:.5rem .8rem;transition-duration:.1s;transition-property:background-color;transition-timing-function:ease-in}.Pill_Pill__ESV8L[data-theme=dark-grey]{background-color:rgba(36,35,97,.5)}.Pill_Pill__ESV8L[data-theme=light-grey]{background-color:hsla(0,0%,57%,.5)}.Pill_Pill__ESV8L[data-theme=white]{background-color:#fff;color:#333}.Handoff_cols__YbvRF{display:flex;flex-direction:row;min-height:50px}.Handoff_col1__FFuS8{padding:0 .5rem 0 0}.Handoff_col1__FFuS8,.Handoff_col2__7hikc{align-items:"start";align-items:var(--valign,"start");display:flex;flex:1;flex:var(--flex,1)}.Handoff_col2__7hikc{padding:0 0 0 .5rem}.Handoff_footer__uEJFz{margin:1rem 0}.CameraHelp_suggestions__UoBJv{border-radius:1rem;max-height:40vh;overflow:auto;position:relative;transition-property:box-shadow}.CameraContent_subHeading__XwTYu{box-sizing:border-box;color:#666;font-weight:600;margin:0 auto;text-align:center;width:80%}.CameraContent_subFooter__Qz6KO{text-align:left;width:100%}.CameraContent_Caption__dRH8S{background-color:#fff;border:solid #ccc;border-radius:1rem;border-bottom-left-radius:0;border-bottom-right-radius:0;border-width:1px 1px .5px;color:#666;display:block;display:inline-block;padding:.4rem 1rem}.CameraContent_Caption__dRH8S[data-hidden=true]{visibility:hidden}.CameraContent_Caption__dRH8S[data-hidden=false]{-webkit-animation:CameraContent_slide-up__emwO2 .45s ease-in;animation:CameraContent_slide-up__emwO2 .45s ease-in}.CameraContent_content__tDpUr{align-items:center;-webkit-animation:CameraContent_fade-in__9CcEu .15s ease-in;animation:CameraContent_fade-in__9CcEu .15s ease-in;bottom:0;display:flex;flex:1 1;flex-direction:column;justify-content:center;left:0;position:absolute;right:0;top:0}.CameraContent_needHelp__H8Jn7{margin:.6rem 2rem}.CameraContent_ManualCaptureControl__2j2TP{cursor:pointer;padding:20px 20px 30px 30px;position:absolute;right:0;top:0;z-index:1000}.CameraContent_ManualCaptureControl__2j2TP:active div[data-pill]{box-shadow:0 0 1px 5px rgba(250,251,251,.4)!important;transition-duration:.1s;transition-property:box-shadow;transition-timing-function:ease-in-out}.CameraContent_ShutterButton__NI4j0{bottom:0;display:grid;height:110px;left:50%;margin-left:-50px;padding:3px;place-content:center;position:absolute;-webkit-transform:scale(1.3);transform:scale(1.3);-webkit-transform-origin:center;transform-origin:center;width:100px;z-index:1000}.CameraContent_shutterIcon__\+PmVh{-webkit-animation:CameraContent_pop-in__LpNNu .35s ease-in;animation:CameraContent_pop-in__LpNNu .35s ease-in;border:2px solid hsla(0,0%,100%,.8);border-radius:200%;box-shadow:inset 0 0 0 2px rgba(0,0,0,.5),0 0 0 2px rgba(0,0,0,.5),inset 0 0 0 50px hsla(0,0%,100%,.8);box-sizing:border-box;display:inline-block;height:50px;margin:4px;width:50px}@-webkit-keyframes CameraContent_fade-in__9CcEu{0%{opacity:0}to{opacity:1}}@keyframes CameraContent_fade-in__9CcEu{0%{opacity:0}to{opacity:1}}@-webkit-keyframes CameraContent_slide-up__emwO2{0%{-webkit-transform:translate3d(0,3rem,0);transform:translate3d(0,3rem,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@keyframes CameraContent_slide-up__emwO2{0%{-webkit-transform:translate3d(0,3rem,0);transform:translate3d(0,3rem,0)}to{-webkit-transform:translateZ(0);transform:translateZ(0)}}@-webkit-keyframes CameraContent_pop-in__LpNNu{0%{-webkit-transform:scale(.9);transform:scale(.9)}50%{-webkit-transform:scale(1.05);transform:scale(1.05)}to{-webkit-transform:scale(1);transform:scale(1)}}@keyframes CameraContent_pop-in__LpNNu{0%{-webkit-transform:scale(.9);transform:scale(.9)}50%{-webkit-transform:scale(1.05);transform:scale(1.05)}to{-webkit-transform:scale(1);transform:scale(1)}}.FaceGuide_FaceGuide__eYtgr{height:100%;left:15%;opacity:.9;-webkit-perspective:400px;perspective:400px;position:absolute;top:10%;width:100%;z-index:9999}.FaceGuide_face__w2k4P{-webkit-animation-direction:alternate;animation-direction:alternate;-webkit-animation-duration:.55s;animation-duration:.55s;-webkit-animation-iteration-count:infinite;animation-iteration-count:infinite;background:radial-gradient(circle,hsla(0,0%,100%,.2) 0,hsla(0,0%,100%,.3) 50%,rgba(0,0,0,.2) 100%);border:1px solid rgba(0,0,0,.3);border-radius:80% 80% 100% 100%;box-shadow:inset 0 -3px 3px 3px hsla(0,0%,100%,.3);height:50%;left:15%;margin-left:auto;margin-right:auto;position:absolute;top:20%;-webkit-transform:rotate3d(0,0,0);transform:rotate3d(0,0,0);-webkit-transform-origin:50% 55%;transform-origin:50% 55%;-webkit-transform-style:preserve-3d;transform-style:preserve-3d;transition-duration:.3s;transition-property:-webkit-transform;transition-property:transform;transition-property:transform,-webkit-transform;width:40%}.FaceGuide_face__w2k4P[data-side=left]{-webkit-animation-name:FaceGuide_face-left__ZL-hQ;animation-name:FaceGuide_face-left__ZL-hQ;-webkit-transform:rotateY(-30deg);transform:rotateY(-30deg)}@-webkit-keyframes FaceGuide_face-left__ZL-hQ{0%{-webkit-transform:rotateY(-20deg);transform:rotateY(-20deg)}to{-webkit-transform:rotateY(-28deg);transform:rotateY(-28deg)}}@keyframes FaceGuide_face-left__ZL-hQ{0%{-webkit-transform:rotateY(-20deg);transform:rotateY(-20deg)}to{-webkit-transform:rotateY(-28deg);transform:rotateY(-28deg)}}.FaceGuide_face__w2k4P[data-side=front]{-webkit-transform:rotateY(0deg);transform:rotateY(0deg)}.FaceGuide_face__w2k4P[data-side=right]{-webkit-animation-name:FaceGuide_face-right__U-Xt-;animation-name:FaceGuide_face-right__U-Xt-}@-webkit-keyframes FaceGuide_face-right__U-Xt-{0%{-webkit-transform:rotateY(28deg);transform:rotateY(28deg)}to{-webkit-transform:rotateY(30deg);transform:rotateY(30deg)}}@keyframes FaceGuide_face-right__U-Xt-{0%{-webkit-transform:rotateY(28deg);transform:rotateY(28deg)}to{-webkit-transform:rotateY(30deg);transform:rotateY(30deg)}}.FaceGuide_face__w2k4P[data-side=down]{-webkit-animation-name:FaceGuide_face-down__mBZdE;animation-name:FaceGuide_face-down__mBZdE}@-webkit-keyframes FaceGuide_face-down__mBZdE{0%{-webkit-transform:rotateX(-20deg) skewX(-2deg);transform:rotateX(-20deg) skewX(-2deg)}to{-webkit-transform:rotateX(-40deg) skewX(-6deg);transform:rotateX(-40deg) skewX(-6deg)}}@keyframes FaceGuide_face-down__mBZdE{0%{-webkit-transform:rotateX(-20deg) skewX(-2deg);transform:rotateX(-20deg) skewX(-2deg)}to{-webkit-transform:rotateX(-40deg) skewX(-6deg);transform:rotateX(-40deg) skewX(-6deg)}}.FaceGuide_face__w2k4P[data-side=up]{-webkit-animation-name:FaceGuide_face-up__cyoDW;animation-name:FaceGuide_face-up__cyoDW}@-webkit-keyframes FaceGuide_face-up__cyoDW{0%{-webkit-transform:rotateX(20deg) skewX(5deg);transform:rotateX(20deg) skewX(5deg)}to{-webkit-transform:rotateX(28deg) skewX(5deg);transform:rotateX(28deg) skewX(5deg)}}@keyframes FaceGuide_face-up__cyoDW{0%{-webkit-transform:rotateX(20deg) skewX(5deg);transform:rotateX(20deg) skewX(5deg)}to{-webkit-transform:rotateX(28deg) skewX(5deg);transform:rotateX(28deg) skewX(5deg)}}.FaceGuide_face__w2k4P[data-right=front]{-webkit-transform:rotateY(0);transform:rotateY(0)}.FaceGuide_nose__EHTX5{background-color:hsla(0,0%,100%,.1);border-radius:0;border-radius:90% 90% 60% 60%;border-width:3px;box-sizing:border-box;height:20%;left:40%;position:absolute;top:50%;width:20%}.FaceGuide_eye__H1vmS{border:3px solid #aaa;border-radius:100%;height:10%;left:0;position:absolute;top:0;width:20%}.FaceGuide_eye__H1vmS:after{border-radius:100%;border-top:3px solid #ccc;content:"";height:10px;left:0;position:absolute;top:-8px;width:100%}.FaceGuide_eye1__R4R3L{left:15%;top:35%}.FaceGuide_eye2__\+wjYR{left:55%;top:35%}.SuccessPage_SuccessPage__\+PYCL{align-items:center;box-sizing:border-box;display:flex;flex:1 1;flex-direction:column;height:100%;justify-content:center;line-height:180%;margin:auto;padding:2rem;text-align:center;width:100%}
/*# sourceMappingURL=main.20f93cc8.css.map*/

</style>